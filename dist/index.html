<!doctype html>
<html data-n-head-ssr>
  <head>
    <link rel="preload" href="/_nuxt/f62ea000a860f007d223.js" as="script"><link rel="preload" href="/_nuxt/aba86204b870b3f85761.js" as="script"><link rel="preload" href="/_nuxt/539483b3328220de0cef.js" as="script"><link rel="preload" href="/_nuxt/61a4f66024b75752c21d.js" as="script"><style data-vue-ssr-id="47712f1a:0 3191d5ad:0">a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}table{border-collapse:collapse;border-spacing:0}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;-webkit-transition:width .1s,opacity .4s;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{-webkit-transition:none;transition:none}.nuxt-progress-failed{background-color:red}</style>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div data-v-30c2fd22><pre data-v-30c2fd22>[
  {
    "rendered_body": "&lt;p>記事を書いているときに参考にしたウェブページを掲載しますが、タイトルのコピーが厄介です。&lt;/p>\n\n&lt;p>そんなときのために、表示しているページのタイトルをコピーするブックマークレットをご紹介します。&lt;/p>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"p\">(()&lt;/span> &lt;span class=\"o\">=&ampgt;&lt;/span> &lt;span class=\"p\">{&lt;/span>\n  &lt;span class=\"c1\">// タイトルを参照&lt;/span>\n  &lt;span class=\"kd\">const&lt;/span> &lt;span class=\"nx\">title&lt;/span> &lt;span class=\"o\">=&lt;/span> &lt;span class=\"nb\">document&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">title&lt;/span>&lt;span class=\"p\">;&lt;/span>\n\n  &lt;span class=\"c1\">// コピーの元にするtextareaを作成&lt;/span>\n  &lt;span class=\"kd\">const&lt;/span> &lt;span class=\"nx\">textarea&lt;/span> &lt;span class=\"o\">=&lt;/span> &lt;span class=\"nb\">document&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">createElement&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">textarea&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"p\">);&lt;/span>\n  &lt;span class=\"nx\">textarea&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">textContent&lt;/span> &lt;span class=\"o\">=&lt;/span> &lt;span class=\"nx\">title&lt;/span>&lt;span class=\"p\">;&lt;/span>\n\n  &lt;span class=\"c1\">// bodyタグの最後にtextareaを追加&lt;/span>\n  &lt;span class=\"nb\">document&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">body&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">appendChild&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">textarea&lt;/span>&lt;span class=\"p\">);&lt;/span>\n\n  &lt;span class=\"c1\">// textareaの内容をクリップボードにコピー&lt;/span>\n  &lt;span class=\"nx\">textarea&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">select&lt;/span>&lt;span class=\"p\">();&lt;/span>\n  &lt;span class=\"nb\">document&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">execCommand&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">copy&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"p\">);&lt;/span>\n\n  &lt;span class=\"c1\">// 最初に作成したtextareaをbodyから削除&lt;/span>\n  &lt;span class=\"nb\">document&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">body&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">removeChild&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">textarea&lt;/span>&lt;span class=\"p\">);&lt;/span>\n\n  &lt;span class=\"nx\">console&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">log&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"s2\">`Copyed this website title \"&lt;/span>&lt;span class=\"p\">${&lt;/span>&lt;span class=\"nx\">title&lt;/span>&lt;span class=\"p\">}&lt;/span>&lt;span class=\"s2\">\"`&lt;/span>&lt;span class=\"p\">);&lt;/span>\n&lt;span class=\"p\">})();&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;p>Minified:&lt;/p>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"p\">(()&lt;/span>&lt;span class=\"o\">=&ampgt;&lt;/span>&lt;span class=\"p\">{&lt;/span>&lt;span class=\"kd\">const&lt;/span> &lt;span class=\"nx\">e&lt;/span>&lt;span class=\"o\">=&lt;/span>&lt;span class=\"nb\">document&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">title&lt;/span>&lt;span class=\"p\">,&lt;/span>&lt;span class=\"nx\">t&lt;/span>&lt;span class=\"o\">=&lt;/span>&lt;span class=\"nb\">document&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">createElement&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"dl\">\"&lt;/span>&lt;span class=\"s2\">textarea&lt;/span>&lt;span class=\"dl\">\"&lt;/span>&lt;span class=\"p\">);&lt;/span>&lt;span class=\"nx\">t&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">textContent&lt;/span>&lt;span class=\"o\">=&lt;/span>&lt;span class=\"nx\">e&lt;/span>&lt;span class=\"p\">,&lt;/span>&lt;span class=\"nb\">document&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">body&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">appendChild&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">t&lt;/span>&lt;span class=\"p\">),&lt;/span>&lt;span class=\"nx\">t&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">select&lt;/span>&lt;span class=\"p\">(),&lt;/span>&lt;span class=\"nb\">document&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">execCommand&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"dl\">\"&lt;/span>&lt;span class=\"s2\">copy&lt;/span>&lt;span class=\"dl\">\"&lt;/span>&lt;span class=\"p\">),&lt;/span>&lt;span class=\"nb\">document&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">body&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">removeChild&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">t&lt;/span>&lt;span class=\"p\">),&lt;/span>&lt;span class=\"nx\">console&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">log&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"s2\">`Copyed this website title \"&lt;/span>&lt;span class=\"p\">${&lt;/span>&lt;span class=\"nx\">e&lt;/span>&lt;span class=\"p\">}&lt;/span>&lt;span class=\"s2\">\"`&lt;/span>&lt;span class=\"p\">)})();&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;p>使い方：&lt;/p>\n\n&lt;p>冒頭に&lt;code>javascript:&lt;/code>をつけてブックマークに保存してください。あとは、登録したブックマークを実行したらタイトルがコピーできるようになります。&lt;/p>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"nx\">javascript&lt;/span>&lt;span class=\"p\">(()&lt;/span>&lt;span class=\"o\">=&ampgt;&lt;/span>&lt;span class=\"p\">{&lt;/span>&lt;span class=\"kd\">const&lt;/span>&lt;span class=\"p\">...});&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n",
    "body": "記事を書いているときに参考にしたウェブページを掲載しますが、タイトルのコピーが厄介です。\n\nそんなときのために、表示しているページのタイトルをコピーするブックマークレットをご紹介します。\n\n```ts\n(() => {\n  // タイトルを参照\n  const title = document.title;\n\n  // コピーの元にするtextareaを作成\n  const textarea = document.createElement('textarea');\n  textarea.textContent = title;\n\n  // bodyタグの最後にtextareaを追加\n  document.body.appendChild(textarea);\n  \n  // textareaの内容をクリップボードにコピー\n  textarea.select();\n  document.execCommand('copy');\n\n  // 最初に作成したtextareaをbodyから削除\n  document.body.removeChild(textarea);\n\n  console.log(`Copyed this website title \"${title}\"`);\n})();\n```\n\nMinified:\n\n```ts\n(()=>{const e=document.title,t=document.createElement(\"textarea\");t.textContent=e,document.body.appendChild(t),t.select(),document.execCommand(\"copy\"),document.body.removeChild(t),console.log(`Copyed this website title \"${e}\"`)})();\n```\n\n使い方：\n\n冒頭に`javascript:`をつけてブックマークに保存してください。あとは、登録したブックマークを実行したらタイトルがコピーできるようになります。\n\n```ts\njavascript(()=>{const...});\n```\n",
    "coediting": false,
    "comments_count": 0,
    "created_at": "2019-10-17T21:35:57+09:00",
    "group": null,
    "id": "234c2a8203ac951bef19",
    "likes_count": 0,
    "private": false,
    "reactions_count": 0,
    "tags": [
      {
        "name": "bookmarklet",
        "versions": []
      }
    ],
    "title": "見ているサイトのタイトルをコピーするブックマークレット",
    "updated_at": "2019-10-17T21:35:57+09:00",
    "url": "https://qiita.com/simochee/items/234c2a8203ac951bef19",
    "user": {
      "description": "Nuxt & TypeScript大好きマンです",
      "facebook_id": "",
      "followees_count": 9,
      "followers_count": 14,
      "github_login_name": "tamuraryoya",
      "id": "simochee",
      "items_count": 27,
      "linkedin_id": "",
      "location": "Chiba, Japan",
      "name": "",
      "organization": "",
      "permanent_id": 127934,
      "profile_image_url": "https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/profile-images/1558357993",
      "team_only": false,
      "twitter_screen_name": "lollipop_onl",
      "website_url": ""
    },
    "page_views_count": null
  },
  {
    "rendered_body": "\n&lt;h1>\n&lt;span id=\"はじめに\" class=\"fragment\">&lt;/span>&lt;a href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>はじめに&lt;/h1>\n\n&lt;p>せっかくTypeScriptを使っているのだから、&lt;code>Vue.set&lt;/code>も型安全にしたい！と、誰しも一度は考えたことがあるのではないでしょうか？&lt;/p>\n\n&lt;p>この記事では、過程とともに&lt;code>Vue.set&lt;/code>を型安全にする実装をご紹介します。&lt;/p>\n\n&lt;h1>\n&lt;span id=\"tldr\" class=\"fragment\">&lt;/span>&lt;a href=\"#tldr\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>TL;DR&lt;/h1>\n\n&lt;p>&lt;details>&lt;summary>最終的なコード&lt;/summary>&lt;br>\n&lt;p>&lt;/p>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"nx\">Vue&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">typedSet&lt;/span> &lt;span class=\"o\">=&lt;/span> &lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">any&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">key&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">any&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">value&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">any&lt;/span>&lt;span class=\"p\">)&lt;/span> &lt;span class=\"o\">=&ampgt;&lt;/span> &lt;span class=\"nx\">Vue&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"kd\">set&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">key&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">value&lt;/span>&lt;span class=\"p\">);&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"c1\">// src/@types/vue.d.ts&lt;/span>\n&lt;span class=\"k\">import&lt;/span> &lt;span class=\"nx\">Vue&lt;/span> &lt;span class=\"k\">from&lt;/span> &lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">vue&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"p\">;&lt;/span>\n\n&lt;span class=\"nx\">declare&lt;/span> &lt;span class=\"nx\">module&lt;/span> &lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">vue/types/vue&lt;/span>&lt;span class=\"dl\">'&lt;/span> &lt;span class=\"p\">{&lt;/span>\n  &lt;span class=\"kr\">interface&lt;/span> &lt;span class=\"nx\">VueConstructor&lt;/span> &lt;span class=\"p\">{&lt;/span>\n    &lt;span class=\"nx\">typedSet&lt;/span>&lt;span class=\"o\">&amplt;&lt;/span>&lt;span class=\"nx\">T&lt;/span> &lt;span class=\"kd\">extends&lt;/span> &lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">K&lt;/span> &lt;span class=\"kd\">extends&lt;/span> &lt;span class=\"nx\">keyof&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"o\">&ampgt;&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">key&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">value&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">[&lt;/span>&lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">]):&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">[&lt;/span>&lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">];&lt;/span>\n  &lt;span class=\"p\">}&lt;/span>\n&lt;span class=\"p\">}&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;p>&lt;/p>\n&lt;br>\n&lt;/details>&lt;/p>\n\n&lt;h1>\n&lt;span id=\"vuesetの型\" class=\"fragment\">&lt;/span>&lt;a href=\"#vueset%E3%81%AE%E5%9E%8B\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>&lt;code>Vue.set&lt;/code>の型&lt;/h1>\n\n&lt;p>&lt;code>Vue.set&lt;/code>の型は&lt;code>vue/types/vue.d.ts&lt;/code>に以下のように定義されています。&lt;/p>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>  &lt;span class=\"kd\">set&lt;/span>&lt;span class=\"o\">&amplt;&lt;/span>&lt;span class=\"nx\">T&lt;/span>&lt;span class=\"o\">&ampgt;&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">key&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">string&lt;/span> &lt;span class=\"o\">|&lt;/span> &lt;span class=\"nx\">number&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">value&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">):&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">;&lt;/span>\n  &lt;span class=\"kd\">set&lt;/span>&lt;span class=\"o\">&amplt;&lt;/span>&lt;span class=\"nx\">T&lt;/span>&lt;span class=\"o\">&ampgt;&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">array&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">[],&lt;/span> &lt;span class=\"nx\">key&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">number&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">value&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">):&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">;&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;p>配列の場合は問題ないのですが、オブジェクトの値は本来の型とは異なるものを設定できてしまいます。&lt;/p>\n\n&lt;p>これは良くない、ということで型安全にする手立てを考えてみましょう。&lt;/p>\n\n&lt;h1>\n&lt;span id=\"型安全なvuesetの型を考える\" class=\"fragment\">&lt;/span>&lt;a href=\"#%E5%9E%8B%E5%AE%89%E5%85%A8%E3%81%AAvueset%E3%81%AE%E5%9E%8B%E3%82%92%E8%80%83%E3%81%88%E3%82%8B\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>型安全な&lt;code>Vue.set&lt;/code>の型を考える&lt;/h1>\n\n&lt;p>まずは、型安全な&lt;code>Vue.set&lt;/code>がどのようなものかを考えてみましょう。&lt;/p>\n\n&lt;p>第２引数は第１引数で取りうるKeyを指定でき、第３引数では第2引数で指定した第１引数のKeyの値と同じ型を指定することができる、ということになります。&lt;/p>\n\n&lt;p>これを型定義に書き起こすと、以下のようになります。&lt;/p>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>  &lt;span class=\"kd\">set&lt;/span>&lt;span class=\"o\">&amplt;&lt;/span>&lt;span class=\"nx\">T&lt;/span> &lt;span class=\"kd\">extends&lt;/span> &lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">K&lt;/span> &lt;span class=\"kd\">extends&lt;/span> &lt;span class=\"nx\">keyof&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"o\">&ampgt;&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">key&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">value&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">[&lt;/span>&lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">]):&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">[&lt;/span>&lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">];&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;p>これ１つで配列もオブジェクトもOKなSetメソッドの型を定義することができました。&lt;/p>\n\n&lt;h1>\n&lt;span id=\"vueconstructorへの型指定\" class=\"fragment\">&lt;/span>&lt;a href=\"#vueconstructor%E3%81%B8%E3%81%AE%E5%9E%8B%E6%8C%87%E5%AE%9A\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>&lt;code>VueConstructor&lt;/code>への型指定&lt;/h1>\n\n&lt;p>&lt;code>Vue.set&lt;/code>の型が定義されている&lt;code>vue/types/vue.d.ts&lt;/code>の&lt;code>VueConstructor&lt;/code>を拡張しましょう。&lt;/p>\n\n&lt;p>TypeScriptでは対象範囲全ての&lt;code>@types&lt;/code>以下の型定義ファイルを自動でコンパイルに含めてくれます。&lt;br>\n今回は&lt;code>src/@types/&lt;/code>以下に&lt;code>vue.d.ts&lt;/code>という型定義ファイルを作成しました。&lt;/p>\n\n&lt;p>この中に、&lt;code>VueConstructor&lt;/code>を拡張するような型定義を書いてみましょう。&lt;/p>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"c1\">// src/@types/vue.d.ts&lt;/span>\n&lt;span class=\"k\">import&lt;/span> &lt;span class=\"nx\">Vue&lt;/span> &lt;span class=\"k\">from&lt;/span> &lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">vue&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"p\">;&lt;/span>\n\n&lt;span class=\"nx\">declare&lt;/span> &lt;span class=\"nx\">module&lt;/span> &lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">vue/types/vue&lt;/span>&lt;span class=\"dl\">'&lt;/span> &lt;span class=\"p\">{&lt;/span>\n  &lt;span class=\"kr\">interface&lt;/span> &lt;span class=\"nx\">VueConstructor&lt;/span> &lt;span class=\"p\">{&lt;/span>\n    &lt;span class=\"kd\">set&lt;/span>&lt;span class=\"o\">&amplt;&lt;/span>&lt;span class=\"nx\">T&lt;/span> &lt;span class=\"kd\">extends&lt;/span> &lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">K&lt;/span> &lt;span class=\"kd\">extends&lt;/span> &lt;span class=\"nx\">keyof&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"o\">&ampgt;&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">key&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">value&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">[&lt;/span>&lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">]):&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">[&lt;/span>&lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">];&lt;/span>\n  &lt;span class=\"p\">}&lt;/span>\n&lt;span class=\"p\">}&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;p>&lt;code>declare module&lt;/code>は続くモジュール名（今回の場合は&lt;code>node_modules/vue&lt;/code>以下の&lt;code>types/vue.d.ts&lt;/code>を指定）の内部を拡張することができます。&lt;br>\n&lt;code>declare module 'vue/types/vue' { ... }&lt;/code>の&lt;code>{ ... }&lt;/code>内は&lt;code>vue/types/vue.d.ts&lt;/code>で&lt;code>export&lt;/code>されているインターフェースをオーバーライドすることができます。&lt;/p>\n\n&lt;h1>\n&lt;span id=\"使ってみた\" class=\"fragment\">&lt;/span>&lt;a href=\"#%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>使ってみた&lt;/h1>\n\n&lt;p>これで、&lt;code>Vue.set&lt;/code>をタイプセーフに拡張できました。試してみましょう。&lt;/p>\n\n&lt;p>&lt;a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fa1094d7b-132c-344f-839e-65d5086534ee.png?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;s=4a8a475de3085bbada26d56fa83a36fa\" target=\"_blank\" rel=\"nofollow noopener\">&lt;img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fa1094d7b-132c-344f-839e-65d5086534ee.png?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;s=4a8a475de3085bbada26d56fa83a36fa\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/a1094d7b-132c-344f-839e-65d5086534ee.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fa1094d7b-132c-344f-839e-65d5086534ee.png?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;w=1400&ampamp;fit=max&ampamp;s=99e970267021d8181cf8cac78a40e30d 1x\" loading=\"lazy\">&lt;/a>&lt;/p>\n\n&lt;p>キーは補完されるようになりました！続いて不正な値を設定してみましょう！&lt;/p>\n\n&lt;p>&lt;a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Ffc37302d-338d-03b7-fc2f-62dd699e3f72.png?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;s=24dc3a0b7d28a063f3d4325b7b8f5666\" target=\"_blank\" rel=\"nofollow noopener\">&lt;img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Ffc37302d-338d-03b7-fc2f-62dd699e3f72.png?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;s=24dc3a0b7d28a063f3d4325b7b8f5666\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/fc37302d-338d-03b7-fc2f-62dd699e3f72.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Ffc37302d-338d-03b7-fc2f-62dd699e3f72.png?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;w=1400&ampamp;fit=max&ampamp;s=65197acc5e82c37e260f820889db0fcf 1x\" loading=\"lazy\">&lt;/a>&lt;/p>\n\n&lt;p>おやおや・・・&lt;code>obj.foo&lt;/code>は文字列なのに&lt;code>0&lt;/code>を設定できてしまいました。これはいけない。&lt;/p>\n\n&lt;h2>\n&lt;span id=\"不正な型を設定できる理由\" class=\"fragment\">&lt;/span>&lt;a href=\"#%E4%B8%8D%E6%AD%A3%E3%81%AA%E5%9E%8B%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%A7%E3%81%8D%E3%82%8B%E7%90%86%E7%94%B1\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>不正な型を設定できる理由&lt;/h2>\n\n&lt;p>TypeScriptのインターフェース拡張は「すでにある定義を壊さない形での拡張」のみが許されます。&lt;br>\nさらに、関数の場合は引数の数が同じ定義の関数があればチェック対象となります。&lt;/p>\n\n&lt;p>つまりこの事象は、型安全な方の型チェックに引っかかったけど、後続の型安全でない方の型チェックがパスしたからOK、みたいな挙動になってしまっているわけです。&lt;/p>\n\n&lt;p>ということで、純粋に&lt;code>Vue.set&lt;/code>を拡張するだけでは元の定義が後に控えているためあまり意味がありません。&lt;/p>\n\n&lt;h1>\n&lt;span id=\"後続の型定義を参照させないようにする\" class=\"fragment\">&lt;/span>&lt;a href=\"#%E5%BE%8C%E7%B6%9A%E3%81%AE%E5%9E%8B%E5%AE%9A%E7%BE%A9%E3%82%92%E5%8F%82%E7%85%A7%E3%81%95%E3%81%9B%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>後続の型定義を参照させないようにする&lt;/h1>\n\n&lt;p>TypeScriptで後続の型定義を探す条件は「全く同じ定義の型」に限られます。&lt;/p>\n\n&lt;p>以下のような型定義の場合は&lt;code>fn()&lt;/code>は引数さえあれば型エラーになりません。&lt;/p>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"kr\">interface&lt;/span> &lt;span class=\"nx\">Sample&lt;/span> &lt;span class=\"p\">{&lt;/span>\n  &lt;span class=\"nx\">fn&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">foo&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">string&lt;/span>&lt;span class=\"p\">)&lt;/span> &lt;span class=\"o\">=&ampgt;&lt;/span> &lt;span class=\"k\">void&lt;/span>&lt;span class=\"p\">;&lt;/span>\n  &lt;span class=\"nx\">fn&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">bar&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">any&lt;/span>&lt;span class=\"p\">)&lt;/span> &lt;span class=\"o\">=&ampgt;&lt;/span> &lt;span class=\"k\">void&lt;/span>&lt;span class=\"p\">;&lt;/span>\n&lt;span class=\"p\">}&lt;/span>\n\n&lt;span class=\"nx\">fn&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">a&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"p\">);&lt;/span>\n&lt;span class=\"nx\">fn&lt;/span>&lt;span class=\"p\">({});&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;p>これに第２引数のあるメソッドを追加してみると、正しく型チェックが行われるようになります。当然といえば当然ですね。&lt;/p>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"kr\">interface&lt;/span> &lt;span class=\"nx\">Sample&lt;/span> &lt;span class=\"p\">{&lt;/span>\n  &lt;span class=\"nx\">fn&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">baz&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">string&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">qux&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">number&lt;/span>&lt;span class=\"p\">)&lt;/span> &lt;span class=\"o\">=&ampgt;&lt;/span> &lt;span class=\"k\">void&lt;/span>&lt;span class=\"p\">;&lt;/span>\n  &lt;span class=\"nx\">fn&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">foo&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">string&lt;/span>&lt;span class=\"p\">)&lt;/span> &lt;span class=\"o\">=&ampgt;&lt;/span> &lt;span class=\"k\">void&lt;/span>&lt;span class=\"p\">;&lt;/span>\n  &lt;span class=\"nx\">fn&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">bar&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">any&lt;/span>&lt;span class=\"p\">)&lt;/span> &lt;span class=\"o\">=&ampgt;&lt;/span> &lt;span class=\"k\">void&lt;/span>&lt;span class=\"p\">;&lt;/span>\n&lt;span class=\"p\">}&lt;/span>\n\n&lt;span class=\"nx\">fn&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">a&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"mi\">0&lt;/span>&lt;span class=\"p\">);&lt;/span> &lt;span class=\"c1\">// OK&lt;/span>\n&lt;span class=\"nx\">fn&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"mi\">0&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"mi\">0&lt;/span>&lt;span class=\"p\">);&lt;/span>   &lt;span class=\"c1\">// Error&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;p>つまり、引数の数を増やせば、後続の型定義を参照させずに済むということです。&lt;br>\nこれを&lt;del>悪用&lt;/del>利用して、型定義上だけ、フラグを追加してみます。&lt;/p>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"c1\">// src/@types/vue.d.ts&lt;/span>\n&lt;span class=\"k\">import&lt;/span> &lt;span class=\"nx\">Vue&lt;/span> &lt;span class=\"k\">from&lt;/span> &lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">vue&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"p\">;&lt;/span>\n\n&lt;span class=\"nx\">declare&lt;/span> &lt;span class=\"nx\">module&lt;/span> &lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">vue/types/vue&lt;/span>&lt;span class=\"dl\">'&lt;/span> &lt;span class=\"p\">{&lt;/span>\n  &lt;span class=\"kr\">interface&lt;/span> &lt;span class=\"nx\">VueConstructor&lt;/span> &lt;span class=\"p\">{&lt;/span>\n    &lt;span class=\"kd\">set&lt;/span>&lt;span class=\"o\">&amplt;&lt;/span>&lt;span class=\"nx\">T&lt;/span> &lt;span class=\"kd\">extends&lt;/span> &lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">K&lt;/span> &lt;span class=\"kd\">extends&lt;/span> &lt;span class=\"nx\">keyof&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"o\">&ampgt;&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">key&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">value&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">[&lt;/span>&lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">],&lt;/span> &lt;span class=\"nx\">isTyped&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"kc\">true&lt;/span>&lt;span class=\"p\">):&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">[&lt;/span>&lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">];&lt;/span>\n  &lt;span class=\"p\">}&lt;/span>\n&lt;span class=\"p\">}&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;p>これで、第4引数に&lt;code>true&lt;/code>が渡された場合は型安全な&lt;code>Vue.set&lt;/code>を利用することができるようになります。&lt;/p>\n\n&lt;p>&lt;a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F4c93f1fb-b024-3bb5-6237-15e9dea2175c.png?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;s=5ffc9df69a13726a1f1c6d3555477463\" target=\"_blank\" rel=\"nofollow noopener\">&lt;img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F4c93f1fb-b024-3bb5-6237-15e9dea2175c.png?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;s=5ffc9df69a13726a1f1c6d3555477463\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/4c93f1fb-b024-3bb5-6237-15e9dea2175c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F4c93f1fb-b024-3bb5-6237-15e9dea2175c.png?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;w=1400&ampamp;fit=max&ampamp;s=d5cb5c7cc09ae1efe9836144b2e36602 1x\" loading=\"lazy\">&lt;/a>&lt;/p>\n\n&lt;p>先程の例でも文字列以外は設定できなくなりました。&lt;/p>\n\n&lt;hr>\n\n&lt;p>で、終わってしまいたかったのですが、いつか本当に&lt;code>Vue.set&lt;/code>の第4引数にフラグが追加されてしまったときにこの型定義では困ります。&lt;br>\nまた、まやかしの型定義はそれ自体が黒魔術なのであまり胸を張って使えるものではありませんね。&lt;/p>\n\n&lt;p>代案を考えましょう。&lt;/p>\n\n&lt;h1>\n&lt;span id=\"vuetypedsetを実装する\" class=\"fragment\">&lt;/span>&lt;a href=\"#vuetypedset%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>&lt;code>Vue.typedSet&lt;/code>を実装する&lt;/h1>\n\n&lt;p>&lt;code>Vue.set&lt;/code>の拡張は厳しそうです。&lt;br>\nならばいっそ、&lt;code>Vue.typedSet&lt;/code>という新しいグローバルメソッドを定義してしまいましょう。&lt;/p>\n\n&lt;p>Vueのグローバルメソッドの追加は簡単で、&lt;code>Vue.newGlobalMethod = Function&lt;/code>のようにVueにプロパティを生やすだけです。&lt;/p>\n\n&lt;p>&lt;code>Vue.typedSet&lt;/code>は&lt;code>Vue.set&lt;/code>のエイリアスで良いので、実装自体は以下のようになります。&lt;/p>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"nx\">Vue&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">typedSet&lt;/span> &lt;span class=\"o\">=&lt;/span> &lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">any&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">key&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">any&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">value&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">any&lt;/span>&lt;span class=\"p\">)&lt;/span> &lt;span class=\"o\">=&ampgt;&lt;/span> &lt;span class=\"nx\">Vue&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"kd\">set&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">key&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">value&lt;/span>&lt;span class=\"p\">);&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;p>もし、Nuxtを使用しているのなら、プラグインを定義してこれをサーバー・クライアント双方で呼び出すようにしておけば問題ないでしょう。&lt;/p>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"c1\">// @/plugins/vue-typedSet.ts`&lt;/span>\n&lt;span class=\"k\">import&lt;/span> &lt;span class=\"p\">{&lt;/span> &lt;span class=\"nx\">Plugin&lt;/span> &lt;span class=\"p\">}&lt;/span> &lt;span class=\"k\">from&lt;/span> &lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">@nuxt/types&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"p\">;&lt;/span>\n\n&lt;span class=\"kd\">const&lt;/span> &lt;span class=\"nx\">plugin&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">Plugin&lt;/span> &lt;span class=\"o\">=&lt;/span> &lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">context&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">inject&lt;/span>&lt;span class=\"p\">)&lt;/span> &lt;span class=\"o\">=&ampgt;&lt;/span> &lt;span class=\"p\">{&lt;/span>\n  &lt;span class=\"nx\">Vue&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">typedSet&lt;/span> &lt;span class=\"o\">=&lt;/span> &lt;span class=\"p\">(&lt;/span>&lt;span class=\"na\">object&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">any&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"na\">key&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">any&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"na\">value&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">any&lt;/span>&lt;span class=\"p\">)&lt;/span> &lt;span class=\"o\">=&ampgt;&lt;/span> &lt;span class=\"nx\">Vue&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"kd\">set&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">key&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">value&lt;/span>&lt;span class=\"p\">);&lt;/span>\n&lt;span class=\"p\">});&lt;/span>\n\n&lt;span class=\"k\">export&lt;/span> &lt;span class=\"k\">default&lt;/span> &lt;span class=\"nx\">plugin&lt;/span>&lt;span class=\"p\">;&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;p>最後に、先程拡張した型定義のメソッド名を&lt;code>typedSet&lt;/code>に変更しましょう。&lt;/p>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"c1\">// src/@types/vue.d.ts&lt;/span>\n&lt;span class=\"k\">import&lt;/span> &lt;span class=\"nx\">Vue&lt;/span> &lt;span class=\"k\">from&lt;/span> &lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">vue&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"p\">;&lt;/span>\n\n&lt;span class=\"nx\">declare&lt;/span> &lt;span class=\"nx\">module&lt;/span> &lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">vue/types/vue&lt;/span>&lt;span class=\"dl\">'&lt;/span> &lt;span class=\"p\">{&lt;/span>\n  &lt;span class=\"kr\">interface&lt;/span> &lt;span class=\"nx\">VueConstructor&lt;/span> &lt;span class=\"p\">{&lt;/span>\n    &lt;span class=\"nx\">typedSet&lt;/span>&lt;span class=\"o\">&amplt;&lt;/span>&lt;span class=\"nx\">T&lt;/span> &lt;span class=\"kd\">extends&lt;/span> &lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">K&lt;/span> &lt;span class=\"kd\">extends&lt;/span> &lt;span class=\"nx\">keyof&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"o\">&ampgt;&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">object&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">key&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"nx\">value&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">[&lt;/span>&lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">]):&lt;/span> &lt;span class=\"nx\">T&lt;/span>&lt;span class=\"p\">[&lt;/span>&lt;span class=\"nx\">K&lt;/span>&lt;span class=\"p\">];&lt;/span>\n  &lt;span class=\"p\">}&lt;/span>\n&lt;span class=\"p\">}&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;p>新しいメソッドを定義してしまいましたが、これで型安全に&lt;code>Vue.set&lt;/code>できるようになりました！&lt;/p>\n\n&lt;p>&lt;a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fee193bab-eb63-b419-321e-03a5acf036a3.png?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;s=3d8c6f20c6aed221bf04de2a7aa24bc7\" target=\"_blank\" rel=\"nofollow noopener\">&lt;img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fee193bab-eb63-b419-321e-03a5acf036a3.png?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;s=3d8c6f20c6aed221bf04de2a7aa24bc7\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/ee193bab-eb63-b419-321e-03a5acf036a3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fee193bab-eb63-b419-321e-03a5acf036a3.png?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;w=1400&ampamp;fit=max&ampamp;s=de157df47691460ff48fb65bb1f35e45 1x\" loading=\"lazy\">&lt;/a>&lt;/p>\n\n&lt;p>めでたしめでたし。&lt;/p>\n\n&lt;h1>\n&lt;span id=\"参考\" class=\"fragment\">&lt;/span>&lt;a href=\"#%E5%8F%82%E8%80%83\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>参考&lt;/h1>\n\n&lt;ul>\n&lt;li>&lt;a href=\"https://012-jp.vuejs.org/guide/extending.html\" rel=\"nofollow noopener\" target=\"_blank\">Vue の拡張 - vue.js&lt;/a>&lt;/li>\n&lt;li>&lt;a href=\"https://qiita.com/ka_/items/3727c3f16dc69fed935c\" id=\"reference-3738486528aa53033812\">foo, bar, baz の続き - Qiita&lt;/a>&lt;/li>\n&lt;/ul>\n",
    "body": "# はじめに\n\nせっかくTypeScriptを使っているのだから、`Vue.set`も型安全にしたい！と、誰しも一度は考えたことがあるのではないでしょうか？\n\nこの記事では、過程とともに`Vue.set`を型安全にする実装をご紹介します。\n\n# TL;DR\n\n&lt;details>&lt;summary>最終的なコード&lt;/summary>\n&lt;p>\n\n```ts\nVue.typedSet = (object: any, key: any, value: any) => Vue.set(object, key, value);\n```\n\n```ts\n// src/@types/vue.d.ts\nimport Vue from 'vue';\n\ndeclare module 'vue/types/vue' {\n  interface VueConstructor {\n    typedSet&lt;T extends object, K extends keyof T>(object: T, key: K, value: T[K]): T[K];\n  }\n}\n```\n\n&lt;/p>\n&lt;/details>\n\n\n# `Vue.set`の型\n\n`Vue.set`の型は`vue/types/vue.d.ts`に以下のように定義されています。\n\n```ts\n  set&lt;T>(object: object, key: string | number, value: T): T;\n  set&lt;T>(array: T[], key: number, value: T): T;\n```\n\n配列の場合は問題ないのですが、オブジェクトの値は本来の型とは異なるものを設定できてしまいます。\n\nこれは良くない、ということで型安全にする手立てを考えてみましょう。\n\n# 型安全な`Vue.set`の型を考える\n\nまずは、型安全な`Vue.set`がどのようなものかを考えてみましょう。\n\n第２引数は第１引数で取りうるKeyを指定でき、第３引数では第2引数で指定した第１引数のKeyの値と同じ型を指定することができる、ということになります。\n\nこれを型定義に書き起こすと、以下のようになります。\n\n```ts\n  set&lt;T extends object, K extends keyof T>(object: T, key: K, value: T[K]): T[K];\n```\n\nこれ１つで配列もオブジェクトもOKなSetメソッドの型を定義することができました。\n\n# `VueConstructor`への型指定\n\n`Vue.set`の型が定義されている`vue/types/vue.d.ts`の`VueConstructor`を拡張しましょう。\n\nTypeScriptでは対象範囲全ての`@types`以下の型定義ファイルを自動でコンパイルに含めてくれます。\n今回は`src/@types/`以下に`vue.d.ts`という型定義ファイルを作成しました。\n\nこの中に、`VueConstructor`を拡張するような型定義を書いてみましょう。\n\n```ts\n// src/@types/vue.d.ts\nimport Vue from 'vue';\n\ndeclare module 'vue/types/vue' {\n  interface VueConstructor {\n    set&lt;T extends object, K extends keyof T>(object: T, key: K, value: T[K]): T[K];\n  }\n}\n```\n\n`declare module`は続くモジュール名（今回の場合は`node_modules/vue`以下の`types/vue.d.ts`を指定）の内部を拡張することができます。\n`declare module 'vue/types/vue' { ... }`の`{ ... }`内は`vue/types/vue.d.ts`で`export`されているインターフェースをオーバーライドすることができます。\n\n# 使ってみた\n\nこれで、`Vue.set`をタイプセーフに拡張できました。試してみましょう。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/a1094d7b-132c-344f-839e-65d5086534ee.png)\n\nキーは補完されるようになりました！続いて不正な値を設定してみましょう！\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/fc37302d-338d-03b7-fc2f-62dd699e3f72.png)\n\nおやおや・・・`obj.foo`は文字列なのに`0`を設定できてしまいました。これはいけない。\n\n## 不正な型を設定できる理由\n\nTypeScriptのインターフェース拡張は「すでにある定義を壊さない形での拡張」のみが許されます。\nさらに、関数の場合は引数の数が同じ定義の関数があればチェック対象となります。\n\nつまりこの事象は、型安全な方の型チェックに引っかかったけど、後続の型安全でない方の型チェックがパスしたからOK、みたいな挙動になってしまっているわけです。\n\nということで、純粋に`Vue.set`を拡張するだけでは元の定義が後に控えているためあまり意味がありません。\n\n# 後続の型定義を参照させないようにする\n\nTypeScriptで後続の型定義を探す条件は「全く同じ定義の型」に限られます。\n\n以下のような型定義の場合は`fn()`は引数さえあれば型エラーになりません。\n\n```ts\ninterface Sample {\n  fn(foo: string) => void;\n  fn(bar: any) => void;\n}\n\nfn('a');\nfn({});\n```\n\nこれに第２引数のあるメソッドを追加してみると、正しく型チェックが行われるようになります。当然といえば当然ですね。\n\n```ts\ninterface Sample {\n  fn(baz: string, qux: number) => void;\n  fn(foo: string) => void;\n  fn(bar: any) => void;\n}\n\nfn('a', 0); // OK\nfn(0, 0);   // Error\n```\n\nつまり、引数の数を増やせば、後続の型定義を参照させずに済むということです。\nこれを~~悪用~~利用して、型定義上だけ、フラグを追加してみます。\n\n```ts\n// src/@types/vue.d.ts\nimport Vue from 'vue';\n\ndeclare module 'vue/types/vue' {\n  interface VueConstructor {\n    set&lt;T extends object, K extends keyof T>(object: T, key: K, value: T[K], isTyped: true): T[K];\n  }\n}\n```\n\nこれで、第4引数に`true`が渡された場合は型安全な`Vue.set`を利用することができるようになります。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/4c93f1fb-b024-3bb5-6237-15e9dea2175c.png)\n\n先程の例でも文字列以外は設定できなくなりました。\n\n---\n\nで、終わってしまいたかったのですが、いつか本当に`Vue.set`の第4引数にフラグが追加されてしまったときにこの型定義では困ります。\nまた、まやかしの型定義はそれ自体が黒魔術なのであまり胸を張って使えるものではありませんね。\n\n代案を考えましょう。\n\n# `Vue.typedSet`を実装する\n\n`Vue.set`の拡張は厳しそうです。\nならばいっそ、`Vue.typedSet`という新しいグローバルメソッドを定義してしまいましょう。\n\nVueのグローバルメソッドの追加は簡単で、`Vue.newGlobalMethod = Function`のようにVueにプロパティを生やすだけです。\n\n`Vue.typedSet`は`Vue.set`のエイリアスで良いので、実装自体は以下のようになります。\n\n```ts\nVue.typedSet = (object: any, key: any, value: any) => Vue.set(object, key, value);\n```\n\nもし、Nuxtを使用しているのなら、プラグインを定義してこれをサーバー・クライアント双方で呼び出すようにしておけば問題ないでしょう。\n\n```ts\n// @/plugins/vue-typedSet.ts`\nimport { Plugin } from '@nuxt/types';\n\nconst plugin: Plugin = (context, inject) => {\n  Vue.typedSet = (object: any, key: any, value: any) => Vue.set(object, key, value);\n});\n\nexport default plugin;\n```\n\n最後に、先程拡張した型定義のメソッド名を`typedSet`に変更しましょう。\n\n```ts\n// src/@types/vue.d.ts\nimport Vue from 'vue';\n\ndeclare module 'vue/types/vue' {\n  interface VueConstructor {\n    typedSet&lt;T extends object, K extends keyof T>(object: T, key: K, value: T[K]): T[K];\n  }\n}\n```\n\n新しいメソッドを定義してしまいましたが、これで型安全に`Vue.set`できるようになりました！\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/ee193bab-eb63-b419-321e-03a5acf036a3.png)\n\nめでたしめでたし。\n\n# 参考\n\n* [Vue の拡張 - vue.js](https://012-jp.vuejs.org/guide/extending.html)\n* [foo, bar, baz の続き - Qiita](https://qiita.com/ka_/items/3727c3f16dc69fed935c)\n",
    "coediting": false,
    "comments_count": 0,
    "created_at": "2019-10-17T21:23:09+09:00",
    "group": null,
    "id": "4d31414cb612f96a4c9f",
    "likes_count": 27,
    "private": false,
    "reactions_count": 0,
    "tags": [
      {
        "name": "TypeScript",
        "versions": []
      },
      {
        "name": "Vue.js",
        "versions": []
      }
    ],
    "title": "TypeScriptでVue.setを型安全にしたい",
    "updated_at": "2019-10-21T20:10:33+09:00",
    "url": "https://qiita.com/simochee/items/4d31414cb612f96a4c9f",
    "user": {
      "description": "Nuxt & TypeScript大好きマンです",
      "facebook_id": "",
      "followees_count": 9,
      "followers_count": 14,
      "github_login_name": "tamuraryoya",
      "id": "simochee",
      "items_count": 27,
      "linkedin_id": "",
      "location": "Chiba, Japan",
      "name": "",
      "organization": "",
      "permanent_id": 127934,
      "profile_image_url": "https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/profile-images/1558357993",
      "team_only": false,
      "twitter_screen_name": "lollipop_onl",
      "website_url": ""
    },
    "page_views_count": null
  },
  {
    "rendered_body": "\n&lt;h2>\n&lt;span id=\"profile\" class=\"fragment\">&lt;/span>&lt;a href=\"#profile\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>Profile&lt;/h2>\n\n&lt;p>&lt;a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-user-profile-images.imgix.net%2Fhttps%253A%252F%252Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%252F0%252F127934%252Fprofile-images%252F1558357993%3Fixlib%3Drb-1.2.2%26auto%3Dcompress%252Cformat%26lossless%3D0%26w%3D300%26s%3D5680c7c3e731dcc74dc2e6f5eb18d267?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;s=a574ec04faf21ea0d157e1038767275f\" target=\"_blank\" rel=\"nofollow noopener\">&lt;img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-user-profile-images.imgix.net%2Fhttps%253A%252F%252Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%252F0%252F127934%252Fprofile-images%252F1558357993%3Fixlib%3Drb-1.2.2%26auto%3Dcompress%252Cformat%26lossless%3D0%26w%3D300%26s%3D5680c7c3e731dcc74dc2e6f5eb18d267?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;s=a574ec04faf21ea0d157e1038767275f\" width=\"120px\" data-canonical-src=\"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fprofile-images%2F1558357993?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;lossless=0&ampamp;w=300&ampamp;s=5680c7c3e731dcc74dc2e6f5eb18d267\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-user-profile-images.imgix.net%2Fhttps%253A%252F%252Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%252F0%252F127934%252Fprofile-images%252F1558357993%3Fixlib%3Drb-1.2.2%26auto%3Dcompress%252Cformat%26lossless%3D0%26w%3D300%26s%3D5680c7c3e731dcc74dc2e6f5eb18d267?ixlib=rb-1.2.2&ampamp;auto=compress%2Cformat&ampamp;gif-q=60&ampamp;w=1400&ampamp;fit=max&ampamp;s=67d50f8170ce749f59281e6698b29280 1x\" loading=\"lazy\">&lt;/a>&lt;br>\n・simochee &lt;sub>(しもちぃって読みます)&lt;/sub>&lt;br>\n・フロントエンドエンジニア&lt;br>\n・&lt;a href=\"https://qiita.com/simochee\">Qiita (simochee)&lt;/a>&lt;br>\n・&lt;a href=\"https://twitter.com/lollipop_onl\" rel=\"nofollow noopener\" target=\"_blank\">Twitter&lt;/a>&lt;/p>\n\n&lt;hr>\n\n&lt;h2>\n&lt;span id=\"proposal-collection-normalization\" class=\"fragment\">&lt;/span>&lt;a href=\"#proposal-collection-normalization\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>&lt;a href=\"https://github.com/tc39/proposal-collection-normalization\" rel=\"nofollow noopener\" target=\"_blank\">proposal-collection-normalization&lt;/a>\n&lt;/h2>\n\n&lt;p>&lt;em>Stage 2&lt;/em>&lt;/p>\n\n&lt;p>&lt;strong>Map/SetへKeyとValueを正規化する&lt;br>&lt;code>coerceKey&lt;/code>と&lt;code>coerceValue&lt;/code>の追加&lt;/strong>&lt;/p>\n\n&lt;hr>\n\n&lt;h3>\n&lt;span id=\"以降実際に動かしてはいません\" class=\"fragment\">&lt;/span>&lt;a href=\"#%E4%BB%A5%E9%99%8D%E5%AE%9F%E9%9A%9B%E3%81%AB%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%AF%E3%81%84%E3%81%BE%E3%81%9B%E3%82%93\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>※以降、実際に動かしてはいません&lt;/h3>\n\n&lt;hr>\n\n&lt;h2>\n&lt;span id=\"keyの正規化オブジェクトのkeyをkeyとして設定する\" class=\"fragment\">&lt;/span>&lt;a href=\"#key%E3%81%AE%E6%AD%A3%E8%A6%8F%E5%8C%96%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AEkey%E3%82%92key%E3%81%A8%E3%81%97%E3%81%A6%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>Keyの正規化①&lt;br>オブジェクトのKeyをKeyとして設定する&lt;/h2>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"kd\">const&lt;/span> &lt;span class=\"nx\">profile&lt;/span> &lt;span class=\"o\">=&lt;/span> &lt;span class=\"p\">{&lt;/span> &lt;span class=\"na\">email&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">simochee@example.com&lt;/span>&lt;span class=\"dl\">'&lt;/span> &lt;span class=\"p\">};&lt;/span>\n\n&lt;span class=\"kd\">const&lt;/span> &lt;span class=\"nx\">pointMap&lt;/span> &lt;span class=\"o\">=&lt;/span> &lt;span class=\"k\">new&lt;/span> &lt;span class=\"nb\">Map&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"kc\">undefined&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"p\">{&lt;/span>\n  &lt;span class=\"na\">coerceKey&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"p\">({&lt;/span> &lt;span class=\"nx\">email&lt;/span> &lt;span class=\"p\">})&lt;/span> &lt;span class=\"o\">=&ampgt;&lt;/span> &lt;span class=\"nx\">email&lt;/span>&lt;span class=\"p\">,&lt;/span>\n&lt;span class=\"p\">});&lt;/span>\n\n&lt;span class=\"nx\">pointMap&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"kd\">set&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">profile&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"mi\">1200&lt;/span>&lt;span class=\"p\">);&lt;/span>\n\n&lt;span class=\"nx\">pointMap&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"kd\">get&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">simochee@example.com&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"p\">);&lt;/span> &lt;span class=\"c1\">// 1200&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;hr>\n\n&lt;h2>\n&lt;span id=\"keyの正規化keyを文字列化させる\" class=\"fragment\">&lt;/span>&lt;a href=\"#key%E3%81%AE%E6%AD%A3%E8%A6%8F%E5%8C%96key%E3%82%92%E6%96%87%E5%AD%97%E5%88%97%E5%8C%96%E3%81%95%E3%81%9B%E3%82%8B\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>Keyの正規化②&lt;br>Keyを文字列化させる&lt;/h2>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"kd\">const&lt;/span> &lt;span class=\"nx\">map&lt;/span> &lt;span class=\"o\">=&lt;/span> &lt;span class=\"k\">new&lt;/span> &lt;span class=\"nb\">Map&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"kc\">undefined&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"p\">{&lt;/span>\n  &lt;span class=\"na\">coerceKey&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"nb\">String&lt;/span>&lt;span class=\"p\">,&lt;/span>\n&lt;span class=\"p\">});&lt;/span>\n\n&lt;span class=\"nx\">map&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"kd\">set&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"mi\">1&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">simochee&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"p\">);&lt;/span>\n&lt;span class=\"nx\">map&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">has&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"mi\">1&lt;/span>&lt;span class=\"p\">);&lt;/span> &lt;span class=\"c1\">// true&lt;/span>\n\n&lt;span class=\"c1\">// map.has('1') // true? false?&lt;/span>\n\n&lt;span class=\"p\">[...&lt;/span>&lt;span class=\"nx\">map&lt;/span>&lt;span class=\"p\">.&lt;/span>&lt;span class=\"nx\">entries&lt;/span>&lt;span class=\"p\">()];&lt;/span> &lt;span class=\"c1\">// [['1', 'simochee']]&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;hr>\n\n&lt;h2>\n&lt;span id=\"valueの正規化データをインスタンス化させる\" class=\"fragment\">&lt;/span>&lt;a href=\"#value%E3%81%AE%E6%AD%A3%E8%A6%8F%E5%8C%96%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E5%8C%96%E3%81%95%E3%81%9B%E3%82%8B\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>Valueの正規化①&lt;br>データをインスタンス化させる&lt;/h2>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"kd\">const&lt;/span> &lt;span class=\"nx\">map&lt;/span> &lt;span class=\"o\">=&lt;/span> &lt;span class=\"k\">new&lt;/span> &lt;span class=\"nb\">Map&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"kc\">undefined&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"p\">{&lt;/span>\n  &lt;span class=\"na\">coerceValue&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">user&lt;/span>&lt;span class=\"p\">)&lt;/span> &lt;span class=\"o\">=&ampgt;&lt;/span> &lt;span class=\"p\">{&lt;/span>\n    &lt;span class=\"k\">return&lt;/span> &lt;span class=\"nx\">user&lt;/span> &lt;span class=\"k\">instanceof&lt;/span> &lt;span class=\"nx\">UserModel&lt;/span>\n      &lt;span class=\"p\">?&lt;/span> &lt;span class=\"nx\">user&lt;/span>\n      &lt;span class=\"p\">:&lt;/span> &lt;span class=\"k\">new&lt;/span> &lt;span class=\"nx\">UserModel&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">user&lt;/span>&lt;span class=\"p\">);&lt;/span>\n  &lt;span class=\"p\">},&lt;/span>\n&lt;span class=\"p\">});&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;hr>\n\n&lt;h2>\n&lt;span id=\"valueの正規化不正なインスタンスの場合エラーにする\" class=\"fragment\">&lt;/span>&lt;a href=\"#value%E3%81%AE%E6%AD%A3%E8%A6%8F%E5%8C%96%E4%B8%8D%E6%AD%A3%E3%81%AA%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E5%A0%B4%E5%90%88%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%99%E3%82%8B\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>Valueの正規化②&lt;br>不正なインスタンスの場合エラーにする&lt;/h2>\n\n&lt;div class=\"code-frame\" data-lang=\"ts\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"kd\">const&lt;/span> &lt;span class=\"nx\">map&lt;/span> &lt;span class=\"o\">=&lt;/span> &lt;span class=\"k\">new&lt;/span> &lt;span class=\"nb\">Map&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"kc\">undefined&lt;/span>&lt;span class=\"p\">,&lt;/span> &lt;span class=\"p\">{&lt;/span>\n  &lt;span class=\"na\">coerceValue&lt;/span>&lt;span class=\"p\">:&lt;/span> &lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">user&lt;/span>&lt;span class=\"p\">)&lt;/span> &lt;span class=\"o\">=&ampgt;&lt;/span> &lt;span class=\"p\">{&lt;/span>\n    &lt;span class=\"k\">if&lt;/span> &lt;span class=\"p\">(&lt;/span>&lt;span class=\"o\">!&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"nx\">user&lt;/span> &lt;span class=\"k\">instanceof&lt;/span> &lt;span class=\"nx\">UserModel&lt;/span>&lt;span class=\"p\">))&lt;/span> &lt;span class=\"p\">{&lt;/span>\n      &lt;span class=\"k\">throw&lt;/span> &lt;span class=\"k\">new&lt;/span> &lt;span class=\"nx\">TypeError&lt;/span>&lt;span class=\"p\">(&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"s1\">データの方が不正です&lt;/span>&lt;span class=\"dl\">'&lt;/span>&lt;span class=\"p\">);&lt;/span>\n    &lt;span class=\"p\">}&lt;/span>\n\n    &lt;span class=\"k\">return&lt;/span> &lt;span class=\"nx\">user&lt;/span>&lt;span class=\"p\">;&lt;/span>\n  &lt;span class=\"p\">},&lt;/span>\n&lt;span class=\"p\">});&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;hr>\n\n&lt;h2>\n&lt;span id=\"references\" class=\"fragment\">&lt;/span>&lt;a href=\"#references\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>References&lt;/h2>\n\n&lt;ul>\n&lt;li>&lt;a href=\"https://github.com/tc39/proposal-collection-normalization\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://github.com/tc39/proposal-collection-normalization&lt;/a>&lt;/li>\n&lt;/ul>\n",
    "body": "## Profile\n\n&lt;img src=\"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fprofile-images%2F1558357993?ixlib=rb-1.2.2&auto=compress%2Cformat&lossless=0&w=300&s=5680c7c3e731dcc74dc2e6f5eb18d267\" width=\"120px\" />\n・simochee &lt;sub>(しもちぃって読みます)&lt;/sub>\n・フロントエンドエンジニア\n・[Qiita (simochee)](https://qiita.com/simochee)\n・[Twitter](https://twitter.com/lollipop_onl)\n\n---\n\n## [proposal-collection-normalization](https://github.com/tc39/proposal-collection-normalization)\n\n*Stage 2*\n\n**Map/SetへKeyとValueを正規化する&lt;br>`coerceKey`と`coerceValue`の追加**\n\n---\n\n### ※以降、実際に動かしてはいません\n\n---\n\n## Keyの正規化①&lt;br>オブジェクトのKeyをKeyとして設定する\n\n```ts\nconst profile = { email: 'simochee@example.com' };\n\nconst pointMap = new Map(undefined, {\n  coerceKey: ({ email }) => email,\n});\n\npointMap.set(profile, 1200);\n\npointMap.get('simochee@example.com'); // 1200\n```\n\n---\n\n## Keyの正規化②&lt;br>Keyを文字列化させる\n\n```ts\nconst map = new Map(undefined, {\n  coerceKey: String,\n});\n\nmap.set(1, 'simochee');\nmap.has(1); // true\n\n// map.has('1') // true? false?\n\n[...map.entries()]; // [['1', 'simochee']]\n```\n\n---\n\n## Valueの正規化①&lt;br>データをインスタンス化させる\n\n```ts\nconst map = new Map(undefined, {\n  coerceValue: (user) => {\n    return user instanceof UserModel\n      ? user\n      : new UserModel(user);\n  },\n});\n```\n\n---\n\n## Valueの正規化②&lt;br>不正なインスタンスの場合エラーにする\n\n```ts\nconst map = new Map(undefined, {\n  coerceValue: (user) => {\n    if (!(user instanceof UserModel)) {\n      throw new TypeError('データの方が不正です');\n    }\n\n    return user;\n  },\n});\n```\n\n---\n\n## References\n\n* https://github.com/tc39/proposal-collection-normalization\n",
    "coediting": false,
    "comments_count": 0,
    "created_at": "2019-10-08T09:52:33+09:00",
    "group": null,
    "id": "197dd4ecf1ec7aca4366",
    "likes_count": 2,
    "private": false,
    "reactions_count": 0,
    "tags": [
      {
        "name": "TC39",
        "versions": []
      }
    ],
    "title": "proposal-collection-normalization",
    "updated_at": "2019-10-09T20:26:14+09:00",
    "url": "https://qiita.com/simochee/items/197dd4ecf1ec7aca4366",
    "user": {
      "description": "Nuxt & TypeScript大好きマンです",
      "facebook_id": "",
      "followees_count": 9,
      "followers_count": 14,
      "github_login_name": "tamuraryoya",
      "id": "simochee",
      "items_count": 27,
      "linkedin_id": "",
      "location": "Chiba, Japan",
      "name": "",
      "organization": "",
      "permanent_id": 127934,
      "profile_image_url": "https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/profile-images/1558357993",
      "team_only": false,
      "twitter_screen_name": "lollipop_onl",
      "website_url": ""
    },
    "page_views_count": null
  },
  {
    "rendered_body": "\n&lt;h1>\n&lt;span id=\"事象\" class=\"fragment\">&lt;/span>&lt;a href=\"#%E4%BA%8B%E8%B1%A1\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>事象&lt;/h1>\n\n&lt;p>&lt;code>is&lt;/code>属性で要素名を指定しているコンポーネントに対して、&lt;code>v-model&lt;/code>を使用すると、&lt;code>v-model&lt;/code>が機能しなくなりました。&lt;/p>\n\n&lt;p>どういうことかは例を見ていただくと早いです。&lt;/p>\n\n&lt;h2>\n&lt;span id=\"正常\" class=\"fragment\">&lt;/span>&lt;a href=\"#%E6%AD%A3%E5%B8%B8\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>正常&lt;/h2>\n\n&lt;div class=\"code-frame\" data-lang=\"html\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"nt\">&amplt;input&lt;/span> &lt;span class=\"na\">type=&lt;/span>&lt;span class=\"s\">\"text\"&lt;/span> &lt;span class=\"na\">v-model=&lt;/span>&lt;span class=\"s\">\"value\"&lt;/span>&lt;span class=\"nt\">&ampgt;&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;blockquote>\n&lt;p>&lt;a href=\"https://jsfiddle.net/simochee/fjdvowr7/4\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://jsfiddle.net/simochee/fjdvowr7/4&lt;/a>&lt;/p>\n&lt;/blockquote>\n\n&lt;h2>\n&lt;span id=\"異常\" class=\"fragment\">&lt;/span>&lt;a href=\"#%E7%95%B0%E5%B8%B8\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>異常&lt;/h2>\n\n&lt;div class=\"code-frame\" data-lang=\"html\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"nt\">&amplt;div&lt;/span> &lt;span class=\"na\">is=&lt;/span>&lt;span class=\"s\">\"input\"&lt;/span> &lt;span class=\"na\">type=&lt;/span>&lt;span class=\"s\">\"text\"&lt;/span> &lt;span class=\"na\">v-model=&lt;/span>&lt;span class=\"s\">\"value\"&lt;/span>&lt;span class=\"nt\">&ampgt;&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;blockquote>\n&lt;p>&lt;a href=\"https://jsfiddle.net/simochee/fjdvowr7/5\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://jsfiddle.net/simochee/fjdvowr7/5&lt;/a>&lt;/p>\n&lt;/blockquote>\n\n&lt;h1>\n&lt;span id=\"原因\" class=\"fragment\">&lt;/span>&lt;a href=\"#%E5%8E%9F%E5%9B%A0\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>原因&lt;/h1>\n\n&lt;p>なぜこんな挙動になるのか、それを解決する記述を見つけることはできませんでした。&lt;/p>\n\n&lt;p>ともかく&lt;code>is&lt;/code>と&lt;code>v-model&lt;/code>は併用しないよう気をつけましょう。&lt;/p>\n\n&lt;h1>\n&lt;span id=\"おまけ\" class=\"fragment\">&lt;/span>&lt;a href=\"#%E3%81%8A%E3%81%BE%E3%81%91\">&lt;i class=\"fa fa-link\">&lt;/i>&lt;/a>おまけ&lt;/h1>\n\n&lt;p>疑似&lt;code>v-model&lt;/code>の場合は更に奇妙な挙動になりました。&lt;/p>\n\n&lt;p>初期値は設定されるし、入力値は設定できるものの、代入による値を上書きできなくなります。&lt;/p>\n\n&lt;div class=\"code-frame\" data-lang=\"html\">&lt;div class=\"highlight\">&lt;pre>&lt;span class=\"nt\">&amplt;div&lt;/span>\n  &lt;span class=\"na\">is=&lt;/span>&lt;span class=\"s\">\"input\"&lt;/span>\n  &lt;span class=\"na\">type=&lt;/span>&lt;span class=\"s\">\"text\"&lt;/span>\n  &lt;span class=\"na\">:value=&lt;/span>&lt;span class=\"s\">\"value\"&lt;/span>\n  &lt;span class=\"err\">@&lt;/span>&lt;span class=\"na\">input=&lt;/span>&lt;span class=\"s\">\"value = $event.target.value\"&lt;/span>\n&lt;span class=\"nt\">&ampgt;&lt;/span>\n&lt;/pre>&lt;/div>&lt;/div>\n\n&lt;blockquote>\n&lt;p>&lt;a href=\"https://jsfiddle.net/simochee/fjdvowr7/7/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://jsfiddle.net/simochee/fjdvowr7/7/&lt;/a>&lt;/p>\n&lt;/blockquote>\n",
    "body": "# 事象\n\n`is`属性で要素名を指定しているコンポーネントに対して、`v-model`を使用すると、`v-model`が機能しなくなりました。\n\nどういうことかは例を見ていただくと早いです。\n\n## 正常\n\n```html\n&lt;input type=\"text\" v-model=\"value\">\n```\n\n> https://jsfiddle.net/simochee/fjdvowr7/4\n\n## 異常\n\n```html\n&lt;div is=\"input\" type=\"text\" v-model=\"value\">\n```\n\n> https://jsfiddle.net/simochee/fjdvowr7/5\n\n# 原因\n\nなぜこんな挙動になるのか、それを解決する記述を見つけることはできませんでした。\n\nともかく`is`と`v-model`は併用しないよう気をつけましょう。\n\n# おまけ\n\n疑似`v-model`の場合は更に奇妙な挙動になりました。\n\n初期値は設定されるし、入力値は設定できるものの、代入による値を上書きできなくなります。\n\n```html\n&lt;div\n  is=\"input\"\n  type=\"text\"\n  :value=\"value\"\n  @input=\"value = $event.target.value\"\n>\n```\n\n> https://jsfiddle.net/simochee/fjdvowr7/7/\n",
    "coediting": false,
    "comments_count": 0,
    "created_at": "2019-09-12T10:12:34+09:00",
    "group": null,
    "id": "b903cbf9227120d92e7e",
    "likes_count": 0,
    "private": false,
    "reactions_count": 0,
    "tags": [
      {
        "name": "Vue.js",
        "versions": []
      }
    ],
    "title": "Vueのisとv-modelは併用してはいけない",
    "updated_at": "2019-09-12T10:12:34+09:00",
    "url": "https://qiita.com/simochee/items/b903cbf9227120d92e7e",
    "user": {
      "description": "Nuxt & TypeScript大好きマンです",
      "facebook_id": "",
      "followees_count": 9,
      "followers_count": 14,
      "github_login_name": "tamuraryoya",
      "id": "simochee",
      "items_count": 27,
      "linkedin_id": "",
      "location": "Chiba, Japan",
      "name": "",
      "organization": "",
      "permanent_id": 127934,
      "profile_image_url": "https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/profile-images/1558357993",
      "team_only": false,
      "twitter_screen_name": "lollipop_onl",
      "website_url": ""
    },
    "page_views_count": null
  }
]</pre></div></div></div><script>window.__NUXT__=function(s,a,n,p,e,c,l,t,o,i,r,d,m,u,f,x,h){return{layout:"default",data:[{qiitaItems:[{rendered_body:'<p>記事を書いているときに参考にしたウェブページを掲載しますが、タイトルのコピーが厄介です。</p>\n\n<p>そんなときのために、表示しているページのタイトルをコピーするブックマークレットをご紹介します。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="c1">// タイトルを参照</span>\n  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>\n\n  <span class="c1">// コピーの元にするtextareaを作成</span>\n  <span class="kd">const</span> <span class="nx">textarea</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">\'</span><span class="s1">textarea</span><span class="dl">\'</span><span class="p">);</span>\n  <span class="nx">textarea</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">title</span><span class="p">;</span>\n\n  <span class="c1">// bodyタグの最後にtextareaを追加</span>\n  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">textarea</span><span class="p">);</span>\n\n  <span class="c1">// textareaの内容をクリップボードにコピー</span>\n  <span class="nx">textarea</span><span class="p">.</span><span class="nx">select</span><span class="p">();</span>\n  <span class="nb">document</span><span class="p">.</span><span class="nx">execCommand</span><span class="p">(</span><span class="dl">\'</span><span class="s1">copy</span><span class="dl">\'</span><span class="p">);</span>\n\n  <span class="c1">// 最初に作成したtextareaをbodyから削除</span>\n  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">textarea</span><span class="p">);</span>\n\n  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Copyed this website title "</span><span class="p">${</span><span class="nx">title</span><span class="p">}</span><span class="s2">"`</span><span class="p">);</span>\n<span class="p">})();</span>\n</pre></div></div>\n\n<p>Minified:</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="p">(()</span><span class="o">=&gt;</span><span class="p">{</span><span class="kd">const</span> <span class="nx">e</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span><span class="nx">t</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">textarea</span><span class="dl">"</span><span class="p">);</span><span class="nx">t</span><span class="p">.</span><span class="nx">textContent</span><span class="o">=</span><span class="nx">e</span><span class="p">,</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">t</span><span class="p">),</span><span class="nx">t</span><span class="p">.</span><span class="nx">select</span><span class="p">(),</span><span class="nb">document</span><span class="p">.</span><span class="nx">execCommand</span><span class="p">(</span><span class="dl">"</span><span class="s2">copy</span><span class="dl">"</span><span class="p">),</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">t</span><span class="p">),</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Copyed this website title "</span><span class="p">${</span><span class="nx">e</span><span class="p">}</span><span class="s2">"`</span><span class="p">)})();</span>\n</pre></div></div>\n\n<p>使い方：</p>\n\n<p>冒頭に<code>javascript:</code>をつけてブックマークに保存してください。あとは、登録したブックマークを実行したらタイトルがコピーできるようになります。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="nx">javascript</span><span class="p">(()</span><span class="o">=&gt;</span><span class="p">{</span><span class="kd">const</span><span class="p">...});</span>\n</pre></div></div>\n',body:'記事を書いているときに参考にしたウェブページを掲載しますが、タイトルのコピーが厄介です。\n\nそんなときのために、表示しているページのタイトルをコピーするブックマークレットをご紹介します。\n\n```ts\n(() => {\n  // タイトルを参照\n  const title = document.title;\n\n  // コピーの元にするtextareaを作成\n  const textarea = document.createElement(\'textarea\');\n  textarea.textContent = title;\n\n  // bodyタグの最後にtextareaを追加\n  document.body.appendChild(textarea);\n  \n  // textareaの内容をクリップボードにコピー\n  textarea.select();\n  document.execCommand(\'copy\');\n\n  // 最初に作成したtextareaをbodyから削除\n  document.body.removeChild(textarea);\n\n  console.log(`Copyed this website title "${title}"`);\n})();\n```\n\nMinified:\n\n```ts\n(()=>{const e=document.title,t=document.createElement("textarea");t.textContent=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),console.log(`Copyed this website title "${e}"`)})();\n```\n\n使い方：\n\n冒頭に`javascript:`をつけてブックマークに保存してください。あとは、登録したブックマークを実行したらタイトルがコピーできるようになります。\n\n```ts\njavascript(()=>{const...});\n```\n',coediting:a,comments_count:0,created_at:f,group:p,id:"234c2a8203ac951bef19",likes_count:0,private:a,reactions_count:0,tags:[{name:"bookmarklet",versions:[]}],title:"見ているサイトのタイトルをコピーするブックマークレット",updated_at:f,url:"https://qiita.com/simochee/items/234c2a8203ac951bef19",user:{description:c,facebook_id:s,followees_count:9,followers_count:14,github_login_name:o,id:i,items_count:27,linkedin_id:s,location:r,name:s,organization:s,permanent_id:d,profile_image_url:m,team_only:a,twitter_screen_name:u,website_url:s},page_views_count:p},{rendered_body:'\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p>せっかくTypeScriptを使っているのだから、<code>Vue.set</code>も型安全にしたい！と、誰しも一度は考えたことがあるのではないでしょうか？</p>\n\n<p>この記事では、過程とともに<code>Vue.set</code>を型安全にする実装をご紹介します。</p>\n\n<h1>\n<span id="tldr" class="fragment"></span><a href="#tldr"><i class="fa fa-link"></i></a>TL;DR</h1>\n\n<p><details><summary>最終的なコード</summary><br>\n<p></p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="nx">Vue</span><span class="p">.</span><span class="nx">typedSet</span> <span class="o">=</span> <span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Vue</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>\n</pre></div></div>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="c1">// src/@types/vue.d.ts</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="nx">declare</span> <span class="nx">module</span> <span class="dl">\'</span><span class="s1">vue/types/vue</span><span class="dl">\'</span> <span class="p">{</span>\n  <span class="kr">interface</span> <span class="nx">VueConstructor</span> <span class="p">{</span>\n    <span class="nx">typedSet</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="nx">keyof</span> <span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">]):</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">];</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div></div>\n\n<p></p>\n<br>\n</details></p>\n\n<h1>\n<span id="vuesetの型" class="fragment"></span><a href="#vueset%E3%81%AE%E5%9E%8B"><i class="fa fa-link"></i></a><code>Vue.set</code>の型</h1>\n\n<p><code>Vue.set</code>の型は<code>vue/types/vue.d.ts</code>に以下のように定義されています。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre>  <span class="kd">set</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">number</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">T</span><span class="p">;</span>\n  <span class="kd">set</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">array</span><span class="p">:</span> <span class="nx">T</span><span class="p">[],</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">T</span><span class="p">;</span>\n</pre></div></div>\n\n<p>配列の場合は問題ないのですが、オブジェクトの値は本来の型とは異なるものを設定できてしまいます。</p>\n\n<p>これは良くない、ということで型安全にする手立てを考えてみましょう。</p>\n\n<h1>\n<span id="型安全なvuesetの型を考える" class="fragment"></span><a href="#%E5%9E%8B%E5%AE%89%E5%85%A8%E3%81%AAvueset%E3%81%AE%E5%9E%8B%E3%82%92%E8%80%83%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>型安全な<code>Vue.set</code>の型を考える</h1>\n\n<p>まずは、型安全な<code>Vue.set</code>がどのようなものかを考えてみましょう。</p>\n\n<p>第２引数は第１引数で取りうるKeyを指定でき、第３引数では第2引数で指定した第１引数のKeyの値と同じ型を指定することができる、ということになります。</p>\n\n<p>これを型定義に書き起こすと、以下のようになります。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre>  <span class="kd">set</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="nx">keyof</span> <span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">]):</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">];</span>\n</pre></div></div>\n\n<p>これ１つで配列もオブジェクトもOKなSetメソッドの型を定義することができました。</p>\n\n<h1>\n<span id="vueconstructorへの型指定" class="fragment"></span><a href="#vueconstructor%E3%81%B8%E3%81%AE%E5%9E%8B%E6%8C%87%E5%AE%9A"><i class="fa fa-link"></i></a><code>VueConstructor</code>への型指定</h1>\n\n<p><code>Vue.set</code>の型が定義されている<code>vue/types/vue.d.ts</code>の<code>VueConstructor</code>を拡張しましょう。</p>\n\n<p>TypeScriptでは対象範囲全ての<code>@types</code>以下の型定義ファイルを自動でコンパイルに含めてくれます。<br>\n今回は<code>src/@types/</code>以下に<code>vue.d.ts</code>という型定義ファイルを作成しました。</p>\n\n<p>この中に、<code>VueConstructor</code>を拡張するような型定義を書いてみましょう。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="c1">// src/@types/vue.d.ts</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="nx">declare</span> <span class="nx">module</span> <span class="dl">\'</span><span class="s1">vue/types/vue</span><span class="dl">\'</span> <span class="p">{</span>\n  <span class="kr">interface</span> <span class="nx">VueConstructor</span> <span class="p">{</span>\n    <span class="kd">set</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="nx">keyof</span> <span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">]):</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">];</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div></div>\n\n<p><code>declare module</code>は続くモジュール名（今回の場合は<code>node_modules/vue</code>以下の<code>types/vue.d.ts</code>を指定）の内部を拡張することができます。<br>\n<code>declare module \'vue/types/vue\' { ... }</code>の<code>{ ... }</code>内は<code>vue/types/vue.d.ts</code>で<code>export</code>されているインターフェースをオーバーライドすることができます。</p>\n\n<h1>\n<span id="使ってみた" class="fragment"></span><a href="#%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F"><i class="fa fa-link"></i></a>使ってみた</h1>\n\n<p>これで、<code>Vue.set</code>をタイプセーフに拡張できました。試してみましょう。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fa1094d7b-132c-344f-839e-65d5086534ee.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=4a8a475de3085bbada26d56fa83a36fa" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fa1094d7b-132c-344f-839e-65d5086534ee.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=4a8a475de3085bbada26d56fa83a36fa" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/a1094d7b-132c-344f-839e-65d5086534ee.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fa1094d7b-132c-344f-839e-65d5086534ee.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=99e970267021d8181cf8cac78a40e30d 1x" loading="lazy"></a></p>\n\n<p>キーは補完されるようになりました！続いて不正な値を設定してみましょう！</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Ffc37302d-338d-03b7-fc2f-62dd699e3f72.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=24dc3a0b7d28a063f3d4325b7b8f5666" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Ffc37302d-338d-03b7-fc2f-62dd699e3f72.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=24dc3a0b7d28a063f3d4325b7b8f5666" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/fc37302d-338d-03b7-fc2f-62dd699e3f72.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Ffc37302d-338d-03b7-fc2f-62dd699e3f72.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=65197acc5e82c37e260f820889db0fcf 1x" loading="lazy"></a></p>\n\n<p>おやおや・・・<code>obj.foo</code>は文字列なのに<code>0</code>を設定できてしまいました。これはいけない。</p>\n\n<h2>\n<span id="不正な型を設定できる理由" class="fragment"></span><a href="#%E4%B8%8D%E6%AD%A3%E3%81%AA%E5%9E%8B%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%A7%E3%81%8D%E3%82%8B%E7%90%86%E7%94%B1"><i class="fa fa-link"></i></a>不正な型を設定できる理由</h2>\n\n<p>TypeScriptのインターフェース拡張は「すでにある定義を壊さない形での拡張」のみが許されます。<br>\nさらに、関数の場合は引数の数が同じ定義の関数があればチェック対象となります。</p>\n\n<p>つまりこの事象は、型安全な方の型チェックに引っかかったけど、後続の型安全でない方の型チェックがパスしたからOK、みたいな挙動になってしまっているわけです。</p>\n\n<p>ということで、純粋に<code>Vue.set</code>を拡張するだけでは元の定義が後に控えているためあまり意味がありません。</p>\n\n<h1>\n<span id="後続の型定義を参照させないようにする" class="fragment"></span><a href="#%E5%BE%8C%E7%B6%9A%E3%81%AE%E5%9E%8B%E5%AE%9A%E7%BE%A9%E3%82%92%E5%8F%82%E7%85%A7%E3%81%95%E3%81%9B%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>後続の型定義を参照させないようにする</h1>\n\n<p>TypeScriptで後続の型定義を探す条件は「全く同じ定義の型」に限られます。</p>\n\n<p>以下のような型定義の場合は<code>fn()</code>は引数さえあれば型エラーになりません。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="kr">interface</span> <span class="nx">Sample</span> <span class="p">{</span>\n  <span class="nx">fn</span><span class="p">(</span><span class="nx">foo</span><span class="p">:</span> <span class="nx">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n  <span class="nx">fn</span><span class="p">(</span><span class="nx">bar</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n<span class="p">}</span>\n\n<span class="nx">fn</span><span class="p">(</span><span class="dl">\'</span><span class="s1">a</span><span class="dl">\'</span><span class="p">);</span>\n<span class="nx">fn</span><span class="p">({});</span>\n</pre></div></div>\n\n<p>これに第２引数のあるメソッドを追加してみると、正しく型チェックが行われるようになります。当然といえば当然ですね。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="kr">interface</span> <span class="nx">Sample</span> <span class="p">{</span>\n  <span class="nx">fn</span><span class="p">(</span><span class="nx">baz</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">qux</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n  <span class="nx">fn</span><span class="p">(</span><span class="nx">foo</span><span class="p">:</span> <span class="nx">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n  <span class="nx">fn</span><span class="p">(</span><span class="nx">bar</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n<span class="p">}</span>\n\n<span class="nx">fn</span><span class="p">(</span><span class="dl">\'</span><span class="s1">a</span><span class="dl">\'</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// OK</span>\n<span class="nx">fn</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>   <span class="c1">// Error</span>\n</pre></div></div>\n\n<p>つまり、引数の数を増やせば、後続の型定義を参照させずに済むということです。<br>\nこれを<del>悪用</del>利用して、型定義上だけ、フラグを追加してみます。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="c1">// src/@types/vue.d.ts</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="nx">declare</span> <span class="nx">module</span> <span class="dl">\'</span><span class="s1">vue/types/vue</span><span class="dl">\'</span> <span class="p">{</span>\n  <span class="kr">interface</span> <span class="nx">VueConstructor</span> <span class="p">{</span>\n    <span class="kd">set</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="nx">keyof</span> <span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">],</span> <span class="nx">isTyped</span><span class="p">:</span> <span class="kc">true</span><span class="p">):</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">];</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div></div>\n\n<p>これで、第4引数に<code>true</code>が渡された場合は型安全な<code>Vue.set</code>を利用することができるようになります。</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F4c93f1fb-b024-3bb5-6237-15e9dea2175c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=5ffc9df69a13726a1f1c6d3555477463" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F4c93f1fb-b024-3bb5-6237-15e9dea2175c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=5ffc9df69a13726a1f1c6d3555477463" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/4c93f1fb-b024-3bb5-6237-15e9dea2175c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F4c93f1fb-b024-3bb5-6237-15e9dea2175c.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=d5cb5c7cc09ae1efe9836144b2e36602 1x" loading="lazy"></a></p>\n\n<p>先程の例でも文字列以外は設定できなくなりました。</p>\n\n<hr>\n\n<p>で、終わってしまいたかったのですが、いつか本当に<code>Vue.set</code>の第4引数にフラグが追加されてしまったときにこの型定義では困ります。<br>\nまた、まやかしの型定義はそれ自体が黒魔術なのであまり胸を張って使えるものではありませんね。</p>\n\n<p>代案を考えましょう。</p>\n\n<h1>\n<span id="vuetypedsetを実装する" class="fragment"></span><a href="#vuetypedset%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a><code>Vue.typedSet</code>を実装する</h1>\n\n<p><code>Vue.set</code>の拡張は厳しそうです。<br>\nならばいっそ、<code>Vue.typedSet</code>という新しいグローバルメソッドを定義してしまいましょう。</p>\n\n<p>Vueのグローバルメソッドの追加は簡単で、<code>Vue.newGlobalMethod = Function</code>のようにVueにプロパティを生やすだけです。</p>\n\n<p><code>Vue.typedSet</code>は<code>Vue.set</code>のエイリアスで良いので、実装自体は以下のようになります。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="nx">Vue</span><span class="p">.</span><span class="nx">typedSet</span> <span class="o">=</span> <span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Vue</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>\n</pre></div></div>\n\n<p>もし、Nuxtを使用しているのなら、プラグインを定義してこれをサーバー・クライアント双方で呼び出すようにしておけば問題ないでしょう。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="c1">// @/plugins/vue-typedSet.ts`</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Plugin</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nuxt/types</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="kd">const</span> <span class="nx">plugin</span><span class="p">:</span> <span class="nx">Plugin</span> <span class="o">=</span> <span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">inject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="nx">Vue</span><span class="p">.</span><span class="nx">typedSet</span> <span class="o">=</span> <span class="p">(</span><span class="na">object</span><span class="p">:</span> <span class="nx">any</span><span class="p">,</span> <span class="na">key</span><span class="p">:</span> <span class="nx">any</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Vue</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>\n<span class="p">});</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">plugin</span><span class="p">;</span>\n</pre></div></div>\n\n<p>最後に、先程拡張した型定義のメソッド名を<code>typedSet</code>に変更しましょう。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="c1">// src/@types/vue.d.ts</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="nx">declare</span> <span class="nx">module</span> <span class="dl">\'</span><span class="s1">vue/types/vue</span><span class="dl">\'</span> <span class="p">{</span>\n  <span class="kr">interface</span> <span class="nx">VueConstructor</span> <span class="p">{</span>\n    <span class="nx">typedSet</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="nx">keyof</span> <span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">]):</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">];</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</pre></div></div>\n\n<p>新しいメソッドを定義してしまいましたが、これで型安全に<code>Vue.set</code>できるようになりました！</p>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fee193bab-eb63-b419-321e-03a5acf036a3.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=3d8c6f20c6aed221bf04de2a7aa24bc7" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fee193bab-eb63-b419-321e-03a5acf036a3.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=3d8c6f20c6aed221bf04de2a7aa24bc7" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/ee193bab-eb63-b419-321e-03a5acf036a3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fee193bab-eb63-b419-321e-03a5acf036a3.png?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=de157df47691460ff48fb65bb1f35e45 1x" loading="lazy"></a></p>\n\n<p>めでたしめでたし。</p>\n\n<h1>\n<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>\n\n<ul>\n<li><a href="https://012-jp.vuejs.org/guide/extending.html" rel="nofollow noopener" target="_blank">Vue の拡張 - vue.js</a></li>\n<li><a href="https://qiita.com/ka_/items/3727c3f16dc69fed935c" id="reference-3738486528aa53033812">foo, bar, baz の続き - Qiita</a></li>\n</ul>\n',body:"# はじめに\n\nせっかくTypeScriptを使っているのだから、`Vue.set`も型安全にしたい！と、誰しも一度は考えたことがあるのではないでしょうか？\n\nこの記事では、過程とともに`Vue.set`を型安全にする実装をご紹介します。\n\n# TL;DR\n\n<details><summary>最終的なコード</summary>\n<p>\n\n```ts\nVue.typedSet = (object: any, key: any, value: any) => Vue.set(object, key, value);\n```\n\n```ts\n// src/@types/vue.d.ts\nimport Vue from 'vue';\n\ndeclare module 'vue/types/vue' {\n  interface VueConstructor {\n    typedSet<T extends object, K extends keyof T>(object: T, key: K, value: T[K]): T[K];\n  }\n}\n```\n\n</p>\n</details>\n\n\n# `Vue.set`の型\n\n`Vue.set`の型は`vue/types/vue.d.ts`に以下のように定義されています。\n\n```ts\n  set<T>(object: object, key: string | number, value: T): T;\n  set<T>(array: T[], key: number, value: T): T;\n```\n\n配列の場合は問題ないのですが、オブジェクトの値は本来の型とは異なるものを設定できてしまいます。\n\nこれは良くない、ということで型安全にする手立てを考えてみましょう。\n\n# 型安全な`Vue.set`の型を考える\n\nまずは、型安全な`Vue.set`がどのようなものかを考えてみましょう。\n\n第２引数は第１引数で取りうるKeyを指定でき、第３引数では第2引数で指定した第１引数のKeyの値と同じ型を指定することができる、ということになります。\n\nこれを型定義に書き起こすと、以下のようになります。\n\n```ts\n  set<T extends object, K extends keyof T>(object: T, key: K, value: T[K]): T[K];\n```\n\nこれ１つで配列もオブジェクトもOKなSetメソッドの型を定義することができました。\n\n# `VueConstructor`への型指定\n\n`Vue.set`の型が定義されている`vue/types/vue.d.ts`の`VueConstructor`を拡張しましょう。\n\nTypeScriptでは対象範囲全ての`@types`以下の型定義ファイルを自動でコンパイルに含めてくれます。\n今回は`src/@types/`以下に`vue.d.ts`という型定義ファイルを作成しました。\n\nこの中に、`VueConstructor`を拡張するような型定義を書いてみましょう。\n\n```ts\n// src/@types/vue.d.ts\nimport Vue from 'vue';\n\ndeclare module 'vue/types/vue' {\n  interface VueConstructor {\n    set<T extends object, K extends keyof T>(object: T, key: K, value: T[K]): T[K];\n  }\n}\n```\n\n`declare module`は続くモジュール名（今回の場合は`node_modules/vue`以下の`types/vue.d.ts`を指定）の内部を拡張することができます。\n`declare module 'vue/types/vue' { ... }`の`{ ... }`内は`vue/types/vue.d.ts`で`export`されているインターフェースをオーバーライドすることができます。\n\n# 使ってみた\n\nこれで、`Vue.set`をタイプセーフに拡張できました。試してみましょう。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/a1094d7b-132c-344f-839e-65d5086534ee.png)\n\nキーは補完されるようになりました！続いて不正な値を設定してみましょう！\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/fc37302d-338d-03b7-fc2f-62dd699e3f72.png)\n\nおやおや・・・`obj.foo`は文字列なのに`0`を設定できてしまいました。これはいけない。\n\n## 不正な型を設定できる理由\n\nTypeScriptのインターフェース拡張は「すでにある定義を壊さない形での拡張」のみが許されます。\nさらに、関数の場合は引数の数が同じ定義の関数があればチェック対象となります。\n\nつまりこの事象は、型安全な方の型チェックに引っかかったけど、後続の型安全でない方の型チェックがパスしたからOK、みたいな挙動になってしまっているわけです。\n\nということで、純粋に`Vue.set`を拡張するだけでは元の定義が後に控えているためあまり意味がありません。\n\n# 後続の型定義を参照させないようにする\n\nTypeScriptで後続の型定義を探す条件は「全く同じ定義の型」に限られます。\n\n以下のような型定義の場合は`fn()`は引数さえあれば型エラーになりません。\n\n```ts\ninterface Sample {\n  fn(foo: string) => void;\n  fn(bar: any) => void;\n}\n\nfn('a');\nfn({});\n```\n\nこれに第２引数のあるメソッドを追加してみると、正しく型チェックが行われるようになります。当然といえば当然ですね。\n\n```ts\ninterface Sample {\n  fn(baz: string, qux: number) => void;\n  fn(foo: string) => void;\n  fn(bar: any) => void;\n}\n\nfn('a', 0); // OK\nfn(0, 0);   // Error\n```\n\nつまり、引数の数を増やせば、後続の型定義を参照させずに済むということです。\nこれを~~悪用~~利用して、型定義上だけ、フラグを追加してみます。\n\n```ts\n// src/@types/vue.d.ts\nimport Vue from 'vue';\n\ndeclare module 'vue/types/vue' {\n  interface VueConstructor {\n    set<T extends object, K extends keyof T>(object: T, key: K, value: T[K], isTyped: true): T[K];\n  }\n}\n```\n\nこれで、第4引数に`true`が渡された場合は型安全な`Vue.set`を利用することができるようになります。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/4c93f1fb-b024-3bb5-6237-15e9dea2175c.png)\n\n先程の例でも文字列以外は設定できなくなりました。\n\n---\n\nで、終わってしまいたかったのですが、いつか本当に`Vue.set`の第4引数にフラグが追加されてしまったときにこの型定義では困ります。\nまた、まやかしの型定義はそれ自体が黒魔術なのであまり胸を張って使えるものではありませんね。\n\n代案を考えましょう。\n\n# `Vue.typedSet`を実装する\n\n`Vue.set`の拡張は厳しそうです。\nならばいっそ、`Vue.typedSet`という新しいグローバルメソッドを定義してしまいましょう。\n\nVueのグローバルメソッドの追加は簡単で、`Vue.newGlobalMethod = Function`のようにVueにプロパティを生やすだけです。\n\n`Vue.typedSet`は`Vue.set`のエイリアスで良いので、実装自体は以下のようになります。\n\n```ts\nVue.typedSet = (object: any, key: any, value: any) => Vue.set(object, key, value);\n```\n\nもし、Nuxtを使用しているのなら、プラグインを定義してこれをサーバー・クライアント双方で呼び出すようにしておけば問題ないでしょう。\n\n```ts\n// @/plugins/vue-typedSet.ts`\nimport { Plugin } from '@nuxt/types';\n\nconst plugin: Plugin = (context, inject) => {\n  Vue.typedSet = (object: any, key: any, value: any) => Vue.set(object, key, value);\n});\n\nexport default plugin;\n```\n\n最後に、先程拡張した型定義のメソッド名を`typedSet`に変更しましょう。\n\n```ts\n// src/@types/vue.d.ts\nimport Vue from 'vue';\n\ndeclare module 'vue/types/vue' {\n  interface VueConstructor {\n    typedSet<T extends object, K extends keyof T>(object: T, key: K, value: T[K]): T[K];\n  }\n}\n```\n\n新しいメソッドを定義してしまいましたが、これで型安全に`Vue.set`できるようになりました！\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/ee193bab-eb63-b419-321e-03a5acf036a3.png)\n\nめでたしめでたし。\n\n# 参考\n\n* [Vue の拡張 - vue.js](https://012-jp.vuejs.org/guide/extending.html)\n* [foo, bar, baz の続き - Qiita](https://qiita.com/ka_/items/3727c3f16dc69fed935c)\n",coediting:a,comments_count:0,created_at:"2019-10-17T21:23:09+09:00",group:p,id:"4d31414cb612f96a4c9f",likes_count:27,private:a,reactions_count:0,tags:[{name:"TypeScript",versions:[]},{name:x,versions:[]}],title:"TypeScriptでVue.setを型安全にしたい",updated_at:"2019-10-21T20:10:33+09:00",url:"https://qiita.com/simochee/items/4d31414cb612f96a4c9f",user:{description:c,facebook_id:s,followees_count:9,followers_count:14,github_login_name:o,id:i,items_count:27,linkedin_id:s,location:r,name:s,organization:s,permanent_id:d,profile_image_url:m,team_only:a,twitter_screen_name:u,website_url:s},page_views_count:p},{rendered_body:'\n<h2>\n<span id="profile" class="fragment"></span><a href="#profile"><i class="fa fa-link"></i></a>Profile</h2>\n\n<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-user-profile-images.imgix.net%2Fhttps%253A%252F%252Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%252F0%252F127934%252Fprofile-images%252F1558357993%3Fixlib%3Drb-1.2.2%26auto%3Dcompress%252Cformat%26lossless%3D0%26w%3D300%26s%3D5680c7c3e731dcc74dc2e6f5eb18d267?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=a574ec04faf21ea0d157e1038767275f" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-user-profile-images.imgix.net%2Fhttps%253A%252F%252Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%252F0%252F127934%252Fprofile-images%252F1558357993%3Fixlib%3Drb-1.2.2%26auto%3Dcompress%252Cformat%26lossless%3D0%26w%3D300%26s%3D5680c7c3e731dcc74dc2e6f5eb18d267?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;s=a574ec04faf21ea0d157e1038767275f" width="120px" data-canonical-src="https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fprofile-images%2F1558357993?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;lossless=0&amp;w=300&amp;s=5680c7c3e731dcc74dc2e6f5eb18d267" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-user-profile-images.imgix.net%2Fhttps%253A%252F%252Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%252F0%252F127934%252Fprofile-images%252F1558357993%3Fixlib%3Drb-1.2.2%26auto%3Dcompress%252Cformat%26lossless%3D0%26w%3D300%26s%3D5680c7c3e731dcc74dc2e6f5eb18d267?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;gif-q=60&amp;w=1400&amp;fit=max&amp;s=67d50f8170ce749f59281e6698b29280 1x" loading="lazy"></a><br>\n・simochee <sub>(しもちぃって読みます)</sub><br>\n・フロントエンドエンジニア<br>\n・<a href="https://qiita.com/simochee">Qiita (simochee)</a><br>\n・<a href="https://twitter.com/lollipop_onl" rel="nofollow noopener" target="_blank">Twitter</a></p>\n\n<hr>\n\n<h2>\n<span id="proposal-collection-normalization" class="fragment"></span><a href="#proposal-collection-normalization"><i class="fa fa-link"></i></a><a href="https://github.com/tc39/proposal-collection-normalization" rel="nofollow noopener" target="_blank">proposal-collection-normalization</a>\n</h2>\n\n<p><em>Stage 2</em></p>\n\n<p><strong>Map/SetへKeyとValueを正規化する<br><code>coerceKey</code>と<code>coerceValue</code>の追加</strong></p>\n\n<hr>\n\n<h3>\n<span id="以降実際に動かしてはいません" class="fragment"></span><a href="#%E4%BB%A5%E9%99%8D%E5%AE%9F%E9%9A%9B%E3%81%AB%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%AF%E3%81%84%E3%81%BE%E3%81%9B%E3%82%93"><i class="fa fa-link"></i></a>※以降、実際に動かしてはいません</h3>\n\n<hr>\n\n<h2>\n<span id="keyの正規化オブジェクトのkeyをkeyとして設定する" class="fragment"></span><a href="#key%E3%81%AE%E6%AD%A3%E8%A6%8F%E5%8C%96%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AEkey%E3%82%92key%E3%81%A8%E3%81%97%E3%81%A6%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Keyの正規化①<br>オブジェクトのKeyをKeyとして設定する</h2>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="kd">const</span> <span class="nx">profile</span> <span class="o">=</span> <span class="p">{</span> <span class="na">email</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">simochee@example.com</span><span class="dl">\'</span> <span class="p">};</span>\n\n<span class="kd">const</span> <span class="nx">pointMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">{</span>\n  <span class="na">coerceKey</span><span class="p">:</span> <span class="p">({</span> <span class="nx">email</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">email</span><span class="p">,</span>\n<span class="p">});</span>\n\n<span class="nx">pointMap</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">profile</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span>\n\n<span class="nx">pointMap</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">\'</span><span class="s1">simochee@example.com</span><span class="dl">\'</span><span class="p">);</span> <span class="c1">// 1200</span>\n</pre></div></div>\n\n<hr>\n\n<h2>\n<span id="keyの正規化keyを文字列化させる" class="fragment"></span><a href="#key%E3%81%AE%E6%AD%A3%E8%A6%8F%E5%8C%96key%E3%82%92%E6%96%87%E5%AD%97%E5%88%97%E5%8C%96%E3%81%95%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>Keyの正規化②<br>Keyを文字列化させる</h2>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="kd">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">{</span>\n  <span class="na">coerceKey</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>\n<span class="p">});</span>\n\n<span class="nx">map</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">simochee</span><span class="dl">\'</span><span class="p">);</span>\n<span class="nx">map</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// true</span>\n\n<span class="c1">// map.has(\'1\') // true? false?</span>\n\n<span class="p">[...</span><span class="nx">map</span><span class="p">.</span><span class="nx">entries</span><span class="p">()];</span> <span class="c1">// [[\'1\', \'simochee\']]</span>\n</pre></div></div>\n\n<hr>\n\n<h2>\n<span id="valueの正規化データをインスタンス化させる" class="fragment"></span><a href="#value%E3%81%AE%E6%AD%A3%E8%A6%8F%E5%8C%96%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E5%8C%96%E3%81%95%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>Valueの正規化①<br>データをインスタンス化させる</h2>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="kd">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">{</span>\n  <span class="na">coerceValue</span><span class="p">:</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="nx">user</span> <span class="k">instanceof</span> <span class="nx">UserModel</span>\n      <span class="p">?</span> <span class="nx">user</span>\n      <span class="p">:</span> <span class="k">new</span> <span class="nx">UserModel</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>\n  <span class="p">},</span>\n<span class="p">});</span>\n</pre></div></div>\n\n<hr>\n\n<h2>\n<span id="valueの正規化不正なインスタンスの場合エラーにする" class="fragment"></span><a href="#value%E3%81%AE%E6%AD%A3%E8%A6%8F%E5%8C%96%E4%B8%8D%E6%AD%A3%E3%81%AA%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E5%A0%B4%E5%90%88%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Valueの正規化②<br>不正なインスタンスの場合エラーにする</h2>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><span class="kd">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">{</span>\n  <span class="na">coerceValue</span><span class="p">:</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">user</span> <span class="k">instanceof</span> <span class="nx">UserModel</span><span class="p">))</span> <span class="p">{</span>\n      <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="dl">\'</span><span class="s1">データの方が不正です</span><span class="dl">\'</span><span class="p">);</span>\n    <span class="p">}</span>\n\n    <span class="k">return</span> <span class="nx">user</span><span class="p">;</span>\n  <span class="p">},</span>\n<span class="p">});</span>\n</pre></div></div>\n\n<hr>\n\n<h2>\n<span id="references" class="fragment"></span><a href="#references"><i class="fa fa-link"></i></a>References</h2>\n\n<ul>\n<li><a href="https://github.com/tc39/proposal-collection-normalization" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/tc39/proposal-collection-normalization</a></li>\n</ul>\n',body:"## Profile\n\n<img src=\"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fprofile-images%2F1558357993?ixlib=rb-1.2.2&auto=compress%2Cformat&lossless=0&w=300&s=5680c7c3e731dcc74dc2e6f5eb18d267\" width=\"120px\" />\n・simochee <sub>(しもちぃって読みます)</sub>\n・フロントエンドエンジニア\n・[Qiita (simochee)](https://qiita.com/simochee)\n・[Twitter](https://twitter.com/lollipop_onl)\n\n---\n\n## [proposal-collection-normalization](https://github.com/tc39/proposal-collection-normalization)\n\n*Stage 2*\n\n**Map/SetへKeyとValueを正規化する<br>`coerceKey`と`coerceValue`の追加**\n\n---\n\n### ※以降、実際に動かしてはいません\n\n---\n\n## Keyの正規化①<br>オブジェクトのKeyをKeyとして設定する\n\n```ts\nconst profile = { email: 'simochee@example.com' };\n\nconst pointMap = new Map(undefined, {\n  coerceKey: ({ email }) => email,\n});\n\npointMap.set(profile, 1200);\n\npointMap.get('simochee@example.com'); // 1200\n```\n\n---\n\n## Keyの正規化②<br>Keyを文字列化させる\n\n```ts\nconst map = new Map(undefined, {\n  coerceKey: String,\n});\n\nmap.set(1, 'simochee');\nmap.has(1); // true\n\n// map.has('1') // true? false?\n\n[...map.entries()]; // [['1', 'simochee']]\n```\n\n---\n\n## Valueの正規化①<br>データをインスタンス化させる\n\n```ts\nconst map = new Map(undefined, {\n  coerceValue: (user) => {\n    return user instanceof UserModel\n      ? user\n      : new UserModel(user);\n  },\n});\n```\n\n---\n\n## Valueの正規化②<br>不正なインスタンスの場合エラーにする\n\n```ts\nconst map = new Map(undefined, {\n  coerceValue: (user) => {\n    if (!(user instanceof UserModel)) {\n      throw new TypeError('データの方が不正です');\n    }\n\n    return user;\n  },\n});\n```\n\n---\n\n## References\n\n* https://github.com/tc39/proposal-collection-normalization\n",coediting:a,comments_count:0,created_at:"2019-10-08T09:52:33+09:00",group:p,id:"197dd4ecf1ec7aca4366",likes_count:2,private:a,reactions_count:0,tags:[{name:"TC39",versions:[]}],title:"proposal-collection-normalization",updated_at:"2019-10-09T20:26:14+09:00",url:"https://qiita.com/simochee/items/197dd4ecf1ec7aca4366",user:{description:c,facebook_id:s,followees_count:9,followers_count:14,github_login_name:o,id:i,items_count:27,linkedin_id:s,location:r,name:s,organization:s,permanent_id:d,profile_image_url:m,team_only:a,twitter_screen_name:u,website_url:s},page_views_count:p},{rendered_body:'\n<h1>\n<span id="事象" class="fragment"></span><a href="#%E4%BA%8B%E8%B1%A1"><i class="fa fa-link"></i></a>事象</h1>\n\n<p><code>is</code>属性で要素名を指定しているコンポーネントに対して、<code>v-model</code>を使用すると、<code>v-model</code>が機能しなくなりました。</p>\n\n<p>どういうことかは例を見ていただくと早いです。</p>\n\n<h2>\n<span id="正常" class="fragment"></span><a href="#%E6%AD%A3%E5%B8%B8"><i class="fa fa-link"></i></a>正常</h2>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">v-model=</span><span class="s">"value"</span><span class="nt">&gt;</span>\n</pre></div></div>\n\n<blockquote>\n<p><a href="https://jsfiddle.net/simochee/fjdvowr7/4" class="autolink" rel="nofollow noopener" target="_blank">https://jsfiddle.net/simochee/fjdvowr7/4</a></p>\n</blockquote>\n\n<h2>\n<span id="異常" class="fragment"></span><a href="#%E7%95%B0%E5%B8%B8"><i class="fa fa-link"></i></a>異常</h2>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">is=</span><span class="s">"input"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">v-model=</span><span class="s">"value"</span><span class="nt">&gt;</span>\n</pre></div></div>\n\n<blockquote>\n<p><a href="https://jsfiddle.net/simochee/fjdvowr7/5" class="autolink" rel="nofollow noopener" target="_blank">https://jsfiddle.net/simochee/fjdvowr7/5</a></p>\n</blockquote>\n\n<h1>\n<span id="原因" class="fragment"></span><a href="#%E5%8E%9F%E5%9B%A0"><i class="fa fa-link"></i></a>原因</h1>\n\n<p>なぜこんな挙動になるのか、それを解決する記述を見つけることはできませんでした。</p>\n\n<p>ともかく<code>is</code>と<code>v-model</code>は併用しないよう気をつけましょう。</p>\n\n<h1>\n<span id="おまけ" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91"><i class="fa fa-link"></i></a>おまけ</h1>\n\n<p>疑似<code>v-model</code>の場合は更に奇妙な挙動になりました。</p>\n\n<p>初期値は設定されるし、入力値は設定できるものの、代入による値を上書きできなくなります。</p>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><span class="nt">&lt;div</span>\n  <span class="na">is=</span><span class="s">"input"</span>\n  <span class="na">type=</span><span class="s">"text"</span>\n  <span class="na">:value=</span><span class="s">"value"</span>\n  <span class="err">@</span><span class="na">input=</span><span class="s">"value = $event.target.value"</span>\n<span class="nt">&gt;</span>\n</pre></div></div>\n\n<blockquote>\n<p><a href="https://jsfiddle.net/simochee/fjdvowr7/7/" class="autolink" rel="nofollow noopener" target="_blank">https://jsfiddle.net/simochee/fjdvowr7/7/</a></p>\n</blockquote>\n',body:'# 事象\n\n`is`属性で要素名を指定しているコンポーネントに対して、`v-model`を使用すると、`v-model`が機能しなくなりました。\n\nどういうことかは例を見ていただくと早いです。\n\n## 正常\n\n```html\n<input type="text" v-model="value">\n```\n\n> https://jsfiddle.net/simochee/fjdvowr7/4\n\n## 異常\n\n```html\n<div is="input" type="text" v-model="value">\n```\n\n> https://jsfiddle.net/simochee/fjdvowr7/5\n\n# 原因\n\nなぜこんな挙動になるのか、それを解決する記述を見つけることはできませんでした。\n\nともかく`is`と`v-model`は併用しないよう気をつけましょう。\n\n# おまけ\n\n疑似`v-model`の場合は更に奇妙な挙動になりました。\n\n初期値は設定されるし、入力値は設定できるものの、代入による値を上書きできなくなります。\n\n```html\n<div\n  is="input"\n  type="text"\n  :value="value"\n  @input="value = $event.target.value"\n>\n```\n\n> https://jsfiddle.net/simochee/fjdvowr7/7/\n',coediting:a,comments_count:0,created_at:h,group:p,id:"b903cbf9227120d92e7e",likes_count:0,private:a,reactions_count:0,tags:[{name:x,versions:[]}],title:"Vueのisとv-modelは併用してはいけない",updated_at:h,url:"https://qiita.com/simochee/items/b903cbf9227120d92e7e",user:{description:c,facebook_id:s,followees_count:9,followers_count:14,github_login_name:o,id:i,items_count:27,linkedin_id:s,location:r,name:s,organization:s,permanent_id:d,profile_image_url:m,team_only:a,twitter_screen_name:u,website_url:s},page_views_count:p}]}],error:p,serverRendered:!0}}("",!1,0,null,0,"Nuxt & TypeScript大好きマンです",0,0,"tamuraryoya","simochee","Chiba, Japan",127934,"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/profile-images/1558357993","lollipop_onl","2019-10-17T21:35:57+09:00","Vue.js","2019-09-12T10:12:34+09:00")</script><script src="/_nuxt/f62ea000a860f007d223.js" defer></script><script src="/_nuxt/61a4f66024b75752c21d.js" defer></script><script src="/_nuxt/aba86204b870b3f85761.js" defer></script><script src="/_nuxt/539483b3328220de0cef.js" defer></script>
  </body>
</html>
