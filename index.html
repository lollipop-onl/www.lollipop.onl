<!doctype html>
<html data-n-head-ssr>
  <head>
    <title>www.lollipop.onl</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="Welcome to simochee's portfolio!"><link data-n-head="ssr" rel="stylesheet" href="//lollipop-onl.github.io/webfonts.lollipop.onl/Ronde-B-Square.css"><link rel="preload" href="/_nuxt/155dd73f6b0b2b931a90.js" as="script"><link rel="preload" href="/_nuxt/ef8eb22d59ee9fe25327.js" as="script"><link rel="preload" href="/_nuxt/39686abb48b4935114da.css" as="style"><link rel="preload" href="/_nuxt/22a5f94eeb032400948e.js" as="script"><link rel="preload" href="/_nuxt/c5d3b4f3037bf0d4ed79.css" as="style"><link rel="preload" href="/_nuxt/c964435de51fda9f2a43.js" as="script"><link rel="stylesheet" href="/_nuxt/39686abb48b4935114da.css"><link rel="stylesheet" href="/_nuxt/c5d3b4f3037bf0d4ed79.css">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div data-v-70bd6132><div class="main-content" data-v-70bd6132><div class="side" data-v-70bd6132><div class="my-profile profile" data-v-211d068e data-v-70bd6132><img src="/_nuxt/img/0590137.jpg" alt="simochee" class="avatar" data-v-211d068e><div class="name" data-v-211d068e>simochee</div><div class="fullname" data-v-211d068e>Ryoya Tamura</div><div class="socials" data-v-211d068e><a target="_blank" rel="noopener" href="https://twitter.com/lollipop_onl" data-name="lollipop_onl" class="social" data-v-50cdca9b data-v-211d068e><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUwIiBoZWlnaHQ9IjIwMyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0tNzUtOThoNDAwdjQwMEgtNzV6Ii8+PHBhdGggZD0iTTc5IDIwNGM5NCAwIDE0Ni03OSAxNDYtMTQ2bC0xLTdjMTAtNyAxOS0xNiAyNi0yNy05IDUtMTkgNy0yOSA5IDEwLTcgMTgtMTcgMjItMjktMTAgNi0yMSAxMC0zMiAxM2E1MSA1MSAwIDAwLTg4IDQ2QzgyIDYxIDQzIDQyIDE3IDEwIDQgMzMgMTEgNjMgMzMgNzhjLTggMC0xNi0yLTIzLTZ2MWMwIDI0IDE3IDQ1IDQxIDUwLTcgMi0xNSAyLTIzIDEgNyAyMSAyNiAzNSA0OCAzNWExMDMgMTAzIDAgMDEtNzYgMjJjMjMgMTUgNTEgMjMgNzkgMjMiIGZpbGw9IiMxREExRjIiIGZpbGwtcnVsZT0ibm9uemVybyIvPjwvZz48L3N2Zz4K" alt="lollipop_onl" class="icon" data-v-50cdca9b data-v-211d068e></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee" data-name="simochee" class="social" data-v-50cdca9b data-v-211d068e><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSIjNTliYjBjIiBkPSJNMCAwaDI1NnYyNTZIMHoiLz48cGF0aCBkPSJNMjExIDE4MWExNDQgMTQ0IDAgMDAyOC04NiAxNDEgMTQxIDAgMDAtMzgtOTVIMHYyMDBjMjUgMjQgNTkgMzggOTggMzhhMTQwIDE0MCAwIDAwODEtMjZsNDYgNDQgMzEtMzJ6TTk3IDE5M0E5NyA5NyAwIDAxODIgMGgzMGE5NyA5NyAwIDAxLTE1IDE5M3oiIGZpbGw9IiNmZmYiLz48cGF0aCBkYXRhLW5hbWU9IiZsdDvjgrnjg6njgqTjgrkmZ3Q7IiBmaWxsPSJub25lIiBkPSJNMCAwaDI1NnYyNTZIMHoiLz48L3N2Zz4K" alt="simochee" class="icon" data-v-50cdca9b data-v-211d068e></a><a target="_blank" rel="noopener" href="https://github.com/lollipop-onl" data-name="lollipop-onl" class="social" data-v-50cdca9b data-v-211d068e><img src="/_nuxt/img/3e1a79e.svg" alt="lollipop-onl" class="icon" data-v-50cdca9b data-v-211d068e></a><a target="_blank" rel="noopener" href="https://npmjs.com/~lollipop-onl" data-name="lollipop-onl" class="social" data-v-50cdca9b data-v-211d068e><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTAgMTZWMGgxNnYxNnpNMyAzdjEwaDVWNWgzdjhoMlYzeiIgZmlsbD0iI2MxMjEyNyIvPjxwYXRoIGQ9Ik0zIDNoMTB2MTBoLTJWNUg4djhIM3oiIGZpbGw9IiNmZmYiLz48L3N2Zz4K" alt="lollipop-onl" class="icon" data-v-50cdca9b data-v-211d068e></a></div><p class="description" data-v-211d068e></p><p>NuxtとTypeScript大好き芸人
最近の趣味はTypeScriptでいかにきれいな型エラーを表示させるかの探求</p>
<p>技術書典８ Day2 く30 ロリポップランチャーにて「フロントエンドエンジニアのためのGitHub Actionsレシピ」頒布</p>
<p></p></div></div><div class="main" data-v-70bd6132><section class="page-section section" data-v-fa957afe data-v-70bd6132><div class="header" data-v-fa957afe><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTYgMjU2Ij48cGF0aCBmaWxsPSIjNTliYjBjIiBkPSJNMCAwaDI1NnYyNTZIMHoiLz48cGF0aCBkPSJNMjExIDE4MWExNDQgMTQ0IDAgMDAyOC04NiAxNDEgMTQxIDAgMDAtMzgtOTVIMHYyMDBjMjUgMjQgNTkgMzggOTggMzhhMTQwIDE0MCAwIDAwODEtMjZsNDYgNDQgMzEtMzJ6TTk3IDE5M0E5NyA5NyAwIDAxODIgMGgzMGE5NyA5NyAwIDAxLTE1IDE5M3oiIGZpbGw9IiNmZmYiLz48cGF0aCBkYXRhLW5hbWU9IiZsdDvjgrnjg6njgqTjgrkmZ3Q7IiBmaWxsPSJub25lIiBkPSJNMCAwaDI1NnYyNTZIMHoiLz48L3N2Zz4K" alt="" class="icon" data-v-fa957afe data-v-70bd6132><h2 class="title" data-v-fa957afe>Qiita feeds</h2></div><div class="content" data-v-fa957afe><div data-v-f8179936 data-v-70bd6132><div class="qiita-item-list" data-v-f8179936><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/367ff4b90cbbfd0055c5" class="qiita-item item" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/1325d873-e558-d97c-11f4-d246d1740b7b.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>JavaScript</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>parcel</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>7</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>いろいろ試そう Parcel 2@beta</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>a year</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/5cdda06b099ae3b7a36a" class="qiita-item item" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>JavaScript</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>TypeScript</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>gatsby</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>4</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>2行でgatsby-config.jsで補完を効かせる方法</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>a year</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/58f04385713dd65f69f5" class="qiita-item item" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>github-pages</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>Hexo</li></ul><!----></div><div class="title" data-v-50cdca9b data-v-aa5e3380>Hexo × GitHub Pagesでカスタムドメインをつける</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/b3d4dc15f474f805573c" class="qiita-item item" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>TypeScript</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>18</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>TypeScriptでInputEventを扱うときの正しいアプローチ</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/ba7264cc679f2508c782" class="qiita-item item" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>ReVIEW</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>GitHubActions</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>7</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>GitHub ActionsでRe:VIEW原稿をビルドする</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/aed30b6240664dccbdb9" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>Markdown</li></ul><!----></div><div class="title" data-v-50cdca9b data-v-aa5e3380>Markdownで行内改行する方法</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/89f4b17fe971b4571961" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/7fe68a26-2ac6-6eea-5f13-b5618543b52b.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>AdventCalendar</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>TypeScript</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>Vue.js</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>7</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>TypeScriptでVue.set/deleteを型安全にするライブラリ作った</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/a2eca2ea8761409889be" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/73594c50-bdf8-3fcd-1905-98888e9ac927.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>TypeScript</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>nuxt.js</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>25</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>Nuxt.jsでTypeScript 3.7を使う</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/fbca7cb6c69e82484873" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>nuxt.js</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>40</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>nuxt-childでlayoutの量産を防ぐ</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/234c2a8203ac951bef19" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>bookmarklet</li></ul><!----></div><div class="title" data-v-50cdca9b data-v-aa5e3380>見ているサイトのタイトルをコピーするブックマークレット</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/4d31414cb612f96a4c9f" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/a1094d7b-132c-344f-839e-65d5086534ee.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>TypeScript</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>Vue.js</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>29</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>TypeScriptでVue.setを型安全にしたい</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/197dd4ecf1ec7aca4366" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>TC39</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>2</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>proposal-collection-normalization</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/b903cbf9227120d92e7e" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>Vue.js</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>1</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>Vueのisとv-modelは併用してはいけない</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/126f42f2e42fcf194515" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>TypeScript</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>ESLint</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>eslint-plugin-vue</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>4</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>vue-eslint-parserには@typescript-eslint v2との互換性がない</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/344a183c6d05a7d5d7b4" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>NVIDIA</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>LinuxMint</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>xserver</li></ul><!----></div><div class="title" data-v-50cdca9b data-v-aa5e3380>Linux MintがXserverがどうので起動しなくなった</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/77e074e48d036ce2444b" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>TypeScript</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>nuxt.js</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>33</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>Nuxt×TypeScriptでfetch, asyncDataの引数に型を指定する</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/3e537f530ca94ce6fb3a" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>bem</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>rscss</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>4</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>[BEM to RSCSS] Quick Migration Guide</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/a8057324e1d557cc7ffd" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>TypeScript</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>Vue.js</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>vue-property-decorator</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>1</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>VueでWatch対象のパスを安全に指定できるライブラリ vuekey を作った</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/e5b77af4aa36bd0f32e5" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>TypeScript</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>Vue.js</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>nuxt.js</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>vue-property-decorator</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>nuxt-property-decorator</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>473</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>はじめてのvue-property-decorator (nuxtにも対応）</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a><a target="_blank" rel="noopener" href="https://qiita.com/simochee/items/fa667a33c118766ee55a" class="qiita-item item" style="display:none" data-v-50cdca9b data-v-aa5e3380 data-v-f8179936><div class="thumbnail" data-v-50cdca9b data-v-aa5e3380><div class="skeleton" data-v-50cdca9b data-v-aa5e3380></div><img src="//placehold.jp/320x320.png" class="image" data-v-50cdca9b data-v-aa5e3380></div><div class="detail" data-v-50cdca9b data-v-aa5e3380><ul class="tags" data-v-50cdca9b data-v-aa5e3380><li class="tag" data-v-50cdca9b data-v-aa5e3380>TypeScript</li><li class="tag" data-v-50cdca9b data-v-aa5e3380>Vuex</li></ul><div class="likes" data-v-50cdca9b data-v-aa5e3380>11</div></div><div class="title" data-v-50cdca9b data-v-aa5e3380>TypeScriptでVuexの型ユーティリティを作ろう</div><div class="updated" data-v-50cdca9b data-v-aa5e3380>2 years</div></a></div><button class="more-button" data-v-f8179936>SHOW MORE POSTS</button></div></div></section><section class="page-section section" data-v-fa957afe data-v-70bd6132><div class="header" data-v-fa957afe><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+PHBhdGggZD0iTTAgMTZWMGgxNnYxNnpNMyAzdjEwaDVWNWgzdjhoMlYzeiIgZmlsbD0iI2MxMjEyNyIvPjxwYXRoIGQ9Ik0zIDNoMTB2MTBoLTJWNUg4djhIM3oiIGZpbGw9IiNmZmYiLz48L3N2Zz4K" alt="" class="icon" data-v-fa957afe data-v-70bd6132><h2 class="title" data-v-fa957afe>NPM Packages</h2></div><div class="content" data-v-fa957afe><ul class="npm-package-list" data-v-06280f96 data-v-70bd6132><li class="npm-package package" data-v-6f5d3cb5 data-v-06280f96><div class="header" data-v-6f5d3cb5><div class="name" data-v-6f5d3cb5>@lollipop-onl/vue-typed-reactive</div><button class="copy" data-v-6f5d3cb5>> Copy</button></div><div class="detail" data-v-6f5d3cb5><div class="version" data-v-6f5d3cb5>v1.1.3</div><div class="updated" data-v-6f5d3cb5>Last publish: in 7 months</div><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/%40lollipop-onl%2Fvue-typed-reactive" class="link" data-v-50cdca9b data-v-6f5d3cb5>Browse on npm</a></div><div class="description" data-v-6f5d3cb5><p>Provide type-safe Vue.set/Vue.delete mehtods</p>
</div></li><li class="npm-package package" data-v-6f5d3cb5 data-v-06280f96><div class="header" data-v-6f5d3cb5><div class="name" data-v-6f5d3cb5>@lollipop-onl/axios-logger</div><button class="copy" data-v-6f5d3cb5>> Copy</button></div><div class="detail" data-v-6f5d3cb5><div class="version" data-v-6f5d3cb5>v0.2.3</div><div class="updated" data-v-6f5d3cb5>Last publish: in 3 months</div><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/%40lollipop-onl%2Faxios-logger" class="link" data-v-50cdca9b data-v-6f5d3cb5>Browse on npm</a></div><div class="description" data-v-6f5d3cb5><p>Pretty Axios logger</p>
</div></li><li class="npm-package package" data-v-6f5d3cb5 data-v-06280f96><div class="header" data-v-6f5d3cb5><div class="name" data-v-6f5d3cb5>@lollipop-onl/vuekey</div><button class="copy" data-v-6f5d3cb5>> Copy</button></div><div class="detail" data-v-6f5d3cb5><div class="version" data-v-6f5d3cb5>v0.1.1</div><div class="updated" data-v-6f5d3cb5>Last publish: in 2 years</div><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/%40lollipop-onl%2Fvuekey" class="link" data-v-50cdca9b data-v-6f5d3cb5>Browse on npm</a></div><div class="description" data-v-6f5d3cb5><p><code>vuekey</code> is a library of typesafe data path for <a target="_blank" href="https://github.com/kaorun343/vue-property-decorator#Watch"><code>@Watch</code></a> and <code>vm.set</code>.</p>
</div></li></ul></div></section><section class="page-section section" data-v-fa957afe data-v-70bd6132><div class="header" data-v-fa957afe><h2 class="title" data-v-fa957afe>Web tools</h2></div><div class="content" data-v-fa957afe></div></section><section class="page-section section" data-v-fa957afe data-v-70bd6132><div class="header" data-v-fa957afe><img src="https://placehold.jp/320x320.png" alt="" class="icon" data-v-fa957afe data-v-70bd6132><h2 class="title" data-v-fa957afe>Books</h2></div><div class="content" data-v-fa957afe><ul class="book-item-list" data-v-6744f33a data-v-70bd6132><li class="item" data-v-6744f33a><div class="book-item" data-v-117fc4cb data-v-6744f33a><img src="/images/books/techbook-cover-gh-actions.png" alt="書籍カバー" class="cover" data-v-117fc4cb><div class="details" data-v-117fc4cb><div class="title" data-v-117fc4cb>GitHub Actions Recipe</div><div class="subtitle" data-v-117fc4cb>フロントエンドエンジニアのためのレシピ集</div><div class="published" data-v-117fc4cb>初出: 技術書典8 Day2</div><p class="lead" data-v-117fc4cb>フロントエンドの開発には、自動化すると効率が良くなるタスクがたくさん存在します。
本書ではいくつかのタスクをGitHub Actionsで自動化するワークフローのレシピをご紹介します。
</p><div class="external-links links" data-v-117fc4cb><a target="_blank" rel="noopener" href="https://techbookfest8-gh-actions.resources.lollipop.onl" class="link" data-v-50cdca9b data-v-117fc4cb>ダウンロードコンテンツ</a><a target="_blank" rel="noopener" href="/" class="link" data-v-50cdca9b data-v-117fc4cb>物理本 BOOTH販売ページ</a><a target="_blank" rel="noopener" href="/" class="link" data-v-50cdca9b data-v-117fc4cb>PDF本 BOOTH販売ページ</a></div></div></div></li><li class="item" data-v-6744f33a><div class="book-item" data-v-117fc4cb data-v-6744f33a><img src="/images/books/techbook-cover-eslint.png" alt="書籍カバー" class="cover" data-v-117fc4cb><div class="details" data-v-117fc4cb><div class="title" data-v-117fc4cb>Stylish ESLint Rules</div><div class="subtitle" data-v-117fc4cb>こだわりのコードを実現する63のルール</div><div class="published" data-v-117fc4cb>初出: 技術書典8 Day2 (2020/03/01)</div><p class="lead" data-v-117fc4cb>ESLintルールの中から、コードの「スタイル」をチェックする自動修正可能なルールをまとめました。
</p><div class="external-links links" data-v-117fc4cb><a target="_blank" rel="noopener" href="https://techbookfest8-gh-actions.resources.lollipop.onl" class="link" data-v-50cdca9b data-v-117fc4cb>ダウンロードコンテンツ</a><a target="_blank" rel="noopener" href="/" class="link" data-v-50cdca9b data-v-117fc4cb>物理本 BOOTH販売ページ</a><a target="_blank" rel="noopener" href="/" class="link" data-v-50cdca9b data-v-117fc4cb>PDF本 BOOTH販売ページ</a></div></div></div></li></ul></div></section></div></div><footer class="the-footer" data-v-47d45dfc data-v-70bd6132><div class="fugu" data-v-47d45dfc><img src="/_nuxt/img/89cd864.png" class="avatar" data-v-47d45dfc><div class="bubbles" data-v-47d45dfc></div></div></footer></div></div></div><script>window.__NUXT__=function(s,a,n,p,e,c,l,t,o,i,d,r,u,m,g,f,h,x,v,y,b,k,E,A,w,_,V,C,T,S,B,P,j){return{layout:"default",data:[{qiitaItems:[{rendered_body:'\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p>去る 2020年6月19日、Parcel v2のベータバージョンがリリースされました。</p>\n\n<blockquote>\n<p><a href="https://medium.com/@devongovett/parcel-2-beta-1-improved-stability-tree-shaking-source-map-performance-and-more-78179779e8b7" rel="nofollow noopener" target="_blank">📦 Parcel 2 beta 1: improved stability, tree shaking, source map performance, and more! 🚀</a></p>\n</blockquote>\n\n<p></p><blockquote class="twitter-tweet">\n<p>🚀 Parcel 2 beta 1 has been released!<br><br>🌳 Improved tree shaking<br>🗺 20x faster source map builds<br>#️⃣ Improved content hashing<br>🚨 Resolver diagnostics<br>📊 More accurate bundle reports<br>🐞 Tons of bugfixes!<br><br>📝 Read more: <a href="https://t.co/hMGtOKEOs3" rel="nofollow noopener" target="_blank"></a><a href="https://t.co/hMGtOKEOs3" class="autolink" rel="nofollow noopener" target="_blank">https://t.co/hMGtOKEOs3</a><br>🌎 New website! <a href="https://t.co/SWaS5OvWIA" rel="nofollow noopener" target="_blank"></a><a href="https://t.co/SWaS5OvWIA" class="autolink" rel="nofollow noopener" target="_blank">https://t.co/SWaS5OvWIA</a></p>— Devon Govett (@devongovett) <a href="https://twitter.com/devongovett/status/1273685386020024320?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">June 18, 2020</a>\n</blockquote> <script async src="https://platform.twitter.com/widgets.js"><\/script>\n\n<p>この記事では、Parcel v2の基本的な使い方から、いくつかのAltJS・ライブラリをParcelでコンパイルするテンプレートについて説明します。</p>\n\n<p>なお、この記事の内容は<a href="https://github.com/parcel-bundler/parcel/tree/v2.0.0-beta.1" rel="nofollow noopener" target="_blank"><code>v2.0.0-beta.1</code></a>時点でのドキュメント、ソースコードをベースにしています。<br>\nまた、無印のParcelを <strong>Parcel v1</strong>、新しいv2を <strong>Parcel v2</strong>と表記します。</p>\n\n<h1>\n<span id="オフィシャルドキュメント" class="fragment"></span><a href="#%E3%82%AA%E3%83%95%E3%82%A3%E3%82%B7%E3%83%A3%E3%83%AB%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>オフィシャルドキュメント</h1>\n\n<p>Parcel v1のドキュメントは <a href="https://parceljs.org/" class="autolink" rel="nofollow noopener" target="_blank">https://parceljs.org/</a> でしたが、v2ではURLが代わり <a href="https://v2.parceljs.org/" class="autolink" rel="nofollow noopener" target="_blank">https://v2.parceljs.org/</a> （未完成）がドキュメントとして提供されています。</p>\n\n<p><a href="https://v2.parceljs.org/" rel="nofollow noopener" target="_blank"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F1325d873-e558-d97c-11f4-d246d1740b7b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2249c010f589e53c5231f3b2c19351b5" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/1325d873-e558-d97c-11f4-d246d1740b7b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F1325d873-e558-d97c-11f4-d246d1740b7b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=89a5f7714f85c80372865cd6ec388be1 1x" loading="lazy"></a><br>\n▲ Parcel v2のドキュメント</p>\n\n<h1>\n<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h1>\n\n<p>Parcel v1のパッケージは<code>parcel-bundler</code>という名前で公開されていましたが、Parcel v2からパッケージ名が<code>parcel</code>となりました。</p>\n\n<p>また、現在のParcel v2はベータ版のため、バージョンを<code>@next</code>と指定してインストールします。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre class="with-code"><code><span class="nv">$ </span>yarn add <span class="nt">-D</span> parcel@next\n</code></pre></div></div>\n\n<h1>\n<span id="設定ファイル" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB"><i class="fa fa-link"></i></a>設定ファイル</h1>\n\n<p>Parcel v2では、<code>.parcelrc</code>という設定ファイルを使用できるようになりました。<br>\n<code>.parcelrc</code>を指定しなかった場合は、デフォルトの設定（<a href="https://github.com/parcel-bundler/parcel/tree/v2.0.0-beta.1/packages/configs/default" rel="nofollow noopener" target="_blank"><code>@parcel/config-default</code></a>）でバンドルされます。</p>\n\n<p><code>.parcelrc</code>はParcelのプラグインを種類ごとに設定します。</p>\n\n<p>設定できるプラグインの種類は次のとおりです。</p>\n\n<ul>\n<li>\n<a href="https://github.com/parcel-bundler/parcel#resolvers" rel="nofollow noopener" target="_blank">Resolvers</a>\n\n<ul>\n<li>ファイルやパッケージ、アセットを解決するプラグイン</li>\n</ul>\n</li>\n<li>\n<a href="https://github.com/parcel-bundler/parcel#transformers" rel="nofollow noopener" target="_blank">Transformers</a>\n\n<ul>\n<li>ソースコードを変換（トランスパイル）するプラグイン</li>\n<li>公式でBabelやTypeScript、Vue、Yamlなどのトランスフォーマが提供されている</li>\n</ul>\n</li>\n<li>\n<a href="https://github.com/parcel-bundler/parcel#bundlers" rel="nofollow noopener" target="_blank">Bundlers</a>\n\n<ul>\n<li>アセットをバンドルするプラグイン</li>\n</ul>\n</li>\n<li>\n<a href="https://github.com/parcel-bundler/parcel#namers" rel="nofollow noopener" target="_blank">Namers</a>\n\n<ul>\n<li>ファイルの命名やコンテントハッシュなどを付与するプラグイン</li>\n</ul>\n</li>\n<li>\n<a href="https://github.com/parcel-bundler/parcel#runtimes" rel="nofollow noopener" target="_blank">Runtimes</a>\n\n<ul>\n<li>バンドラーフェーズのあとに最終的にバンドルに含まれるアセット（HMRのコードなど）を生成するプラグイン</li>\n</ul>\n</li>\n<li>\n<a href="https://github.com/parcel-bundler/parcel#packagers" rel="nofollow noopener" target="_blank">Packagers</a>\n\n<ul>\n<li>異なるアセットタイプを単一のバンドルにマージするプラグイン</li>\n</ul>\n</li>\n<li>\n<a href="https://github.com/parcel-bundler/parcel#optimizers" rel="nofollow noopener" target="_blank">Optimizers</a>\n\n<ul>\n<li>バンドルを最適化するプラグイン</li>\n</ul>\n</li>\n<li>\n<a href="https://github.com/parcel-bundler/parcel#reporters" rel="nofollow noopener" target="_blank">Reporters</a>\n\n<ul>\n<li>Parcelでのイベントを受け取ってロガーに出力したり、ログファイルを生成するプラグイン</li>\n</ul>\n</li>\n<li>\n<a href="https://github.com/parcel-bundler/parcel#validators" rel="nofollow noopener" target="_blank">Validators</a>\n\n<ul>\n<li>ビルド後にソースコードの検証を行いエラーを表示するプラグイン</li>\n</ul>\n</li>\n</ul>\n\n<p>いずれのプラグインも自作が可能ですが、基本的な機能は公式パッケージとして公開されているものを使用すれば問題ないでしょう。</p>\n\n<p>もし、個別の<code>.parcelrc</code>を設定する場合はデフォルトの設定に追加する形で定義するとよいでしょう。</p>\n\n<div class="code-frame" data-lang="parcelrc"><div class="highlight"><pre class="with-code"><code>{\n  // デフォルトの設定を継承する\n  "extends": "@parcel/config-default",\n  "optimizers": {\n    "*.{png,jpg}": ["@parcel/optimizer-awesome-images"]\n  }\n}\n</code></pre></div></div>\n\n<p>また、ある拡張子にプラグインを追加する際は、デフォルトの設定を引き継ぐよう<code>...</code>を最後に記載するようにしましょう。</p>\n\n<div class="code-frame" data-lang="parcelrc"><div class="highlight"><pre class="with-code"><code>{\n  "extends": "@parcel/config-default",\n  "transforers": {\n    // デフォルト設定が引き継がれないためコンパイルできない\n    "*.{ts,tsx}": [],\n    // ... で extends で継承された設定を引き継ぐ\n    "*.{ts,tsx}": ["..."],\n  }\n}\n</code></pre></div></div>\n\n<h1>\n<span id="いろいろ試してみよう" class="fragment"></span><a href="#%E3%81%84%E3%82%8D%E3%81%84%E3%82%8D%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>いろいろ試してみよう</h1>\n\n<p>ここからは、Parcel v2でいろいろなAltJS、ライブラリをバンドルする設定を見ていきましょう。<br>\nそれぞれ、GitHubでソースコードを公開しています。</p>\n\n<p>また、公式のリポジトリにも<a href="https://github.com/parcel-bundler/parcel/tree/v2.0.0-beta.1/packages/examples" rel="nofollow noopener" target="_blank">いくつかのサンプルプロジェクト</a>が用意されています。</p>\n\n<h2>\n<span id="pug--sass" class="fragment"></span><a href="#pug--sass"><i class="fa fa-link"></i></a>Pug + Sass</h2>\n\n<p>テンプレートエンジンのPugとCSSプリプロセッサのSassを使用したサンプルです。</p>\n\n<blockquote>\n<p><a href="https://github.com/lollipop-onl/parcel-v2-playground" rel="nofollow noopener" target="_blank">サンプルリポジトリ</a></p>\n</blockquote>\n\n<h3>\n<span id="開発環境構築" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89"><i class="fa fa-link"></i></a>開発環境構築</h3>\n\n<p>サンプルリポジトリの開発環境構築の手順を紹介します。</p>\n\n<p>ここでは、次の構成でファイルを配置しています。<br>\nそれぞれのファイルの内容はサンプルリポジトリでご確認ください。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>.\n├── src/\n│   ├── index.pug\n│   └── styles.sass\n└── package.json\n</code></pre></div></div>\n\n<p>PugとSassの設定はデフォルトで定義されているため、<code>.parcelrc</code>ファイルでの設定は必要ありません。<br>\n（<a href="https://github.com/parcel-bundler/parcel/blob/d24e09a9797af41a9d2c6c733b1c6cf6671d60c7/packages/configs/default/index.json#L21" rel="nofollow noopener" target="_blank">Pugの設定</a>・<a href="https://github.com/parcel-bundler/parcel/blob/d24e09a9797af41a9d2c6c733b1c6cf6671d60c7/packages/configs/default/index.json#L13" rel="nofollow noopener" target="_blank">Sassの設定</a>）</p>\n\n<p>インストールした依存関係は<code>parcel@next</code>と次のパッケージです。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre class="with-code"><code><span class="nv">$ </span>yarn add <span class="nt">-D</span> pug sass\n\n<span class="c"># reset.css</span>\n<span class="nv">$ </span>yarn add reset-css\n</code></pre></div></div>\n\n<p>ここまでできたら、Parcelで開発サーバーを起動します。<br>\n<code>serve</code>コマンドは省略できます。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre class="with-code"><code><span class="nv">$ </span>yarn parcel serve src/index.pug\n</code></pre></div></div>\n\n<p>ポートを指定していない場合、<code>http://localhost:1234</code>で開発サーバーが起動します。</p>\n\n<p><a href="https://camo.qiitausercontent.com/c940a4ed47bfdb734cadac9a26c069893be2611e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132373933342f61336630656237352d303561652d626265612d313365332d6564393562393362316535352e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fa3f0eb75-05ae-bbea-13e3-ed95b93b1e55.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5b34610156588a482d396e8474bd1225" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/a3f0eb75-05ae-bbea-13e3-ed95b93b1e55.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fa3f0eb75-05ae-bbea-13e3-ed95b93b1e55.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=fd6860e5c30af0de55499d64e290a6f8 1x" loading="lazy"></a></p>\n\n<p>あとは、Pugファイル、Sassファイルへ変更を加えるとHMRで表示中の内容が入れ替わります。</p>\n\n<p>以上でPugとSassの開発環境ができました！かんたんですね。</p>\n\n<h3>\n<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h3>\n\n<ul>\n<li><code>yarn add -D parcel@next pug sass</code></li>\n<li>PugとSassを記述</li>\n<li><code>yarn parcel serve src/index.pug</code></li>\n<li>\n<a href="http://localhost:1234" class="autolink" rel="nofollow noopener" target="_blank">http://localhost:1234</a> を開く</li>\n</ul>\n\n<h3>\n<span id="余談" class="fragment"></span><a href="#%E4%BD%99%E8%AB%87"><i class="fa fa-link"></i></a>余談</h3>\n\n<p>Parcelでは、Sassから<code>node_modules</code>へインストールされたパッケージをインポートする際、パッケージ名のプレフィックスとして<code>~</code>を<strong>必要としません</strong>。</p>\n\n<p><code>~package-name</code>の指定は本来、Webpackでのシンタックスのようで、ParcelのCLI上では次のようにレポートされます。</p>\n\n<p><a href="https://camo.qiitausercontent.com/894d1e5ad20b3a3121835aff0c019fd83381e1a9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132373933342f65663434653038332d376439322d656361332d643331342d6366353733396236363931322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fef44e083-7d92-eca3-d314-cf5739b66912.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f95e30e7e57e7cf774007492d25ff7ba" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/ef44e083-7d92-eca3-d314-cf5739b66912.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fef44e083-7d92-eca3-d314-cf5739b66912.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=a08e845fc59eebfeb912c766ddd921c7 1x" loading="lazy"></a></p>\n\n<p>具体的な理由まで書かれていて、とても親切なエラーメッセージですね！</p>\n\n<h2>\n<span id="react--css-modules" class="fragment"></span><a href="#react--css-modules"><i class="fa fa-link"></i></a>React + CSS Modules</h2>\n\n<p>React（JSX）とCSS Modulesによるサンプルです。</p>\n\n<blockquote>\n<p><a href="https://github.com/lollipop-onl/parcel-v2-playground/tree/examples/react-cssmodules" rel="nofollow noopener" target="_blank">サンプルリポジトリ</a></p>\n</blockquote>\n\n<h3>\n<span id="開発環境構築-1" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89-1"><i class="fa fa-link"></i></a>開発環境構築</h3>\n\n<p>サンプルリポジトリの開発環境構築の手順を紹介します。</p>\n\n<p>ここでは、次の構成でファイルを配置しています。<br>\nそれぞれのファイルの内容はサンプルリポジトリでご確認ください。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>.\n├── src/\n│   ├── Hello/\n│   │   ├── index.jsx\n│   │   └── index.modules.css\n│   ├── entry.jsx\n│   ├── index.html\n│   └── styles.css\n├── .postcssrc\n└── package.json\n</code></pre></div></div>\n\n<p>JSXやCSSのバンドルに関する設定はデフォルトで定義されているため、<code>.parcelrc</code>ファイルでの設定は必要ありません。<br>\n（<a href="https://github.com/parcel-bundler/parcel/blob/d24e09a9797af41a9d2c6c733b1c6cf6671d60c7/packages/configs/default/index.json#L5-L8" rel="nofollow noopener" target="_blank">JSXの設定</a>）</p>\n\n<p>ただし、CSS Modulesを使用するためのPostCSSの設定が必要です。<br>\nここでは、<code>postcss-modules</code>パッケージを使用してCSS Modulesを実現しています。</p>\n\n<div class="code-frame" data-lang="postcssrc"><div class="highlight"><pre class="with-code"><code>{\n  "modules": true,\n  "plugins": []\n}\n</code></pre></div></div>\n\n<p>インストールした依存関係は<code>parcel@next</code>と次のパッケージです。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre class="with-code"><code><span class="nv">$ </span>yarn add react react-dom prop-types\n<span class="nv">$ </span>yarn add <span class="nt">-D</span> postcss-modules\n\n<span class="c"># reset.css</span>\n<span class="nv">$ </span>yarn add reset-css\n</code></pre></div></div>\n\n<p>ここまでできたら、Parcelで開発サーバーを起動します。<br>\nserveコマンドは省略できます。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre class="with-code"><code><span class="nv">$ </span>yarn parcel serve src/index.html\n</code></pre></div></div>\n\n<p>ポートを指定していない場合、<code>http://localhost:1234</code>で開発サーバーが起動します。</p>\n\n<p><a href="https://camo.qiitausercontent.com/7ab973ce526e27aaf465042038df0943d8b6d596/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132373933342f32316535633165632d396166342d336466302d323162362d3162653065353362316238392e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F21e5c1ec-9af4-3df0-21b6-1be0e53b1b89.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=6c066acf963d9f5cfb95c7688635a3e4" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/21e5c1ec-9af4-3df0-21b6-1be0e53b1b89.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F21e5c1ec-9af4-3df0-21b6-1be0e53b1b89.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3f0b7950fb7309f629f15ad6556a1cb2 1x" loading="lazy"></a></p>\n\n<p>あとは、JSXファイルやCSSファイルへ変更を加えるとHMRで表示中の内容が入れ替わります。</p>\n\n<p>以上でReactとCSS Modulesの開発環境が構築できました。こちらもかんたんでしたね！</p>\n\n<h3>\n<span id="まとめ-1" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81-1"><i class="fa fa-link"></i></a>まとめ</h3>\n\n<ul>\n<li><code>yarn add -D parcel@next postcss-modules</code></li>\n<li><code>yarn add react react-dom prop-types</code></li>\n<li>\n<code>.postcssrc</code>に設定を記述</li>\n<li>Reactを記述</li>\n<li><code>yarn parcel serve src/index.html</code></li>\n<li>\n<a href="http://localhost:1234" class="autolink" rel="nofollow noopener" target="_blank">http://localhost:1234</a> を開く</li>\n</ul>\n\n<h3>\n<span id="余談-1" class="fragment"></span><a href="#%E4%BD%99%E8%AB%87-1"><i class="fa fa-link"></i></a>余談</h3>\n\n<p>今回はプレーンなCSSを使用したCSS Modulesでしたが、JSXファイルから参照するファイルを<code>.sass</code>や<code>.styl</code>へ変更し、必要なパッケージ（<code>sass</code>や<code>stylus</code>）をインストールすれば、設定を変更することなくほかのCSSプリプロセッサを使用したCSS Modulesで開発ができます。</p>\n\n<h2>\n<span id="vue" class="fragment"></span><a href="#vue"><i class="fa fa-link"></i></a>Vue</h2>\n\n<p>残念ながら、Parcel v2 beta.1時点ではVueのトランスフォーマプラグインが開発されていません。</p>\n\n<p>開発については次のIssue内で議論が行われています。</p>\n\n<p><a href="https://github.com/parcel-bundler/parcel/issues/3364" rel="nofollow noopener" target="_blank">Parcel 2: Vue transformer · Issue #3364 · parcel-bundler/parcel</a></p>\n\n<p>状況として、Parcel v2のコアチームにVueを使用するメンバーが少なくSFCの取り扱いについて議論しているようです。</p>\n\n<p>開発が終了し、公開されれば次のように<code>.parcelrc</code>に記載すればVueもバンドルできるようになるのではないかなと思います。</p>\n\n<div class="code-frame" data-lang="parcelrc"><div class="highlight"><pre class="with-code"><code>{\n  "extends": "@parcel/config-default",\n  "transformers": {\n    "*.vue": ["@parcel/transformer-vue"]\n  }\n}\n</code></pre></div></div>\n\n<h2>\n<span id="typescript--eslint" class="fragment"></span><a href="#typescript--eslint"><i class="fa fa-link"></i></a>TypeScript + ESLint</h2>\n\n<p>TypeScriptとESLintを使用したサンプルです。</p>\n\n<blockquote>\n<p><a href="https://github.com/lollipop-onl/parcel-v2-playground/tree/examples/typescript-eslint" rel="nofollow noopener" target="_blank">サンプルリポジトリ</a></p>\n</blockquote>\n\n<h3>\n<span id="開発環境構築-2" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89-2"><i class="fa fa-link"></i></a>開発環境構築</h3>\n\n<p>サンプルリポジトリの開発環境構築の手順を紹介します。</p>\n\n<p>ここでは、次の構成でファイルを配置しています。<br>\nそれぞれのファイルの内容はサンプルリポジトリでご確認ください。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>.\n├── src/\n│   └── index.ts\n├── .eslintrc\n└── package.json\n└── tsconfig.json\n</code></pre></div></div>\n\n<p>インストールした依存関係は<code>parcel@next</code>と次のパッケージです。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre class="with-code"><code>yarn add <span class="nt">-D</span> typescript @parcel/validator-typescript @parcel/validator-eslint\n\n<span class="c"># ESLint</span>\nyarn add <span class="nt">-D</span> eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin\n</code></pre></div></div>\n\n<p>TypeScriptの設定はデフォルトで定義されているため、<code>.parcelrc</code>ファイルでの必要はありませんが、型をチェックするには別途、バリデータプラグイン<code>@parcel/validator-typescript</code>を追加する必要があります。<br>\nまた、ESLintチェックもTypeScriptの型チェックと同様、バリデータプラグイン<code>@parcel/validator-eslint</code>が必要です。</p>\n\n<p>バリデータプラグインを設定した<code>.parcelrc</code>ファイルは次のとおりです。</p>\n\n<div class="code-frame" data-lang="parcelrc"><div class="highlight"><pre class="with-code"><code>{\n  "extends": "@parcel/config-default",\n  "validators": {\n    "*.{js,jsx,ts,tsx}": ["@parcel/validator-eslint", "@parcel/validator-typescript"]\n  }\n}\n</code></pre></div></div>\n\n<p>ここまでできたら、Parcelで<code>.ts</code>ファイルをビルドします。</p>\n\n<div class="code-frame" data-lang="shell"><div class="highlight"><pre class="with-code"><code><span class="nv">$ </span>yarn parcel build src/index.ts\n</code></pre></div></div>\n\n<p>ソースコードに問題がなければビルドに成功しますが、エラーがあった場合は次のようにCLI上にエラーが表示されます。</p>\n\n<p><a href="https://camo.qiitausercontent.com/4a087415c9f305f9d1b031ed6240d597782d99e5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132373933342f39383034663135622d656138342d356234612d313862302d3562393764306437313339342e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F9804f15b-ea84-5b4a-18b0-5b97d0d71394.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=c5c76d42468a89954e9d5d9c12b920d0" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/9804f15b-ea84-5b4a-18b0-5b97d0d71394.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F9804f15b-ea84-5b4a-18b0-5b97d0d71394.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0a57c526811e9b07e74bdf38051e6a54 1x" loading="lazy"></a><br>\n▲ 型エラー</p>\n\n<p><a href="https://camo.qiitausercontent.com/64176306622c171dddf7422d6137d0a82d5552cd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132373933342f34343037643961392d363364662d336338642d383536372d6262623334613662663538362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F4407d9a9-63df-3c8d-8567-bbb34a6bf586.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b0c06cab0b8afed9bda17b038e29e69f" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/4407d9a9-63df-3c8d-8567-bbb34a6bf586.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F4407d9a9-63df-3c8d-8567-bbb34a6bf586.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=98a3c1b199779fadcaa5be4432fc4b23 1x" loading="lazy"></a><br>\n▲ ESLintエラー</p>\n\n<p>なお、ESLintエラーのAuto Fixには対応していないようです。</p>\n\n<h3>\n<span id="まとめ-2" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81-2"><i class="fa fa-link"></i></a>まとめ</h3>\n\n<ul>\n<li><code>yarn add -D parcel@next typescript eslint @parcel/validator-typescript @parcel/validator-eslint</code></li>\n<li>\n<code>.eslintrc</code>にESLint設定を記述</li>\n<li><code>yarn parcel build src/index.ts</code></li>\n<li>エラーがあればCLI上に表示される</li>\n</ul>\n\n<h1>\n<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>\n\n<p>Parcel v2でv1時代より柔軟にオプションを設定できるようになりましたが、設定不要でバンドルできる手軽さも健在です。</p>\n\n<p>まだベータ版ですが、一般的な使い方をする分には申し分ない機能が提供されているなという印象でした。<br>\nただ、新しいツールのため、調べられる情報や公開されているプラグインが少なく真に柔軟に使えるようになるにはまだまだ時間がかかるかなと思います。</p>\n\n<p>2019/8/14にα版が公開されてから10ヶ月、ついにParcel v2も正式リリースの日が近づいてきました。<br>\nこれからのParcelの発展が楽しみです！</p>\n',body:'# はじめに\n\n去る 2020年6月19日、Parcel v2のベータバージョンがリリースされました。\n\n> [📦 Parcel 2 beta 1: improved stability, tree shaking, source map performance, and more! 🚀](https://medium.com/@devongovett/parcel-2-beta-1-improved-stability-tree-shaking-source-map-performance-and-more-78179779e8b7)\n\n<blockquote class="twitter-tweet"><p lang="en" dir="ltr">🚀 Parcel 2 beta 1 has been released!<br><br>🌳 Improved tree shaking<br>🗺 20x faster source map builds<br>#️⃣ Improved content hashing<br>🚨 Resolver diagnostics<br>📊 More accurate bundle reports<br>🐞 Tons of bugfixes!<br><br>📝 Read more: <a href="https://t.co/hMGtOKEOs3">https://t.co/hMGtOKEOs3</a><br>🌎 New website! <a href="https://t.co/SWaS5OvWIA">https://t.co/SWaS5OvWIA</a></p>&mdash; Devon Govett (@devongovett) <a href="https://twitter.com/devongovett/status/1273685386020024320?ref_src=twsrc%5Etfw">June 18, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"><\/script>\n\nこの記事では、Parcel v2の基本的な使い方から、いくつかのAltJS・ライブラリをParcelでコンパイルするテンプレートについて説明します。\n\nなお、この記事の内容は[`v2.0.0-beta.1`](https://github.com/parcel-bundler/parcel/tree/v2.0.0-beta.1)時点でのドキュメント、ソースコードをベースにしています。\nまた、無印のParcelを **Parcel v1**、新しいv2を **Parcel v2**と表記します。\n\n# オフィシャルドキュメント\n\nParcel v1のドキュメントは https://parceljs.org/ でしたが、v2ではURLが代わり https://v2.parceljs.org/ （未完成）がドキュメントとして提供されています。\n\n[![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/1325d873-e558-d97c-11f4-d246d1740b7b.png)](https://v2.parceljs.org/)\n▲ Parcel v2のドキュメント\n\n# インストール\n\nParcel v1のパッケージは`parcel-bundler`という名前で公開されていましたが、Parcel v2からパッケージ名が`parcel`となりました。\n\nまた、現在のParcel v2はベータ版のため、バージョンを`@next`と指定してインストールします。\n\n```shell\n$ yarn add -D parcel@next\n```\n\n# 設定ファイル\n\nParcel v2では、`.parcelrc`という設定ファイルを使用できるようになりました。\n`.parcelrc`を指定しなかった場合は、デフォルトの設定（[`@parcel/config-default`](https://github.com/parcel-bundler/parcel/tree/v2.0.0-beta.1/packages/configs/default)）でバンドルされます。\n\n`.parcelrc`はParcelのプラグインを種類ごとに設定します。\n\n設定できるプラグインの種類は次のとおりです。\n\n* [Resolvers](https://github.com/parcel-bundler/parcel#resolvers)\n  * ファイルやパッケージ、アセットを解決するプラグイン\n* [Transformers](https://github.com/parcel-bundler/parcel#transformers)\n  * ソースコードを変換（トランスパイル）するプラグイン\n  * 公式でBabelやTypeScript、Vue、Yamlなどのトランスフォーマが提供されている\n* [Bundlers](https://github.com/parcel-bundler/parcel#bundlers)\n  * アセットをバンドルするプラグイン\n* [Namers](https://github.com/parcel-bundler/parcel#namers)\n  * ファイルの命名やコンテントハッシュなどを付与するプラグイン\n* [Runtimes](https://github.com/parcel-bundler/parcel#runtimes)\n  * バンドラーフェーズのあとに最終的にバンドルに含まれるアセット（HMRのコードなど）を生成するプラグイン\n* [Packagers](https://github.com/parcel-bundler/parcel#packagers)\n  * 異なるアセットタイプを単一のバンドルにマージするプラグイン\n* [Optimizers](https://github.com/parcel-bundler/parcel#optimizers)\n  * バンドルを最適化するプラグイン\n* [Reporters](https://github.com/parcel-bundler/parcel#reporters)\n  * Parcelでのイベントを受け取ってロガーに出力したり、ログファイルを生成するプラグイン\n* [Validators](https://github.com/parcel-bundler/parcel#validators)\n  * ビルド後にソースコードの検証を行いエラーを表示するプラグイン\n\nいずれのプラグインも自作が可能ですが、基本的な機能は公式パッケージとして公開されているものを使用すれば問題ないでしょう。\n\nもし、個別の`.parcelrc`を設定する場合はデフォルトの設定に追加する形で定義するとよいでしょう。\n\n```.parcelrc\n{\n  // デフォルトの設定を継承する\n  "extends": "@parcel/config-default",\n  "optimizers": {\n    "*.{png,jpg}": ["@parcel/optimizer-awesome-images"]\n  }\n}\n```\n\nまた、ある拡張子にプラグインを追加する際は、デフォルトの設定を引き継ぐよう`...`を最後に記載するようにしましょう。\n\n```.parcelrc\n{\n  "extends": "@parcel/config-default",\n  "transforers": {\n    // デフォルト設定が引き継がれないためコンパイルできない\n    "*.{ts,tsx}": [],\n    // ... で extends で継承された設定を引き継ぐ\n    "*.{ts,tsx}": ["..."],\n  }\n}\n```\n\n# いろいろ試してみよう\n\nここからは、Parcel v2でいろいろなAltJS、ライブラリをバンドルする設定を見ていきましょう。\nそれぞれ、GitHubでソースコードを公開しています。\n\nまた、公式のリポジトリにも[いくつかのサンプルプロジェクト](https://github.com/parcel-bundler/parcel/tree/v2.0.0-beta.1/packages/examples)が用意されています。\n\n## Pug + Sass\n\nテンプレートエンジンのPugとCSSプリプロセッサのSassを使用したサンプルです。\n\n> [サンプルリポジトリ](https://github.com/lollipop-onl/parcel-v2-playground)\n\n### 開発環境構築\n\nサンプルリポジトリの開発環境構築の手順を紹介します。\n\nここでは、次の構成でファイルを配置しています。\nそれぞれのファイルの内容はサンプルリポジトリでご確認ください。\n\n```\n.\n├── src/\n│   ├── index.pug\n│   └── styles.sass\n└── package.json\n```\n\nPugとSassの設定はデフォルトで定義されているため、`.parcelrc`ファイルでの設定は必要ありません。\n（[Pugの設定](https://github.com/parcel-bundler/parcel/blob/d24e09a9797af41a9d2c6c733b1c6cf6671d60c7/packages/configs/default/index.json#L21)・[Sassの設定](https://github.com/parcel-bundler/parcel/blob/d24e09a9797af41a9d2c6c733b1c6cf6671d60c7/packages/configs/default/index.json#L13)）\n\nインストールした依存関係は`parcel@next`と次のパッケージです。\n\n```shell\n$ yarn add -D pug sass\n\n# reset.css\n$ yarn add reset-css\n```\n\nここまでできたら、Parcelで開発サーバーを起動します。\n`serve`コマンドは省略できます。\n\n```shell\n$ yarn parcel serve src/index.pug\n```\n\nポートを指定していない場合、`http://localhost:1234`で開発サーバーが起動します。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/a3f0eb75-05ae-bbea-13e3-ed95b93b1e55.png)\n\nあとは、Pugファイル、Sassファイルへ変更を加えるとHMRで表示中の内容が入れ替わります。\n\n以上でPugとSassの開発環境ができました！かんたんですね。\n\n### まとめ\n\n* `yarn add -D parcel@next pug sass`\n* PugとSassを記述\n* `yarn parcel serve src/index.pug`\n* http://localhost:1234 を開く\n\n### 余談\n\nParcelでは、Sassから`node_modules`へインストールされたパッケージをインポートする際、パッケージ名のプレフィックスとして`~`を**必要としません**。\n\n`~package-name`の指定は本来、Webpackでのシンタックスのようで、ParcelのCLI上では次のようにレポートされます。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/ef44e083-7d92-eca3-d314-cf5739b66912.png)\n\n具体的な理由まで書かれていて、とても親切なエラーメッセージですね！\n\n## React + CSS Modules\n\nReact（JSX）とCSS Modulesによるサンプルです。\n\n> [サンプルリポジトリ](https://github.com/lollipop-onl/parcel-v2-playground/tree/examples/react-cssmodules)\n\n### 開発環境構築\n\nサンプルリポジトリの開発環境構築の手順を紹介します。\n\nここでは、次の構成でファイルを配置しています。\nそれぞれのファイルの内容はサンプルリポジトリでご確認ください。\n\n```\n.\n├── src/\n│   ├── Hello/\n│   │   ├── index.jsx\n│   │   └── index.modules.css\n│   ├── entry.jsx\n│   ├── index.html\n│   └── styles.css\n├── .postcssrc\n└── package.json\n```\n\nJSXやCSSのバンドルに関する設定はデフォルトで定義されているため、`.parcelrc`ファイルでの設定は必要ありません。\n（[JSXの設定](https://github.com/parcel-bundler/parcel/blob/d24e09a9797af41a9d2c6c733b1c6cf6671d60c7/packages/configs/default/index.json#L5-L8)）\n\nただし、CSS Modulesを使用するためのPostCSSの設定が必要です。\nここでは、`postcss-modules`パッケージを使用してCSS Modulesを実現しています。\n\n```.postcssrc\n{\n  "modules": true,\n  "plugins": []\n}\n```\n\nインストールした依存関係は`parcel@next`と次のパッケージです。\n\n```shell\n$ yarn add react react-dom prop-types\n$ yarn add -D postcss-modules\n\n# reset.css\n$ yarn add reset-css\n```\n\nここまでできたら、Parcelで開発サーバーを起動します。\nserveコマンドは省略できます。\n\n```shell\n$ yarn parcel serve src/index.html\n```\n\nポートを指定していない場合、`http://localhost:1234`で開発サーバーが起動します。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/21e5c1ec-9af4-3df0-21b6-1be0e53b1b89.png)\n\nあとは、JSXファイルやCSSファイルへ変更を加えるとHMRで表示中の内容が入れ替わります。\n\n以上でReactとCSS Modulesの開発環境が構築できました。こちらもかんたんでしたね！\n\n### まとめ\n\n* `yarn add -D parcel@next postcss-modules`\n* `yarn add react react-dom prop-types`\n* `.postcssrc`に設定を記述\n* Reactを記述\n* `yarn parcel serve src/index.html`\n* http://localhost:1234 を開く\n\n### 余談\n\n今回はプレーンなCSSを使用したCSS Modulesでしたが、JSXファイルから参照するファイルを`.sass`や`.styl`へ変更し、必要なパッケージ（`sass`や`stylus`）をインストールすれば、設定を変更することなくほかのCSSプリプロセッサを使用したCSS Modulesで開発ができます。\n\n## Vue\n\n残念ながら、Parcel v2 beta.1時点ではVueのトランスフォーマプラグインが開発されていません。\n\n開発については次のIssue内で議論が行われています。\n\n[Parcel 2: Vue transformer · Issue #3364 · parcel-bundler/parcel](https://github.com/parcel-bundler/parcel/issues/3364)\n\n状況として、Parcel v2のコアチームにVueを使用するメンバーが少なくSFCの取り扱いについて議論しているようです。\n\n開発が終了し、公開されれば次のように`.parcelrc`に記載すればVueもバンドルできるようになるのではないかなと思います。\n\n```.parcelrc\n{\n  "extends": "@parcel/config-default",\n  "transformers": {\n    "*.vue": ["@parcel/transformer-vue"]\n  }\n}\n```\n\n## TypeScript + ESLint\n\nTypeScriptとESLintを使用したサンプルです。\n\n> [サンプルリポジトリ](https://github.com/lollipop-onl/parcel-v2-playground/tree/examples/typescript-eslint)\n\n### 開発環境構築\n\nサンプルリポジトリの開発環境構築の手順を紹介します。\n\nここでは、次の構成でファイルを配置しています。\nそれぞれのファイルの内容はサンプルリポジトリでご確認ください。\n\n```\n.\n├── src/\n│   └── index.ts\n├── .eslintrc\n└── package.json\n└── tsconfig.json\n```\n\nインストールした依存関係は`parcel@next`と次のパッケージです。\n\n```shell\nyarn add -D typescript @parcel/validator-typescript @parcel/validator-eslint\n\n# ESLint\nyarn add -D eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin\n```\n\nTypeScriptの設定はデフォルトで定義されているため、`.parcelrc`ファイルでの必要はありませんが、型をチェックするには別途、バリデータプラグイン`@parcel/validator-typescript`を追加する必要があります。\nまた、ESLintチェックもTypeScriptの型チェックと同様、バリデータプラグイン`@parcel/validator-eslint`が必要です。\n\nバリデータプラグインを設定した`.parcelrc`ファイルは次のとおりです。\n\n```.parcelrc\n{\n  "extends": "@parcel/config-default",\n  "validators": {\n    "*.{js,jsx,ts,tsx}": ["@parcel/validator-eslint", "@parcel/validator-typescript"]\n  }\n}\n```\n\nここまでできたら、Parcelで`.ts`ファイルをビルドします。\n\n```shell\n$ yarn parcel build src/index.ts\n```\n\nソースコードに問題がなければビルドに成功しますが、エラーがあった場合は次のようにCLI上にエラーが表示されます。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/9804f15b-ea84-5b4a-18b0-5b97d0d71394.png)\n▲ 型エラー\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/4407d9a9-63df-3c8d-8567-bbb34a6bf586.png)\n▲ ESLintエラー\n\nなお、ESLintエラーのAuto Fixには対応していないようです。\n\n### まとめ\n\n* `yarn add -D parcel@next typescript eslint @parcel/validator-typescript @parcel/validator-eslint`\n* `.eslintrc`にESLint設定を記述\n* `yarn parcel build src/index.ts`\n* エラーがあればCLI上に表示される\n\n# おわりに\n\nParcel v2でv1時代より柔軟にオプションを設定できるようになりましたが、設定不要でバンドルできる手軽さも健在です。\n\nまだベータ版ですが、一般的な使い方をする分には申し分ない機能が提供されているなという印象でした。\nただ、新しいツールのため、調べられる情報や公開されているプラグインが少なく真に柔軟に使えるようになるにはまだまだ時間がかかるかなと思います。\n\n2019/8/14にα版が公開されてから10ヶ月、ついにParcel v2も正式リリースの日が近づいてきました。\nこれからのParcelの発展が楽しみです！\n',coediting:a,comments_count:0,created_at:"2020-06-21T21:02:07+09:00",group:s,id:"367ff4b90cbbfd0055c5",likes_count:7,private:a,reactions_count:0,tags:[{name:k,versions:[]},{name:"parcel",versions:[]}],title:"いろいろ試そう Parcel 2@beta",updated_at:"2020-06-25T14:32:44+09:00",url:"https://qiita.com/simochee/items/367ff4b90cbbfd0055c5",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'<p>※この記事は <a href="/akameco" class="user-mention js-hovercard" title="akameco" data-hovercard-target-type="user" data-hovercard-target-name="akameco">@akameco</a> さんの <a href="https://qiita.com/akameco/items/e12377e55e379d29636e" id="reference-c3ae703f8705bdc7e76b">2行でwebpack.config.jsで補完を効かせる方法</a> のオマージュです。</p>\n\n<h2>\n<span id="how" class="fragment"></span><a href="#how"><i class="fa fa-link"></i></a>How</h2>\n\n<p><code>gatsby-config.js</code>の<code>module.exports</code>の前に次のようなJSDocを追加します。</p>\n\n<div class="code-frame" data-lang="javascript">\n<div class="code-lang"><span class="bold">gatsby-config.js</span></div>\n<div class="highlight"><pre class="with-code"><code><span class="cm">/**\n * @type import(\'gatsby\').GatsbyConfig\n */</span>\n<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{};</span>\n</code></pre></div>\n</div>\n\n<p>これで、<code>siteMetadata</code>や<code>plugins</code>などのプロパティの補完および型の表示がされるようになります。</p>\n\n<h2>\n<span id="why" class="fragment"></span><a href="#why"><i class="fa fa-link"></i></a>Why</h2>\n\n<p><a href="/akameco" class="user-mention js-hovercard" title="akameco" data-hovercard-target-type="user" data-hovercard-target-name="akameco">@akameco</a> さんの <a href="https://qiita.com/akameco/items/e12377e55e379d29636e">2行でwebpack.config.jsで補完を効かせる方法</a> が詳しいので、そちらを参照してください。</p>\n',body:"※この記事は @akameco さんの [2行でwebpack.config.jsで補完を効かせる方法](https://qiita.com/akameco/items/e12377e55e379d29636e) のオマージュです。\n\n## How\n\n`gatsby-config.js`の`module.exports`の前に次のようなJSDocを追加します。\n\n```gatsby-config.js\n/**\n * @type import('gatsby').GatsbyConfig\n */\nmodule.exports = {};\n```\n\nこれで、`siteMetadata`や`plugins`などのプロパティの補完および型の表示がされるようになります。\n\n## Why\n\n@akameco さんの [2行でwebpack.config.jsで補完を効かせる方法](https://qiita.com/akameco/items/e12377e55e379d29636e) が詳しいので、そちらを参照してください。\n",coediting:a,comments_count:0,created_at:E,group:s,id:"5cdda06b099ae3b7a36a",likes_count:4,private:a,reactions_count:0,tags:[{name:k,versions:[]},{name:f,versions:[]},{name:"gatsby",versions:[]}],title:"2行でgatsby-config.jsで補完を効かせる方法",updated_at:E,url:"https://qiita.com/simochee/items/5cdda06b099ae3b7a36a",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'<p>Hexoでは、ビルドの際に<code>sources</code>内の<code>.md</code>以外のファイルはそのまま<code>public</code>ディレクトリにコピーされます。</p>\n\n<p>これを利用して、GitHub Pagesでカスタムドメインを設定するときに必要な<code>CNAME</code>ファイルを<code>sources</code>直下に追加します。</p>\n\n<div class="code-frame" data-lang="text">\n<div class="code-lang"><span class="bold">sources/CNAME</span></div>\n<div class="highlight"><pre class="with-code"><code>custom.domain.com\n</code></pre></div>\n</div>\n\n<p>あとは、普通にデプロイすれば、<code>public</code>直下に<code>CNAME</code>ファイルがコピーされます。</p>\n\n<p>これで、GitHub Pagesのカスタムドメインの設定を維持することができます。</p>\n',body:"Hexoでは、ビルドの際に`sources`内の`.md`以外のファイルはそのまま`public`ディレクトリにコピーされます。\n\nこれを利用して、GitHub Pagesでカスタムドメインを設定するときに必要な`CNAME`ファイルを`sources`直下に追加します。\n\n```text:sources/CNAME\ncustom.domain.com\n```\n\nあとは、普通にデプロイすれば、`public`直下に`CNAME`ファイルがコピーされます。\n\nこれで、GitHub Pagesのカスタムドメインの設定を維持することができます。\n",coediting:a,comments_count:0,created_at:A,group:s,id:"58f04385713dd65f69f5",likes_count:0,private:a,reactions_count:0,tags:[{name:"github-pages",versions:[]},{name:"Hexo",versions:[]}],title:"Hexo × GitHub Pagesでカスタムドメインをつける",updated_at:A,url:"https://qiita.com/simochee/items/58f04385713dd65f69f5",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'<p>TypeScriptで<code>input</code>イベントの<code>event.target.value</code>を参照しようとすると、型エラーとなります。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kd">const</span> <span class="nx">inputField</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">\'</span><span class="s1">inputField</span><span class="dl">\'</span><span class="p">);</span>\n\n<span class="nx">inputField</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">\'</span><span class="s1">input</span><span class="dl">\'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span> <span class="c1">// Property \'value\' does not exist on type \'EventTarget\'.</span>\n<span class="p">});</span>\n</code></pre></div></div>\n\n<p>これは、<code>event.target</code>の型が確定していないため発生します。</p>\n\n<p>正しくは<code>event.target</code>の型チェックを行って想定される要素ではないことを確認します。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// Input要素の場合</span>\n<span class="kd">const</span> <span class="nx">inputField</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">\'</span><span class="s1">inputField</span><span class="dl">\'</span><span class="p">);</span>\n\n<span class="nx">inputField</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">\'</span><span class="s1">input</span><span class="dl">\'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">target</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">event</span><span class="p">;</span>\n\n  <span class="c1">// Input要素以外の場合は終了</span>\n  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">target</span> <span class="k">instanceof</span> <span class="nx">HTMLInputElement</span><span class="p">))</span> <span class="p">{</span>\n    <span class="k">return</span><span class="p">;</span>\n  <span class="p">}</span>\n\n  <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span> <span class="c1">// 👍</span>\n<span class="p">});</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// TextArea要素の場合</span>\n<span class="kd">const</span> <span class="nx">textareaField</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">\'</span><span class="s1">textareaField</span><span class="dl">\'</span><span class="p">);</span>\n\n<span class="nx">inputField</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">\'</span><span class="s1">input</span><span class="dl">\'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="kd">const</span> <span class="p">{</span> <span class="nx">target</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">event</span><span class="p">;</span>\n\n  <span class="c1">// TextArea要素以外の場合は終了</span>\n  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">target</span> <span class="k">instanceof</span> <span class="nx">HTMLTextAreaElement</span><span class="p">))</span> <span class="p">{</span>\n    <span class="k">return</span><span class="p">;</span>\n  <span class="p">}</span>\n\n  <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span> <span class="c1">// 👍</span>\n<span class="p">});</span>\n</code></pre></div></div>\n\n<p>一手間かかりますが、これでより型安全にInputEventを扱えるようになります。</p>\n',body:"TypeScriptで`input`イベントの`event.target.value`を参照しようとすると、型エラーとなります。\n\n\n```ts\nconst inputField = document.getElementById('inputField');\n\ninputField.addEventListener('input', (event) => {\n  const value = event.target.value; // Property 'value' does not exist on type 'EventTarget'.\n});\n```\n\nこれは、`event.target`の型が確定していないため発生します。\n\n正しくは`event.target`の型チェックを行って想定される要素ではないことを確認します。\n\n```ts\n// Input要素の場合\nconst inputField = document.getElementById('inputField');\n\ninputField.addEventListener('input', (event) => {\n  const { target } = event;\n\n  // Input要素以外の場合は終了\n  if (!(target instanceof HTMLInputElement)) {\n    return;\n  }\n\n  const value = target.value; // 👍\n});\n```\n\n```ts\n// TextArea要素の場合\nconst textareaField = document.getElementById('textareaField');\n\ninputField.addEventListener('input', (event) => {\n  const { target } = event;\n\n  // TextArea要素以外の場合は終了\n  if (!(target instanceof HTMLTextAreaElement)) {\n    return;\n  }\n\n  const value = target.value; // 👍\n});\n```\n\n一手間かかりますが、これでより型安全にInputEventを扱えるようになります。\n",coediting:a,comments_count:0,created_at:w,group:s,id:"b3d4dc15f474f805573c",likes_count:18,private:a,reactions_count:0,tags:[{name:f,versions:[]}],title:"TypeScriptでInputEventを扱うときの正しいアプローチ",updated_at:w,url:"https://qiita.com/simochee/items/b3d4dc15f474f805573c",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p>Re:VIEWの開発環境をローカルに用意するの、しんどいですよね。<br>\n普段DockerやRubyを使わないのにこれらをインストールするのは億劫だと思います。</p>\n\n<p>そんな方に、GitHub ActionsにRe:VIEWのビルド丸投げして楽しませんか？</p>\n\n<blockquote>\n<p><strong>注意</strong><br>\nこの記事の内容は<a href="https://github.com/TechBooster/ReVIEW-Template" rel="nofollow noopener" target="_blank">TechBooster/ReVIEW-Template</a>のテンプレートを使用した場合の例です。</p>\n</blockquote>\n\n<h1>\n<span id="ワークフローファイル" class="fragment"></span><a href="#%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%95%E3%83%AD%E3%83%BC%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB"><i class="fa fa-link"></i></a>ワークフローファイル</h1>\n\n<p>以下の内容を<code>.github/workflows</code>以下のYAMLファイルにコピペしてリポジトリにPushしてください。<br>\nここでは<code>pdf.yml</code>として作成したとします。</p>\n\n<div class="code-frame" data-lang="yml">\n<div class="code-lang"><span class="bold">.github/workflows/pdf.yml</span></div>\n<div class="highlight"><pre class="with-code"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Generate preview pdf</span>\n<span class="na">on</span><span class="pi">:</span> <span class="s">push</span>\n\n<span class="na">jobs</span><span class="pi">:</span>\n  <span class="na">build</span><span class="pi">:</span>\n    <span class="na">name</span><span class="pi">:</span> <span class="s">Generate pdf</span>\n    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>\n    <span class="na">steps</span><span class="pi">:</span>\n      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@master</span>\n        <span class="na">with</span><span class="pi">:</span>\n          <span class="na">fetch-depth</span><span class="pi">:</span> <span class="m">1</span>\n      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">docker://vvakame/review:4.0</span>\n      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">./build-in-docker.sh</span>\n      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get build date</span>\n        <span class="na">id</span><span class="pi">:</span> <span class="s">get-date</span>\n        <span class="na">run</span><span class="pi">:</span> <span class="s">echo "::set-output name=date::$(date +"%Y-%m-%d")"</span>\n      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get Repository Name</span>\n        <span class="na">id</span><span class="pi">:</span> <span class="s">get-repo-name</span>\n        <span class="na">run</span><span class="pi">:</span> <span class="s">echo "::set-output name=repo-name::${GITHUB_REPOSITORY##*/}"</span>\n      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/upload-artifact@master</span>\n        <span class="na">with</span><span class="pi">:</span>\n          <span class="na">name</span><span class="pi">:</span> <span class="s">${{ steps.get-repo-name.outputs.repo-name }}-${{ steps.get-date.outputs.date }}</span>\n          <span class="c1"># config.yml の bookname の値によって変える</span>\n          <span class="na">path</span><span class="pi">:</span> <span class="s">articles/output.pdf</span>\n</code></pre></div>\n</div>\n\n<p>また、プライベートリポジトリなどでなるべく実行回数を抑えたいという場合は、実行するファイルパスを明示的に指定してください。</p>\n\n<div class="code-frame" data-lang="yml"><div class="highlight"><pre class="with-code"><code><span class="na">on</span><span class="pi">:</span>\n  <span class="na">push</span><span class="pi">:</span>\n    <span class="na">paths</span><span class="pi">:</span>\n      <span class="pi">-</span> <span class="s">articles/*</span>\n      <span class="pi">-</span> <span class="s">Gemfile</span>\n      <span class="pi">-</span> <span class="s">build-in-docker.sh</span>\n      <span class="pi">-</span> <span class="s">Gruntfile.js</span>\n      <span class="pi">-</span> <span class="s">package.json</span>\n      <span class="pi">-</span> <span class="s">rebuild-css.sh</span>\n      <span class="pi">-</span> <span class="s">setup.sh</span>\n      <span class="pi">-</span> <span class="s">.github/workflows/pdf.yml</span>\n</code></pre></div></div>\n\n<h1>\n<span id="機能" class="fragment"></span><a href="#%E6%A9%9F%E8%83%BD"><i class="fa fa-link"></i></a>機能</h1>\n\n<p>ワークフローが正常に終了すると、 <code>&lt;リポジトリ名&gt;-&lt;年月日&gt;</code> というアーティファクトが登録されます。<br>\n例：<code>lollipop-onl/techbook-sample</code> → <code>techbook-sample-2020-01-10</code></p>\n\n<p>アーティファクトのZIPファイル内にビルドされたPDFが入っているので、解凍してご覧ください。</p>\n\n<p>また、プレビューしたい事にPushすることになるので、Commitが細かくなりリカバリがしやすくなる...かもしれません。</p>\n',body:'# はじめに\n\nRe:VIEWの開発環境をローカルに用意するの、しんどいですよね。\n普段DockerやRubyを使わないのにこれらをインストールするのは億劫だと思います。\n\nそんな方に、GitHub ActionsにRe:VIEWのビルド丸投げして楽しませんか？\n\n> **注意**\n> この記事の内容は[TechBooster/ReVIEW-Template](https://github.com/TechBooster/ReVIEW-Template)のテンプレートを使用した場合の例です。\n\n# ワークフローファイル\n\n以下の内容を`.github/workflows`以下のYAMLファイルにコピペしてリポジトリにPushしてください。\nここでは`pdf.yml`として作成したとします。\n\n```yml:.github/workflows/pdf.yml\nname: Generate preview pdf\non: push\n\njobs:\n  build:\n    name: Generate pdf\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@master\n        with:\n          fetch-depth: 1\n      - uses: docker://vvakame/review:4.0\n      - run: ./build-in-docker.sh\n      - name: Get build date\n        id: get-date\n        run: echo "::set-output name=date::$(date +"%Y-%m-%d")"\n      - name: Get Repository Name\n        id: get-repo-name\n        run: echo "::set-output name=repo-name::${GITHUB_REPOSITORY##*/}"\n      - uses: actions/upload-artifact@master\n        with:\n          name: ${{ steps.get-repo-name.outputs.repo-name }}-${{ steps.get-date.outputs.date }}\n          # config.yml の bookname の値によって変える\n          path: articles/output.pdf\n```\n\nまた、プライベートリポジトリなどでなるべく実行回数を抑えたいという場合は、実行するファイルパスを明示的に指定してください。\n\n```yml\non:\n  push:\n    paths:\n      - articles/*\n      - Gemfile\n      - build-in-docker.sh\n      - Gruntfile.js\n      - package.json\n      - rebuild-css.sh\n      - setup.sh\n      - .github/workflows/pdf.yml\n```\n\n# 機能\n\nワークフローが正常に終了すると、 `<リポジトリ名>-<年月日>` というアーティファクトが登録されます。\n例：`lollipop-onl/techbook-sample` → `techbook-sample-2020-01-10`\n\nアーティファクトのZIPファイル内にビルドされたPDFが入っているので、解凍してご覧ください。\n\nまた、プレビューしたい事にPushすることになるので、Commitが細かくなりリカバリがしやすくなる...かもしれません。\n',coediting:a,comments_count:1,created_at:_,group:s,id:"ba7264cc679f2508c782",likes_count:7,private:a,reactions_count:0,tags:[{name:"ReVIEW",versions:[]},{name:"GitHubActions",versions:[]}],title:"GitHub ActionsでRe:VIEW原稿をビルドする",updated_at:_,url:"https://qiita.com/simochee/items/ba7264cc679f2508c782",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'<p>Markdownではソースコード上で改行しただけでは改行されない。</p>\n\n<blockquote>\n<p><strong>注意</strong><br>\nQiitaではMarkdown上で改行しただけで実際に改行されるので、以下の一般的なプレビューは都合よく表示させています。<br>\n本来の見え方は <a href="https://gist.github.com/lollipop-onl/0352be43bf8c9291778a6c28112a2b66" rel="nofollow noopener" target="_blank">Gist</a> でご覧ください。</p>\n</blockquote>\n\n<p><strong>改行されない例</strong></p>\n\n<div class="code-frame" data-lang="md"><div class="highlight"><pre class="with-code"><code>１行目\n２行目\n</code></pre></div></div>\n\n<p>１行目 ２行目</p>\n\n<p><strong>改行される例</strong></p>\n\n<div class="code-frame" data-lang="md"><div class="highlight"><pre class="with-code"><code>１行目\n\n２行目\n</code></pre></div></div>\n\n<p>１行目</p>\n\n<p>２行目</p>\n\n<p>ただ、行内で改行したいこともある。<br>\nその場合は<code>&lt;br&gt;</code>タグを直接打ち込めば改行できる。</p>\n\n<p><strong><code>&lt;br&gt;</code>タグで改行する例</strong></p>\n\n<div class="code-frame" data-lang="md"><div class="highlight"><pre class="with-code"><code>１行目<span class="nt">&lt;br&gt;</span>\n２行目\n</code></pre></div></div>\n\n<p>１行目<br>\n２行目</p>\n\n<p>これと同じことが行末にスペース２つ入れるだけで表現できる。</p>\n\n<p><strong>行末スペースで改行する例</strong></p>\n\n<div class="code-frame" data-lang="md"><div class="highlight"><pre class="with-code"><code>１行目  \n２行目\n</code></pre></div></div>\n\n<p>１行目<br>\n２行目</p>\n\n<p>全部同じ内容の長い行を改行したいときに便利。</p>\n',body:"Markdownではソースコード上で改行しただけでは改行されない。\n\n> **注意**\n> QiitaではMarkdown上で改行しただけで実際に改行されるので、以下の一般的なプレビューは都合よく表示させています。\n> 本来の見え方は [Gist](https://gist.github.com/lollipop-onl/0352be43bf8c9291778a6c28112a2b66) でご覧ください。\n\n**改行されない例**\n\n```md\n１行目\n２行目\n```\n\n１行目 ２行目\n\n**改行される例**\n\n```md\n１行目\n\n２行目\n```\n\n１行目\n\n２行目\n\nただ、行内で改行したいこともある。\nその場合は`<br>`タグを直接打ち込めば改行できる。\n\n**`<br>`タグで改行する例**\n\n```md\n１行目<br>\n２行目\n```\n\n１行目\n２行目\n\nこれと同じことが行末にスペース２つ入れるだけで表現できる。\n\n**行末スペースで改行する例**\n\n```md\n１行目  \n２行目\n```\n\n１行目\n２行目\n\n全部同じ内容の長い行を改行したいときに便利。\n",coediting:a,comments_count:0,created_at:"2020-01-10T15:25:05+09:00",group:s,id:"aed30b6240664dccbdb9",likes_count:0,private:a,reactions_count:0,tags:[{name:"Markdown",versions:[]}],title:"Markdownで行内改行する方法",updated_at:"2020-01-10T21:18:28+09:00",url:"https://qiita.com/simochee/items/aed30b6240664dccbdb9",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'<p>この記事は<a href="https://qiita.com/advent-calendar/2019/javascript">Vue #2 Advent Calendar 2019</a>の11日目です。</p>\n\n<p>昨日は <a href="/nishihara_zari" class="user-mention js-hovercard" title="nishihara_zari" data-hovercard-target-type="user" data-hovercard-target-name="nishihara_zari">@nishihara_zari</a> さんの <a href="https://qiita.com/nishihara_zari/items/4a31d03711ab520d0c99" id="reference-2ee2620c8d815c669de3">jQueryしか書けなかった自分がVueを使えるようになるまでの話と同じような環境の人たちへ</a> でした。</p>\n\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p>以前、<a href="https://qiita.com/simochee/items/4d31414cb612f96a4c9f" id="reference-3072c6195d4332245539">TypeScriptでVue.setを型安全にしたい</a>という記事を書ました。<br>\n今回はその記事で紹介した、<code>Vue.set</code>（と<code>Vue.delete</code>）を型安全にする実装をライブラリ化したので、実装内容についてご紹介します。</p>\n\n<p>本文だけ読みたいという方は <a href="#%E5%AE%9F%E8%A3%85%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">実装について</a> まで読み飛ばしてください。</p>\n\n<h1>\n<span id="ライブラリのご紹介" class="fragment"></span><a href="#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E3%81%94%E7%B4%B9%E4%BB%8B"><i class="fa fa-link"></i></a>ライブラリのご紹介</h1>\n\n<p>実装の紹介の前に、公開したライブラリについてご紹介させていただきます。</p>\n\n<p><a href="https://www.npmjs.com/package/@lollipop-onl/vue-typed-reactive" rel="nofollow noopener" target="_blank"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F7fe68a26-2ac6-6eea-5f13-b5618543b52b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a71a84927f5241725970edf07ef2944e" alt="vtyped.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/7fe68a26-2ac6-6eea-5f13-b5618543b52b.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F7fe68a26-2ac6-6eea-5f13-b5618543b52b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c135c50ba51547cdf92c5d6f0bd719e4 1x" loading="lazy"></a></p>\n\n<blockquote>\n<p><a href="https://www.npmjs.com/package/@lollipop-onl/vue-typed-reactive" rel="nofollow noopener" target="_blank">@lollipop-onl/vue-typed-reactive - npm</a></p>\n</blockquote>\n\n<p><code>@lollipop-onl/vue-typed-reactive</code>はVueのグローバルに<code>Vue.typedSet</code>と<code>Vue.typedDelete</code>を、インスタンスに<code>vm.$typedSet</code>と<code>vm.$typedDelete</code>を提供するプラグインです。</p>\n\n<div class="code-frame" data-lang="sh"><div class="highlight"><pre class="with-code"><code><span class="nv">$ </span>yarn add @lollipop-onl/vue-typed-reactive\n<span class="c"># or</span>\n<span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-S</span> @lollipop-onl/vue-typed-reactive\n</code></pre></div></div>\n\n<h2>\n<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>\n\n<p>使い方は簡単で、Vueへの登録と<code>tsconfig.json</code>への設定の追加のみです。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// Vueへの登録</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="nx">TypedReactive</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@lollipop-onl/vue-typed-reactive</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">TypedReactive</span><span class="p">);</span>\n</code></pre></div></div>\n\n<p><details><summary>Nuxtの場合</summary><br>\n<p></p>\n\n<p>Nuxtの場合はプラグイン化して登録するのがおすすめです。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// @/plugins/libs/vue-typed-reactive.ts</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Plugin</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nuxt/types</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="nx">TypedReactive</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@lollipop-onl/vue-typed-reactive</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="kd">const</span> <span class="nx">plugin</span><span class="p">:</span> <span class="nx">Plugin</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">TypedReactive</span><span class="p">);</span>\n<span class="p">};</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">plugin</span><span class="p">;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Configuration</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nuxt/types</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="kd">const</span> <span class="nx">config</span><span class="p">:</span> <span class="nx">Configuration</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="p">...</span>\n  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>\n    <span class="dl">\'</span><span class="s1">@/plugins/libs/vue-typed-reactive</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="p">],</span>\n  <span class="p">...</span>\n<span class="p">};</span>\n</code></pre></div></div>\n\n<hr>\n\n<p></p>\n<br>\n</details></p>\n\n<p><code>tsconfig.json</code>では、<code>types</code>オプションにこのライブラリを追加してください。</p>\n\n<div class="code-frame" data-lang="js"><div class="highlight"><pre class="with-code"><code><span class="c1">// tsconfig.json</span>\n<span class="p">{</span>\n  <span class="dl">"</span><span class="s2">compilerOptions</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>\n    <span class="dl">"</span><span class="s2">types</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>\n      <span class="dl">"</span><span class="s2">@lollipop-onl/vue-typed-reactive</span><span class="dl">"</span>\n    <span class="p">]</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<p>あとは、Vueコンポーネント内であれば<code>this.$typedSet</code>を、VuexのMutationの中などであれば<code>Vue.typedSet</code>を使用するようにするだけです。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kr">interface</span> <span class="nx">IUser</span> <span class="p">{</span>\n    <span class="nl">name</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>\n    <span class="nl">age</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>\n<span class="p">}</span>\n\n<span class="c1">// Vue Component</span>\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="nl">profile</span><span class="p">:</span> <span class="nx">IUser</span> <span class="o">=</span> <span class="p">{</span> <span class="na">age</span><span class="p">:</span> <span class="mi">0</span> <span class="p">};</span>\n\n  <span class="nx">onChangeName</span><span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">$typedSet</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">profile</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">name</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>\n  <span class="p">}</span>\n\n  <span class="nx">clearProfileName</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">$typedDelete</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">profile</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">name</span><span class="dl">\'</span><span class="p">);</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">$typedDelete</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">profile</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">age</span><span class="dl">\'</span><span class="p">);</span> <span class="c1">// TypeError!</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// Vuex Store Module</span>\n<span class="k">export</span> <span class="kd">const</span> <span class="nx">mutations</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="nx">setUserName</span><span class="p">(</span><span class="na">state</span><span class="p">:</span> <span class="nx">IState</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>\n    <span class="nx">Vue</span><span class="p">.</span><span class="nx">typedSet</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">name</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>\n  <span class="p">},</span>\n<span class="p">};</span>\n</code></pre></div></div>\n\n<p>実装上は、<code>Vue.typedSet</code>は<code>Vue.set</code>の完全なエイリアスなので、全て置き換えても正常に動作すると思います（<code>delete</code>も同様）。</p>\n\n<h2>\n<span id="機能" class="fragment"></span><a href="#%E6%A9%9F%E8%83%BD"><i class="fa fa-link"></i></a>機能</h2>\n\n<p><code>typedSet</code>と<code>typedDelete</code>いずれも、プロパティと値の型安全以外にも <del>余計な</del> 機能をつけました。</p>\n\n<p><code>typedSet</code>では、<code>readonly</code>なプロパティへの値の設定ができないようにし、<code>typedDelete</code>では、Optionalなプロパティのキーのみ削除できるようにしました。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kr">interface</span> <span class="nx">IFoo</span> <span class="p">{</span>\n  <span class="nl">bar</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>\n  <span class="nl">baz</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>\n  <span class="k">readonly</span> <span class="nx">qux</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>\n<span class="p">}</span>\n\n<span class="kd">const</span> <span class="nx">foo</span><span class="p">:</span> <span class="nx">IFoo</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>\n\n<span class="nx">Vue</span><span class="p">.</span><span class="nx">typedSet</span><span class="p">(</span><span class="nx">foo</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">bar</span><span class="dl">\'</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// ok.</span>\n<span class="nx">Vue</span><span class="p">.</span><span class="nx">typedSet</span><span class="p">(</span><span class="nx">foo</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">qux</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">hello</span><span class="dl">\'</span><span class="p">);</span> <span class="c1">// Argument of type \'"qux"\' is not assignable to parameter of type \'never\'.</span>\n\n<span class="nx">Vue</span><span class="p">.</span><span class="nx">typedDelete</span><span class="p">(</span><span class="nx">foo</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">bar</span><span class="dl">\'</span><span class="p">);</span> <span class="c1">// Argument of type \'"bar"\' is not assignable to parameter of type \'never\'.</span>\n<span class="nx">Vue</span><span class="p">.</span><span class="nx">typedDelete</span><span class="p">(</span><span class="nx">foo</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">baz</span><span class="dl">\'</span><span class="p">);</span> <span class="c1">// ok.</span>\n<span class="nx">Vue</span><span class="p">.</span><span class="nx">typedDelete</span><span class="p">(</span><span class="nx">foo</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">qux</span><span class="dl">\'</span><span class="p">);</span> <span class="c1">// Argument of type \'"qux"\' is not assignable to parameter of type \'never\'.</span>\n</code></pre></div></div>\n\n<p>また、もともとのVueの実装は残っているため、対応不可な型エラーは<code>Vue.set</code>、<code>Vue.delete</code>で回避することができます。</p>\n\n<h2>\n<span id="恩恵" class="fragment"></span><a href="#%E6%81%A9%E6%81%B5"><i class="fa fa-link"></i></a>恩恵</h2>\n\n<p>実際に開発に組み込んでみて、VuexストアのMutationでとても活躍しています。<br>\nVuexのモジュールモードはモジュールがネストするとMutation内での<code>Vue.set</code>の使用が必須となります。</p>\n\n<p>せっかくTypeScriptを使っているのにStateへの代入時の型不整合がチェックできないのはそこそこしんどいと思っていました。<br>\nまた、プロパティ名の変更なども<code>Vue.set</code>、<code>Vue.delete</code>では検知できないので手動リファクタが必要なってきます。</p>\n\n<p>そういうのって面倒ですよね。</p>\n\n<p><code>Vue.typedSet</code>と<code>Vue.typedDelete</code>を使ってよりリファクタリングのしやすいVueアプリにしませんか？</p>\n\n<h1>\n<span id="実装について" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>実装について</h1>\n\n<p>ここからは、<code>vue-typed-reactive</code>の実装内容についてご紹介します。</p>\n\n<p>以降はほぼほぼTypeScriptに関する内容になります。<br>\nVueのアドベントカレンダーなのにすみません。。</p>\n\n<h2>\n<span id="vueの拡張" class="fragment"></span><a href="#vue%E3%81%AE%E6%8B%A1%E5%BC%B5"><i class="fa fa-link"></i></a>Vueの拡張</h2>\n\n<p><code>Vue.typedSet</code>、<code>Vue.typedDelete</code>というメソッドはVueには存在しません。<br>\nそれぞれ<code>Vue.set</code>、<code>Vue.delete</code>のエイリアスとして機能するよう、Vueを拡張してます。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// グローバルメソッド Vue.typedSet</span>\n<span class="nx">Vue</span><span class="p">.</span><span class="nx">typedSet</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="kd">set</span><span class="p">;</span>\n<span class="nx">Vue</span><span class="p">.</span><span class="nx">typedDelete</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="k">delete</span><span class="p">;</span>\n\n<span class="c1">// インスタンスメソッド vm.$typedSet</span>\n<span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$typedSet</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="kd">set</span><span class="p">;</span>\n<span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$typedDelete</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="k">delete</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p>これらを<code>Vue.use</code>でVueに登録できるようにするために、Vueプラグイン形式のオブジェクトでラップしています。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">PluginObject</span> <span class="p">}</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="kd">const</span> <span class="nx">TypedReactive</span><span class="p">:</span> <span class="nx">PluginObject</span><span class="o">&lt;</span><span class="nx">never</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="c1">// Vue.useしたときに呼ばれるメソッド</span>\n  <span class="na">install</span><span class="p">:</span> <span class="p">(</span><span class="nx">Vue</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="c1">// グローバルメソッド Vue.typedSet</span>\n    <span class="nx">Vue</span><span class="p">.</span><span class="nx">typedSet</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="kd">set</span><span class="p">;</span>\n    <span class="nx">Vue</span><span class="p">.</span><span class="nx">typedDelete</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="k">delete</span><span class="p">;</span>\n\n    <span class="c1">// インスタンスメソッド vm.$typedSet</span>\n    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$typedSet</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="kd">set</span><span class="p">;</span>\n    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$typedDelete</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="k">delete</span><span class="p">;</span>\n  <span class="p">},</span>\n<span class="p">};</span>\n</code></pre></div></div>\n\n<p><strong><a href="https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/index.ts#L20-L30" rel="nofollow noopener" target="_blank">🔗 実際の実装箇所</a></strong></p>\n\n<p><code>PluginObject</code>はVueプラグインの型情報です。Genericにはプラグインオプションの型を指定します。<br>\n今回はオプションなしなので<code>never</code>を指定しています。</p>\n\n<blockquote>\n<p><a href="https://jp.vuejs.org/v2/guide/plugins.html#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E8%A8%98%E8%BF%B0" rel="nofollow noopener" target="_blank">プラグイン — Vue.js</a></p>\n</blockquote>\n\n<h2>\n<span id="vuetypedsetの型定義" class="fragment"></span><a href="#vuetypedset%E3%81%AE%E5%9E%8B%E5%AE%9A%E7%BE%A9"><i class="fa fa-link"></i></a><code>Vue.typedSet</code>の型定義</h2>\n\n<p><code>Vue.typedSet</code>の定義は以下のとおりです。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kr">declare</span> <span class="kr">module</span> <span class="dl">\'</span><span class="s1">vue/types/vue</span><span class="dl">\'</span> <span class="p">{</span>\n  <span class="kr">interface</span> <span class="nx">VueConstructor</span> <span class="p">{</span>\n    <span class="nx">typedSet</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="nx">WritableKeys</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">]):</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">];</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<p><strong><a href="https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/index.ts#L13-L14" rel="nofollow noopener" target="_blank">🔗 実際の実装箇所</a></strong></p>\n\n<p>ちょっと長めですが、シンプルにすると以下のようになります。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="nx">typedSet</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">]):</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">];</span>\n</code></pre></div></div>\n\n<p>言語化すると</p>\n\n<blockquote>\n<p><code>object</code>で受け取った引数にあるプロパティのみを<code>key</code>で指定でき、<code>key</code>で指定したプロパティの値と同じ型のみ<code>value</code>で受け付ける</p>\n</blockquote>\n\n<p>という実装になっています。</p>\n\n<p>さて、シンプルにする前後で異なるのは、<code>readonly</code>でないプロパティのみを取得する型 <code>WritableKeys</code> です。<br>\n詳しく見ていきましょう。</p>\n\n<h3>\n<span id="writablekeys型" class="fragment"></span><a href="#writablekeys%E5%9E%8B"><i class="fa fa-link"></i></a><code>WritableKeys</code>型</h3>\n\n<p><code>WritableKeys</code>型は以下のような定義になっています。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="cm">/** オブジェクトの値の型を取得する */</span>\n<span class="k">export</span> <span class="kd">type</span> <span class="nx">Values</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">object</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span><span class="p">[</span><span class="kr">keyof</span> <span class="nx">T</span><span class="p">];</span>\n\n<span class="cm">/** ２つの型を比較し、一緒ならtrueを異なればfalseを返す */</span>\n<span class="k">export</span> <span class="kd">type</span> <span class="nx">IsEquals</span><span class="o">&lt;</span><span class="nx">X</span><span class="p">,</span> <span class="nx">Y</span><span class="o">&gt;</span> <span class="o">=</span>\n  <span class="p">(</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="nx">X</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span><span class="p">)</span> <span class="kd">extends</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="nx">Y</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span><span class="p">)</span> <span class="p">?</span> <span class="kc">true</span> <span class="p">:</span> <span class="kc">false</span><span class="p">;</span>\n\n<span class="cm">/** プロパティがreadonlyかどうかを判定する */</span>\n<span class="k">export</span> <span class="kd">type</span> <span class="nx">IsNotReadonly</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">IsEquals</span><span class="o">&lt;</span><span class="p">{</span> <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="nx">P</span><span class="p">]:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">P</span><span class="p">]</span> <span class="p">},</span> <span class="p">{</span> <span class="o">-</span><span class="k">readonly</span> <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="nx">P</span><span class="p">]:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">P</span><span class="p">]}</span><span class="o">&gt;</span><span class="p">;</span>\n\n<span class="cm">/** readonlyでないプロパティのみ取得する */</span>\n<span class="k">export</span> <span class="kd">type</span> <span class="nx">WritableKeys</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="o">&gt;</span> <span class="o">=</span> \n  <span class="nx">T</span> <span class="kd">extends</span> <span class="kr">any</span><span class="p">[]</span> <span class="p">?</span> <span class="kr">number</span> <span class="p">:</span> <span class="nx">Values</span><span class="o">&lt;</span><span class="p">{</span>\n    <span class="p">[</span><span class="nx">P</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="p">]</span><span class="o">-</span><span class="p">?:</span> <span class="nx">IsNotReadonly</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">P</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="kc">true</span> <span class="p">?</span> <span class="nx">P</span> <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n  <span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p>ちょっと情報が多いですね。<code>WritableKeys</code>型のみ見てみましょう。</p>\n\n<p><code>WritableKeys</code>型は、Genericで渡された型が配列であれば<code>number</code>型を、そうでなければ<code>readonly</code>ではないプロパティのキーを返します。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="cm">/** readonlyでないプロパティのキーを取得する */</span>\n<span class="k">export</span> <span class="kd">type</span> <span class="nx">WritableKeys</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="o">&gt;</span> <span class="o">=</span> \n  <span class="nx">T</span> <span class="kd">extends</span> <span class="kr">any</span><span class="p">[]</span> <span class="p">?</span> <span class="kr">number</span> <span class="p">:</span> <span class="nx">Values</span><span class="o">&lt;</span><span class="p">{</span>\n    <span class="p">[</span><span class="nx">P</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="p">]</span><span class="o">-</span><span class="p">?:</span> <span class="nx">IsNotReadonly</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">P</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="kc">true</span> <span class="p">?</span> <span class="nx">P</span> <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n  <span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p><strong><a href="https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/utils.ts#L23-L26" rel="nofollow noopener" target="_blank">🔗 実際の実装箇所</a></strong></p>\n\n<p>まず、型<code>T</code>には<code>Object</code>型が渡されますが、配列である可能性もあります。<br>\n<code>T</code>が配列である場合（<code>T extends any[]</code>）はキーの型として<code>number</code>型を返しています。<br>\nここまでが以下の部分です。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">export</span> <span class="kd">type</span> <span class="nx">WritableKeys</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="o">&gt;</span> <span class="o">=</span> \n  <span class="nx">T</span> <span class="kd">extends</span> <span class="kr">any</span><span class="p">[]</span> <span class="p">?</span> <span class="kr">number</span> <span class="p">:</span> <span class="cm">/*\n    readonlyではないプロパティのキーを取得する\n  */</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p>続いて、<code>readonly</code>でないプロパティのみを取り出します。</p>\n\n<p>ここでは、 <a href="#isnotreadonly%E5%9E%8B"><code>IsNotReadonly</code>型</a> を使って、<code>readonly</code>でないプロパティであれば値がプロパティ名に、<code>readonly</code>なプロパティであれば値が<code>never</code>になるようなオブジェクト型に変換しています。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="p">{</span>\n  <span class="c1">// Optionalなプロパティは値にundefinedが残るので -? でOptional除去</span>\n  <span class="p">[</span><span class="nx">P</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="p">]</span><span class="o">-</span><span class="p">?:</span> <span class="nx">IsNotReadonly</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">P</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="kc">true</span> <span class="p">?</span> <span class="nx">P</span> <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n<span class="p">}</span>\n\n<span class="c1">// 例</span>\n<span class="kr">interface</span> <span class="nx">IFoo</span> <span class="p">{</span>\n  <span class="nl">bar</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>\n  <span class="k">readonly</span> <span class="nx">baz</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>\n  <span class="nl">qux</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>\n<span class="p">}</span>\n<span class="c1">// 以下のような型に変換される</span>\n<span class="p">{</span>\n  <span class="na">bar</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">bar</span><span class="dl">\'</span><span class="p">;</span>\n  <span class="nl">baz</span><span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n  <span class="nl">qux</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">qux</span><span class="dl">\'</span><span class="p">;</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<p>その上で、 <a href="#values%E5%9E%8B"><code>Values</code>型</a> で値の型のみ取り出しています。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">export</span> <span class="kd">type</span> <span class="nx">WritableKeys</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="o">&gt;</span> <span class="o">=</span> \n  <span class="cm">/* 配列判定 */</span> <span class="p">:</span> <span class="nx">Values</span><span class="o">&lt;</span><span class="p">{</span>\n    <span class="p">[</span><span class="nx">P</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="p">]</span><span class="o">-</span><span class="p">?:</span> <span class="nx">IsNotReadonly</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">P</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="kc">true</span> <span class="p">?</span> <span class="nx">P</span> <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n  <span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>\n\n<span class="c1">// 例</span>\n<span class="kr">interface</span> <span class="nx">IFoo</span> <span class="p">{</span>\n  <span class="nl">bar</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>\n  <span class="k">readonly</span> <span class="nx">baz</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>\n  <span class="nl">qux</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>\n<span class="p">}</span>\n<span class="c1">// 以下のような型に変換される</span>\n<span class="kd">type</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nx">WritableKeys</span><span class="o">&lt;</span><span class="nx">IFoo</span><span class="o">&gt;</span><span class="p">;</span> <span class="c1">// \'bar\' | \'qux\'</span>\n</code></pre></div></div>\n\n<h4>\n<span id="プロパティのフィルタリング" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%81%AE%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>プロパティのフィルタリング</h4>\n\n<p>このようにすこし回りくどい方法でプロパティのフィルタリングを行っているのは、TypeScriptではマッピングとともにプロパティを除去することができないからです。</p>\n\n<p>TypeScriptでは<code>{ [K in keyof T]: any }</code>と<code>keyof</code>と<code>in</code>を使うことにより、元のオブジェクトと同じキーを持つ別の型を生成することができます。</p>\n\n<p>このとき、マッピングに使えるのが<code>keyof</code>だけで、キー自体をフィルタリングする方法は今の所ありません。</p>\n\n<p>そこで、回りくどいですが、一度<code>value</code>側に値をセットし、その<code>value</code>の型を取り出すことでキーをフィルタリングしているように見せています。</p>\n\n<h2>\n<span id="vuetypeddeleteの型定義" class="fragment"></span><a href="#vuetypeddelete%E3%81%AE%E5%9E%8B%E5%AE%9A%E7%BE%A9"><i class="fa fa-link"></i></a><code>Vue.typedDelete</code>の型定義</h2>\n\n<p><code>Vue.typedDelete</code>の定義は以下のとおりです。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kr">declare</span> <span class="kr">module</span> <span class="dl">\'</span><span class="s1">vue/types/vue</span><span class="dl">\'</span> <span class="p">{</span>\n  <span class="kr">interface</span> <span class="nx">VueConstructor</span> <span class="p">{</span>\n    <span class="nx">typedDelete</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="nx">OptionalKeys</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<p><strong><a href="https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/index.ts#L15-L16" rel="nofollow noopener" target="_blank">🔗 実際の実装箇所</a></strong></p>\n\n<p><code>Vue.typeSet</code>と同じく、シンプルにすると<code>object</code>で受け取った引数にあるプロパティのみを<code>key</code>で受け取れるという実装になっています。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="nx">typedDelete</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p>こちらでシンプルにする前後で異なるのはOptionalなプロパティのキーのみを取得する型<code>OptionalKeys</code>です。<br>\n詳しく見ていきましょう。</p>\n\n<h3>\n<span id="optionalkeys型" class="fragment"></span><a href="#optionalkeys%E5%9E%8B"><i class="fa fa-link"></i></a><code>OptionalKeys</code>型</h3>\n\n<p><code>OptionalKeys</code>方は以下のような定義になっています。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="cm">/** オブジェクトの値の型を取得する */</span>\n<span class="k">export</span> <span class="kd">type</span> <span class="nx">Values</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">object</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span><span class="p">[</span><span class="kr">keyof</span> <span class="nx">T</span><span class="p">];</span>\n\n<span class="cm">/** ２つの型がいずれもtrueの場合のみtrueを返す */</span>\n<span class="k">export</span> <span class="kd">type</span> <span class="nx">And</span><span class="o">&lt;</span><span class="nx">X</span> <span class="kd">extends</span> <span class="nx">boolean</span><span class="p">,</span> <span class="nx">Y</span> <span class="kd">extends</span> <span class="nx">boolean</span><span class="o">&gt;</span> <span class="o">=</span>\n  <span class="nx">X</span> <span class="kd">extends</span> <span class="kc">true</span>\n    <span class="p">?</span> <span class="nx">Y</span> <span class="kd">extends</span> <span class="kc">true</span>\n      <span class="p">?</span> <span class="kc">true</span>\n      <span class="p">:</span> <span class="kc">false</span>\n    <span class="p">:</span> <span class="kc">false</span><span class="p">;</span>\n\n<span class="cm">/** ２つの型を比較し、一緒ならtrueを異なればfalseを返す */</span>\n<span class="k">export</span> <span class="kd">type</span> <span class="nx">IsEquals</span><span class="o">&lt;</span><span class="nx">X</span><span class="p">,</span> <span class="nx">Y</span><span class="o">&gt;</span> <span class="o">=</span>\n  <span class="p">(</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="nx">X</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span><span class="p">)</span> <span class="kd">extends</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="nx">Y</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span><span class="p">)</span> <span class="p">?</span> <span class="kc">true</span> <span class="p">:</span> <span class="kc">false</span><span class="p">;</span>\n\n<span class="cm">/** プロパティがOptionalかどうかを判定する */</span>\n<span class="k">export</span> <span class="kd">type</span> <span class="nx">IsOptional</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">IsEquals</span><span class="o">&lt;</span><span class="nb">Pick</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">P</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">{</span> <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="nx">P</span><span class="p">]?:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">P</span><span class="p">]</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>\n\n<span class="cm">/** プロパティがreadonlyかどうかを判定する */</span>\n<span class="k">export</span> <span class="kd">type</span> <span class="nx">IsNotReadonly</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">IsEquals</span><span class="o">&lt;</span><span class="p">{</span> <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="nx">P</span><span class="p">]:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">P</span><span class="p">]</span> <span class="p">},</span> <span class="p">{</span> <span class="o">-</span><span class="k">readonly</span> <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="nx">P</span><span class="p">]:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">P</span><span class="p">]}</span><span class="o">&gt;</span><span class="p">;</span>\n\n<span class="cm">/** Optionalなプロパティのみ取得する */</span>\n<span class="k">export</span> <span class="kd">type</span> <span class="nx">OptionalKeys</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="o">&gt;</span> <span class="o">=</span> \n  <span class="nx">T</span> <span class="kd">extends</span> <span class="kr">any</span><span class="p">[]</span> <span class="p">?</span> <span class="kr">number</span> <span class="p">:</span> <span class="nx">Values</span><span class="o">&lt;</span><span class="p">{</span>\n    <span class="p">[</span><span class="nx">P</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="p">]</span><span class="o">-</span><span class="p">?:</span> <span class="nx">And</span><span class="o">&lt;</span><span class="nx">IsOptional</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">P</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">IsNotReadonly</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">P</span><span class="o">&gt;&gt;</span> <span class="kd">extends</span> <span class="kc">true</span> <span class="p">?</span> <span class="nx">P</span> <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n  <span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p>こちらも情報が多いですね。</p>\n\n<p><code>OptionalKeys</code>型は、Genericで渡された型が配列であれば<code>number</code>型を、そうでなければOptionalかつ<code>readonly</code>ではないプロパティのキーを返します。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">export</span> <span class="kd">type</span> <span class="nx">OptionalKeys</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="o">&gt;</span> <span class="o">=</span> \n  <span class="nx">T</span> <span class="kd">extends</span> <span class="kr">any</span><span class="p">[]</span> <span class="p">?</span> <span class="kr">number</span> <span class="p">:</span> <span class="nx">Values</span><span class="o">&lt;</span><span class="p">{</span>\n    <span class="p">[</span><span class="nx">P</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="p">]</span><span class="o">-</span><span class="p">?:</span> <span class="nx">And</span><span class="o">&lt;</span><span class="nx">IsOptional</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">P</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">IsNotReadonly</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">P</span><span class="o">&gt;&gt;</span> <span class="kd">extends</span> <span class="kc">true</span> <span class="p">?</span> <span class="nx">P</span> <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n  <span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p><strong><a href="https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/utils.ts#L28-L32" rel="nofollow noopener" target="_blank">🔗 実際の実装箇所</a></strong></p>\n\n<p><code>value</code>の条件以外は<code>WritableKeys</code>型と同じです。</p>\n\n<p>条件もOptionalなプロパティ（<code>IsOptional&lt;T, P&gt;</code>）かつ、<code>readonly</code>ではないプロパティ（<code>IsNotReadonly&lt;T, P&gt;</code>）というシンプルなものです。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="nx">And</span><span class="o">&lt;</span><span class="nx">IsOptional</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">P</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">IsNotReadonly</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">P</span><span class="o">&gt;&gt;</span> <span class="kd">extends</span> <span class="kc">true</span> <span class="p">?</span> <span class="nx">P</span> <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n</code></pre></div></div>\n\n<ul>\n<li><a href="#and%E5%9E%8B"><code>And</code>型</a></li>\n<li><a href="#isoptional%E5%9E%8B"><code>IsOptional</code>型</a></li>\n<li><a href="#isnotreadonly%E5%9E%8B"><code>IsNotReadonly</code>型</a></li>\n</ul>\n\n<h2>\n<span id="vmtypedsetvmtypeddeleteの型定義" class="fragment"></span><a href="#vmtypedsetvmtypeddelete%E3%81%AE%E5%9E%8B%E5%AE%9A%E7%BE%A9"><i class="fa fa-link"></i></a><code>vm.$typedSet</code>/<code>vm.$typedDelete</code>の型定義</h2>\n\n<p>最後に、インスタンスメソッドの型定義を行います。</p>\n\n<p>メソッド名が異なるので、全く同じ定義を２度書かなければなりません。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kr">declare</span> <span class="kr">module</span> <span class="dl">\'</span><span class="s1">vue/types/vue</span><span class="dl">\'</span> <span class="p">{</span>\n  <span class="kr">interface</span> <span class="nx">Vue</span> <span class="p">{</span>\n    <span class="cm">/** Type-safe version of Vue.set */</span>\n    <span class="nx">$typedSet</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="nx">WritableKeys</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">]):</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">];</span>\n    <span class="cm">/** Type-safe version of Vue.delete */</span>\n    <span class="nx">$typedDelete</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="nx">OptionalKeys</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<p><strong><a href="https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/index.ts#L5-L10" rel="nofollow noopener" target="_blank">🔗 実際の実装箇所</a></strong></p>\n\n<p>とくに説明することもないですね。</p>\n\n<h2>\n<span id="ユーティリティ型" class="fragment"></span><a href="#%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3%E5%9E%8B"><i class="fa fa-link"></i></a>ユーティリティ型</h2>\n\n<p>本文中にちょいちょい出てくるユーティリティ型の解説をまとめています。適宜参照してください。</p>\n\n<h3>\n<span id="values型" class="fragment"></span><a href="#values%E5%9E%8B"><i class="fa fa-link"></i></a><code>Values</code>型</h3>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">export</span> <span class="kd">type</span> <span class="nx">Values</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">object</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span><span class="p">[</span><span class="kr">keyof</span> <span class="nx">T</span><span class="p">];</span>\n\n<span class="kd">type</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">Values</span><span class="o">&lt;</span><span class="p">{</span> <span class="na">foo</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">bar</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">;</span> <span class="c1">// 0 | 1</span>\n<span class="kd">type</span> <span class="nx">bar</span> <span class="o">=</span> <span class="nx">Values</span><span class="o">&lt;</span><span class="p">{</span> <span class="na">foo</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">bar</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">;</span> <span class="c1">// 0 | \'foo\'</span>\n</code></pre></div></div>\n\n<p><strong><a href="https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/utils.ts#L1-L2" rel="nofollow noopener" target="_blank">🔗 実際の実装箇所</a></strong></p>\n\n<p>この型は、オブジェクトの値の型を取得するためのものです。</p>\n\n<p>オブジェクトの型<code>T</code>に対して<code>keyof T</code>の値を参照しています。<br>\nそのためすべてのプロパティ（<code>keyof T</code>）の値の型情報を取り出すことができます。</p>\n\n<h3>\n<span id="and型" class="fragment"></span><a href="#and%E5%9E%8B"><i class="fa fa-link"></i></a><code>And</code>型</h3>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">export</span> <span class="kd">type</span> <span class="nx">And</span><span class="o">&lt;</span><span class="nx">X</span> <span class="kd">extends</span> <span class="nx">boolean</span><span class="p">,</span> <span class="nx">Y</span> <span class="kd">extends</span> <span class="nx">boolean</span><span class="o">&gt;</span> <span class="o">=</span>\n  <span class="nx">X</span> <span class="kd">extends</span> <span class="kc">true</span>\n    <span class="p">?</span> <span class="nx">Y</span> <span class="kd">extends</span> <span class="kc">true</span>\n      <span class="p">?</span> <span class="kc">true</span>\n      <span class="p">:</span> <span class="kc">false</span>\n    <span class="p">:</span> <span class="kc">false</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p><strong><a href="https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/utils.ts#L4-L10" rel="nofollow noopener" target="_blank">🔗 実際の実装箇所</a></strong></p>\n\n<p>この型は、Genericで渡された２つの型の両方が<code>true</code>の場合のみ<code>true</code>を、それ以外の場合は<code>false</code>を返すものです。<br>\nJavaScriptでの<code>&amp;&amp;</code>と同等の型です。</p>\n\n<h3>\n<span id="isequals型" class="fragment"></span><a href="#isequals%E5%9E%8B"><i class="fa fa-link"></i></a><code>IsEquals</code>型</h3>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">export</span> <span class="kd">type</span> <span class="nx">IsEquals</span><span class="o">&lt;</span><span class="nx">X</span><span class="p">,</span> <span class="nx">Y</span><span class="o">&gt;</span> <span class="o">=</span>\n  <span class="p">(</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="nx">X</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span><span class="p">)</span> <span class="kd">extends</span>\n  <span class="p">(</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="nx">Y</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span><span class="p">)</span> <span class="p">?</span> <span class="kc">true</span> <span class="p">:</span> <span class="kc">false</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p><strong><a href="https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/utils.ts#L12-L14" rel="nofollow noopener" target="_blank">🔗 実際の実装箇所</a></strong></p>\n\n<p>この型はGenericで指定した２つの型が同一かを判定するものです。</p>\n\n<blockquote>\n<p><a href="https://github.com/Microsoft/TypeScript/issues/27024#issuecomment-421529650" rel="nofollow noopener" target="_blank">[Feature request]type level equal operator · Issue #27024 · microsoft/TypeScript</a></p>\n</blockquote>\n\n<p>TypeScriptリポジトリのIssue内で提案された型ですが、正直ちゃんと理解できていません。</p>\n\n<p>挙動を見るに、１つ目のConditional Typeで<code>T</code>の型が型<code>X</code>とひも付き必ず<code>1</code>となり、２つ目の<code>Conditional Type</code>では１つ目で確定した型<code>T</code>と型<code>Y</code>を比較することで<code>X</code>と同じであれば<code>1</code>、異なれば<code>2</code>になる。みたいなことではないかなと思っています（挙動からの憶測です。。）。</p>\n\n<p><strong>詳しい方、この型の解説をコメントしていただきたいです...</strong></p>\n\n<h3>\n<span id="isnotreadonly型" class="fragment"></span><a href="#isnotreadonly%E5%9E%8B"><i class="fa fa-link"></i></a><code>IsNotReadonly</code>型</h3>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">export</span> <span class="kd">type</span> <span class="nx">IsNotReadonly</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">IsEquals</span><span class="o">&lt;</span><span class="p">{</span> <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="nx">P</span><span class="p">]:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">P</span><span class="p">]</span> <span class="p">},</span> <span class="p">{</span> <span class="o">-</span><span class="k">readonly</span> <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="nx">P</span><span class="p">]:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">P</span><span class="p">]}</span><span class="o">&gt;</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p><strong><a href="https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/utils.ts#L19-L20" rel="nofollow noopener" target="_blank">🔗 実際の実装箇所</a></strong></p>\n\n<p>この型は、Genericで渡されたオブジェクトの型<code>T</code>とプロパティ<code>P</code>について、<code>P</code>が<code>readonly</code>でない場合に<code>true</code>を返すものです。</p>\n\n<p>前述の<a href="#isequals%E5%9E%8B"><code>IsEquals</code>型</a>でもともとのプロパティ（<code>{ [K in P]: T[P] }</code>）と<code>readonly</code>を除去したプロパティ（<code>{ -readonly [K in P]: T[P]}</code>）とを比較しています。<br>\nこの比較が<code>true</code>であるイコールもともと<code>readonly</code>がついていないという判断がつきます。</p>\n\n<h3>\n<span id="isoptional型" class="fragment"></span><a href="#isoptional%E5%9E%8B"><i class="fa fa-link"></i></a><code>IsOptional</code>型</h3>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">export</span> <span class="kd">type</span> <span class="nx">IsOptional</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">IsEquals</span><span class="o">&lt;</span><span class="p">{</span> <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="nx">P</span><span class="p">]:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">P</span><span class="p">]</span> <span class="p">},</span> <span class="p">{</span> <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="nx">P</span><span class="p">]?:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">P</span><span class="p">]</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p><strong><a href="https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/utils.ts#L16-L17" rel="nofollow noopener" target="_blank">🔗 実際の実装箇所</a></strong></p>\n\n<p>この型はGenericで渡されたオブジェクトの型<code>T</code>とプロパティ<code>P</code>について<code>P</code>がOptionalなプロパティかどうかを判定しています。</p>\n\n<p>実装内容については<a href="#isnotreadonly%E5%9E%8B"><code>IsNotReadonly</code>型</a>のOptional版なので詳しい説明は省略します。</p>\n\n<h2>\n<span id="型定義のテスト" class="fragment"></span><a href="#%E5%9E%8B%E5%AE%9A%E7%BE%A9%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>型定義のテスト</h2>\n\n<p>一応、<code>@lollipop-onl/vue-typed-reactive</code>では型定義のテストを書いています。</p>\n\n<p><strong><a href="https://github.com/lollipop-onl/vue-typed-reactive/blob/master/tests/index.ts" rel="nofollow noopener" target="_blank">🔗 実際の実装箇所</a></strong></p>\n\n<p>テストに使用しているのは <code>conditional-type-checks</code> という型ライブラリです。 </p>\n\n<blockquote>\n<p><a href="https://github.com/dsherret/conditional-type-checks" rel="nofollow noopener" target="_blank">dsherret/conditional-type-checks: Types for testing TypeScript types.</a></p>\n</blockquote>\n\n<p><code>conditional-type-checks</code>では、型の比較などに便利な型定義が様々収録されています。<br>\nまた、<code>asset</code>関数を使えば「型チェックにパスする or 失敗するかどうか」をテストすることができます。</p>\n\n<p><strong><code>@lollipop-onl/vue-typed-reactive</code>での例</strong></p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">assert</span><span class="p">,</span> <span class="nx">IsExact</span><span class="p">,</span> <span class="nx">Has</span><span class="p">,</span> <span class="nx">NotHas</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">conditional-type-checks</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="c1">// typedSet - key</span>\n<span class="cm">/** typedSetで指定可能なキーを取得する */</span>\n<span class="kd">type</span> <span class="nx">TypedSetKeys</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">TypedSet</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">infer</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span> <span class="p">?</span> <span class="nx">K</span> <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n\n<span class="cm">/** レコード型に対して正しくキーを指定できる */</span>\n<span class="nx">assert</span><span class="o">&lt;</span><span class="nx">Has</span><span class="o">&lt;</span><span class="nx">TypedSetKeys</span><span class="o">&lt;</span><span class="p">{</span> <span class="na">foo</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>\n<span class="cm">/** readonlyなプロパティに対してキーを指定できない */</span>\n<span class="nx">assert</span><span class="o">&lt;</span><span class="nx">NotHas</span><span class="o">&lt;</span><span class="nx">TypedSetKeys</span><span class="o">&lt;</span><span class="p">{</span> <span class="k">readonly</span> <span class="na">foo</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>\n<span class="cm">/** 配列に対してnumber型をキーとして指定できる */</span>\n<span class="nx">assert</span><span class="o">&lt;</span><span class="nx">IsExact</span><span class="o">&lt;</span><span class="nx">TypedSetKeys</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">&gt;</span><span class="p">,</span> <span class="kr">number</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>\n\n<span class="c1">// typedSet - value</span>\n<span class="cm">/** typedSetで指定可能な値の型を取得する */</span>\n<span class="kd">type</span> <span class="nx">TypedSetValue</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="nx">WritableKeys</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="nx">TypedSet</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">infer</span> <span class="nx">V</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span> <span class="p">?</span> <span class="nx">V</span> <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n\n<span class="cm">/** Record型に対して値を設定できる */</span>\n<span class="nx">assert</span><span class="o">&lt;</span><span class="nx">IsExact</span><span class="o">&lt;</span><span class="nx">TypedSetValue</span><span class="o">&lt;</span><span class="p">{</span> <span class="na">foo</span><span class="p">:</span> <span class="kr">string</span> <span class="p">},</span> <span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="o">&gt;</span><span class="p">,</span> <span class="kr">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>\n<span class="cm">/** Record型のOptionalなプロパティに対して値を設定できる */</span>\n<span class="nx">assert</span><span class="o">&lt;</span><span class="nx">IsExact</span><span class="o">&lt;</span><span class="nx">TypedSetValue</span><span class="o">&lt;</span><span class="p">{</span> <span class="nx">foo</span><span class="p">?:</span> <span class="kr">string</span> <span class="p">},</span> <span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="o">&gt;</span><span class="p">,</span> <span class="kr">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>\n\n<span class="c1">// typedDelete</span>\n<span class="cm">/** typeDeleteで指定可能なキーを取得する */</span>\n<span class="kd">type</span> <span class="nx">TypedDeleteKey</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nb">Object</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">TypedDelete</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">infer</span> <span class="nx">K</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span> <span class="p">?</span> <span class="nx">K</span> <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n\n<span class="cm">/** Optionalでないプロパティのキーを指定できない */</span>\n<span class="nx">assert</span><span class="o">&lt;</span><span class="nx">NotHas</span><span class="o">&lt;</span><span class="nx">TypedDeleteKey</span><span class="o">&lt;</span><span class="p">{</span> <span class="na">foo</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>\n<span class="cm">/** Optoinalなプロパティのキーを指定できる */</span>\n<span class="nx">assert</span><span class="o">&lt;</span><span class="nx">Has</span><span class="o">&lt;</span><span class="nx">TypedDeleteKey</span><span class="o">&lt;</span><span class="p">{</span> <span class="nx">foo</span><span class="p">?:</span> <span class="kr">string</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>\n<span class="cm">/** readonlyでOptionalなプロパティのキーを指定できない */</span>\n<span class="nx">assert</span><span class="o">&lt;</span><span class="nx">NotHas</span><span class="o">&lt;</span><span class="nx">TypedDeleteKey</span><span class="o">&lt;</span><span class="p">{</span> <span class="k">readonly</span> <span class="nx">foo</span><span class="p">?:</span> <span class="kr">string</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>\n<span class="cm">/** 配列に対してnumber型のキーを指定できる */</span>\n<span class="nx">assert</span><span class="o">&lt;</span><span class="nx">IsExact</span><span class="o">&lt;</span><span class="nx">TypedDeleteKey</span><span class="o">&lt;</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">&gt;</span><span class="p">,</span> <span class="kr">number</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>\n</code></pre></div></div>\n\n<p>関数の引数をテストしたい場合などは自前で型定義が必要だったりしますが、型定義にもテストを書けるのはリファクタリングなどがしやすいので助かります。</p>\n\n<h1>\n<span id="出典" class="fragment"></span><a href="#%E5%87%BA%E5%85%B8"><i class="fa fa-link"></i></a>出典</h1>\n\n<ul>\n<li><a href="https://stackoverflow.com/questions/49579094/typescript-conditional-types-filter-out-readonly-properties-pick-only-requir" rel="nofollow noopener" target="_blank">typescript2.8 - TypeScript conditional types - filter out readonly properties / pick only required properties - Stack Overflow</a></li>\n</ul>\n',body:"この記事は[Vue #2 Advent Calendar 2019](https://qiita.com/advent-calendar/2019/javascript)の11日目です。\n\n昨日は @nishihara_zari さんの [jQueryしか書けなかった自分がVueを使えるようになるまでの話と同じような環境の人たちへ](https://qiita.com/nishihara_zari/items/4a31d03711ab520d0c99) でした。\n\n# はじめに\n\n以前、[TypeScriptでVue.setを型安全にしたい](https://qiita.com/simochee/items/4d31414cb612f96a4c9f)という記事を書ました。\n今回はその記事で紹介した、`Vue.set`（と`Vue.delete`）を型安全にする実装をライブラリ化したので、実装内容についてご紹介します。\n\n本文だけ読みたいという方は [実装について](#実装について) まで読み飛ばしてください。\n\n# ライブラリのご紹介\n\n実装の紹介の前に、公開したライブラリについてご紹介させていただきます。\n\n[![vtyped.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/7fe68a26-2ac6-6eea-5f13-b5618543b52b.png)](https://www.npmjs.com/package/@lollipop-onl/vue-typed-reactive)\n\n> [@lollipop-onl/vue-typed-reactive - npm](https://www.npmjs.com/package/@lollipop-onl/vue-typed-reactive)\n\n`@lollipop-onl/vue-typed-reactive`はVueのグローバルに`Vue.typedSet`と`Vue.typedDelete`を、インスタンスに`vm.$typedSet`と`vm.$typedDelete`を提供するプラグインです。\n\n```sh\n$ yarn add @lollipop-onl/vue-typed-reactive\n# or\n$ npm install -S @lollipop-onl/vue-typed-reactive\n```\n\n## 使い方\n\n使い方は簡単で、Vueへの登録と`tsconfig.json`への設定の追加のみです。\n\n```ts\n// Vueへの登録\nimport Vue from 'vue';\nimport TypedReactive from '@lollipop-onl/vue-typed-reactive';\n\nVue.use(TypedReactive);\n```\n\n<details><summary>Nuxtの場合</summary>\n<p>\n\nNuxtの場合はプラグイン化して登録するのがおすすめです。\n\n```ts\n// @/plugins/libs/vue-typed-reactive.ts\nimport { Plugin } from '@nuxt/types';\nimport Vue from 'vue';\nimport TypedReactive from '@lollipop-onl/vue-typed-reactive';\n \nconst plugin: Plugin = () => {\n  Vue.use(TypedReactive);\n};\n \nexport default plugin;\n```\n\n```ts\nimport { Configuration } from '@nuxt/types';\n\nconst config: Configuration = {\n  ...\n  plugins: [\n    '@/plugins/libs/vue-typed-reactive',\n  ],\n  ...\n};\n```\n\n---\n\n</p>\n</details>\n\n`tsconfig.json`では、`types`オプションにこのライブラリを追加してください。\n\n```js\n// tsconfig.json\n{\n  \"compilerOptions\": {\n    \"types\": [\n      \"@lollipop-onl/vue-typed-reactive\"\n    ]\n  }\n}\n```\n\nあとは、Vueコンポーネント内であれば`this.$typedSet`を、VuexのMutationの中などであれば`Vue.typedSet`を使用するようにするだけです。\n\n```ts\ninterface IUser {\n    name?: string;\n    age: number;\n}\n\n// Vue Component\n@Component\nexport default class SampleComponent extends Vue {\n  profile: IUser = { age: 0 };\n\n  onChangeName(name: string): void {\n    this.$typedSet(this.profile, 'name', name);\n  }\n\n  clearProfileName(): void {\n    this.$typedDelete(this.profile, 'name');\n    this.$typedDelete(this.profile, 'age'); // TypeError!\n  }\n}\n```\n\n```ts\n// Vuex Store Module\nexport const mutations = {\n  setUserName(state: IState, name: string): void {\n    Vue.typedSet(state.user, 'name', name);\n  },\n};\n```\n\n実装上は、`Vue.typedSet`は`Vue.set`の完全なエイリアスなので、全て置き換えても正常に動作すると思います（`delete`も同様）。\n\n## 機能\n\n`typedSet`と`typedDelete`いずれも、プロパティと値の型安全以外にも ~~余計な~~ 機能をつけました。\n\n`typedSet`では、`readonly`なプロパティへの値の設定ができないようにし、`typedDelete`では、Optionalなプロパティのキーのみ削除できるようにしました。\n\n```ts\ninterface IFoo {\n  bar: number;\n  baz?: string;\n  readonly qux: string;\n}\n\nconst foo: IFoo = { ... };\n\nVue.typedSet(foo, 'bar', 100); // ok.\nVue.typedSet(foo, 'qux', 'hello'); // Argument of type '\"qux\"' is not assignable to parameter of type 'never'.\n\nVue.typedDelete(foo, 'bar'); // Argument of type '\"bar\"' is not assignable to parameter of type 'never'.\nVue.typedDelete(foo, 'baz'); // ok.\nVue.typedDelete(foo, 'qux'); // Argument of type '\"qux\"' is not assignable to parameter of type 'never'.\n```\n\nまた、もともとのVueの実装は残っているため、対応不可な型エラーは`Vue.set`、`Vue.delete`で回避することができます。\n\n## 恩恵\n\n実際に開発に組み込んでみて、VuexストアのMutationでとても活躍しています。\nVuexのモジュールモードはモジュールがネストするとMutation内での`Vue.set`の使用が必須となります。\n\nせっかくTypeScriptを使っているのにStateへの代入時の型不整合がチェックできないのはそこそこしんどいと思っていました。\nまた、プロパティ名の変更なども`Vue.set`、`Vue.delete`では検知できないので手動リファクタが必要なってきます。\n\nそういうのって面倒ですよね。\n\n`Vue.typedSet`と`Vue.typedDelete`を使ってよりリファクタリングのしやすいVueアプリにしませんか？\n\n# 実装について\n\nここからは、`vue-typed-reactive`の実装内容についてご紹介します。\n\n以降はほぼほぼTypeScriptに関する内容になります。\nVueのアドベントカレンダーなのにすみません。。\n\n## Vueの拡張\n\n`Vue.typedSet`、`Vue.typedDelete`というメソッドはVueには存在しません。\nそれぞれ`Vue.set`、`Vue.delete`のエイリアスとして機能するよう、Vueを拡張してます。\n\n```ts\n// グローバルメソッド Vue.typedSet\nVue.typedSet = Vue.set;\nVue.typedDelete = Vue.delete;\n\n// インスタンスメソッド vm.$typedSet\nVue.prototype.$typedSet = Vue.set;\nVue.prototype.$typedDelete = Vue.delete;\n```\n\nこれらを`Vue.use`でVueに登録できるようにするために、Vueプラグイン形式のオブジェクトでラップしています。\n\n```ts\nimport { PluginObject } = 'vue';\n\nconst TypedReactive: PluginObject<never> = {\n  // Vue.useしたときに呼ばれるメソッド\n  install: (Vue) => {\n    // グローバルメソッド Vue.typedSet\n    Vue.typedSet = Vue.set;\n    Vue.typedDelete = Vue.delete;\n\n    // インスタンスメソッド vm.$typedSet\n    Vue.prototype.$typedSet = Vue.set;\n    Vue.prototype.$typedDelete = Vue.delete;\n  },\n};\n```\n\n**[🔗 実際の実装箇所](https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/index.ts#L20-L30)**\n\n`PluginObject`はVueプラグインの型情報です。Genericにはプラグインオプションの型を指定します。\n今回はオプションなしなので`never`を指定しています。\n\n> [プラグイン — Vue.js](https://jp.vuejs.org/v2/guide/plugins.html#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E8%A8%98%E8%BF%B0)\n\n## `Vue.typedSet`の型定義\n\n`Vue.typedSet`の定義は以下のとおりです。\n\n```ts\ndeclare module 'vue/types/vue' {\n  interface VueConstructor {\n    typedSet<T extends Object, K extends WritableKeys<T>>(object: T, key: K, value: T[K]): T[K];\n  }\n}\n```\n\n**[🔗 実際の実装箇所](https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/index.ts#L13-L14)**\n\nちょっと長めですが、シンプルにすると以下のようになります。\n\n```ts\ntypedSet<T extends Object, K extends keyof T>(object: T, key: K, value: T[K]): T[K];\n```\n\n言語化すると\n\n> `object`で受け取った引数にあるプロパティのみを`key`で指定でき、`key`で指定したプロパティの値と同じ型のみ`value`で受け付ける\n\nという実装になっています。\n\nさて、シンプルにする前後で異なるのは、`readonly`でないプロパティのみを取得する型 `WritableKeys` です。\n詳しく見ていきましょう。\n\n### `WritableKeys`型\n\n`WritableKeys`型は以下のような定義になっています。\n\n```ts\n/** オブジェクトの値の型を取得する */\nexport type Values<T extends object> = T[keyof T];\n\n/** ２つの型を比較し、一緒ならtrueを異なればfalseを返す */\nexport type IsEquals<X, Y> =\n  (<T>() => T extends X ? 1 : 2) extends (<T>() => T extends Y ? 1 : 2) ? true : false;\n\n/** プロパティがreadonlyかどうかを判定する */\nexport type IsNotReadonly<T extends Object, P extends keyof T> = IsEquals<{ [K in P]: T[P] }, { -readonly [K in P]: T[P]}>;\n\n/** readonlyでないプロパティのみ取得する */\nexport type WritableKeys<T extends Object> = \n  T extends any[] ? number : Values<{\n    [P in keyof T]-?: IsNotReadonly<T, P> extends true ? P : never;\n  }>;\n```\n\nちょっと情報が多いですね。`WritableKeys`型のみ見てみましょう。\n\n`WritableKeys`型は、Genericで渡された型が配列であれば`number`型を、そうでなければ`readonly`ではないプロパティのキーを返します。\n\n```ts\n/** readonlyでないプロパティのキーを取得する */\nexport type WritableKeys<T extends Object> = \n  T extends any[] ? number : Values<{\n    [P in keyof T]-?: IsNotReadonly<T, P> extends true ? P : never;\n  }>;\n```\n\n**[🔗 実際の実装箇所](https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/utils.ts#L23-L26)**\n\nまず、型`T`には`Object`型が渡されますが、配列である可能性もあります。\n`T`が配列である場合（`T extends any[]`）はキーの型として`number`型を返しています。\nここまでが以下の部分です。\n\n```ts\nexport type WritableKeys<T extends Object> = \n  T extends any[] ? number : /*\n    readonlyではないプロパティのキーを取得する\n  */;\n```\n\n続いて、`readonly`でないプロパティのみを取り出します。\n\nここでは、 [`IsNotReadonly`型](#isnotreadonly型) を使って、`readonly`でないプロパティであれば値がプロパティ名に、`readonly`なプロパティであれば値が`never`になるようなオブジェクト型に変換しています。\n\n```ts\n{\n  // Optionalなプロパティは値にundefinedが残るので -? でOptional除去\n  [P in keyof T]-?: IsNotReadonly<T, P> extends true ? P : never;\n}\n\n// 例\ninterface IFoo {\n  bar: string;\n  readonly baz: string;\n  qux: number;\n}\n// 以下のような型に変換される\n{\n  bar: 'bar';\n  baz: never;\n  qux: 'qux';\n}\n```\n\nその上で、 [`Values`型](#values型) で値の型のみ取り出しています。\n\n```ts\nexport type WritableKeys<T extends Object> = \n  /* 配列判定 */ : Values<{\n    [P in keyof T]-?: IsNotReadonly<T, P> extends true ? P : never;\n  }>;\n\n// 例\ninterface IFoo {\n  bar: string;\n  readonly baz: string;\n  qux: number;\n}\n// 以下のような型に変換される\ntype keys = WritableKeys<IFoo>; // 'bar' | 'qux'\n```\n\n#### プロパティのフィルタリング\n\nこのようにすこし回りくどい方法でプロパティのフィルタリングを行っているのは、TypeScriptではマッピングとともにプロパティを除去することができないからです。\n\nTypeScriptでは`{ [K in keyof T]: any }`と`keyof`と`in`を使うことにより、元のオブジェクトと同じキーを持つ別の型を生成することができます。\n\nこのとき、マッピングに使えるのが`keyof`だけで、キー自体をフィルタリングする方法は今の所ありません。\n\nそこで、回りくどいですが、一度`value`側に値をセットし、その`value`の型を取り出すことでキーをフィルタリングしているように見せています。\n\n## `Vue.typedDelete`の型定義\n\n`Vue.typedDelete`の定義は以下のとおりです。\n\n```ts\ndeclare module 'vue/types/vue' {\n  interface VueConstructor {\n    typedDelete<T extends Object, K extends OptionalKeys<T>>(object: T, key: K): void;\n  }\n}\n```\n\n**[🔗 実際の実装箇所](https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/index.ts#L15-L16)**\n\n`Vue.typeSet`と同じく、シンプルにすると`object`で受け取った引数にあるプロパティのみを`key`で受け取れるという実装になっています。\n\n```ts\ntypedDelete<T extends Object, K extends keyof T>(object: T, key: K): void;\n```\n\nこちらでシンプルにする前後で異なるのはOptionalなプロパティのキーのみを取得する型`OptionalKeys `です。\n詳しく見ていきましょう。\n\n### `OptionalKeys`型\n\n`OptionalKeys`方は以下のような定義になっています。\n\n```ts\n/** オブジェクトの値の型を取得する */\nexport type Values<T extends object> = T[keyof T];\n\n/** ２つの型がいずれもtrueの場合のみtrueを返す */\nexport type And<X extends boolean, Y extends boolean> =\n  X extends true\n    ? Y extends true\n      ? true\n      : false\n    : false;\n\n/** ２つの型を比較し、一緒ならtrueを異なればfalseを返す */\nexport type IsEquals<X, Y> =\n  (<T>() => T extends X ? 1 : 2) extends (<T>() => T extends Y ? 1 : 2) ? true : false;\n\n/** プロパティがOptionalかどうかを判定する */\nexport type IsOptional<T extends Object, P extends keyof T> = IsEquals<Pick<T, P>, { [K in P]?: T[P] }>;\n\n/** プロパティがreadonlyかどうかを判定する */\nexport type IsNotReadonly<T extends Object, P extends keyof T> = IsEquals<{ [K in P]: T[P] }, { -readonly [K in P]: T[P]}>;\n\n/** Optionalなプロパティのみ取得する */\nexport type OptionalKeys<T extends Object> = \n  T extends any[] ? number : Values<{\n    [P in keyof T]-?: And<IsOptional<T, P>, IsNotReadonly<T, P>> extends true ? P : never;\n  }>;\n```\n\nこちらも情報が多いですね。\n\n`OptionalKeys`型は、Genericで渡された型が配列であれば`number`型を、そうでなければOptionalかつ`readonly`ではないプロパティのキーを返します。\n\n```ts\nexport type OptionalKeys<T extends Object> = \n  T extends any[] ? number : Values<{\n    [P in keyof T]-?: And<IsOptional<T, P>, IsNotReadonly<T, P>> extends true ? P : never;\n  }>;\n```\n\n**[🔗 実際の実装箇所](https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/utils.ts#L28-L32)**\n\n`value`の条件以外は`WritableKeys`型と同じです。\n\n条件もOptionalなプロパティ（`IsOptional<T, P>`）かつ、`readonly`ではないプロパティ（`IsNotReadonly<T, P>`）というシンプルなものです。\n\n```ts\nAnd<IsOptional<T, P>, IsNotReadonly<T, P>> extends true ? P : never;\n```\n\n* [`And`型](#and型)\n* [`IsOptional`型](#isoptional型)\n* [`IsNotReadonly`型](#isnotreadonly型)\n\n## `vm.$typedSet`/`vm.$typedDelete`の型定義\n\n最後に、インスタンスメソッドの型定義を行います。\n\nメソッド名が異なるので、全く同じ定義を２度書かなければなりません。\n\n```ts\ndeclare module 'vue/types/vue' {\n  interface Vue {\n    /** Type-safe version of Vue.set */\n    $typedSet<T extends Object, K extends WritableKeys<T>>(object: T, key: K, value: T[K]): T[K];\n    /** Type-safe version of Vue.delete */\n    $typedDelete<T extends Object, K extends OptionalKeys<T>>(object: T, key: K): void;\n  }\n}\n```\n\n**[🔗 実際の実装箇所](https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/index.ts#L5-L10)**\n\nとくに説明することもないですね。\n\n## ユーティリティ型\n\n本文中にちょいちょい出てくるユーティリティ型の解説をまとめています。適宜参照してください。\n\n### `Values`型\n\n```ts\nexport type Values<T extends object> = T[keyof T];\n\ntype foo = Values<{ foo: 0, bar: 1 }>; // 0 | 1\ntype bar = Values<{ foo: 0, bar: 'foo' }>; // 0 | 'foo'\n```\n\n**[🔗 実際の実装箇所](https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/utils.ts#L1-L2)**\n\nこの型は、オブジェクトの値の型を取得するためのものです。\n\nオブジェクトの型`T`に対して`keyof T`の値を参照しています。\nそのためすべてのプロパティ（`keyof T`）の値の型情報を取り出すことができます。\n\n### `And`型\n\n```ts\nexport type And<X extends boolean, Y extends boolean> =\n  X extends true\n    ? Y extends true\n      ? true\n      : false\n    : false;\n```\n\n**[🔗 実際の実装箇所](https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/utils.ts#L4-L10)**\n\nこの型は、Genericで渡された２つの型の両方が`true`の場合のみ`true`を、それ以外の場合は`false`を返すものです。\nJavaScriptでの`&&`と同等の型です。\n\n### `IsEquals`型\n\n```ts\nexport type IsEquals<X, Y> =\n  (<T>() => T extends X ? 1 : 2) extends\n  (<T>() => T extends Y ? 1 : 2) ? true : false;\n```\n\n**[🔗 実際の実装箇所](https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/utils.ts#L12-L14)**\n\nこの型はGenericで指定した２つの型が同一かを判定するものです。\n\n> [[Feature request]type level equal operator · Issue #27024 · microsoft/TypeScript](https://github.com/Microsoft/TypeScript/issues/27024#issuecomment-421529650)\n\nTypeScriptリポジトリのIssue内で提案された型ですが、正直ちゃんと理解できていません。\n\n挙動を見るに、１つ目のConditional Typeで`T`の型が型`X`とひも付き必ず`1`となり、２つ目の`Conditional Type`では１つ目で確定した型`T`と型`Y`を比較することで`X`と同じであれば`1`、異なれば`2`になる。みたいなことではないかなと思っています（挙動からの憶測です。。）。\n\n**詳しい方、この型の解説をコメントしていただきたいです...**\n\n### `IsNotReadonly`型\n\n```ts\nexport type IsNotReadonly<T extends Object, P extends keyof T> = IsEquals<{ [K in P]: T[P] }, { -readonly [K in P]: T[P]}>;\n```\n\n**[🔗 実際の実装箇所](https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/utils.ts#L19-L20)**\n\nこの型は、Genericで渡されたオブジェクトの型`T`とプロパティ`P`について、`P`が`readonly`でない場合に`true`を返すものです。\n\n前述の[`IsEquals`型](#isequals型)でもともとの\bプロパティ（`{ [K in P]: T[P] }`）と`readonly`を除去したプロパティ（`{ -readonly [K in P]: T[P]}`）とを比較しています。\nこの比較が`true`であるイコールもともと`readonly`がついていないという判断がつきます。\n\n### `IsOptional`型\n\n```ts\nexport type IsOptional<T extends Object, P extends keyof T> = IsEquals<{ [K in P]: T[P] }, { [K in P]?: T[P] }>;\n```\n\n**[🔗 実際の実装箇所](https://github.com/lollipop-onl/vue-typed-reactive/blob/bf9b8afb4976cd6825944c023de6c957c890ecb3/src/utils.ts#L16-L17)**\n\nこの型はGenericで渡されたオブジェクトの型`T`とプロパティ`P`について`P`がOptionalなプロパティかどうかを判定しています。\n\n実装内容については[`IsNotReadonly`型](#isnotreadonly型)のOptional版なので詳しい説明は省略します。\n\n## 型定義のテスト\n\n一応、`@lollipop-onl/vue-typed-reactive`では型定義のテストを書いています。\n\n**[🔗 実際の実装箇所](https://github.com/lollipop-onl/vue-typed-reactive/blob/master/tests/index.ts)**\n\nテストに使用しているのは `conditional-type-checks` という型ライブラリです。 \n\n> [dsherret/conditional-type-checks: Types for testing TypeScript types.](https://github.com/dsherret/conditional-type-checks)\n\n`conditional-type-checks`では、型の比較などに便利な型定義が様々収録されています。\nまた、`asset`関数を使えば「型チェックにパスする or 失敗するかどうか」をテストすることができます。\n\n**`@lollipop-onl/vue-typed-reactive`での例**\n\n```ts\nimport { assert, IsExact, Has, NotHas } from 'conditional-type-checks';\n\n// typedSet - key\n/** typedSetで指定可能なキーを取得する */\ntype TypedSetKeys<T extends Object> = TypedSet<T> extends (object: T, key: infer K, value: any) => any ? K : never;\n\n/** レコード型に対して正しくキーを指定できる */\nassert<Has<TypedSetKeys<{ foo: string }>, 'foo'>>(true);\n/** readonlyなプロパティに対してキーを指定できない */\nassert<NotHas<TypedSetKeys<{ readonly foo: string }>, 'foo'>>(true);\n/** 配列に対してnumber型をキーとして指定できる */\nassert<IsExact<TypedSetKeys<[1, 2, 3]>, number>>(true);\n\n// typedSet - value\n/** typedSetで指定可能な値の型を取得する */\ntype TypedSetValue<T extends Object, K extends WritableKeys<T>> = TypedSet<T> extends (object: T, key: K, value: infer V) => any ? V : never;\n\n/** Record型に対して値を設定できる */\nassert<IsExact<TypedSetValue<{ foo: string }, 'foo'>, string>>(true);\n/** Record型のOptionalなプロパティに対して値を設定できる */\nassert<IsExact<TypedSetValue<{ foo?: string }, 'foo'>, string>>(true);\n\n// typedDelete\n/** typeDeleteで指定可能なキーを取得する */\ntype TypedDeleteKey<T extends Object> = TypedDelete<T> extends (object: T, key: infer K) => void ? K : never;\n\n/** Optionalでないプロパティのキーを指定できない */\nassert<NotHas<TypedDeleteKey<{ foo: string }>, 'foo'>>(true);\n/** Optoinalなプロパティのキーを指定できる */\nassert<Has<TypedDeleteKey<{ foo?: string }>, 'foo'>>(true);\n/** readonlyでOptionalなプロパティのキーを指定できない */\nassert<NotHas<TypedDeleteKey<{ readonly foo?: string }>, 'foo'>>(true);\n/** 配列に対してnumber型のキーを指定できる */\nassert<IsExact<TypedDeleteKey<[1, 2, 3]>, number>>(true);\n```\n\n関数の引数をテストしたい場合などは自前で型定義が必要だったりしますが、型定義にもテストを書けるのはリファクタリングなどがしやすいので助かります。\n\n# 出典\n\n* [typescript2.8 - TypeScript conditional types - filter out readonly properties / pick only required properties - Stack Overflow](https://stackoverflow.com/questions/49579094/typescript-conditional-types-filter-out-readonly-properties-pick-only-requir)\n",coediting:a,comments_count:0,created_at:"2019-12-09T03:07:19+09:00",group:s,id:"89f4b17fe971b4571961",likes_count:7,private:a,reactions_count:0,tags:[{name:"AdventCalendar",versions:[]},{name:f,versions:[]},{name:v,versions:[]}],title:"TypeScriptでVue.set/deleteを型安全にするライブラリ作った",updated_at:"2019-12-11T07:01:57+09:00",url:"https://qiita.com/simochee/items/89f4b17fe971b4571961",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'\n<h1>\n<span id="20191218追記" class="fragment"></span><a href="#20191218%E8%BF%BD%E8%A8%98"><i class="fa fa-link"></i></a>2019/12/18追記</h1>\n\n<p>12/12にBabelを取り除きTypeScriptのみでTypeScript 3.7の新機能に対応した<a href="https://github.com/nuxt/typescript/releases/tag/%40nuxt%2Ftypescript-build%400.5.1" rel="nofollow noopener" target="_blank"><code>@nuxt/typescript-build@0.5.1</code></a>がリリースされました。</p>\n\n<p>Babel削除に伴い、<code>tsconfig.json</code>の<code>target</code>を<code>es2018</code>に指定しないと、<code>vue-loader</code>がOptional ChainingやNullish Coalescingを解析できなくなりました。<br>\nそのため、TypeScriptの時点でPolyfill込みのトランスパイルを行う必要があります。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>SyntaxError: /path/to/project/component.vue: Support for the experimental syntax \'optionalChaining\' isn\'t currently enabled (30:28):\n\n  29 |         const obj = { foo: 1 };\n&gt; 30 |         console.log(obj.bar?.baz?.qux);\n     |                            ^\n\nAdd @babel/plugin-proposal-optional-chaining (https://git.io/vb4Sk) to the \'plugins\' section of your Babel config to enable transformation.\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="diff"><div class="highlight"><pre class="with-code"><code><span class="err">{</span>\n  "compilerOptions": {\n<span class="gd">-    "target": "esnext"\n</span><span class="gi">+    "target": "es2018"\n</span>  }\n<span class="err">}</span>\n</code></pre></div></div>\n\n<p>なお、<code>@nuxt/typescript-build@0.5.1</code>以降は<code>tsconfig.json</code>の<code>target</code>指定以外に特別な対応は不要となりました。</p>\n\n<h2>\n<span id="手動アップグレード分を削除する" class="fragment"></span><a href="#%E6%89%8B%E5%8B%95%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E5%88%86%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>手動アップグレード分を削除する</h2>\n\n<p>追記前の状態では、手動で関連パッケージをインストールしているため、今後バージョンの乖離が起こる可能性があります。そのため、手動アップデート分のパッケージ情報を<code>package.json</code>から削除することをおすすめします。</p>\n\n<div class="code-frame" data-lang="sh"><div class="highlight"><pre class="with-code"><code><span class="nv">$ </span>yarn remove typescript ts-node ts-loader @babel/plugin-proposal-nullish-coalescing-operator @babel/plugin-proposal-optional-chaining\n</code></pre></div></div>\n\n<h1>\n<span id="20191209追記" class="fragment"></span><a href="#20191209%E8%BF%BD%E8%A8%98"><i class="fa fa-link"></i></a>2019/12/09追記</h1>\n\n<p>本日リリースされた<a href="https://github.com/nuxt/typescript/releases/tag/%40nuxt%2Ftypescript-build%400.4.0" rel="nofollow noopener" target="_blank"><code>@nuxt/typescript-build@0.4.0</code></a>と<a href="https://github.com/nuxt/typescript/releases/tag/%40nuxt%2Ftypescript-runtime%400.3.0" rel="nofollow noopener" target="_blank"><code>@nuxt/typescript-runtime@0.3.0</code></a>でTypeScript 3.7が正式にサポートされました 🎉</p>\n\n<p>これらのバージョンを使用していれば、以降の<a href="#babel%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E8%BF%BD%E5%8A%A0">Babelプラグインの追加</a>以外の設定は不要となります。</p>\n\n<p><a href="#babel%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E8%BF%BD%E5%8A%A0">Babelプラグインの追加</a>自体はNode側プロセスで必要みたいなので対応しなければならなようです。</p>\n\n<h2>\n<span id="手動アップグレード分を削除する-1" class="fragment"></span><a href="#%E6%89%8B%E5%8B%95%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E5%88%86%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B-1"><i class="fa fa-link"></i></a>手動アップグレード分を削除する</h2>\n\n<p>以降の手順を試された方は、今後のアップデートでバージョンの乖離が起きないよう、手動アップグレードした<code>typescript</code>と<code>ts-node</code>、<code>ts-loader</code>を<code>package.json</code>から削除しておくことをおすすめします。</p>\n\n<div class="code-frame" data-lang="sh"><div class="highlight"><pre class="with-code"><code><span class="nv">$ </span>yarn remove typescript ts-node ts-loader\n</code></pre></div></div>\n\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p>2019/11/18現在、Nuxt.jsではTypeScript 3.7を使用することはできません。</p>\n\n<p>ただし、使用しているパッケージのバージョンを手動で変更すればTypeScript 3.7に対応することができるようです。</p>\n\n<p>ここでは、その手順をご紹介します。</p>\n\n<h1>\n<span id="開発環境での設定" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%81%A7%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>開発環境での設定</h1>\n\n<h2>\n<span id="パッケージのバージョンアップ" class="fragment"></span><a href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>パッケージのバージョンアップ</h2>\n\n<p>手動で以下のパッケージをバージョンアップします。</p>\n\n<ul>\n<li><code>@nuxt/typescript-runtime</code></li>\n<li><code>@nuxt/typescript-build</code></li>\n<li><code>ts-node</code></li>\n<li><code>ts-loader</code></li>\n<li><code>typescript</code></li>\n</ul>\n\n<div class="code-frame" data-lang="sh"><div class="highlight"><pre class="with-code"><code><span class="nv">$ </span>yarn add <span class="s2">"@nuxt/typescript-build@^0.3.4"</span>\n<span class="nv">$ </span>yarn add <span class="nt">-D</span> <span class="se">\\</span>\n  <span class="s2">"@nuxt/typescript-runtime@^0.2.4"</span> <span class="se">\\</span>\n  <span class="s2">"ts-node@^8.5.0"</span> <span class="se">\\</span>\n  <span class="s2">"ts-loader@^6.2.1"</span> <span class="se">\\</span>\n  <span class="s2">"typescript@^3.7.2"</span>\n</code></pre></div></div>\n\n<h2>\n<span id="babelプラグインの追加" class="fragment"></span><a href="#babel%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>Babelプラグインの追加</h2>\n\n<p>TypeScript 3.7から追加された文法上の新機能である <code>Optional Chaining</code> と <code>Nullish Coalescing</code> はそのままでは実行することができません。</p>\n\n<ul>\n<li><code>@babel/plugin-proposal-nullish-coalescing-operator</code></li>\n<li><code>@babel/plugin-proposal-optional-chaining</code></li>\n</ul>\n\n<p>そのため、Babelプラグインを追加してトランスパイルされるようにします。</p>\n\n<div class="code-frame" data-lang="sh"><div class="highlight"><pre class="with-code"><code>yarn add <span class="nt">-D</span> <span class="se">\\</span>\n  @babel/plugin-proposal-nullish-coalescing-operator <span class="se">\\</span>\n  @babel/plugin-proposal-optional-chaining\n</code></pre></div></div>\n\n<p>これら２つのプラグインをBabelの設定に追加します。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// nuxt.config.ts</span>\n<span class="kd">const</span> <span class="nx">config</span><span class="p">:</span> <span class="nx">Configuration</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="na">build</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">babel</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>\n        <span class="dl">\'</span><span class="s1">@babel/plugin-proposal-nullish-coalescing-operator</span><span class="dl">\'</span><span class="p">,</span>\n        <span class="dl">\'</span><span class="s1">@babel/plugin-proposal-optional-chaining</span><span class="dl">\'</span><span class="p">,</span>\n      <span class="p">],</span>\n    <span class="p">},</span>\n  <span class="p">},</span>\n<span class="p">};</span>\n\n<span class="nx">moodule</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p>以上で、TypeScript 3.7を使ってNuxtアプリがビルドできるようになりました 🎊</p>\n\n<h1>\n<span id="vscodeでの設定" class="fragment"></span><a href="#vscode%E3%81%A7%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>VSCodeでの設定</h1>\n\n<p>VSCodeでTypeScript 3.7を用いたVueアプリの開発を行うためには少し設定が必要です。</p>\n\n<h2>\n<span id="tsファイル" class="fragment"></span><a href="#ts%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB"><i class="fa fa-link"></i></a><code>.ts</code>ファイル</h2>\n\n<p><code>.ts</code>ファイルの場合は、右下のTypeScriptバージョンを<code>3.6.3</code>から<code>ワークスペースのバージョン (3.7.2)</code>に変更すればTypeScript 3.7の新機能でもエラーが発生しなくなります。</p>\n\n<p><a href="https://camo.qiitausercontent.com/ea42202635b6fed209a388169f3bd32e58d759d3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132373933342f37333539346335302d626466382d336663642d313930352d3938383838653961633932372e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F73594c50-bdf8-3fcd-1905-98888e9ac927.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e9e05cd5638bb2237f9a6e049911e044" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/73594c50-bdf8-3fcd-1905-98888e9ac927.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F73594c50-bdf8-3fcd-1905-98888e9ac927.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0bca0e87714e6bd846ca293560dd36e2 1x" loading="lazy"></a></p>\n\n<p><a href="https://camo.qiitausercontent.com/e8c0139134d21bd4206051a92018e65dac57634d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132373933342f64643135353936352d376335332d356330352d333166362d6233363638383636356131362e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fdd155965-7c53-5c05-31f6-b36688665a16.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b0395f99b8dff1b53d05b1e93f1a0506" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/dd155965-7c53-5c05-31f6-b36688665a16.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fdd155965-7c53-5c05-31f6-b36688665a16.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0efe9b04b511889d9739008a2eaf0821 1x" loading="lazy"></a></p>\n\n<h2>\n<span id="vueファイル" class="fragment"></span><a href="#vue%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB"><i class="fa fa-link"></i></a><code>.vue</code>ファイル</h2>\n\n<p><code>.vue</code>ファイルの場合はVeturの設定を変更する必要があります。</p>\n\n<p><code>vetur.useWorkspaceDependencies</code>にチェックを入れると、ワークスペースのTypeScriptをVeturが参照するため、<code>3.7.2</code>の新機能を使用できるようになります。</p>\n\n<p><a href="https://camo.qiitausercontent.com/cc1577f08c28410ad7873019573ac4dcc1b61b69/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132373933342f64393338663533382d323164642d396331322d303836352d6233333735656164396638302e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fd938f538-21dd-9c12-0865-b3375ead9f80.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=718ff001902e674a1286267622c14cd0" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/d938f538-21dd-9c12-0865-b3375ead9f80.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fd938f538-21dd-9c12-0865-b3375ead9f80.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=289e7b5b42353b2d5c3199430f127b54 1x" loading="lazy"></a></p>\n\n<h1>\n<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>\n\n<ul>\n<li><a href="https://github.com/nuxt/typescript/issues/185" rel="nofollow noopener" target="_blank">TypeScript 3.7 support · Issue #185 · nuxt/typescript</a></li>\n<li><a href="https://dev.classmethod.jp/client-side/typescript-3-7-2-release/#toc-visual-studio-codevs-code" rel="nofollow noopener" target="_blank">TypeScript 3.7.2がリリースされました！Optional ChainingやNullish Coalescingをさっそく使ってみた ｜ Developers.IO</a></li>\n<li><a href="https://qiita.com/ibara1454/items/10d6091858db106e717b" id="reference-a060d80a0159b16fb7df">VeturにTypeScript3.7のOptional Chainingを適用してみる - Qiita</a></li>\n</ul>\n',body:'# 2019/12/18追記\n\n12/12にBabelを取り除きTypeScriptのみでTypeScript 3.7の新機能に対応した[`@nuxt/typescript-build@0.5.1`](https://github.com/nuxt/typescript/releases/tag/%40nuxt%2Ftypescript-build%400.5.1)がリリースされました。\n\nBabel削除に伴い、`tsconfig.json`の`target`を`es2018`に指定しないと、`vue-loader`がOptional ChainingやNullish Coalescingを解析できなくなりました。\nそのため、TypeScriptの時点でPolyfill込みのトランスパイルを行う必要があります。\n\n```\nSyntaxError: /path/to/project/component.vue: Support for the experimental syntax \'optionalChaining\' isn\'t currently enabled (30:28):\n\n  29 |         const obj = { foo: 1 };\n> 30 |         console.log(obj.bar?.baz?.qux);\n     |                            ^\n\nAdd @babel/plugin-proposal-optional-chaining (https://git.io/vb4Sk) to the \'plugins\' section of your Babel config to enable transformation.\n```\n\n```diff\n{\n  "compilerOptions": {\n-    "target": "esnext"\n+    "target": "es2018"\n  }\n}\n```\n\nなお、`@nuxt/typescript-build@0.5.1`以降は`tsconfig.json`の`target`指定以外に特別な対応は不要となりました。\n\n## 手動アップグレード分を削除する\n\n追記前の状態では、手動で関連パッケージをインストールしているため、今後バージョンの乖離が起こる可能性があります。そのため、手動アップデート分のパッケージ情報を`package.json`から削除することをおすすめします。\n\n```sh\n$ yarn remove typescript ts-node ts-loader @babel/plugin-proposal-nullish-coalescing-operator @babel/plugin-proposal-optional-chaining\n```\n\n# 2019/12/09追記\n\n本日リリースされた[`@nuxt/typescript-build@0.4.0`](https://github.com/nuxt/typescript/releases/tag/%40nuxt%2Ftypescript-build%400.4.0)と[`@nuxt/typescript-runtime@0.3.0`](https://github.com/nuxt/typescript/releases/tag/%40nuxt%2Ftypescript-runtime%400.3.0)でTypeScript 3.7が正式にサポートされました 🎉\n\nこれらのバージョンを使用していれば、以降の[Babelプラグインの追加](#babelプラグインの追加)以外の設定は不要となります。\n\n[Babelプラグインの追加](#babelプラグインの追加)自体はNode側プロセスで必要みたいなので対応しなければならなようです。\n\n## 手動アップグレード分を削除する\n\n以降の手順を試された方は、今後のアップデートでバージョンの乖離が起きないよう、手動アップグレードした`typescript`と`ts-node`、`ts-loader`を`package.json`から削除しておくことをおすすめします。\n\n```sh\n$ yarn remove typescript ts-node ts-loader\n```\n\n# はじめに\n\n2019/11/18現在、Nuxt.jsではTypeScript 3.7を使用することはできません。\n\nただし、使用しているパッケージのバージョンを手動で変更すればTypeScript 3.7に対応することができるようです。\n\nここでは、その手順をご紹介します。\n\n# 開発環境での設定\n\n## パッケージのバージョンアップ\n\n手動で以下のパッケージをバージョンアップします。\n\n* `@nuxt/typescript-runtime`\n* `@nuxt/typescript-build`\n* `ts-node`\n* `ts-loader`\n* `typescript`\n\n```sh\n$ yarn add "@nuxt/typescript-build@^0.3.4"\n$ yarn add -D \\\n  "@nuxt/typescript-runtime@^0.2.4" \\\n  "ts-node@^8.5.0" \\\n  "ts-loader@^6.2.1" \\\n  "typescript@^3.7.2"\n```\n\n## Babelプラグインの追加\n\nTypeScript 3.7から追加された文法上の新機能である `Optional Chaining` と `Nullish Coalescing` はそのままでは実行することができません。\n\n* `@babel/plugin-proposal-nullish-coalescing-operator`\n* `@babel/plugin-proposal-optional-chaining`\n\nそのため、Babelプラグインを追加してトランスパイルされるようにします。\n\n```sh\nyarn add -D \\\n  @babel/plugin-proposal-nullish-coalescing-operator \\\n  @babel/plugin-proposal-optional-chaining\n```\n\nこれら２つのプラグインをBabelの設定に追加します。\n\n```ts\n// nuxt.config.ts\nconst config: Configuration = {\n  build: {\n    babel: {\n      plugins: [\n        \'@babel/plugin-proposal-nullish-coalescing-operator\',\n        \'@babel/plugin-proposal-optional-chaining\',\n      ],\n    },\n  },\n};\n\nmoodule.exports = config;\n```\n\n以上で、TypeScript 3.7を使ってNuxtアプリがビルドできるようになりました 🎊\n\n# VSCodeでの設定\n\nVSCodeでTypeScript 3.7を用いたVueアプリの開発を行うためには少し設定が必要です。\n\n## `.ts`ファイル\n\n`.ts`ファイルの場合は、右下のTypeScriptバージョンを`3.6.3`から`ワークスペースのバージョン (3.7.2)`に変更すればTypeScript 3.7の新機能でもエラーが発生しなくなります。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/73594c50-bdf8-3fcd-1905-98888e9ac927.png)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/dd155965-7c53-5c05-31f6-b36688665a16.png)\n\n## `.vue`ファイル\n\n`.vue`ファイルの場合はVeturの設定を変更する必要があります。\n\n`vetur.useWorkspaceDependencies`にチェックを入れると、ワークスペースのTypeScriptをVeturが参照するため、`3.7.2`の新機能を使用できるようになります。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/d938f538-21dd-9c12-0865-b3375ead9f80.png)\n\n# 参考\n\n* [TypeScript 3.7 support · Issue #185 · nuxt/typescript](https://github.com/nuxt/typescript/issues/185)\n* [TypeScript 3.7.2がリリースされました！Optional ChainingやNullish Coalescingをさっそく使ってみた ｜ Developers.IO](https://dev.classmethod.jp/client-side/typescript-3-7-2-release/#toc-visual-studio-codevs-code)\n* [VeturにTypeScript3.7のOptional Chainingを適用してみる - Qiita](https://qiita.com/ibara1454/items/10d6091858db106e717b)\n',coediting:a,comments_count:0,created_at:"2019-11-18T11:53:08+09:00",group:s,id:"a2eca2ea8761409889be",likes_count:25,private:a,reactions_count:0,tags:[{name:f,versions:[]},{name:y,versions:[]}],title:"Nuxt.jsでTypeScript 3.7を使う",updated_at:"2019-12-18T12:24:18+09:00",url:"https://qiita.com/simochee/items/a2eca2ea8761409889be",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p>この度、<code>nuxt-child</code>というコンポーネントの存在を知り、戦慄しました。</p>\n\n<blockquote>\n<p><a href="https://ja.nuxtjs.org/api/components-nuxt-child/" rel="nofollow noopener" target="_blank">API:  コンポーネント - NuxtJS</a></p>\n</blockquote>\n\n<p>これまで、ページカテゴリの数だけレイアウトファイルを量産し、似通った初期化処理を何度も書いてしまっていました。<br>\n<strong>が、それは本来、レイアウトファイルで行うべきことではなかったのです</strong>。</p>\n\n<p>この記事では<code>nuxt-child</code>コンポーネントの使い方をご紹介します。</p>\n\n<h1>\n<span id="nested-routes" class="fragment"></span><a href="#nested-routes"><i class="fa fa-link"></i></a>Nested Routes</h1>\n\n<p>Nuxtにはネストされたルート（Nested Routes）という機能が存在します。<br>\nこれは、ページパスと同名のページコンポーネントをレイアウト相当として動作させる事ができる機能です。</p>\n\n<blockquote>\n<p><a href="https://ja.nuxtjs.org/guide/routing/#%E3%83%8D%E3%82%B9%E3%83%88%E3%81%95%E3%82%8C%E3%81%9F%E3%83%AB%E3%83%BC%E3%83%88" rel="nofollow noopener" target="_blank">ネストされたルート (ルーティング - NuxtJS)</a></p>\n</blockquote>\n\n<p>たとえば、以下のようなページ構成にするとします。</p>\n\n<div class="code-frame" data-lang="text"><div class="highlight"><pre class="with-code"><code>.\n└── pages/\n    ├── product/\n    │   ├── index.vue\n    │   ├── list.vue\n    │   └── _id.vue\n    └── product.vue\n</code></pre></div></div>\n\n<p>有効になるルートは<code>/product</code>、<code>/product/list</code>、<code>/product/_id</code>の３つです。</p>\n\n<p>このとき、<code>pages/product.vue</code>に記述した内容は、<code>pages/product/</code>以下のすべてのページコンポーネントで有効になります。<br>\nつまり、<code>pages/product.vue</code>が<code>pages/product/</code>以下のページのレイアウトとして機能するようになります。</p>\n\n<p>また、<code>pages/product.vue</code>には実際のページを表示させる領域に<code>nuxt-child</code>コンポーネントを配置する必要があります。</p>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre class="with-code"><code><span class="c">&lt;!-- /pages/product.vue --&gt;</span>\n<span class="nt">&lt;template&gt;</span>\n  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"page-container"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;TheHeader</span> <span class="na">class=</span><span class="s">"header"</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"contents"</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;TheBreadcrumbs</span> <span class="nt">/&gt;</span>\n        <span class="c">&lt;!-- ここにページの内容が入る --&gt;</span>\n        <span class="nt">&lt;nuxt-child</span> <span class="nt">/&gt;</span>\n      <span class="nt">&lt;/div&gt;</span>\n    <span class="nt">&lt;/TheHeader&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/template&gt;</span>\n</code></pre></div></div>\n\n<p>このようにすれば、<code>/pages/product/</code>以下のページで共通したヘッダーとパンくずリストを表示することができます。<br>\n同様に、マイページや注文関連のページもそれぞれ異なるレイアウトで表示することができます。</p>\n\n<p>そして、レイアウトファイルはグローバルスタイルやレイアウトの定義のみとなり、量産を防ぐことができます。</p>\n\n<h1>\n<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>\n\n<p>Nuxtはディレクトリ階層ベースのルーティングシステムのため、かなりURL定義が重要になります。<br>\nNested Routesもカテゴリごとにディレクトリ分けされて初めて機能します。</p>\n\n<p>カテゴリごとにディレクトリ分けされていないようなケースではあまり有効ではありません。<br>\nそのときは諦めてレイアウトファイルを量産するなどしてください。</p>\n\n<p>それ以外に良い方法があれば教えてほしい...。</p>\n',body:'# はじめに\n\nこの度、`nuxt-child`というコンポーネントの存在を知り、戦慄しました。\n\n> [API: <nuxt-child> コンポーネント - NuxtJS](https://ja.nuxtjs.org/api/components-nuxt-child/)\n\nこれまで、ページカテゴリの数だけレイアウトファイルを量産し、似通った初期化処理を何度も書いてしまっていました。\n**が、それは本来、レイアウトファイルで行うべきことではなかったのです**。\n\nこの記事では`nuxt-child`コンポーネントの使い方をご紹介します。\n\n# Nested Routes\n\nNuxtにはネストされたルート（Nested Routes）という機能が存在します。\nこれは、ページパスと同名のページコンポーネントをレイアウト相当として動作させる事ができる機能です。\n\n> [ネストされたルート (ルーティング - NuxtJS)](https://ja.nuxtjs.org/guide/routing/#%E3%83%8D%E3%82%B9%E3%83%88%E3%81%95%E3%82%8C%E3%81%9F%E3%83%AB%E3%83%BC%E3%83%88)\n\nたとえば、以下のようなページ構成にするとします。\n\n```\n.\n└── pages/\n    ├── product/\n    │   ├── index.vue\n    │   ├── list.vue\n    │   └── _id.vue\n    └── product.vue\n```\n\n有効になるルートは`/product`、`/product/list`、`/product/_id`の３つです。\n\nこのとき、`pages/product.vue`に記述した内容は、`pages/product/`以下のすべてのページコンポーネントで有効になります。\nつまり、`pages/product.vue`が`pages/product/`以下のページのレイアウトとして機能するようになります。\n\nまた、`pages/product.vue`には実際のページを表示させる領域に`nuxt-child`コンポーネントを配置する必要があります。\n\n```html\n\x3c!-- /pages/product.vue --\x3e\n<template>\n  <div class="page-container">\n    <TheHeader class="header">\n      <div class="contents">\n        <TheBreadcrumbs />\n        \x3c!-- ここにページの内容が入る --\x3e\n        <nuxt-child />\n      </div>\n    </TheHeader>\n  </div>\n</template>\n```\n\nこのようにすれば、`/pages/product/`以下のページで共通したヘッダーとパンくずリストを表示することができます。\n同様に、マイページや注文関連のページもそれぞれ異なるレイアウトで表示することができます。\n\nそして、レイアウトファイルはグローバルスタイルやレイアウトの定義のみとなり、量産を防ぐことができます。\n\n# おわりに\n\nNuxtはディレクトリ階層ベースのルーティングシステムのため、かなりURL定義が重要になります。\nNested Routesもカテゴリごとにディレクトリ分けされて初めて機能します。\n\nカテゴリごとにディレクトリ分けされていないようなケースではあまり有効ではありません。\nそのときは諦めてレイアウトファイルを量産するなどしてください。\n\nそれ以外に良い方法があれば教えてほしい...。\n',coediting:a,comments_count:0,created_at:V,group:s,id:"fbca7cb6c69e82484873",likes_count:40,private:a,reactions_count:0,tags:[{name:y,versions:[]}],title:"nuxt-childでlayoutの量産を防ぐ",updated_at:V,url:"https://qiita.com/simochee/items/fbca7cb6c69e82484873",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'<p>記事を書いているときに参考にしたウェブページを掲載しますが、タイトルのコピーが厄介です。</p>\n\n<p>そんなときのために、表示しているページのタイトルをコピーするブックマークレットをご紹介します。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><code><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="c1">// タイトルを参照</span>\n  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>\n\n  <span class="c1">// コピーの元にするtextareaを作成</span>\n  <span class="kd">const</span> <span class="nx">textarea</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">\'</span><span class="s1">textarea</span><span class="dl">\'</span><span class="p">);</span>\n  <span class="nx">textarea</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">title</span><span class="p">;</span>\n\n  <span class="c1">// bodyタグの最後にtextareaを追加</span>\n  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">textarea</span><span class="p">);</span>\n\n  <span class="c1">// textareaの内容をクリップボードにコピー</span>\n  <span class="nx">textarea</span><span class="p">.</span><span class="nx">select</span><span class="p">();</span>\n  <span class="nb">document</span><span class="p">.</span><span class="nx">execCommand</span><span class="p">(</span><span class="dl">\'</span><span class="s1">copy</span><span class="dl">\'</span><span class="p">);</span>\n\n  <span class="c1">// 最初に作成したtextareaをbodyから削除</span>\n  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">textarea</span><span class="p">);</span>\n\n  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Copyed this website title "</span><span class="p">${</span><span class="nx">title</span><span class="p">}</span><span class="s2">"`</span><span class="p">);</span>\n<span class="p">})();</span>\n</code></pre></div></div>\n\n<p>Minified:</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><code><span class="p">(()</span><span class="o">=&gt;</span><span class="p">{</span><span class="kd">const</span> <span class="nx">e</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span><span class="nx">t</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">textarea</span><span class="dl">"</span><span class="p">);</span><span class="nx">t</span><span class="p">.</span><span class="nx">textContent</span><span class="o">=</span><span class="nx">e</span><span class="p">,</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">t</span><span class="p">),</span><span class="nx">t</span><span class="p">.</span><span class="nx">select</span><span class="p">(),</span><span class="nb">document</span><span class="p">.</span><span class="nx">execCommand</span><span class="p">(</span><span class="dl">"</span><span class="s2">copy</span><span class="dl">"</span><span class="p">),</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">t</span><span class="p">),</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Copyed this website title "</span><span class="p">${</span><span class="nx">e</span><span class="p">}</span><span class="s2">"`</span><span class="p">)})();</span>\n</code></pre></div></div>\n\n<p>使い方：</p>\n\n<p>冒頭に<code>javascript:</code>をつけてブックマークに保存してください。あとは、登録したブックマークを実行したらタイトルがコピーできるようになります。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><code><span class="nx">javascript</span><span class="p">(()</span><span class="o">=&gt;</span><span class="p">{</span><span class="kd">const</span><span class="p">...});</span>\n</code></pre></div></div>\n',body:'記事を書いているときに参考にしたウェブページを掲載しますが、タイトルのコピーが厄介です。\n\nそんなときのために、表示しているページのタイトルをコピーするブックマークレットをご紹介します。\n\n```ts\n(() => {\n  // タイトルを参照\n  const title = document.title;\n\n  // コピーの元にするtextareaを作成\n  const textarea = document.createElement(\'textarea\');\n  textarea.textContent = title;\n\n  // bodyタグの最後にtextareaを追加\n  document.body.appendChild(textarea);\n  \n  // textareaの内容をクリップボードにコピー\n  textarea.select();\n  document.execCommand(\'copy\');\n\n  // 最初に作成したtextareaをbodyから削除\n  document.body.removeChild(textarea);\n\n  console.log(`Copyed this website title "${title}"`);\n})();\n```\n\nMinified:\n\n```ts\n(()=>{const e=document.title,t=document.createElement("textarea");t.textContent=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),console.log(`Copyed this website title "${e}"`)})();\n```\n\n使い方：\n\n冒頭に`javascript:`をつけてブックマークに保存してください。あとは、登録したブックマークを実行したらタイトルがコピーできるようになります。\n\n```ts\njavascript(()=>{const...});\n```\n',coediting:a,comments_count:0,created_at:C,group:s,id:"234c2a8203ac951bef19",likes_count:0,private:a,reactions_count:0,tags:[{name:"bookmarklet",versions:[]}],title:"見ているサイトのタイトルをコピーするブックマークレット",updated_at:C,url:"https://qiita.com/simochee/items/234c2a8203ac951bef19",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'\n<h1>\n<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>\n\n<p>せっかくTypeScriptを使っているのだから、<code>Vue.set</code>も型安全にしたい！と、誰しも一度は考えたことがあるのではないでしょうか？</p>\n\n<p>この記事では、過程とともに<code>Vue.set</code>を型安全にする実装をご紹介します。</p>\n\n<h1>\n<span id="tldr" class="fragment"></span><a href="#tldr"><i class="fa fa-link"></i></a>TL;DR</h1>\n\n<p><details><summary>最終的なコード</summary><br>\n<p></p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="nx">Vue</span><span class="p">.</span><span class="nx">typedSet</span> <span class="o">=</span> <span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Vue</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// src/@types/vue.d.ts</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="kr">declare</span> <span class="kr">module</span> <span class="dl">\'</span><span class="s1">vue/types/vue</span><span class="dl">\'</span> <span class="p">{</span>\n  <span class="kr">interface</span> <span class="nx">VueConstructor</span> <span class="p">{</span>\n    <span class="nx">typedSet</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">]):</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">];</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<p></p>\n<br>\n</details></p>\n\n<h1>\n<span id="vuesetの型" class="fragment"></span><a href="#vueset%E3%81%AE%E5%9E%8B"><i class="fa fa-link"></i></a><code>Vue.set</code>の型</h1>\n\n<p><code>Vue.set</code>の型は<code>vue/types/vue.d.ts</code>に以下のように定義されています。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code>  <span class="kd">set</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">T</span><span class="p">;</span>\n  <span class="kd">set</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">array</span><span class="p">:</span> <span class="nx">T</span><span class="p">[],</span> <span class="nx">key</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">T</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p>配列の場合は問題ないのですが、オブジェクトの値は本来の型とは異なるものを設定できてしまいます。</p>\n\n<p>これは良くない、ということで型安全にする手立てを考えてみましょう。</p>\n\n<h1>\n<span id="型安全なvuesetの型を考える" class="fragment"></span><a href="#%E5%9E%8B%E5%AE%89%E5%85%A8%E3%81%AAvueset%E3%81%AE%E5%9E%8B%E3%82%92%E8%80%83%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>型安全な<code>Vue.set</code>の型を考える</h1>\n\n<p>まずは、型安全な<code>Vue.set</code>がどのようなものかを考えてみましょう。</p>\n\n<p>第２引数は第１引数で取りうるKeyを指定でき、第３引数では第2引数で指定した第１引数のKeyの値と同じ型を指定することができる、ということになります。</p>\n\n<p>これを型定義に書き起こすと、以下のようになります。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code>  <span class="kd">set</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">]):</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">];</span>\n</code></pre></div></div>\n\n<p>これ１つで配列もオブジェクトもOKなSetメソッドの型を定義することができました。</p>\n\n<h1>\n<span id="vueconstructorへの型指定" class="fragment"></span><a href="#vueconstructor%E3%81%B8%E3%81%AE%E5%9E%8B%E6%8C%87%E5%AE%9A"><i class="fa fa-link"></i></a><code>VueConstructor</code>への型指定</h1>\n\n<p><code>Vue.set</code>の型が定義されている<code>vue/types/vue.d.ts</code>の<code>VueConstructor</code>を拡張しましょう。</p>\n\n<p>TypeScriptでは対象範囲全ての<code>@types</code>以下の型定義ファイルを自動でコンパイルに含めてくれます。<br>\n今回は<code>src/@types/</code>以下に<code>vue.d.ts</code>という型定義ファイルを作成しました。</p>\n\n<p>この中に、<code>VueConstructor</code>を拡張するような型定義を書いてみましょう。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// src/@types/vue.d.ts</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="kr">declare</span> <span class="kr">module</span> <span class="dl">\'</span><span class="s1">vue/types/vue</span><span class="dl">\'</span> <span class="p">{</span>\n  <span class="kr">interface</span> <span class="nx">VueConstructor</span> <span class="p">{</span>\n    <span class="kd">set</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">]):</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">];</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<p><code>declare module</code>は続くモジュール名（今回の場合は<code>node_modules/vue</code>以下の<code>types/vue.d.ts</code>を指定）の内部を拡張することができます。<br>\n<code>declare module \'vue/types/vue\' { ... }</code>の<code>{ ... }</code>内は<code>vue/types/vue.d.ts</code>で<code>export</code>されているインターフェースをオーバーライドすることができます。</p>\n\n<h1>\n<span id="使ってみた" class="fragment"></span><a href="#%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F"><i class="fa fa-link"></i></a>使ってみた</h1>\n\n<p>これで、<code>Vue.set</code>をタイプセーフに拡張できました。試してみましょう。</p>\n\n<p><a href="https://camo.qiitausercontent.com/b3fedf9f0d54577219a49cb6ef8265902610d163/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132373933342f61313039346437622d313332632d333434662d383339652d3635643530383635333465652e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fa1094d7b-132c-344f-839e-65d5086534ee.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f7ae5768c38ddaeb8c75347ad9e53837" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/a1094d7b-132c-344f-839e-65d5086534ee.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fa1094d7b-132c-344f-839e-65d5086534ee.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=af4a4de6a6c6cf9cefa6749bb7f0feb9 1x" loading="lazy"></a></p>\n\n<p>キーは補完されるようになりました！続いて不正な値を設定してみましょう！</p>\n\n<p><a href="https://camo.qiitausercontent.com/4803ba23447cf6543596159186d7206d034fb9e9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132373933342f66633337333032642d333338642d303362372d666332662d3632646436393965336637322e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Ffc37302d-338d-03b7-fc2f-62dd699e3f72.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=162bdba60d6c1fa2b461d180c0f6f002" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/fc37302d-338d-03b7-fc2f-62dd699e3f72.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Ffc37302d-338d-03b7-fc2f-62dd699e3f72.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d567c82d130316641931e73124cf0490 1x" loading="lazy"></a></p>\n\n<p>おやおや・・・<code>obj.foo</code>は文字列なのに<code>0</code>を設定できてしまいました。これはいけない。</p>\n\n<h2>\n<span id="不正な型を設定できる理由" class="fragment"></span><a href="#%E4%B8%8D%E6%AD%A3%E3%81%AA%E5%9E%8B%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%A7%E3%81%8D%E3%82%8B%E7%90%86%E7%94%B1"><i class="fa fa-link"></i></a>不正な型を設定できる理由</h2>\n\n<p>TypeScriptのインターフェース拡張は「すでにある定義を壊さない形での拡張」のみが許されます。<br>\nさらに、関数の場合は引数の数が同じ定義の関数があればチェック対象となります。</p>\n\n<p>つまりこの事象は、型安全な方の型チェックに引っかかったけど、後続の型安全でない方の型チェックがパスしたからOK、みたいな挙動になってしまっているわけです。</p>\n\n<p>ということで、純粋に<code>Vue.set</code>を拡張するだけでは元の定義が後に控えているためあまり意味がありません。</p>\n\n<h1>\n<span id="後続の型定義を参照させないようにする" class="fragment"></span><a href="#%E5%BE%8C%E7%B6%9A%E3%81%AE%E5%9E%8B%E5%AE%9A%E7%BE%A9%E3%82%92%E5%8F%82%E7%85%A7%E3%81%95%E3%81%9B%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>後続の型定義を参照させないようにする</h1>\n\n<p>TypeScriptで後続の型定義を探す条件は「全く同じ定義の型」に限られます。</p>\n\n<p>以下のような型定義の場合は<code>fn()</code>は引数さえあれば型エラーになりません。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kr">interface</span> <span class="nx">Sample</span> <span class="p">{</span>\n  <span class="nx">fn</span><span class="p">(</span><span class="nx">foo</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n  <span class="nx">fn</span><span class="p">(</span><span class="nx">bar</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n<span class="p">}</span>\n\n<span class="nx">fn</span><span class="p">(</span><span class="dl">\'</span><span class="s1">a</span><span class="dl">\'</span><span class="p">);</span>\n<span class="nx">fn</span><span class="p">({});</span>\n</code></pre></div></div>\n\n<p>これに第２引数のあるメソッドを追加してみると、正しく型チェックが行われるようになります。当然といえば当然ですね。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kr">interface</span> <span class="nx">Sample</span> <span class="p">{</span>\n  <span class="nx">fn</span><span class="p">(</span><span class="nx">baz</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">qux</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n  <span class="nx">fn</span><span class="p">(</span><span class="nx">foo</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n  <span class="nx">fn</span><span class="p">(</span><span class="nx">bar</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>\n<span class="p">}</span>\n\n<span class="nx">fn</span><span class="p">(</span><span class="dl">\'</span><span class="s1">a</span><span class="dl">\'</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// OK</span>\n<span class="nx">fn</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>   <span class="c1">// Error</span>\n</code></pre></div></div>\n\n<p>つまり、引数の数を増やせば、後続の型定義を参照させずに済むということです。<br>\nこれを<del>悪用</del>利用して、型定義上だけ、フラグを追加してみます。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// src/@types/vue.d.ts</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="kr">declare</span> <span class="kr">module</span> <span class="dl">\'</span><span class="s1">vue/types/vue</span><span class="dl">\'</span> <span class="p">{</span>\n  <span class="kr">interface</span> <span class="nx">VueConstructor</span> <span class="p">{</span>\n    <span class="kd">set</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">],</span> <span class="nx">isTyped</span><span class="p">:</span> <span class="kc">true</span><span class="p">):</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">];</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<p>これで、第4引数に<code>true</code>が渡された場合は型安全な<code>Vue.set</code>を利用することができるようになります。</p>\n\n<p><a href="https://camo.qiitausercontent.com/3ba27bb70cdad2b0d993f862e3a953acb97e688b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132373933342f34633933663166622d623032342d336262352d363233372d3135653964656132313735632e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F4c93f1fb-b024-3bb5-6237-15e9dea2175c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2f9493a2daccf88f0c1a322d651f551d" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/4c93f1fb-b024-3bb5-6237-15e9dea2175c.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2F4c93f1fb-b024-3bb5-6237-15e9dea2175c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6d10ab2562cbb6186e9b77a19ab5a29c 1x" loading="lazy"></a></p>\n\n<p>先程の例でも文字列以外は設定できなくなりました。</p>\n\n<hr>\n\n<p>で、終わってしまいたかったのですが、いつか本当に<code>Vue.set</code>の第4引数にフラグが追加されてしまったときにこの型定義では困ります。<br>\nまた、まやかしの型定義はそれ自体が黒魔術なのであまり胸を張って使えるものではありませんね。</p>\n\n<p>代案を考えましょう。</p>\n\n<h1>\n<span id="vuetypedsetを実装する" class="fragment"></span><a href="#vuetypedset%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a><code>Vue.typedSet</code>を実装する</h1>\n\n<p><code>Vue.set</code>の拡張は厳しそうです。<br>\nならばいっそ、<code>Vue.typedSet</code>という新しいグローバルメソッドを定義してしまいましょう。</p>\n\n<p>Vueのグローバルメソッドの追加は簡単で、<code>Vue.newGlobalMethod = Function</code>のようにVueにプロパティを生やすだけです。</p>\n\n<p><code>Vue.typedSet</code>は<code>Vue.set</code>のエイリアスで良いので、実装自体は以下のようになります。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="nx">Vue</span><span class="p">.</span><span class="nx">typedSet</span> <span class="o">=</span> <span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Vue</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>\n</code></pre></div></div>\n\n<p>もし、Nuxtを使用しているのなら、プラグインを定義してこれをサーバー・クライアント双方で呼び出すようにしておけば問題ないでしょう。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// @/plugins/vue-typedSet.ts`</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Plugin</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nuxt/types</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="kd">const</span> <span class="nx">plugin</span><span class="p">:</span> <span class="nx">Plugin</span> <span class="o">=</span> <span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">inject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n  <span class="nx">Vue</span><span class="p">.</span><span class="nx">typedSet</span> <span class="o">=</span> <span class="p">(</span><span class="na">object</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="na">key</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Vue</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>\n<span class="p">});</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">plugin</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p>最後に、先程拡張した型定義のメソッド名を<code>typedSet</code>に変更しましょう。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// src/@types/vue.d.ts</span>\n<span class="k">import</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="kr">declare</span> <span class="kr">module</span> <span class="dl">\'</span><span class="s1">vue/types/vue</span><span class="dl">\'</span> <span class="p">{</span>\n  <span class="kr">interface</span> <span class="nx">VueConstructor</span> <span class="p">{</span>\n    <span class="nx">typedSet</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">K</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">object</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">]):</span> <span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">];</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<p>新しいメソッドを定義してしまいましたが、これで型安全に<code>Vue.set</code>できるようになりました！</p>\n\n<p><a href="https://camo.qiitausercontent.com/8b7b3b1660535b1f7a22066a94126671245a2edd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132373933342f65653139336261622d656236332d623431392d333231652d3033613561636630333661332e706e67" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fee193bab-eb63-b419-321e-03a5acf036a3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ba57d0b9794db31cee2312682ba55ffc" alt="image.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/ee193bab-eb63-b419-321e-03a5acf036a3.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fee193bab-eb63-b419-321e-03a5acf036a3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8c2759d4cbdef4bb7bc178d17a503d7c 1x" loading="lazy"></a></p>\n\n<p>めでたしめでたし。</p>\n\n<h1>\n<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>\n\n<ul>\n<li><a href="https://012-jp.vuejs.org/guide/extending.html" rel="nofollow noopener" target="_blank">Vue の拡張 - vue.js</a></li>\n<li><a href="https://qiita.com/ka_/items/3727c3f16dc69fed935c" id="reference-3738486528aa53033812">foo, bar, baz の続き - Qiita</a></li>\n</ul>\n',body:"# はじめに\n\nせっかくTypeScriptを使っているのだから、`Vue.set`も型安全にしたい！と、誰しも一度は考えたことがあるのではないでしょうか？\n\nこの記事では、過程とともに`Vue.set`を型安全にする実装をご紹介します。\n\n# TL;DR\n\n<details><summary>最終的なコード</summary>\n<p>\n\n```ts\nVue.typedSet = (object: any, key: any, value: any) => Vue.set(object, key, value);\n```\n\n```ts\n// src/@types/vue.d.ts\nimport Vue from 'vue';\n\ndeclare module 'vue/types/vue' {\n  interface VueConstructor {\n    typedSet<T extends object, K extends keyof T>(object: T, key: K, value: T[K]): T[K];\n  }\n}\n```\n\n</p>\n</details>\n\n\n# `Vue.set`の型\n\n`Vue.set`の型は`vue/types/vue.d.ts`に以下のように定義されています。\n\n```ts\n  set<T>(object: object, key: string | number, value: T): T;\n  set<T>(array: T[], key: number, value: T): T;\n```\n\n配列の場合は問題ないのですが、オブジェクトの値は本来の型とは異なるものを設定できてしまいます。\n\nこれは良くない、ということで型安全にする手立てを考えてみましょう。\n\n# 型安全な`Vue.set`の型を考える\n\nまずは、型安全な`Vue.set`がどのようなものかを考えてみましょう。\n\n第２引数は第１引数で取りうるKeyを指定でき、第３引数では第2引数で指定した第１引数のKeyの値と同じ型を指定することができる、ということになります。\n\nこれを型定義に書き起こすと、以下のようになります。\n\n```ts\n  set<T extends object, K extends keyof T>(object: T, key: K, value: T[K]): T[K];\n```\n\nこれ１つで配列もオブジェクトもOKなSetメソッドの型を定義することができました。\n\n# `VueConstructor`への型指定\n\n`Vue.set`の型が定義されている`vue/types/vue.d.ts`の`VueConstructor`を拡張しましょう。\n\nTypeScriptでは対象範囲全ての`@types`以下の型定義ファイルを自動でコンパイルに含めてくれます。\n今回は`src/@types/`以下に`vue.d.ts`という型定義ファイルを作成しました。\n\nこの中に、`VueConstructor`を拡張するような型定義を書いてみましょう。\n\n```ts\n// src/@types/vue.d.ts\nimport Vue from 'vue';\n\ndeclare module 'vue/types/vue' {\n  interface VueConstructor {\n    set<T extends object, K extends keyof T>(object: T, key: K, value: T[K]): T[K];\n  }\n}\n```\n\n`declare module`は続くモジュール名（今回の場合は`node_modules/vue`以下の`types/vue.d.ts`を指定）の内部を拡張することができます。\n`declare module 'vue/types/vue' { ... }`の`{ ... }`内は`vue/types/vue.d.ts`で`export`されているインターフェースをオーバーライドすることができます。\n\n# 使ってみた\n\nこれで、`Vue.set`をタイプセーフに拡張できました。試してみましょう。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/a1094d7b-132c-344f-839e-65d5086534ee.png)\n\nキーは補完されるようになりました！続いて不正な値を設定してみましょう！\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/fc37302d-338d-03b7-fc2f-62dd699e3f72.png)\n\nおやおや・・・`obj.foo`は文字列なのに`0`を設定できてしまいました。これはいけない。\n\n## 不正な型を設定できる理由\n\nTypeScriptのインターフェース拡張は「すでにある定義を壊さない形での拡張」のみが許されます。\nさらに、関数の場合は引数の数が同じ定義の関数があればチェック対象となります。\n\nつまりこの事象は、型安全な方の型チェックに引っかかったけど、後続の型安全でない方の型チェックがパスしたからOK、みたいな挙動になってしまっているわけです。\n\nということで、純粋に`Vue.set`を拡張するだけでは元の定義が後に控えているためあまり意味がありません。\n\n# 後続の型定義を参照させないようにする\n\nTypeScriptで後続の型定義を探す条件は「全く同じ定義の型」に限られます。\n\n以下のような型定義の場合は`fn()`は引数さえあれば型エラーになりません。\n\n```ts\ninterface Sample {\n  fn(foo: string) => void;\n  fn(bar: any) => void;\n}\n\nfn('a');\nfn({});\n```\n\nこれに第２引数のあるメソッドを追加してみると、正しく型チェックが行われるようになります。当然といえば当然ですね。\n\n```ts\ninterface Sample {\n  fn(baz: string, qux: number) => void;\n  fn(foo: string) => void;\n  fn(bar: any) => void;\n}\n\nfn('a', 0); // OK\nfn(0, 0);   // Error\n```\n\nつまり、引数の数を増やせば、後続の型定義を参照させずに済むということです。\nこれを~~悪用~~利用して、型定義上だけ、フラグを追加してみます。\n\n```ts\n// src/@types/vue.d.ts\nimport Vue from 'vue';\n\ndeclare module 'vue/types/vue' {\n  interface VueConstructor {\n    set<T extends object, K extends keyof T>(object: T, key: K, value: T[K], isTyped: true): T[K];\n  }\n}\n```\n\nこれで、第4引数に`true`が渡された場合は型安全な`Vue.set`を利用することができるようになります。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/4c93f1fb-b024-3bb5-6237-15e9dea2175c.png)\n\n先程の例でも文字列以外は設定できなくなりました。\n\n---\n\nで、終わってしまいたかったのですが、いつか本当に`Vue.set`の第4引数にフラグが追加されてしまったときにこの型定義では困ります。\nまた、まやかしの型定義はそれ自体が黒魔術なのであまり胸を張って使えるものではありませんね。\n\n代案を考えましょう。\n\n# `Vue.typedSet`を実装する\n\n`Vue.set`の拡張は厳しそうです。\nならばいっそ、`Vue.typedSet`という新しいグローバルメソッドを定義してしまいましょう。\n\nVueのグローバルメソッドの追加は簡単で、`Vue.newGlobalMethod = Function`のようにVueにプロパティを生やすだけです。\n\n`Vue.typedSet`は`Vue.set`のエイリアスで良いので、実装自体は以下のようになります。\n\n```ts\nVue.typedSet = (object: any, key: any, value: any) => Vue.set(object, key, value);\n```\n\nもし、Nuxtを使用しているのなら、プラグインを定義してこれをサーバー・クライアント双方で呼び出すようにしておけば問題ないでしょう。\n\n```ts\n// @/plugins/vue-typedSet.ts`\nimport { Plugin } from '@nuxt/types';\n\nconst plugin: Plugin = (context, inject) => {\n  Vue.typedSet = (object: any, key: any, value: any) => Vue.set(object, key, value);\n});\n\nexport default plugin;\n```\n\n最後に、先程拡張した型定義のメソッド名を`typedSet`に変更しましょう。\n\n```ts\n// src/@types/vue.d.ts\nimport Vue from 'vue';\n\ndeclare module 'vue/types/vue' {\n  interface VueConstructor {\n    typedSet<T extends object, K extends keyof T>(object: T, key: K, value: T[K]): T[K];\n  }\n}\n```\n\n新しいメソッドを定義してしまいましたが、これで型安全に`Vue.set`できるようになりました！\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/ee193bab-eb63-b419-321e-03a5acf036a3.png)\n\nめでたしめでたし。\n\n# 参考\n\n* [Vue の拡張 - vue.js](https://012-jp.vuejs.org/guide/extending.html)\n* [foo, bar, baz の続き - Qiita](https://qiita.com/ka_/items/3727c3f16dc69fed935c)\n",coediting:a,comments_count:0,created_at:"2019-10-17T21:23:09+09:00",group:s,id:"4d31414cb612f96a4c9f",likes_count:29,private:a,reactions_count:0,tags:[{name:f,versions:[]},{name:v,versions:[]}],title:"TypeScriptでVue.setを型安全にしたい",updated_at:"2019-10-21T20:10:33+09:00",url:"https://qiita.com/simochee/items/4d31414cb612f96a4c9f",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'\n<h2>\n<span id="profile" class="fragment"></span><a href="#profile"><i class="fa fa-link"></i></a>Profile</h2>\n\n<p><a href="https://camo.qiitausercontent.com/a941df8f6efe7f36f3bb5315deaaad4370711f6a/68747470733a2f2f71696974612d757365722d70726f66696c652d696d616765732e696d6769782e6e65742f687474707325334125324625324671696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2532463025324631323739333425324670726f66696c652d696d61676573253246313535383335373939333f69786c69623d72622d312e322e32266175746f3d636f6d7072657373253243666f726d6174266c6f73736c6573733d3026773d33303026733d3536383063376333653733316463633734646332653666356562313864323637" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-user-profile-images.imgix.net%2Fhttps%253A%252F%252Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%252F0%252F127934%252Fprofile-images%252F1558357993%3Fixlib%3Drb-1.2.2%26auto%3Dcompress%252Cformat%26lossless%3D0%26w%3D300%26s%3D5680c7c3e731dcc74dc2e6f5eb18d267?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=dfaca9ce0017f85b240bc9e2fcd883f4" width="120px" data-canonical-src="https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fprofile-images%2F1558357993?ixlib=rb-1.2.2&amp;auto=compress%2Cformat&amp;lossless=0&amp;w=300&amp;s=5680c7c3e731dcc74dc2e6f5eb18d267" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-user-profile-images.imgix.net%2Fhttps%253A%252F%252Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%252F0%252F127934%252Fprofile-images%252F1558357993%3Fixlib%3Drb-1.2.2%26auto%3Dcompress%252Cformat%26lossless%3D0%26w%3D300%26s%3D5680c7c3e731dcc74dc2e6f5eb18d267?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=81a430ee787621b08ac67cbb0b5c8541 1x" loading="lazy"></a><br>\n・simochee <sub>(しもちぃって読みます)</sub><br>\n・フロントエンドエンジニア<br>\n・<a href="https://qiita.com/simochee">Qiita (simochee)</a><br>\n・<a href="https://twitter.com/lollipop_onl" rel="nofollow noopener" target="_blank">Twitter</a></p>\n\n<hr>\n\n<h2>\n<span id="proposal-collection-normalization" class="fragment"></span><a href="#proposal-collection-normalization"><i class="fa fa-link"></i></a><a href="https://github.com/tc39/proposal-collection-normalization" rel="nofollow noopener" target="_blank">proposal-collection-normalization</a>\n</h2>\n\n<p><em>Stage 2</em></p>\n\n<p><strong>Map/SetへKeyとValueを正規化する<br><code>coerceKey</code>と<code>coerceValue</code>の追加</strong></p>\n\n<hr>\n\n<h3>\n<span id="以降実際に動かしてはいません" class="fragment"></span><a href="#%E4%BB%A5%E9%99%8D%E5%AE%9F%E9%9A%9B%E3%81%AB%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%AF%E3%81%84%E3%81%BE%E3%81%9B%E3%82%93"><i class="fa fa-link"></i></a>※以降、実際に動かしてはいません</h3>\n\n<hr>\n\n<h2>\n<span id="keyの正規化オブジェクトのkeyをkeyとして設定する" class="fragment"></span><a href="#key%E3%81%AE%E6%AD%A3%E8%A6%8F%E5%8C%96%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AEkey%E3%82%92key%E3%81%A8%E3%81%97%E3%81%A6%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Keyの正規化①<br>オブジェクトのKeyをKeyとして設定する</h2>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><code><span class="kd">const</span> <span class="nx">profile</span> <span class="o">=</span> <span class="p">{</span> <span class="na">email</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">simochee@example.com</span><span class="dl">\'</span> <span class="p">};</span>\n\n<span class="kd">const</span> <span class="nx">pointMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">{</span>\n  <span class="na">coerceKey</span><span class="p">:</span> <span class="p">({</span> <span class="nx">email</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">email</span><span class="p">,</span>\n<span class="p">});</span>\n\n<span class="nx">pointMap</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">profile</span><span class="p">,</span> <span class="mi">1200</span><span class="p">);</span>\n\n<span class="nx">pointMap</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">\'</span><span class="s1">simochee@example.com</span><span class="dl">\'</span><span class="p">);</span> <span class="c1">// 1200</span>\n</code></pre></div></div>\n\n<hr>\n\n<h2>\n<span id="keyの正規化keyを文字列化させる" class="fragment"></span><a href="#key%E3%81%AE%E6%AD%A3%E8%A6%8F%E5%8C%96key%E3%82%92%E6%96%87%E5%AD%97%E5%88%97%E5%8C%96%E3%81%95%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>Keyの正規化②<br>Keyを文字列化させる</h2>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><code><span class="kd">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">{</span>\n  <span class="na">coerceKey</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>\n<span class="p">});</span>\n\n<span class="nx">map</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">simochee</span><span class="dl">\'</span><span class="p">);</span>\n<span class="nx">map</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// true</span>\n\n<span class="c1">// map.has(\'1\') // true? false?</span>\n\n<span class="p">[...</span><span class="nx">map</span><span class="p">.</span><span class="nx">entries</span><span class="p">()];</span> <span class="c1">// [[\'1\', \'simochee\']]</span>\n</code></pre></div></div>\n\n<hr>\n\n<h2>\n<span id="valueの正規化データをインスタンス化させる" class="fragment"></span><a href="#value%E3%81%AE%E6%AD%A3%E8%A6%8F%E5%8C%96%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E5%8C%96%E3%81%95%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>Valueの正規化①<br>データをインスタンス化させる</h2>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><code><span class="kd">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">{</span>\n  <span class="na">coerceValue</span><span class="p">:</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="nx">user</span> <span class="k">instanceof</span> <span class="nx">UserModel</span>\n      <span class="p">?</span> <span class="nx">user</span>\n      <span class="p">:</span> <span class="k">new</span> <span class="nx">UserModel</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>\n  <span class="p">},</span>\n<span class="p">});</span>\n</code></pre></div></div>\n\n<hr>\n\n<h2>\n<span id="valueの正規化不正なインスタンスの場合エラーにする" class="fragment"></span><a href="#value%E3%81%AE%E6%AD%A3%E8%A6%8F%E5%8C%96%E4%B8%8D%E6%AD%A3%E3%81%AA%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E5%A0%B4%E5%90%88%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Valueの正規化②<br>不正なインスタンスの場合エラーにする</h2>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre><code><span class="kd">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">{</span>\n  <span class="na">coerceValue</span><span class="p">:</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>\n    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">user</span> <span class="k">instanceof</span> <span class="nx">UserModel</span><span class="p">))</span> <span class="p">{</span>\n      <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="dl">\'</span><span class="s1">データの方が不正です</span><span class="dl">\'</span><span class="p">);</span>\n    <span class="p">}</span>\n\n    <span class="k">return</span> <span class="nx">user</span><span class="p">;</span>\n  <span class="p">},</span>\n<span class="p">});</span>\n</code></pre></div></div>\n\n<hr>\n\n<h2>\n<span id="references" class="fragment"></span><a href="#references"><i class="fa fa-link"></i></a>References</h2>\n\n<ul>\n<li><a href="https://github.com/tc39/proposal-collection-normalization" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/tc39/proposal-collection-normalization</a></li>\n</ul>\n',body:"## Profile\n\n<img src=\"https://qiita-user-profile-images.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F127934%2Fprofile-images%2F1558357993?ixlib=rb-1.2.2&auto=compress%2Cformat&lossless=0&w=300&s=5680c7c3e731dcc74dc2e6f5eb18d267\" width=\"120px\" />\n・simochee <sub>(しもちぃって読みます)</sub>\n・フロントエンドエンジニア\n・[Qiita (simochee)](https://qiita.com/simochee)\n・[Twitter](https://twitter.com/lollipop_onl)\n\n---\n\n## [proposal-collection-normalization](https://github.com/tc39/proposal-collection-normalization)\n\n*Stage 2*\n\n**Map/SetへKeyとValueを正規化する<br>`coerceKey`と`coerceValue`の追加**\n\n---\n\n### ※以降、実際に動かしてはいません\n\n---\n\n## Keyの正規化①<br>オブジェクトのKeyをKeyとして設定する\n\n```ts\nconst profile = { email: 'simochee@example.com' };\n\nconst pointMap = new Map(undefined, {\n  coerceKey: ({ email }) => email,\n});\n\npointMap.set(profile, 1200);\n\npointMap.get('simochee@example.com'); // 1200\n```\n\n---\n\n## Keyの正規化②<br>Keyを文字列化させる\n\n```ts\nconst map = new Map(undefined, {\n  coerceKey: String,\n});\n\nmap.set(1, 'simochee');\nmap.has(1); // true\n\n// map.has('1') // true? false?\n\n[...map.entries()]; // [['1', 'simochee']]\n```\n\n---\n\n## Valueの正規化①<br>データをインスタンス化させる\n\n```ts\nconst map = new Map(undefined, {\n  coerceValue: (user) => {\n    return user instanceof UserModel\n      ? user\n      : new UserModel(user);\n  },\n});\n```\n\n---\n\n## Valueの正規化②<br>不正なインスタンスの場合エラーにする\n\n```ts\nconst map = new Map(undefined, {\n  coerceValue: (user) => {\n    if (!(user instanceof UserModel)) {\n      throw new TypeError('データの方が不正です');\n    }\n\n    return user;\n  },\n});\n```\n\n---\n\n## References\n\n* https://github.com/tc39/proposal-collection-normalization\n",coediting:a,comments_count:0,created_at:"2019-10-08T09:52:33+09:00",group:s,id:"197dd4ecf1ec7aca4366",likes_count:2,private:a,reactions_count:0,tags:[{name:"TC39",versions:[]}],title:"proposal-collection-normalization",updated_at:"2019-10-09T20:26:14+09:00",url:"https://qiita.com/simochee/items/197dd4ecf1ec7aca4366",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'\n<h1>\n<span id="事象" class="fragment"></span><a href="#%E4%BA%8B%E8%B1%A1"><i class="fa fa-link"></i></a>事象</h1>\n\n<p><code>is</code>属性で要素名を指定しているコンポーネントに対して、<code>v-model</code>を使用すると、<code>v-model</code>が機能しなくなりました。</p>\n\n<p>どういうことかは例を見ていただくと早いです。</p>\n\n<h2>\n<span id="正常" class="fragment"></span><a href="#%E6%AD%A3%E5%B8%B8"><i class="fa fa-link"></i></a>正常</h2>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><code><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">v-model=</span><span class="s">"value"</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<blockquote>\n<p><a href="https://jsfiddle.net/simochee/fjdvowr7/4" class="autolink" rel="nofollow noopener" target="_blank">https://jsfiddle.net/simochee/fjdvowr7/4</a></p>\n</blockquote>\n\n<h2>\n<span id="異常" class="fragment"></span><a href="#%E7%95%B0%E5%B8%B8"><i class="fa fa-link"></i></a>異常</h2>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><code><span class="nt">&lt;div</span> <span class="na">is=</span><span class="s">"input"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">v-model=</span><span class="s">"value"</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<blockquote>\n<p><a href="https://jsfiddle.net/simochee/fjdvowr7/5" class="autolink" rel="nofollow noopener" target="_blank">https://jsfiddle.net/simochee/fjdvowr7/5</a></p>\n</blockquote>\n\n<h1>\n<span id="原因" class="fragment"></span><a href="#%E5%8E%9F%E5%9B%A0"><i class="fa fa-link"></i></a>原因</h1>\n\n<p>なぜこんな挙動になるのか、それを解決する記述を見つけることはできませんでした。</p>\n\n<p>ともかく<code>is</code>と<code>v-model</code>は併用しないよう気をつけましょう。</p>\n\n<h1>\n<span id="おまけ" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91"><i class="fa fa-link"></i></a>おまけ</h1>\n\n<p>疑似<code>v-model</code>の場合は更に奇妙な挙動になりました。</p>\n\n<p>初期値は設定されるし、入力値は設定できるものの、代入による値を上書きできなくなります。</p>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><code><span class="nt">&lt;div</span>\n  <span class="na">is=</span><span class="s">"input"</span>\n  <span class="na">type=</span><span class="s">"text"</span>\n  <span class="na">:value=</span><span class="s">"value"</span>\n  <span class="err">@</span><span class="na">input=</span><span class="s">"value = $event.target.value"</span>\n<span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<blockquote>\n<p><a href="https://jsfiddle.net/simochee/fjdvowr7/7/" class="autolink" rel="nofollow noopener" target="_blank">https://jsfiddle.net/simochee/fjdvowr7/7/</a></p>\n</blockquote>\n',body:'# 事象\n\n`is`属性で要素名を指定しているコンポーネントに対して、`v-model`を使用すると、`v-model`が機能しなくなりました。\n\nどういうことかは例を見ていただくと早いです。\n\n## 正常\n\n```html\n<input type="text" v-model="value">\n```\n\n> https://jsfiddle.net/simochee/fjdvowr7/4\n\n## 異常\n\n```html\n<div is="input" type="text" v-model="value">\n```\n\n> https://jsfiddle.net/simochee/fjdvowr7/5\n\n# 原因\n\nなぜこんな挙動になるのか、それを解決する記述を見つけることはできませんでした。\n\nともかく`is`と`v-model`は併用しないよう気をつけましょう。\n\n# おまけ\n\n疑似`v-model`の場合は更に奇妙な挙動になりました。\n\n初期値は設定されるし、入力値は設定できるものの、代入による値を上書きできなくなります。\n\n```html\n<div\n  is="input"\n  type="text"\n  :value="value"\n  @input="value = $event.target.value"\n>\n```\n\n> https://jsfiddle.net/simochee/fjdvowr7/7/\n',coediting:a,comments_count:0,created_at:T,group:s,id:"b903cbf9227120d92e7e",likes_count:1,private:a,reactions_count:0,tags:[{name:v,versions:[]}],title:"Vueのisとv-modelは併用してはいけない",updated_at:T,url:"https://qiita.com/simochee/items/b903cbf9227120d92e7e",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'<p><a href=""><code>@typescript-eslint</code></a>は先日v2にメジャーアップデートしました。</p>\n\n<p>それに伴って（？）、VueファイルをLintしようとすると以下のようにエラーが表示されるようになりました。</p>\n\n<div class="code-frame" data-lang="sh"><div class="highlight"><pre><code>/myproject/src/components/partials/Base/BaseRadio.vue\n  23:9  error  Parsing error: <span class="s1">\'&gt;\'</span> expected\n</code></pre></div></div>\n\n<p>どうもこれ、<code>@typescript-eslint</code>のv2と<code>vue-eslint-parser</code>に互換性がないことが原因のようです。</p>\n\n<blockquote>\n<p>Incompatibility with typescript-eslint@2<br>\n<a href="https://github.com/vuejs/eslint-plugin-vue/issues/944" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/vuejs/eslint-plugin-vue/issues/944</a></p>\n</blockquote>\n\n<p>ということで、<code>eslint-plugin-vue</code>側がv2に対応するまではバージョンをあげないほうが無難かもしれません。</p>\n\n<p>対応したらそのときは、この記事を更新します。</p>\n',body:"[`@typescript-eslint`]()は先日v2にメジャーアップデートしました。\n\nそれに伴って（？）、VueファイルをLintしようとすると以下のようにエラーが表示されるようになりました。\n\n```sh\n/myproject/src/components/partials/Base/BaseRadio.vue\n  23:9  error  Parsing error: '>' expected\n```\n\nどうもこれ、`@typescript-eslint`のv2と`vue-eslint-parser`に互換性がないことが原因のようです。\n\n> Incompatibility with typescript-eslint@2\n> https://github.com/vuejs/eslint-plugin-vue/issues/944\n\nということで、`eslint-plugin-vue`側がv2に対応するまではバージョンをあげないほうが無難かもしれません。\n\n対応したらそのときは、この記事を更新します。\n",coediting:a,comments_count:0,created_at:"2019-09-05T20:31:12+09:00",group:s,id:"126f42f2e42fcf194515",likes_count:4,private:a,reactions_count:0,tags:[{name:f,versions:[]},{name:"ESLint",versions:[]},{name:"eslint-plugin-vue",versions:[]}],title:"vue-eslint-parserには@typescript-eslint v2との互換性がない",updated_at:"2019-09-05T20:32:56+09:00",url:"https://qiita.com/simochee/items/126f42f2e42fcf194515",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'<blockquote>\n<p>Failed to start the X server (your graphical interface). It is likely that it is not setup correctly. whould you like to view the X server output to diagnose the problem?</p>\n</blockquote>\n\n<p>などと言ってLinux Mintが起動しなくなった。ヤバい。</p>\n\n<p>どうも原因はNvidiaのドライバインストールしたことに関連しているみたい？</p>\n\n<p>以下の手順で解消。</p>\n\n<h4>\n<span id="1-リカバリモードでlinux-mintを起動" class="fragment"></span><a href="#1-%E3%83%AA%E3%82%AB%E3%83%90%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%89%E3%81%A7linux-mint%E3%82%92%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>1. リカバリモードでLinux Mintを起動</h4>\n\n<h4>\n<span id="2-root権限のターミナルにログイン" class="fragment"></span><a href="#2-root%E6%A8%A9%E9%99%90%E3%81%AE%E3%82%BF%E3%83%BC%E3%83%9F%E3%83%8A%E3%83%AB%E3%81%AB%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3"><i class="fa fa-link"></i></a>2. root権限のターミナルにログイン</h4>\n\n<h4>\n<span id="3-xserverの設定ファイルを開く" class="fragment"></span><a href="#3-xserver%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E9%96%8B%E3%81%8F"><i class="fa fa-link"></i></a>3. Xserverの設定ファイルを開く</h4>\n\n<div class="code-frame" data-lang="sh"><div class="highlight"><pre class="with-code"><code><span class="c"># Xserverの設定ファイルを書き出す</span>\n<span class="nv">$ </span>X <span class="nt">-configure</span>\n\n<span class="c"># 設定ファイルを開く。場所は↑のコマンドの結果を見る</span>\n<span class="nv">$ </span>vi /root/xorg.conf.new\n</code></pre></div></div>\n\n<h4>\n<span id="4-設定ファイルを変更" class="fragment"></span><a href="#4-%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>4. 設定ファイルを変更</h4>\n\n<p><code>Device</code>セクションの<code>Driver</code>の項目が`<code>になっていたので、</code>nvidia`に変更する。</p>\n\n<h4>\n<span id="5-再起動" class="fragment"></span><a href="#5-%E5%86%8D%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>5. 再起動</h4>\n\n<h4>\n<span id="復旧" class="fragment"></span><a href="#%E5%BE%A9%E6%97%A7"><i class="fa fa-link"></i></a>復旧！</h4>\n\n<p>Nvidiaはどうしてこう相性悪いこと多いのか。</p>\n',body:"\n> Failed to start the X server (your graphical interface). It is likely that it is not setup correctly. whould you like to view the X server output to diagnose the problem?\n\nなどと言ってLinux Mintが起動しなくなった。ヤバい。\n\nどうも原因はNvidiaのドライバインストールしたことに関連しているみたい？\n\n以下の手順で解消。\n\n#### 1. リカバリモードでLinux Mintを起動\n\n#### 2. root権限のターミナルにログイン\n\n#### 3. Xserverの設定ファイルを開く\n\n```sh\n# Xserverの設定ファイルを書き出す\n$ X -configure\n\n# 設定ファイルを開く。場所は↑のコマンドの結果を見る\n$ vi /root/xorg.conf.new\n```\n\n#### 4. 設定ファイルを変更\n\n`Device`セクションの`Driver`の項目が``になっていたので、`nvidia`に変更する。\n\n#### 5. 再起動\n\n#### 復旧！\n\nNvidiaはどうしてこう相性悪いこと多いのか。\n",coediting:a,comments_count:0,created_at:"2019-08-23T08:56:24+09:00",group:s,id:"344a183c6d05a7d5d7b4",likes_count:0,private:a,reactions_count:0,tags:[{name:"NVIDIA",versions:[]},{name:"LinuxMint",versions:[]},{name:"xserver",versions:[]}],title:"Linux MintがXserverがどうので起動しなくなった",updated_at:"2019-08-23T08:56:33+09:00",url:"https://qiita.com/simochee/items/344a183c6d05a7d5d7b4",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'\n<h2>\n<span id="composition-apiの場合" class="fragment"></span><a href="#composition-api%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>Composition APIの場合</h2>\n\n<p>※2020/10/05追記</p>\n\n<p>Vue 3の新機能、Composition APIをNuxt向けに調整したパッケージ <code>@nuxtjs/composition-api</code> を使用する場合は明示的な型の指定が不要になりました。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">defineComponent</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nuxtjs/composition-api</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="k">export</span> <span class="k">default</span> <span class="nx">defineComponent</span><span class="p">({</span>\n  <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">SampleComponent</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="k">async</span> <span class="nx">asyncData</span><span class="p">(</span><span class="nx">context</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="p">{</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">store</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span>\n\n    <span class="c1">// プラグインにもアクセスできる！</span>\n    <span class="nx">app</span><span class="p">.</span><span class="nx">$plugin</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>\n\n    <span class="c1">// VuexにDispatchできる！</span>\n    <span class="k">await</span> <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">user/checkAuth</span><span class="dl">\'</span><span class="p">);</span>\n  <span class="p">}</span>\n<span class="p">});</span>\n</code></pre></div></div>\n\n<blockquote>\n<p><a href="https://composition-api.nuxtjs.org/" rel="nofollow noopener" target="_blank">Introduction - Nuxt Composition API</a></p>\n</blockquote>\n\n<h2>\n<span id="nuxt-29-以降" class="fragment"></span><a href="#nuxt-29-%E4%BB%A5%E9%99%8D"><i class="fa fa-link"></i></a>Nuxt 2.9 以降</h2>\n\n<p>Nuxt 2.9からTypeScriptが外部パッケージ化され、あたらしく<code>@nuxt/types</code>が利用可能になりました。</p>\n\n<p><code>@nuxt/types</code>は手動でのインストールは不要で2.9から追加された<code>@nuxt/typescript-runtime</code>または<code>@nuxt/typescript-build</code>をインストールすることで利用できるようになります。</p>\n\n<p>あとは、<code>@nuxt/types</code>が提供する<code>Context</code>型を<code>context</code>へ指定することで型安全にコーディングできるようになります。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Context</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nuxt/types</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">nuxt-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="cm">/** Lifecycle */</span>\n  <span class="k">async</span> <span class="nx">asyncData</span><span class="p">(</span><span class="nx">context</span><span class="p">:</span> <span class="nx">Context</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="p">{</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">store</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span>\n\n    <span class="c1">// プラグインにもアクセスできる！</span>\n    <span class="nx">app</span><span class="p">.</span><span class="nx">$plugin</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>\n\n    <span class="c1">// VuexにDispatchできる！</span>\n    <span class="k">await</span> <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">user/checkAuth</span><span class="dl">\'</span><span class="p">);</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<h2>\n<span id="nuxt-28-以前" class="fragment"></span><a href="#nuxt-28-%E4%BB%A5%E5%89%8D"><i class="fa fa-link"></i></a>Nuxt 2.8 以前</h2>\n\n<p>NuxtとTypeScriptを使う時、<code>fetch</code>と<code>asyncData</code>の引数 <code>context</code> の型がなくて困った経験ありませんか？</p>\n\n<p>Nuxtではコアパッケージの1つである<code>@nuxt/vue-app</code>というパッケージが <code>context</code> の型を提供しています。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Context</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@nuxt/vue-app</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">nuxt-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="cm">/** Lifecycle */</span>\n  <span class="k">async</span> <span class="nx">asyncData</span><span class="p">(</span><span class="nx">context</span><span class="p">:</span> <span class="nx">Context</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>\n    <span class="kd">const</span> <span class="p">{</span> <span class="nx">app</span><span class="p">,</span> <span class="nx">store</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span>\n\n    <span class="c1">// プラグインにもアクセスできる！</span>\n    <span class="nx">app</span><span class="p">.</span><span class="nx">$plugin</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>\n\n    <span class="c1">// VuexにDispatchできる！</span>\n    <span class="k">await</span> <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">user/checkAuth</span><span class="dl">\'</span><span class="p">);</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<p>これで、<code>context: any</code>や独自のインターフェースの定義が不要になります。</p>\n\n<p>（ドキュメントのどこにも記載がないのはなぜなんだろうか・・・？）</p>\n',body:"## Composition APIの場合\n\n※2020/10/05追記\n\nVue 3の新機能、Composition APIをNuxt向けに調整したパッケージ `@nuxtjs/composition-api` を使用する場合は明示的な型の指定が不要になりました。\n\n```ts\nimport { defineComponent } from '@nuxtjs/composition-api';\n\nexport default defineComponent({\n  name: 'SampleComponent',\n  async asyncData(context): Promise<void> {\n    const { app, store } = context;\n\n    // プラグインにもアクセスできる！\n    app.$plugin.run();\n\n    // VuexにDispatchできる！\n    await store.dispatch('user/checkAuth');\n  }\n});\n```\n\n> [Introduction - Nuxt Composition API](https://composition-api.nuxtjs.org/)\n\n## Nuxt 2.9 以降\n\nNuxt 2.9からTypeScriptが外部パッケージ化され、あたらしく`@nuxt/types`が利用可能になりました。\n\n`@nuxt/types`は手動でのインストールは不要で2.9から追加された`@nuxt/typescript-runtime`または`@nuxt/typescript-build`をインストールすることで利用できるようになります。\n\nあとは、`@nuxt/types`が提供する`Context`型を`context`へ指定することで型安全にコーディングできるようになります。\n\n```ts\nimport { Context } from '@nuxt/types';\nimport { Component, Vue } from 'nuxt-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  /** Lifecycle */\n  async asyncData(context: Context): Promise<void> {\n    const { app, store } = context;\n\n    // プラグインにもアクセスできる！\n    app.$plugin.run();\n\n    // VuexにDispatchできる！\n    await store.dispatch('user/checkAuth');\n  }\n}\n```\n\n## Nuxt 2.8 以前\n\nNuxtとTypeScriptを使う時、`fetch`と`asyncData`の引数 `context` の型がなくて困った経験ありませんか？\n\nNuxtではコアパッケージの1つである`@nuxt/vue-app`というパッケージが `context` の型を提供しています。\n\n```ts\nimport { Context } from '@nuxt/vue-app';\nimport { Component, Vue } from 'nuxt-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  /** Lifecycle */\n  async asyncData(context: Context): Promise<void> {\n    const { app, store } = context;\n\n    // プラグインにもアクセスできる！\n    app.$plugin.run();\n\n    // VuexにDispatchできる！\n    await store.dispatch('user/checkAuth');\n  }\n}\n```\n\nこれで、`context: any`や独自のインターフェースの定義が不要になります。\n\n（ドキュメントのどこにも記載がないのはなぜなんだろうか・・・？）\n",coediting:a,comments_count:0,created_at:"2019-08-08T15:29:46+09:00",group:s,id:"77e074e48d036ce2444b",likes_count:33,private:a,reactions_count:0,tags:[{name:f,versions:[]},{name:y,versions:[]}],title:"Nuxt×TypeScriptでfetch, asyncDataの引数に型を指定する",updated_at:"2020-10-05T07:57:55+09:00",url:"https://qiita.com/simochee/items/77e074e48d036ce2444b",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'\n<h1>\n<span id="rscssとは" class="fragment"></span><a href="#rscss%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>RSCSSとは</h1>\n\n<blockquote>\n<p>Styling CSS without losing your sanity</p>\n</blockquote>\n\n<p>正気を保ってCSSを書くためのアイデア。<br>\nルールではないため、シンプルにするためなら無視しても問題ない。</p>\n\n<h1>\n<span id="bemとrscssの比較" class="fragment"></span><a href="#bem%E3%81%A8rscss%E3%81%AE%E6%AF%94%E8%BC%83"><i class="fa fa-link"></i></a>BEMとRSCSSの比較</h1>\n\n<ul>\n<li>命名規則\n\n<ul>\n<li>BEMはBlock、Element、Modifierを一つのクラスに連結する</li>\n<li>RSCSSはそれぞれ単独のクラスとして定義する</li>\n</ul>\n</li>\n<li>親子関係\n\n<ul>\n<li>BEMはBlockとElement、ElementとElementの親子関係は厳密ではない</li>\n<li>RSCSSはすべてのセレクタを親子関係として定義する</li>\n</ul>\n</li>\n<li>ネスト\n\n<ul>\n<li>BEMはネストの制約はない</li>\n<li>RSCSSのネストの深さは必ず１で、コンポーネントからの親子関係で指定する</li>\n</ul>\n</li>\n</ul>\n\n<h1>\n<span id="構成する要素" class="fragment"></span><a href="#%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B%E8%A6%81%E7%B4%A0"><i class="fa fa-link"></i></a>構成する要素</h1>\n\n<h2>\n<span id="bem" class="fragment"></span><a href="#bem"><i class="fa fa-link"></i></a>BEM</h2>\n\n<ul>\n<li>Block: 単独で意味のあるまとまり</li>\n<li>Element: 単独では意味を持たない、ブロックに結び付けられた要素\n\n<ul>\n<li>クラスを<code>__</code>で接続する</li>\n</ul>\n</li>\n<li>Modifier: ブロックまたはエレメントのフラグ\n\n<ul>\n<li>クラスを<code>--</code>で接続する</li>\n</ul>\n</li>\n</ul>\n\n<div class="code-frame" data-lang="sass"><div class="highlight"><pre><code><span class="nc">.product-list</span>\n  <span class="k">&amp;</span><span class="nt">__item</span>\n    <span class="k">&amp;</span><span class="nt">--pickup</span>\n    <span class="k">&amp;</span><span class="nt">__name</span>\n    <span class="k">&amp;</span><span class="nt">__description</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><code><span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"product-list"</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"product-list__item"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"product-list__item__name"</span><span class="nt">&gt;</span>Product #01<span class="nt">&lt;/h3&gt;</span>\n    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"product-list__item__description"</span><span class="nt">&gt;</span>Lorem ipsum dolor sit amet.<span class="nt">&lt;/p&gt;</span>\n  <span class="nt">&lt;/li&gt;</span>\n  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"product-list__item product-list__item--pickup"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"product-list__item__name"</span><span class="nt">&gt;</span>Product #02 - Pickup!<span class="nt">&lt;/h3&gt;</span>\n    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"product-list__item__description"</span><span class="nt">&gt;</span>Lorem ipsum dolor sit amet.<span class="nt">&lt;/p&gt;</span>\n  <span class="nt">&lt;/li&gt;</span>\n<span class="nt">&lt;/ul&gt;</span>\n</code></pre></div></div>\n\n<h2>\n<span id="rscss" class="fragment"></span><a href="#rscss"><i class="fa fa-link"></i></a>RSCSS</h2>\n\n<ul>\n<li>Component: BEMでのBlock\n\n<ul>\n<li>クラス名に必ず<code>-</code>を含む<strong>複数単語</strong>で構成する</li>\n</ul>\n</li>\n<li>Element: BEMでのElement\n\n<ul>\n<li>クラス名に<code>-</code>を<strong>含まない</strong>\n</li>\n<li>複数単語の場合でも<code>-</code>や<code>_</code>で連結しない</li>\n<li><strong>Componentからの親子関係で指定する</strong></li>\n<li>ネストは必ず１つ</li>\n</ul>\n</li>\n<li>Variant: BEMでのModifier\n\n<ul>\n<li>クラス名が必ず<code>-</code>で始まる</li>\n</ul>\n</li>\n</ul>\n\n<div class="code-frame" data-lang="sass"><div class="highlight"><pre><code><span class="nc">.product-list</span>\n  <span class="k">&amp;</span> <span class="o">&gt;</span> <span class="nc">.item</span>\n  <span class="k">&amp;</span> <span class="o">&gt;</span> <span class="nc">.item.-pickup</span>\n  <span class="k">&amp;</span> <span class="o">&gt;</span> <span class="nc">.item</span> <span class="o">&gt;</span> <span class="nc">.name</span>\n  <span class="k">&amp;</span> <span class="o">&gt;</span> <span class="nc">.item</span> <span class="o">&gt;</span> <span class="nc">.description</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><code><span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"product-list"</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"name"</span><span class="nt">&gt;</span>Product #01<span class="nt">&lt;/h3&gt;</span>\n    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"description"</span><span class="nt">&gt;</span>Lorem ipsum dolor sit amet.<span class="nt">&lt;/p&gt;</span>\n  <span class="nt">&lt;/li&gt;</span>\n  <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item -pickup"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"name"</span><span class="nt">&gt;</span>Product #02 - Pickup!<span class="nt">&lt;/h3&gt;</span>\n    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"description"</span><span class="nt">&gt;</span>Lorem ipsum dolor sit amet.<span class="nt">&lt;/p&gt;</span>\n  <span class="nt">&lt;/li&gt;</span>\n<span class="nt">&lt;/ul&gt;</span>\n</code></pre></div></div>\n\n<h1>\n<span id="bemにはないrscssの規則" class="fragment"></span><a href="#bem%E3%81%AB%E3%81%AF%E3%81%AA%E3%81%84rscss%E3%81%AE%E8%A6%8F%E5%89%87"><i class="fa fa-link"></i></a>BEMにはないRSCSSの規則</h1>\n\n<h2>\n<span id="レイアウト" class="fragment"></span><a href="#%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88"><i class="fa fa-link"></i></a>レイアウト</h2>\n\n<p>レイアウトに関するプロパティ（<code>position</code>、<code>margin</code>、<code>width</code>など）はコンポーネントに含めず、更に親のコンポーネントクラスを定義してそこで指定するようにします。</p>\n\n<div class="code-frame" data-lang="sass"><div class="highlight"><pre><code><span class="nc">.article-list</span>\n  <span class="k">&amp;</span>\n    <span class="nd">+clearfix</span>\n\n  <span class="k">&amp;</span> <span class="o">&gt;</span> <span class="nc">.article-card</span>\n    <span class="nl">width</span><span class="p">:</span> <span class="m">33</span><span class="mi">.3%</span>\n    <span class="nl">float</span><span class="p">:</span> <span class="nb">left</span>\n</code></pre></div></div>\n\n<blockquote>\n<p><a href="https://rscss.io/layouts.html" rel="nofollow noopener" target="_blank">Layout</a></p>\n</blockquote>\n\n<h2>\n<span id="ヘルパークラス" class="fragment"></span><a href="#%E3%83%98%E3%83%AB%E3%83%91%E3%83%BC%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>ヘルパークラス</h2>\n\n<p><code>!important</code>を付与し、最優先でスタイルを外付けしたいときに使用するヘルパークラスを定義できます。<br>\nヘルパークラスは必ず<code>_</code>で始めます。</p>\n\n<div class="code-frame" data-lang="sass"><div class="highlight"><pre><code><span class="nc">._unmargin</span>\n  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="o">!</span><span class="n">important</span>\n\n<span class="nc">._hidden-sp</span>\n  <span class="k">@media</span> <span class="p">(</span><span class="nv">$sp</span><span class="p">)</span>\n    <span class="nl">display</span><span class="p">:</span> <span class="nb">none</span> <span class="o">!</span><span class="n">important</span>\n</code></pre></div></div>\n\n<blockquote>\n<p><a href="https://rscss.io/helpers.html" rel="nofollow noopener" target="_blank">Helpers</a></p>\n</blockquote>\n\n<h2>\n<span id="コンポーネントのネスト" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%AE%E3%83%8D%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>コンポーネントのネスト</h2>\n\n<p>コンポーネントをネストする必要があるときは以下の２つのガイドラインを参考に簡単かつ疎結合に定義するようにしてください。</p>\n\n<h3>\n<span id="variantを使う" class="fragment"></span><a href="#variant%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>Variantを使う</h3>\n\n<p>コンポーネントをネストさせた際に、子のクラスをコンポーネントで指定するとそのコンポーネント名と密結合なクラスとなっていまします。</p>\n\n<div class="code-frame" data-lang="sass"><div class="highlight"><pre><code><span class="nc">.article-header</span>\n  <span class="k">&amp;</span> <span class="o">&gt;</span> <span class="nc">.vote-box</span> <span class="o">&gt;</span> <span class="nc">.up</span>\n    <span class="c1">// よくない</span>\n</code></pre></div></div>\n\n<p>代わりに、Variantで指定するようにしてください。そうすればコンポーネント名の変更や利用場面の自由度があがります。</p>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"article-header"</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"vote-box -highlight"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"up"</span><span class="nt">&gt;</span> ... <span class="nt">&lt;/div&gt;</span>\n  <span class="nt">&lt;/div&gt;</span>\n<span class="nt">&lt;/div&gt;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="sass"><div class="highlight"><pre><code><span class="nc">.article-header</span>\n  <span class="k">&amp;</span> <span class="o">&gt;</span> <span class="nc">.-highlight</span> <span class="o">&gt;</span> <span class="nc">.up</span>\n    <span class="c1">// ...</span>\n</code></pre></div></div>\n\n<h3>\n<span id="プリプロセッサのextendを活用する" class="fragment"></span><a href="#%E3%83%97%E3%83%AA%E3%83%97%E3%83%AD%E3%82%BB%E3%83%83%E3%82%B5%E3%81%AEextend%E3%82%92%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>プリプロセッサの<code>@extend</code>を活用する</h3>\n\n<p>コンポーネントをネストさせることでクラス名が複雑になることがあります。</p>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"search-form"</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"input"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>\n  <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"search-button -red -large"</span><span class="nt">&gt;</span>Search<span class="nt">&lt;/button&gt;</span>\n<span class="nt">&lt;/div&gt;</span>\n</code></pre></div></div>\n\n<p>代わりに、Elementと定義した上で<code>@extend</code>を使用すれば簡潔に表現できます。</p>\n\n<div class="code-frame" data-lang="html"><div class="highlight"><pre><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"search-form"</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"input"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="nt">/&gt;</span>\n  <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Search<span class="nt">&lt;/button&gt;</span>\n<span class="nt">&lt;/div&gt;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="sass"><div class="highlight"><pre><code><span class="nc">.search-form</span>\n  <span class="k">&amp;</span> <span class="o">&gt;</span> <span class="nc">.submit</span>\n    <span class="k">@extend</span> <span class="nc">.search-button</span>\n    <span class="k">@extend</span> <span class="nc">.search-button.-red</span>\n    <span class="k">@extend</span> <span class="nc">.search-button.-large</span>\n</code></pre></div></div>\n\n<h1>\n<span id="クラス名のチェック" class="fragment"></span><a href="#%E3%82%AF%E3%83%A9%E3%82%B9%E5%90%8D%E3%81%AE%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>クラス名のチェック</h1>\n\n<p>Stylelintで<code>stylelint-rscss</code>というルールセットが利用できます。<br>\nこのルールセットでは「コンポーネントに<code>-</code>が含まれていない」とか「親子として指定してよい上限」などといったルールに違反した記述をチェックすることができます。</p>\n\n<blockquote>\n<p><a href="https://github.com/rstacruz/stylelint-rscss" rel="nofollow noopener" target="_blank"><code>stylelint-rscss</code></a></p>\n</blockquote>\n\n<h1>\n<span id="リンク" class="fragment"></span><a href="#%E3%83%AA%E3%83%B3%E3%82%AF"><i class="fa fa-link"></i></a>リンク</h1>\n\n<ul>\n<li><a href="https://rscss.io" rel="nofollow noopener" target="_blank">RSCSS (Official Document)</a></li>\n<li><a href="https://qiita.com/kk6/items/760efba180ec526903db">日本語ドキュメント</a></li>\n</ul>\n',body:'# RSCSSとは\n\n> Styling CSS without losing your sanity\n\n正気を保ってCSSを書くためのアイデア。\nルールではないため、シンプルにするためなら無視しても問題ない。\n\n# BEMとRSCSSの比較\n\n* 命名規則\n  - BEMはBlock、Element、Modifierを一つのクラスに連結する\n  - RSCSSはそれぞれ単独のクラスとして定義する\n* 親子関係\n  - BEMはBlockとElement、ElementとElementの親子関係は厳密ではない\n  - RSCSSはすべてのセレクタを親子関係として定義する\n* ネスト\n  - BEMはネストの制約はない\n  - RSCSSのネストの深さは必ず１で、コンポーネントからの親子関係で指定する\n\n# 構成する要素\n\n## BEM\n\n* Block: 単独で意味のあるまとまり\n* Element: 単独では意味を持たない、ブロックに結び付けられた要素\n  - クラスを`__`で接続する\n* Modifier: ブロックまたはエレメントのフラグ\n  - クラスを`--`で接続する\n\n```sass\n.product-list\n  &__item\n    &--pickup\n    &__name\n    &__description\n```\n\n```html\n<ul class="product-list">\n  <li class="product-list__item">\n    <h3 class="product-list__item__name">Product #01</h3>\n    <p class="product-list__item__description">Lorem ipsum dolor sit amet.</p>\n  </li>\n  <li class="product-list__item product-list__item--pickup">\n    <h3 class="product-list__item__name">Product #02 - Pickup!</h3>\n    <p class="product-list__item__description">Lorem ipsum dolor sit amet.</p>\n  </li>\n</ul>\n```\n\n## RSCSS\n\n* Component: BEMでのBlock\n  - クラス名に必ず`-`を含む**複数単語**で構成する\n* Element: BEMでのElement\n  - クラス名に`-`を**含まない**\n  - 複数単語の場合でも`-`や`_`で連結しない\n  - **Componentからの親子関係で指定する**\n  - ネストは必ず１つ\n* Variant: BEMでのModifier\n  - クラス名が必ず`-`で始まる\n\n```sass\n.product-list\n  & > .item\n  & > .item.-pickup\n  & > .item > .name\n  & > .item > .description\n```\n\n```html\n<ul class="product-list">\n  <li class="item">\n    <h3 class="name">Product #01</h3>\n    <p class="description">Lorem ipsum dolor sit amet.</p>\n  </li>\n  <li class="item -pickup">\n    <h3 class="name">Product #02 - Pickup!</h3>\n    <p class="description">Lorem ipsum dolor sit amet.</p>\n  </li>\n</ul>\n```\n\n# BEMにはないRSCSSの規則\n\n## レイアウト\n\nレイアウトに関するプロパティ（`position`、`margin`、`width`など）はコンポーネントに含めず、更に親のコンポーネントクラスを定義してそこで指定するようにします。\n\n```sass\n.article-list\n  &\n    +clearfix\n\n  & > .article-card\n    width: 33.3%\n    float: left\n```\n\n> [Layout](https://rscss.io/layouts.html)\n\n## ヘルパークラス\n\n`!important`を付与し、最優先でスタイルを外付けしたいときに使用するヘルパークラスを定義できます。\nヘルパークラスは必ず`_`で始めます。\n\n```sass\n._unmargin\n  margin: 0 !important\n\n._hidden-sp\n  @media ($sp)\n    display: none !important\n```\n\n> [Helpers](https://rscss.io/helpers.html)\n\n## コンポーネントのネスト\n\nコンポーネントをネストする必要があるときは以下の２つのガイドラインを参考に簡単かつ疎結合に定義するようにしてください。\n\n### Variantを使う\n\nコンポーネントをネストさせた際に、子のクラスをコンポーネントで指定するとそのコンポーネント名と密結合なクラスとなっていまします。\n\n```sass\n.article-header\n  & > .vote-box > .up\n    // よくない\n```\n\n代わりに、Variantで指定するようにしてください。そうすればコンポーネント名の変更や利用場面の自由度があがります。\n\n```html\n<div class="article-header">\n  <div class="vote-box -highlight">\n    <div class="up"> ... </div>\n  </div>\n</div>\n```\n\n```sass\n.article-header\n  & > .-highlight > .up\n    // ...\n```\n\n### プリプロセッサの`@extend`を活用する\n\nコンポーネントをネストさせることでクラス名が複雑になることがあります。\n\n```html\n<div class="search-form">\n  <input class="input" type="text" />\n  <button class="search-button -red -large">Search</button>\n</div>\n```\n\n代わりに、Elementと定義した上で`@extend`を使用すれば簡潔に表現できます。\n\n```html\n<div class="search-form">\n  <input class="input" type="text" />\n  <button class="submit">Search</button>\n</div>\n```\n\n```sass\n.search-form\n  & > .submit\n    @extend .search-button\n    @extend .search-button.-red\n    @extend .search-button.-large\n```\n\n# クラス名のチェック\n\nStylelintで`stylelint-rscss`というルールセットが利用できます。\nこのルールセットでは「コンポーネントに`-`が含まれていない」とか「親子として指定してよい上限」などといったルールに違反した記述をチェックすることができます。\n\n> [`stylelint-rscss`](https://github.com/rstacruz/stylelint-rscss)\n\n# リンク\n\n* [RSCSS (Official Document)](https://rscss.io)\n* [日本語ドキュメント](https://qiita.com/kk6/items/760efba180ec526903db)\n',coediting:a,comments_count:0,created_at:"2019-07-26T13:57:37+09:00",group:s,id:"3e537f530ca94ce6fb3a",likes_count:4,private:a,reactions_count:0,tags:[{name:"bem",versions:[]},{name:"rscss",versions:[]}],title:"[BEM to RSCSS] Quick Migration Guide",updated_at:"2019-07-26T15:39:39+09:00",url:"https://qiita.com/simochee/items/3e537f530ca94ce6fb3a",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'\n<h1>\n<span id="作ったもの" class="fragment"></span><a href="#%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>作ったもの</h1>\n\n<p>Vueで値を監視して変更があったらハンドラを発火させる<code>Watch</code>ですが、パスの指定が文字列なので存在しないパスを指定しても誰も怒ってくれません。</p>\n\n<p>そこで、<code>vue-property-decorator</code>の<code>@Watch</code>デコレータ向けにデータへのパスを安全に指定できるライブラリ<code>vuekey</code>を作りました。</p>\n\n<blockquote>\n<p><a href="https://www.npmjs.com/package/@lollipop-onl/vuekey" rel="nofollow noopener" target="_blank">@lollipop-onl/vuekey</a></p>\n</blockquote>\n\n<p>この記事では、簡単に使い方と内部実装についてご紹介します。</p>\n\n<h1>\n<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h1>\n\n<h2>\n<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h2>\n\n<p>まずは、<a href="https://www.npmjs.com/package/@lollipop-onl/vuekey" rel="nofollow noopener" target="_blank"><code>@lollipop-onl/vuekey</code></a>をインストールしてください。</p>\n\n<div class="code-frame" data-lang="sh"><div class="highlight"><pre class="with-code"><code><span class="nv">$ </span>npm i <span class="nt">--save</span> @lollipop-onl/vuekey\n<span class="c"># or </span>\n<span class="nv">$ </span>yarn add @lollipop-onl/vuekey\n</code></pre></div></div>\n\n<h2>\n<span id="vueファイル内でセットアップ" class="fragment"></span><a href="#vue%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%86%85%E3%81%A7%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>Vueファイル内でセットアップ</h2>\n\n<p><code>vuekey</code>では<code>setupVuekey</code>という関数を提供しています。</p>\n\n<p>この関数のGenericとしてVueクラスを渡すと、そのクラス内で有効なパラメータへのパスを検証することができます。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">setupVuekey</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@lollipop-onl/vuekey</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="c1">// vuekeyのセットアップ</span>\n<span class="kd">const</span> <span class="nx">vuekey</span> <span class="o">=</span> <span class="nx">setupVuekey</span><span class="o">&lt;</span><span class="nx">SampleComponent</span><span class="o">&gt;</span><span class="p">();</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{}</span>\n</code></pre></div></div>\n\n<h2>\n<span id="vuekeyでパスを指定" class="fragment"></span><a href="#vuekey%E3%81%A7%E3%83%91%E3%82%B9%E3%82%92%E6%8C%87%E5%AE%9A"><i class="fa fa-link"></i></a><code>vuekey</code>でパスを指定</h2>\n\n<p><code>vuekey(&lt;key&gt;, &lt;key&gt;, ...)</code>とパラメータのキーを指定していきます。最大10個ネストしたパラメータまでを検証できます。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">setupVuekey</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@lollipop-onl/vuekey</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="c1">// vuekeyのセットアップ</span>\n<span class="kd">const</span> <span class="nx">vuekey</span> <span class="o">=</span> <span class="nx">setupVuekey</span><span class="o">&lt;</span><span class="nx">SampleComponent</span><span class="o">&gt;</span><span class="p">();</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="nl">profile</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>\n    <span class="nl">age</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>\n    <span class="nl">works</span><span class="p">:</span> <span class="nx">IWark</span><span class="p">[];</span>\n    <span class="nl">updatedAt</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>\n  <span class="p">};</span>\n\n  <span class="c1">// プロフィールが変更されたらタイムスタンプを更新する</span>\n  <span class="p">@</span><span class="nd">Watch</span><span class="p">(</span><span class="nx">vuekey</span><span class="p">(</span><span class="dl">\'</span><span class="s1">profile</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">name</span><span class="dl">\'</span><span class="p">),</span> <span class="p">{</span> <span class="na">immediate</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>\n  <span class="p">@</span><span class="nd">Watch</span><span class="p">(</span><span class="nx">vuekey</span><span class="p">(</span><span class="dl">\'</span><span class="s1">profile</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">age</span><span class="dl">\'</span><span class="p">))</span>\n  <span class="nx">onChangeProfile</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">$set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">profile</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">updatedAt</span><span class="dl">\'</span><span class="p">,</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">());</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<p>これで、存在しないパラメータキーを指定しようとしたらエラーとなります。</p>\n\n<h2>\n<span id="vmsetもタイプセーフにする" class="fragment"></span><a href="#vmset%E3%82%82%E3%82%BF%E3%82%A4%E3%83%97%E3%82%BB%E3%83%BC%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a><code>vm.$set</code>もタイプセーフにする</h2>\n\n<p><code>this.$set</code>はオブジェクトや配列の要素をリアクティブに変更するためのビルトインメソッドですが、第2引数、第3引数は方に縛られていません。</p>\n\n<p>ここも存在するキー、代入可能な型かどうかを検証させる機能を<code>vuekey</code>に持たせています。</p>\n\n<p>先程のプロフィールのタイムスタンプを更新する例は以下のように変更できます。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">setupVuekey</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@lollipop-onl/vuekey</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="c1">// vuekeyのセットアップ</span>\n<span class="kd">const</span> <span class="nx">vuekey</span> <span class="o">=</span> <span class="nx">setupVuekey</span><span class="o">&lt;</span><span class="nx">SampleComponent</span><span class="o">&gt;</span><span class="p">();</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="nl">profile</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>\n    <span class="nl">age</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>\n    <span class="nl">works</span><span class="p">:</span> <span class="nx">IWark</span><span class="p">[];</span>\n    <span class="nl">updatedAt</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>\n  <span class="p">};</span>\n\n  <span class="c1">// プロフィールが変更されたらタイムスタンプを更新する</span>\n  <span class="p">@</span><span class="nd">Watch</span><span class="p">(</span><span class="nx">vuekey</span><span class="p">(</span><span class="dl">\'</span><span class="s1">profile</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">name</span><span class="dl">\'</span><span class="p">),</span> <span class="p">{</span> <span class="na">immediate</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>\n  <span class="p">@</span><span class="nd">Watch</span><span class="p">(</span><span class="nx">vuekey</span><span class="p">(</span><span class="dl">\'</span><span class="s1">profile</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">age</span><span class="dl">\'</span><span class="p">))</span>\n  <span class="nx">onChangeProfile</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">$set</span><span class="p">(...</span><span class="nx">vuekey</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">profile</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">updatedAt</span><span class="dl">\'</span><span class="p">,</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()));</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<p>これで、<code>this.profile</code>の型定義に存在しないプロパティの指定や、不正な型の代入を防ぐことができます。</p>\n\n<p>Vueで文字列だからとおざなりになりがちなところですが、型安全にして平和にいきましょう！</p>\n\n<h1>\n<span id="実装のこと" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E3%81%AE%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>実装のこと</h1>\n\n<p>ここからは、<code>vuekey</code>を作るにあたって困った点を備忘録として残します。<br>\n同じ轍を踏む人が一人でも減りますように...</p>\n\n<blockquote>\n<p><a href="https://gitlab.com/lollipop.onl/vuekey/blob/master/index.ts" rel="nofollow noopener" target="_blank">ソースコード</a></p>\n</blockquote>\n\n<h2>\n<span id="前の引数で指定したプロパティの持つキーのみを続く引数で指定させる" class="fragment"></span><a href="#%E5%89%8D%E3%81%AE%E5%BC%95%E6%95%B0%E3%81%A7%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%81%AE%E6%8C%81%E3%81%A4%E3%82%AD%E3%83%BC%E3%81%AE%E3%81%BF%E3%82%92%E7%B6%9A%E3%81%8F%E5%BC%95%E6%95%B0%E3%81%A7%E6%8C%87%E5%AE%9A%E3%81%95%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>前の引数で指定したプロパティの持つキーのみを続く引数で指定させる</h2>\n\n<p><code>vuekey</code>では、第1引数で指定したパラメータのキーを第2引数の型とするような機能が必要でした。</p>\n\n<p>当初は</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// vuekey&lt;V extends Vue&gt;は省略しています</span>\n\n<span class="kd">function</span> <span class="nx">vuekey</span><span class="o">&lt;</span><span class="nx">V</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">t1</span><span class="p">?:</span> <span class="kr">keyof</span> <span class="nx">V</span><span class="p">,</span> <span class="nx">t2</span><span class="p">?:</span> <span class="kr">keyof</span> <span class="nx">V</span><span class="p">[</span><span class="k">typeof</span> <span class="nx">t1</span><span class="p">],</span> <span class="nx">t3</span><span class="p">:</span> <span class="kr">keyof</span> <span class="nx">V</span><span class="p">[</span><span class="k">typeof</span> <span class="nx">t1</span><span class="p">][</span><span class="k">typeof</span> <span class="nx">t2</span><span class="p">],</span> <span class="p">...)</span>\n</code></pre></div></div>\n\n<p>のように、前の引数の型を後半でも参照するようにしていました。</p>\n\n<p>しかし、この実装では前半の型は確定しなかったため没になりました。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kd">function</span> <span class="nx">vuekey</span><span class="o">&lt;</span><span class="nx">V</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">t1</span><span class="p">?:</span> <span class="kr">keyof</span> <span class="nx">V</span><span class="p">,</span> <span class="nx">t2</span><span class="p">?:</span> <span class="kr">keyof</span> <span class="nx">V</span><span class="p">[</span><span class="k">typeof</span> <span class="nx">t1</span><span class="p">]</span> <span class="c1">// typeof t1が確定していないのでV[typeof t1]がneverになった</span>\n</code></pre></div></div>\n\n<p>そこで、インターフェースのジェネリックで内部状態（？）として型を指定するようにしました。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kr">interface</span> <span class="nx">Vuekey</span><span class="o">&lt;</span><span class="nx">V</span> <span class="kd">extends</span> <span class="nx">Vue</span><span class="o">&gt;</span> <span class="p">{</span>\n  <span class="o">&lt;</span>\n    <span class="nx">T1</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">V</span><span class="p">,</span>\n    <span class="nx">T2</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">V</span><span class="p">[</span><span class="nx">T1</span><span class="p">],</span>\n    <span class="nx">T3</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">V</span><span class="p">[</span><span class="nx">T1</span><span class="p">][</span><span class="nx">T2</span><span class="p">]</span>\n  <span class="o">&gt;</span><span class="p">(</span><span class="nx">t1</span><span class="p">?:</span> <span class="nx">T1</span><span class="p">,</span> <span class="nx">t2</span><span class="p">?:</span> <span class="nx">T2</span><span class="p">,</span> <span class="nx">t3</span><span class="p">?:</span> <span class="nx">T3</span><span class="p">):</span> <span class="kr">string</span><span class="p">;</span>\n<span class="p">}</span>\n</code></pre></div></div>\n\n<p>こうすることで、<code>T2</code>での<code>T1</code>は実際に指定された定数値を参照することができました。</p>\n\n<h2>\n<span id="nullableなオブジェクトでのkeyof" class="fragment"></span><a href="#nullable%E3%81%AA%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7%E3%81%AEkeyof"><i class="fa fa-link"></i></a>Nullableなオブジェクトでの<code>keyof</code>\n</h2>\n\n<p>任意のクラスメンバーは<code>| undefined</code>となりますが、このような値に対して<code>keyof</code>すると<code>never</code>が返されてしまいます。</p>\n\n<p>任意のパラメータを除去するには<code>Required</code>というビルトインの型を使用します。</p>\n\n<p>さて、任意のパラメータがネストする場合はどうすればよいでしょうか？おそらく<code>DeepRequired</code>みたいな型を作れば良いと思います。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kd">type</span> <span class="nx">DeepRequired</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kd">extends</span> <span class="nx">object</span>\n  <span class="p">?</span> <span class="p">{</span> <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">T</span><span class="p">]</span><span class="o">-</span><span class="p">?:</span> <span class="nx">DeepRequired</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span><span class="o">&gt;</span> <span class="p">}</span>\n  <span class="p">:</span> <span class="nx">T</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p>ただし、<code>vuekey</code>の場合は事情が違います。<code>vuekey</code>では、<code>T</code>にあたる型の親のパラメータが任意である可能性があり、<code>DeepRequired</code>は利用できませんでした。</p>\n\n<p>そこですべての型を<code>Required</code>でラップするという手段で実装を行っています。</p>\n\n<blockquote>\n<p><a href="https://gitlab.com/lollipop.onl/vuekey/blob/master/index.ts#L28" rel="nofollow noopener" target="_blank">該当箇所</a></p>\n</blockquote>\n\n<p>もっと良い方法があればコメントで教えていただきたいです！</p>\n',body:"# 作ったもの\n\nVueで値を監視して変更があったらハンドラを発火させる`Watch`ですが、パスの指定が文字列なので存在しないパスを指定しても誰も怒ってくれません。\n\nそこで、`vue-property-decorator`の`@Watch`デコレータ向けにデータへのパスを安全に指定できるライブラリ`vuekey`を作りました。\n\n> [@lollipop-onl/vuekey](https://www.npmjs.com/package/@lollipop-onl/vuekey)\n\nこの記事では、簡単に使い方と内部実装についてご紹介します。\n\n# 使い方\n\n## インストール\n\nまずは、[`@lollipop-onl/vuekey`](https://www.npmjs.com/package/@lollipop-onl/vuekey)をインストールしてください。\n\n```sh\n$ npm i --save @lollipop-onl/vuekey\n# or \n$ yarn add @lollipop-onl/vuekey\n```\n\n## Vueファイル内でセットアップ\n\n`vuekey`では`setupVuekey`という関数を提供しています。\n\nこの関数のGenericとしてVueクラスを渡すと、そのクラス内で有効なパラメータへのパスを検証することができます。\n\n```ts\nimport { Component, Vue } from 'vue-property-decorator';\nimport { setupVuekey } from '@lollipop-onl/vuekey';\n\n// vuekeyのセットアップ\nconst vuekey = setupVuekey<SampleComponent>();\n\n@Component\nexport default class SampleComponent extends Vue {}\n```\n\n## `vuekey`でパスを指定\n\n`vuekey(<key>, <key>, ...)`とパラメータのキーを指定していきます。最大10個ネストしたパラメータまでを検証できます。\n\n```ts\nimport { Component, Watch, Vue } from 'vue-property-decorator';\nimport { setupVuekey } from '@lollipop-onl/vuekey';\n\n// vuekeyのセットアップ\nconst vuekey = setupVuekey<SampleComponent>();\n\n@Component\nexport default class SampleComponent extends Vue {\n  profile: {\n    name: string;\n    age?: number;\n    works: IWark[];\n    updatedAt: number;\n  };\n\n  // プロフィールが変更されたらタイムスタンプを更新する\n  @Watch(vuekey('profile', 'name'), { immediate: true })\n  @Watch(vuekey('profile', 'age'))\n  onChangeProfile() {\n    this.$set(this.profile, 'updatedAt', Date.now());\n  }\n}\n```\n\nこれで、存在しないパラメータキーを指定しようとしたらエラーとなります。\n\n## `vm.$set`もタイプセーフにする\n\n`this.$set`はオブジェクトや配列の要素をリアクティブに変更するためのビルトインメソッドですが、第2引数、第3引数は方に縛られていません。\n\nここも存在するキー、代入可能な型かどうかを検証させる機能を`vuekey`に持たせています。\n\n先程のプロフィールのタイムスタンプを更新する例は以下のように変更できます。\n\n```ts\nimport { Component, Watch, Vue } from 'vue-property-decorator';\nimport { setupVuekey } from '@lollipop-onl/vuekey';\n\n// vuekeyのセットアップ\nconst vuekey = setupVuekey<SampleComponent>();\n\n@Component\nexport default class SampleComponent extends Vue {\n  profile: {\n    name: string;\n    age?: number;\n    works: IWark[];\n    updatedAt: number;\n  };\n\n  // プロフィールが変更されたらタイムスタンプを更新する\n  @Watch(vuekey('profile', 'name'), { immediate: true })\n  @Watch(vuekey('profile', 'age'))\n  onChangeProfile() {\n    this.$set(...vuekey(this.profile, 'updatedAt', Date.now()));\n  }\n}\n```\n\nこれで、`this.profile`の型定義に存在しないプロパティの指定や、不正な型の代入を防ぐことができます。\n\nVueで文字列だからとおざなりになりがちなところですが、型安全にして平和にいきましょう！\n\n# 実装のこと\n\nここからは、`vuekey`を作るにあたって困った点を備忘録として残します。\n同じ轍を踏む人が一人でも減りますように...\n\n> [ソースコード](https://gitlab.com/lollipop.onl/vuekey/blob/master/index.ts)\n\n## 前の引数で指定したプロパティの持つキーのみを続く引数で指定させる\n\n`vuekey`では、第1引数で指定したパラメータのキーを第2引数の型とするような機能が必要でした。\n\n当初は\n\n```ts\n// vuekey<V extends Vue>は省略しています\n\nfunction vuekey<V>(t1?: keyof V, t2?: keyof V[typeof t1], t3: keyof V[typeof t1][typeof t2], ...)\n```\n\nのように、前の引数の型を後半でも参照するようにしていました。\n\nしかし、この実装では前半の型は確定しなかったため没になりました。\n\n```ts\nfunction vuekey<V>(t1?: keyof V, t2?: keyof V[typeof t1] // typeof t1が確定していないのでV[typeof t1]がneverになった\n```\n\nそこで、インターフェースのジェネリックで内部状態（？）として型を指定するようにしました。\n\n```ts\ninterface Vuekey<V extends Vue> {\n  <\n    T1 extends keyof V,\n    T2 extends keyof V[T1],\n    T3 extends keyof V[T1][T2]\n  >(t1?: T1, t2?: T2, t3?: T3): string;\n}\n```\n\nこうすることで、`T2`での`T1`は実際に指定された定数値を参照することができました。\n\n## Nullableなオブジェクトでの`keyof`\n\n任意のクラスメンバーは` | undefined`となりますが、このような値に対して`keyof`すると`never`が返されてしまいます。\n\n任意のパラメータを除去するには`Required`というビルトインの型を使用します。\n\nさて、任意のパラメータがネストする場合はどうすればよいでしょうか？おそらく`DeepRequired`みたいな型を作れば良いと思います。\n\n```ts\ntype DeepRequired<T> = T extends object\n  ? { [K in keyof T]-?: DeepRequired<T[K]> }\n  : T;\n```\n\nただし、`vuekey`の場合は事情が違います。`vuekey`では、`T`にあたる型の親のパラメータが任意である可能性があり、`DeepRequired`は利用できませんでした。\n\nそこですべての型を`Required`でラップするという手段で実装を行っています。\n\n> [該当箇所](https://gitlab.com/lollipop.onl/vuekey/blob/master/index.ts#L28)\n\nもっと良い方法があればコメントで教えていただきたいです！\n",coediting:a,comments_count:0,created_at:S,group:s,id:"a8057324e1d557cc7ffd",likes_count:1,private:a,reactions_count:0,tags:[{name:f,versions:[]},{name:v,versions:[]},{name:B,versions:[]}],title:"VueでWatch対象のパスを安全に指定できるライブラリ vuekey を作った",updated_at:S,url:"https://qiita.com/simochee/items/a8057324e1d557cc7ffd",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'<p>この記事はVueを勉強している段階からTypeScriptでクラスベースのVueアプリを作りたい！という方へ向けて例を交えながら<a href="https://github.com/kaorun343/vue-property-decorator" rel="nofollow noopener" target="_blank"><code>vue-property-decorator</code></a>の機能を<strong>基本</strong>と<strong>応用</strong>、<strong>上級</strong>の３セクションに分けて説明していきます。</p>\n\n<p>基本では、Vueでアプリを作る上で必須となる機能を、応用では用意されている便利なデコレータを、上級では普通の開発ではほぼ使わない機能について説明します。<br>\nとりあえずは基本のみ理解しておけば困ることはないでしょう。</p>\n\n<p>また、最後に<a href="https://github.com/nuxt-community/nuxt-property-decorator" rel="nofollow noopener" target="_blank"><code>nuxt-property-decorator</code></a>独自のデコレータも紹介しています。</p>\n\n<p><strong>2019/12/09 追記</strong>：<code>nuxt-property-decorator</code>独自のデコレータの紹介を追加しました</p>\n\n<h2>\n<span id="動作確認バージョン" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>動作確認バージョン</h2>\n\n<ul>\n<li><a href="https://github.com/kaorun343/vue-property-decorator/tree/v8.4.2" rel="nofollow noopener" target="_blank"><code>vue-property-decorator v8.4.2</code></a></li>\n<li>\n<a href="https://github.com/nuxt-community/nuxt-property-decorator/tree/v2.5.1" rel="nofollow noopener" target="_blank"><code>nuxt-property-decorator v2.5.1</code></a>\n\n<ul>\n<li>\n<code>nuxt-property-decorator v2.7.2</code> で vuex-module-decorators が同梱されるようになりました（追記予定）</li>\n</ul>\n</li>\n</ul>\n\n<h2>\n<span id="基本" class="fragment"></span><a href="#%E5%9F%BA%E6%9C%AC"><i class="fa fa-link"></i></a>基本</h2>\n\n<h3>\n<span id="コンポーネントの定義" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%AE%E5%AE%9A%E7%BE%A9"><i class="fa fa-link"></i></a>コンポーネントの定義</h3>\n\n<p><code>@Component</code>は続けて定義しているクラスをVueが認識できる形式に変換しています。</p>\n\n<p>以下の２つは同じ意味です。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">SampleComponent</span><span class="dl">\'</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>この時、<code>vue-property-decorator</code>の<code>Vue</code>クラスを継承することを忘れないように気をつけてください。</p>\n\n<h3>\n<span id="data" class="fragment"></span><a href="#data"><i class="fa fa-link"></i></a>Data</h3>\n\n<p>Dataはクラスのメンバーとして定義するだけで利用できます。</p>\n\n<p>以下のサンプルでは名前と年齢をDataに持たせています。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code>\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">simochee</span><span class="dl">\'</span><span class="p">,</span>\n      <span class="na">age</span><span class="p">:</span> <span class="mi">21</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="nx">name</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">simochee</span><span class="dl">\'</span><span class="p">;</span>\n  <span class="nx">age</span> <span class="o">=</span> <span class="mi">21</span><span class="p">;</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>Dataをテンプレート内で使用するときはプレーンなVueと同じように参照できます。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="c">&lt;!-- simochee (21) --&gt;</span>\n  <span class="nt">&lt;p&gt;</span><span class="si">{{</span> <span class="nx">name</span> <span class="si">}}</span> (<span class="si">{{</span> <span class="nx">age</span> <span class="si">}}</span>)<span class="nt">&lt;/p&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<h3>\n<span id="computed" class="fragment"></span><a href="#computed"><i class="fa fa-link"></i></a>Computed</h3>\n\n<p>算出プロパティ（Computed）はクラスのGetterとして定義することで利用できます。</p>\n\n<p>以下のサンプルではDataに定義されたスコアを３倍する算出プロパティを定義しています。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="p">{</span>\n      <span class="na">score</span><span class="p">:</span> <span class="mi">55</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="na">computed</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">triple</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">score</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="nx">score</span> <span class="o">=</span> <span class="mi">55</span><span class="p">;</span>\n\n  <span class="kd">get</span> <span class="nx">triple</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">score</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>Computedをテンプレート内で使用するときはプレーンなVueと同じように参照できます。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="c">&lt;!-- Triple score: 163! --&gt;</span>\n  <span class="nt">&lt;p&gt;</span>Triple score: <span class="si">{{</span> <span class="nx">triple</span> <span class="si">}}</span>!<span class="nt">&lt;/p&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<h3>\n<span id="メソッド" class="fragment"></span><a href="#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>メソッド</h3>\n\n<p>メソッドはクラスのメソッドとして定義するだけで利用することができます。</p>\n\n<p>以下の例では、ボタンが押されたときに<code>onClickButton</code>メソッドを呼び出しています。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;button</span> <span class="err">@</span><span class="na">click=</span><span class="s">"onClickButton"</span><span class="nt">&gt;</span>Click Me!<span class="nt">&lt;/button&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>このようなテンプレートがあったときの<code>onClickButton</code>は以下のように定義できます。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="nx">deafult</span> <span class="p">{</span>\n  <span class="nl">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">onClickButton</span><span class="p">()</span> <span class="p">{</span>\n      <span class="c1">// ボタンが押されたときの処理</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="nx">onClickButton</span><span class="p">()</span> <span class="p">{</span>\n    <span class="c1">// ボタンが押されたときの処理</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>Reactのようにメソッドに<code>this</code>をバインドする必要はありません。</p>\n\n<h3>\n<span id="ライフサイクルフック" class="fragment"></span><a href="#%E3%83%A9%E3%82%A4%E3%83%95%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB%E3%83%95%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>ライフサイクルフック</h3>\n\n<p><a href="https://jp.vuejs.org/v2/api/#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%83%A9%E3%82%A4%E3%83%95%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB%E3%83%95%E3%83%83%E3%82%AF" rel="nofollow noopener" target="_blank">ライフサイクルフック</a>は、クラスにライフサイクルの名前でメソッドを定義するだけで利用できます。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>\n    <span class="c1">// コンポーネントがマウントされたときの処理</span>\n  <span class="p">},</span>\n  <span class="nx">beforeDestroy</span><span class="p">()</span> <span class="p">{</span>\n    <span class="c1">// コンポーネントが破棄される直前の処理</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>\n    <span class="c1">// コンポーネントがマウントされたときの処理</span>\n  <span class="p">}</span>\n\n  <span class="nx">beforeDestroy</span><span class="p">()</span> <span class="p">{</span>\n    <span class="c1">// コンポーネントが破棄される直前の処理</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p><code>vue-property-decorator</code>ではライフサイクルフックとメソッドが同じ領域で定義されるため、ライフサイクルの名前でメソッドを定義しないように注意が必要です。</p>\n\n<h3>\n<span id="component" class="fragment"></span><a href="#component"><i class="fa fa-link"></i></a><code>@Component</code>\n</h3>\n\n<p><code>@Component</code>は引数としてVueのオブジェクトを指定することができます。</p>\n\n<p>以降で各種デコレータを紹介しますが、そこで定義できない<code>components</code>や<code>filters</code>、<code>mixins</code>などのプロパティは<code>@Component</code>の引数として指定します。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="nx">deafult</span> <span class="p">{</span>\n  <span class="nl">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">AppButton</span><span class="p">,</span>\n    <span class="nx">ProductList</span>\n  <span class="p">},</span>\n  <span class="nx">directives</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">resize</span>\n  <span class="p">},</span>\n  <span class="nx">filters</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">dateFormat</span>\n  <span class="p">},</span>\n  <span class="nx">mixins</span><span class="p">:</span> <span class="p">[</span>\n    <span class="nx">PageMixin</span>\n  <span class="p">]</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">AppButton</span><span class="p">,</span>\n    <span class="nx">ProductList</span>\n  <span class="p">},</span>\n  <span class="na">directives</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">resize</span>\n  <span class="p">},</span>\n  <span class="na">filters</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">dateFormat</span>\n  <span class="p">},</span>\n  <span class="na">mixins</span><span class="p">:</span> <span class="p">[</span>\n    <span class="nx">PageMixin</span>\n  <span class="p">]</span>\n<span class="p">})</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>他にも、以下のドキュメントで紹介されているプロパティを指定できます。</p>\n\n<ul>\n<li><a href="https://jp.vuejs.org/v2/api/#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%83%87%E3%83%BC%E3%82%BF" rel="nofollow noopener" target="_blank">オプション / データ</a></li>\n<li><a href="https://jp.vuejs.org/v2/api/#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-DOM" rel="nofollow noopener" target="_blank">オプション / DOM</a></li>\n<li><a href="https://jp.vuejs.org/v2/api/#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%83%A9%E3%82%A4%E3%83%95%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB%E3%83%95%E3%83%83%E3%82%AF" rel="nofollow noopener" target="_blank">オプション / ライフサイクルフック</a></li>\n<li><a href="https://jp.vuejs.org/v2/api/#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%82%A2%E3%82%BB%E3%83%83%E3%83%88" rel="nofollow noopener" target="_blank">オプション / アセット</a></li>\n<li><a href="https://jp.vuejs.org/v2/api/#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E6%A7%8B%E6%88%90" rel="nofollow noopener" target="_blank">オプション / 構成</a></li>\n<li><a href="https://jp.vuejs.org/v2/api/#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%81%9D%E3%81%AE%E4%BB%96" rel="nofollow noopener" target="_blank">オプション / その他</a></li>\n</ul>\n\n<h3>\n<span id="prop" class="fragment"></span><a href="#prop"><i class="fa fa-link"></i></a><code>@Prop</code>\n</h3>\n\n<p><code>@Prop</code>は続けて定義したメンバーを<code>props</code>として使用できるようにします。</p>\n\n<p>親コンポーネントからは定義したメンバー名で<code>props</code>を指定できます。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="nx">deafult</span> <span class="p">{</span>\n  <span class="nl">props</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">userName</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>\n      <span class="na">required</span><span class="p">:</span> <span class="kc">true</span>\n    <span class="p">},</span>\n    <span class="na">isVisible</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">type</span><span class="p">:</span> <span class="nb">Boolean</span><span class="p">,</span>\n      <span class="na">default</span><span class="p">:</span> <span class="kc">false</span>\n    <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="p">@</span><span class="nd">Prop</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>\n  <span class="nx">userName</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>\n\n  <span class="p">@</span><span class="nd">Prop</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="na">defualt</span><span class="p">:</span> <span class="kc">false</span> <span class="p">})</span>\n  <span class="nx">isVisible</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p><code>@Prop</code>の引数には<code>props</code>で指定可能なオプションがすべて指定できます。</p>\n\n<ul>\n<li><a href="https://jp.vuejs.org/v2/api/#props" rel="nofollow noopener" target="_blank">props</a></li>\n</ul>\n\n<h3>\n<span id="watch" class="fragment"></span><a href="#watch"><i class="fa fa-link"></i></a><code>@Watch</code>\n</h3>\n\n<p><code>@Watch</code>は第１引数に監視したい値へのパスを、第２引数にウォッチャのオプションを指定できます。</p>\n\n<p>以下のサンプルでは単一のDataとObjectのプロパティの値を監視するメソッドを定義しています。</p>\n\n<p>なお、<code>immediate: true</code>はコンポーネント初期化時にも処理を実行するかを指定するオプションです。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="nx">deafult</span> <span class="p">{</span>\n  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>\n    <span class="nl">isLoading</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>\n    <span class="nx">profile</span><span class="p">:</span> <span class="p">{</span>\n      <span class="nl">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">simochee</span><span class="dl">\'</span><span class="p">,</span>\n      <span class="nx">age</span><span class="p">:</span> <span class="mi">21</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="nx">watch</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">isLoading</span><span class="p">()</span> <span class="p">{</span>\n      <span class="c1">// ローディング状態が切り替わったときの処理</span>\n    <span class="p">},</span>\n    <span class="dl">\'</span><span class="s1">profile.age</span><span class="dl">\'</span><span class="p">:</span> <span class="p">{</span>\n      <span class="nl">handler</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>\n        <span class="c1">// プロフィールの年齢が変更されたときの処理</span>\n      <span class="p">},</span>\n      <span class="nx">immediate</span><span class="p">:</span> <span class="kc">true</span>\n    <span class="p">}</span> \n  <span class="p">}</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>\n  <span class="nx">profile</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">simochee</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="na">age</span><span class="p">:</span> <span class="mi">21</span>\n  <span class="p">};</span>\n\n  <span class="p">@</span><span class="nd">Watch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">isLoading</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="nx">onChangeLoadingStatus</span><span class="p">()</span> <span class="p">{</span>\n    <span class="c1">// ローディング状態が切り替わったときの処理</span>\n  <span class="p">}</span>\n\n  <span class="p">@</span><span class="nd">Watch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">profile.age</span><span class="dl">\'</span><span class="p">,</span> <span class="p">{</span> <span class="na">immediate</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>\n  <span class="nx">onChangeProfileAge</span><span class="p">()</span> <span class="p">{</span>\n    <span class="c1">// プロフィールの年齢が変更されたときの処理</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>Vueの仕様からも分かる通り、<code>@Watch</code>は同じパスに対して複数回指定することはできません。<br>\n複数回指定された場合は後勝ちとなるため、先に定義したウォッチャは実行されません。</p>\n\n<h2>\n<span id="応用" class="fragment"></span><a href="#%E5%BF%9C%E7%94%A8"><i class="fa fa-link"></i></a>応用</h2>\n\n<h3>\n<span id="propsync" class="fragment"></span><a href="#propsync"><i class="fa fa-link"></i></a><code>@PropSync</code>\n</h3>\n\n<p>Vue.jsでは<code>props</code>を指定する際に<code>.sync</code>修飾子を付与することで、子コンポーネントから親コンポーネントの値を変更することができるようになります。</p>\n\n<p>仕組みとしては、<code>@update:&lt;Prop名&gt;</code>というイベントを受け取ったらDataに代入するという処理を暗黙的に行っています。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code>// 親コンポーネント\n<span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="c">&lt;!-- 以下の２つは同じ意味 --&gt;</span>\n  <span class="nt">&lt;ChildComponent</span>\n<span class="err">　</span>  <span class="na">:childValue.sync=</span><span class="s">"value"</span>\n  <span class="nt">/&gt;</span>\n  <span class="nt">&lt;ChildComponent</span>\n    <span class="na">:childValue=</span><span class="s">"value"</span>\n    <span class="err">@</span><span class="na">update:childValue=</span><span class="s">"value = $event"</span>\n  <span class="nt">/&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>このとき、子コンポーネント以降で<code>.sync</code>プロパティをバケツリレーする際に便利なのが<code>@PropSync</code>デコレータです。</p>\n\n<p>このデコレータを使用しない場合は、以下のように書かなければいけませんでした。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code>// 子コンポーネント\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="p">@</span><span class="nd">Prop</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span> <span class="p">})</span>\n  <span class="nx">childValue</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>\n\n  <span class="c1">// value を変更したいときに呼び出す</span>\n  <span class="nx">updateValue</span><span class="p">(</span><span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">update:childValue</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">);</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>これが、<code>@PropSync</code>で定義した場合はメンバーへ値を代入するだけで同等の処理を実現することができます。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">PropSync</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="p">@</span><span class="nd">PropSync</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span> <span class="p">})</span>\n  <span class="nx">childValue</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>\n\n  <span class="c1">// value を変更したいときに呼び出す</span>\n  <span class="nx">updateValue</span><span class="p">(</span><span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">childValue</span> <span class="o">=</span> <span class="nx">newValue</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>代入するだけで値の変更を通知できるため、さらに<code>.sync</code>で孫コンポーネントへ値を渡す場合なども、とてもシンプルに書くことができます。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;SunComponent</span>\n    <span class="na">:sunValue.sync=</span><span class="s">"childValue"</span>\n  <span class="nt">/&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<h3>\n<span id="emit" class="fragment"></span><a href="#emit"><i class="fa fa-link"></i></a><code>@Emit</code>\n</h3>\n\n<p>Vueではコンポーネント間での値を双方向にやり取りすることができます。</p>\n\n<p>親から子への値渡しはPropを指定することで行い、子から親への値渡しはイベントを通知することによってアクションや値を受け渡せるようになっています。</p>\n\n<p>このとき、子から親へ値を渡すときのイベントを発行するのが<code>$emit</code>メソッドです。</p>\n\n<p>以下のサンプルでは子コンポーネントで送信処理が行われたこと<code>submit</code>イベントとして親コンポーネントへ通知し、受け取った値を元に親コンポーネント側でリクエストを送信しています。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code>// 子コンポーネント\n<span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;form</span> <span class="err">@</span><span class="na">submit=</span><span class="s">"onSubmit"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;input</span> <span class="na">v-model=</span><span class="s">"value"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>\n  <span class="nt">&lt;/submit&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">ChildComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="nx">value</span> <span class="o">=</span> <span class="dl">\'\'</span><span class="p">;</span>\n\n  <span class="c1">// 値を送信する処理</span>\n  <span class="nx">onSubmit</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">submit</span><span class="dl">\'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code>// 親コンポーネント\n<span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;ChildComponent</span>\n    <span class="err">@</span><span class="na">submit=</span><span class="s">"onReceiveSubmit"</span>\n  <span class="nt">/&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="nx">ChildComponent</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">./ChildComponent.vue</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">ChildComponent</span>\n  <span class="p">}</span>\n<span class="p">})</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">ParentComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="k">async</span> <span class="nx">onReceiveSubmit</span><span class="p">(</span><span class="nx">newValue</span><span class="p">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>\n    <span class="c1">// $emitでの第２引数を受け取ることができる</span>\n    <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$request</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">newValue</span><span class="p">);</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p><code>@Emit</code>では<code>$emit</code>の処理を事前に定義することができます。</p>\n\n<p>イベント名は<code>@Emit</code>の第１引数に明示的に指定するか、省略した場合は続けて定義しているメソッド名が利用されます。</p>\n\n<p>また、メソッドで値を返却すれば<code>$emit</code>でその値を送ることもできます。</p>\n\n<p>上記のサンプルの子コンポーネントを<code>@Emit</code>で書き換えると以下のようになります。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;form</span> <span class="err">@</span><span class="na">submit=</span><span class="s">"submit"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;input</span> <span class="na">v-model=</span><span class="s">"value"</span><span class="nt">&gt;</span>\n    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>\n  <span class="nt">&lt;/submit&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Emit</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">ChildComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="nx">value</span> <span class="o">=</span> <span class="dl">\'\'</span><span class="p">;</span>\n\n  <span class="c1">// 値を送信する処理</span>\n  <span class="c1">// イベント名を指定しない場合でも () は省略できない</span>\n  <span class="p">@</span><span class="nd">Emit</span><span class="p">()</span>\n  <span class="nx">submit</span><span class="p">()</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>この他に、<code>@Emit</code>を非同期メソッドへ設定することもできます。</p>\n\n<p>なお、キャメルケースでイベント名、メソッド名を指定した場合、親コンポーネントで受け取る際にはケバブケースへ変換されますので注意が必要です。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// 子コンポーネント</span>\n<span class="p">@</span><span class="nd">Emit</span><span class="p">()</span>\n<span class="nx">submitForm</span><span class="p">()</span> <span class="p">{}</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code>// 親コンポーネント\n<span class="nt">&lt;ChildComponent</span>\n  <span class="err">@</span><span class="na">submit-form=</span><span class="s">"onSubmit"</span>\n  <span class="err">@</span><span class="na">submitForm=</span><span class="s">"onSubmit"</span> <span class="err">//</span> <span class="na">発火しない</span>\n<span class="nt">/&gt;</span>\n</code></pre></div></div>\n\n<p>親コンポーネントでケバブケースのイベントを受け取りたい場合は、デコレータの引数にイベント名を指定する必要があります。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// 子コンポーネント</span>\n<span class="p">@</span><span class="nd">Emit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">submitForm</span><span class="dl">\'</span><span class="p">)</span>\n<span class="nx">submitForm</span><span class="p">()</span> <span class="p">{}</span>\n</code></pre></div></div>\n\n<h3>\n<span id="ref" class="fragment"></span><a href="#ref"><i class="fa fa-link"></i></a><code>@Ref</code>\n</h3>\n\n<p><code>@Ref</code>は<code>$refs</code>で参照できる要素、コンポーネントの型を定義します。<br>\n事前に定義しておくことでタイポや変更へ対応しやすくなります。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">template</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;ChildComponent</span> <span class="na">ref=</span><span class="s">"childComponent"</span> <span class="nt">/&gt;</span>\n  <span class="nt">&lt;button</span> <span class="na">ref=</span><span class="s">"submitButton"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>\n<span class="nt">&lt;/</span><span class="k">template</span><span class="nt">&gt;</span>\n\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n<span class="k">import</span> <span class="nx">ChildComponent</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">@/component/ChildComponent.vue</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>\n  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">ChildComponent</span>\n  <span class="p">}</span>\n<span class="p">});</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="p">@</span><span class="nd">Ref</span><span class="p">()</span> <span class="nx">childComponent</span><span class="p">:</span> <span class="nx">ChildComponent</span><span class="p">;</span>\n  <span class="p">@</span><span class="nd">Ref</span><span class="p">()</span> <span class="nx">submitButton</span><span class="p">:</span> <span class="nx">HTMLButtonElement</span><span class="p">;</span>\n\n  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>\n    <span class="c1">// 子コンポーネントのメソッドを実行する</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">childComponent</span><span class="p">.</span><span class="nx">updateValue</span><span class="p">();</span>\n\n    <span class="c1">// ボタンをフォーカスする</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">submitButton</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<h2>\n<span id="上級" class="fragment"></span><a href="#%E4%B8%8A%E7%B4%9A"><i class="fa fa-link"></i></a>上級</h2>\n\n<p>以降は上級者向けのため、あまり詳しく記載しません。必要であれば公式ドキュメントなどを参照してください。</p>\n\n<h3>\n<span id="model" class="fragment"></span><a href="#model"><i class="fa fa-link"></i></a><code>@Model</code>\n</h3>\n\n<p>VueのModelを定義します。VueではModelを指定する際にPropも定義しそちらに型情報などを記載しなければいけませんでしたが、デコレータでは<code>@Model</code>に併せて定義できます。</p>\n\n<blockquote>\n<p><a href="https://jp.vuejs.org/v2/api/#model" rel="nofollow noopener" target="_blank">Vue.js公式ドキュメント#model</a></p>\n</blockquote>\n\n<p>以下の２つは同じ意味です。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="nx">deafult</span> <span class="p">{</span>\n  <span class="nl">props</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">value</span><span class="p">:</span> <span class="p">{</span>\n      <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>\n      <span class="na">required</span><span class="p">:</span> <span class="kc">true</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n  <span class="nx">model</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nl">prop</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">value</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="nx">event</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">update</span><span class="dl">\'</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Model</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="p">@</span><span class="nd">Model</span><span class="p">(</span><span class="dl">\'</span><span class="s1">update</span><span class="dl">\'</span><span class="p">,</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>\n  <span class="nx">value</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>このとき、暗黙的に<code>value</code>がPropとして定義されるため<code>value</code>という<code>data</code>や<code>methods</code>は定義できません。</p>\n\n<h3>\n<span id="provide--inject" class="fragment"></span><a href="#provide--inject"><i class="fa fa-link"></i></a><code>@Provide</code> / <code>@Inject</code>\n</h3>\n\n<p>Vueでは親で<code>provide</code>として定義した値をその子要素（親子でなくても良い）から<code>inject</code>で参照することができます。</p>\n\n<blockquote>\n<p><a href="https://jp.vuejs.org/v2/api/#provide-inject" rel="nofollow noopener" target="_blank">Vue.js公式ドキュメント#inject/provide</a></p>\n</blockquote>\n\n<p>以下の２つは同じ意味です。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="c">&lt;!-- Parent.vue --&gt;</span>\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="nx">deafult</span> <span class="p">{</span>\n  <span class="nl">provide</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">foo</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="na">bar</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">bar</span><span class="dl">\'</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n\n<span class="c">&lt;!-- Child.vue --&gt;</span>\n<span class="nt">&lt;</span><span class="k">script</span><span class="nt">&gt;</span>\n<span class="k">export</span> <span class="nx">deafult</span> <span class="p">{</span>\n  <span class="nl">inject</span><span class="p">:</span> <span class="p">{</span>\n    <span class="na">foo</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="na">bar</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">bar</span><span class="dl">\'</span><span class="p">,</span>\n    <span class="na">optional</span><span class="p">:</span> <span class="p">{</span> <span class="na">from</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">optional</span><span class="dl">\'</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">default</span><span class="dl">\'</span> <span class="p">}</span>\n  <span class="p">}</span>\n<span class="p">};</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="c">&lt;!-- Parent.vue --&gt;</span>\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Provide</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">ParentComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="p">@</span><span class="nd">Provide</span><span class="p">()</span> <span class="nx">foo</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="p">;</span>\n  <span class="p">@</span><span class="nd">Provide</span><span class="p">(</span><span class="dl">\'</span><span class="s1">bar</span><span class="dl">\'</span><span class="p">)</span> <span class="nx">baz</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">bar</span><span class="dl">\'</span><span class="p">;</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n\n<span class="c">&lt;!-- Child.vue --&gt;</span>\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Inject</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">ChildComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="p">@</span><span class="nd">Inject</span><span class="p">()</span> <span class="nx">foo</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>\n  <span class="p">@</span><span class="nd">Inject</span><span class="p">(</span><span class="dl">\'</span><span class="s1">bar</span><span class="dl">\'</span><span class="p">)</span> <span class="nx">bar</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>\n  <span class="p">@</span><span class="nd">Inject</span><span class="p">({</span> <span class="na">from</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">optional</span><span class="dl">\'</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">default</span><span class="dl">\'</span> <span class="p">})</span> <span class="nx">optional</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>\n  <span class="p">@</span><span class="nd">Inject</span><span class="p">(</span><span class="nx">symbol</span><span class="p">)</span> <span class="nx">baz</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<h3>\n<span id="providereactive--provideinject" class="fragment"></span><a href="#providereactive--provideinject"><i class="fa fa-link"></i></a><code>@ProvideReactive</code> / <code>@ProvideInject</code>\n</h3>\n\n<p><code>@Provide</code> / <code>@Inject</code>の拡張です。親コンポーネントから<code>@ProvideReactive</code>として提供された値の変更を子コンポーネントでキャッチできるようになります。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="c">&lt;!-- Parent.vue --&gt;</span>\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">ProvideReactive</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">ParentComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="p">@</span><span class="nd">ProvideReactive</span><span class="p">()</span> <span class="nx">foo</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="p">;</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n\n<span class="c">&lt;!-- Child.vue --&gt;</span>\n<span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">InjectReactive</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">ChildComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="p">@</span><span class="nd">InjectReactive</span><span class="p">()</span> <span class="nx">foo</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<h3>\n<span id="readonlyとについて" class="fragment"></span><a href="#readonly%E3%81%A8%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a><code>readonly</code>と<code>!</code>、<code>?</code>について</h3>\n\n<p><code>vue-property-decorator</code>のサンプルコードでは<code>readonly</code>や<code>prop!: String</code>のような<code>!</code>が登場しています。</p>\n\n<p>これらはいずれもTypeScriptの機能です。</p>\n\n<p><code>readonly</code>修飾子は、メンバー変数を読み込み専用とするためのものです。<br>\nVueではProp、Modelへの直接の代入はエラーとなります。</p>\n\n<p>誤った代入を事前に防ぐために<code>@Prop</code>および<code>@Model</code>で定義したメンバー変数へは<code>readonly</code>修飾子を付与することをおすすめします。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">PropSync</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="p">@</span><span class="nd">Prop</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span> <span class="p">})</span> <span class="nx">readonly</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>\n  <span class="p">@</span><span class="nd">Model</span><span class="p">(</span><span class="dl">\'</span><span class="s1">update</span><span class="dl">\'</span><span class="p">,</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">Object</span> <span class="p">})</span> <span class="nx">readonly</span> <span class="nx">profile</span><span class="p">:</span> <span class="nx">IProfile</span><span class="p">;</span>\n  <span class="p">@</span><span class="nd">PropSync</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span> <span class="p">})</span> <span class="nx">value</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span> <span class="c1">// 代入可能</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>また、デコレータで定義されたすべてのメンバー変数についている<code>!</code>は <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-0.html#non-null-assertion-operator" rel="nofollow noopener" target="_blank">NonNullAssertionオペレータ</a> と呼ばれる機能です。<br>\n<code>!</code>がついたプロパティがNull/Undefinedではないことを明示します。</p>\n\n<p>ただし、<code>!</code>は<code>required: true</code>またはデフォルト値が設定されているプロパティにのみ指定することをおすすめします。<br>\n逆に、必須項目でなくデフォルト値も指定されていない場合は、<code>?</code>を指定することをおすすめします。</p>\n\n<p>この<code>?</code>はプロパティが任意項目であり、<code>undefined</code>の可能性があることを明示します。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">vue-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="p">@</span><span class="nd">Prop</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>\n  <span class="nx">readonly</span> <span class="nx">name</span><span class="o">!</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>\n\n  <span class="p">@</span><span class="nd">Prop</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="nb">Array</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">[]</span> <span class="p">})</span>\n  <span class="nx">readonly</span> <span class="nx">items</span><span class="o">!</span><span class="p">:</span> <span class="nx">string</span><span class="p">[];</span>\n\n  <span class="p">@</span><span class="nd">Prop</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="nb">Object</span> <span class="p">});</span>\n  <span class="nx">readonly</span> <span class="nx">profile</span><span class="p">?:</span> <span class="nx">IProfile</span><span class="p">;</span>\n\n  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>\n    <span class="c1">// undefinedの可能性のあるオブジェクトのプロパティを</span>\n    <span class="c1">// 参照しようとしたのでタイプエラーになる</span>\n    <span class="nx">profile</span><span class="p">.</span><span class="nx">age</span><span class="p">;</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>より強固に型安全にしたい場合はこれらに気をつけて開発するようにしてみてください。</p>\n\n<h2>\n<span id="nuxt-property-decorator" class="fragment"></span><a href="#nuxt-property-decorator"><i class="fa fa-link"></i></a><code>nuxt-property-decorator</code>\n</h2>\n\n<p><code>nuxt-property-decorator</code>は<code>nuxt-community</code>がメンテナンスを行っている<code>vue-property-decorator</code>のラッパーです。<br>\n<code>vue-property-decorator</code>の機能に加え、Nuxt独自のライフサイクルメソッドやプロパティの対応などが追加されています。</p>\n\n<p>また、<code>nuxt-property-decorator</code>には<code>vue-property-decorator</code>にない独自のデコレータが実装されています。</p>\n\n<h3>\n<span id="on--off--once" class="fragment"></span><a href="#on--off--once"><i class="fa fa-link"></i></a><code>@On</code> / <code>@Off</code> / <code>@Once</code>\n</h3>\n\n<p>Vueでは<code>this.$emit</code>したイベントを<code>this.$on</code>で検知することができます。</p>\n\n<p>以下のソースは、<code>mounted</code>時に<code>foo</code>イベントを待機させる<code>$on</code>/<code>$once</code>を仕込み、<code>onClick</code>メソッド内で<code>foo</code>イベントを発火させています。<br>\n<code>onClick</code>メソッドが実行されると、必ず<code>callback</code>メソッドも実行され、最初の１度のみ<code>onceCallback</code>メソッドも実行されます。</p>\n\n<p>また、<code>clearCallback</code>メソッドが呼ばれると<code>foo</code>イベントに対し設定されたコールバックが<code>$off</code>によって解除され、以降は発火しなくなります。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>\n<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>\n  <span class="na">name</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">SampleComponent</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>\n    <span class="c1">// fooイベントを待機</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">$on</span><span class="p">(</span><span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">callback</span><span class="p">);</span>\n    <span class="c1">// fooイベントを１度だけ待機</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">$once</span><span class="p">(</span><span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onceCallback</span><span class="p">);</span>\n  <span class="p">},</span>\n  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>\n    <span class="nx">callback</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span>\n    <span class="nx">onceCallback</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span>\n    <span class="nx">onClick</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>\n    <span class="p">},</span>\n    <span class="nx">clearCallback</span><span class="p">()</span> <span class="p">{</span>\n      <span class="k">this</span><span class="p">.</span><span class="nx">$off</span><span class="p">(</span><span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">callback</span><span class="p">);</span>\n    <span class="p">}</span>\n  <span class="p">},</span>\n<span class="p">};</span>\n<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;\n</span></code></pre></div></div>\n\n<p>これを<code>nuxt-property-decorator</code>の<code>@On</code>/<code>@Off</code>/<code>@Once</code>デコレータで書き換えると以下のようになります。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">lang</span><span class="o">=</span><span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="o">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Emit</span><span class="p">,</span> <span class="nx">On</span><span class="p">,</span> <span class="nx">Off</span><span class="p">,</span> <span class="nx">Once</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">nuxt-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="p">@</span><span class="nd">On</span><span class="p">(</span><span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="nx">callback</span><span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>\n\n  <span class="p">@</span><span class="nd">Once</span><span class="p">(</span><span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="nx">onceCallback</span><span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>\n\n  <span class="p">@</span><span class="nd">Off</span><span class="p">(</span><span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="p">,</span> <span class="dl">\'</span><span class="s1">callback</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="nx">clearCallback</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span> <span class="p">}</span>\n\n  <span class="p">@</span><span class="nd">Emit</span><span class="p">(</span><span class="dl">\'</span><span class="s1">foo</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="nx">onClick</span><span class="p">(</span><span class="nx">user</span><span class="p">:</span> <span class="nx">IUser</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>\n    <span class="k">return</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;\n</span></code></pre></div></div>\n\n<p>VueのAPIと異なるのは、<code>@Off</code>で指定するのがコールバック関数そのものではなく、その名前であるという点です。<br>\n上記の例では<code>this.callback</code>メソッドのイベントリスナを解除したいので<code>\'callback\'</code>を指定しています。</p>\n\n<h3>\n<span id="nexttick" class="fragment"></span><a href="#nexttick"><i class="fa fa-link"></i></a><code>@NextTick</code>\n</h3>\n\n<p>Vueの<code>this.$nextTick</code>メソッドは、次の処理を描画が終わってから実行するときに使用します。</p>\n\n<div class="code-frame" data-lang="vue"><div class="highlight"><pre class="with-code"><code><span class="nt">&lt;</span><span class="k">script</span> <span class="na">lang=</span><span class="s">"ts"</span><span class="nt">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Ref</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">nuxt-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="cm">/** コンテンツ */</span>\n  <span class="nx">content</span> <span class="o">=</span> <span class="dl">\'\'</span><span class="p">;</span>\n\n  <span class="cm">/** コンテンツの高さ */</span>\n  <span class="nx">contentHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>\n\n  <span class="cm">/** コンテンツの要素のRef */</span>\n  <span class="p">@</span><span class="nd">Ref</span><span class="p">(</span><span class="dl">\'</span><span class="s1">content</span><span class="dl">\'</span><span class="p">)</span> <span class="nx">contentElement</span><span class="p">:</span> <span class="nx">HTMLParagraphElement</span><span class="p">;</span>\n\n  <span class="cm">/**\n   * コンテンツの変更と高さの変更\n   * @param newContent 新しいコンテンツ\n   */</span>\n  <span class="k">async</span> <span class="nx">onChangeContent</span><span class="p">(</span><span class="nx">newContent</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">newContent</span><span class="p">;</span>\n\n    <span class="c1">// 新しいコンテンツ反映後の高さを取るため描画完了を待機</span>\n    <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">();</span>\n\n    <span class="k">this</span><span class="p">.</span><span class="nx">contentHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$ref</span><span class="p">.</span><span class="nx">contentElement</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="nt">&lt;/</span><span class="k">script</span><span class="nt">&gt;</span>\n</code></pre></div></div>\n\n<p>これが、<code>@NextTick</code>デコレータを使うと以下のようになります。</p>\n\n<p><code>@NextTick</code>デコレータは付与したメソッドの実行が完了したあとに、引数で指定したメソッドを呼ぶようにして使用します。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">lang</span><span class="o">=</span><span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="o">&gt;</span>\n<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Ref</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">,</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">\'</span><span class="s1">nuxt-property-decorator</span><span class="dl">\'</span><span class="p">;</span>\n\n<span class="p">@</span><span class="nd">Component</span>\n<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">SampleComponent</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>\n  <span class="cm">/** コンテンツ */</span>\n  <span class="nx">content</span> <span class="o">=</span> <span class="dl">\'\'</span><span class="p">;</span>\n\n  <span class="cm">/** コンテンツの高さ */</span>\n  <span class="nx">contentHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>\n\n  <span class="cm">/** コンテンツの要素のRef */</span>\n  <span class="p">@</span><span class="nd">Ref</span><span class="p">(</span><span class="dl">\'</span><span class="s1">content</span><span class="dl">\'</span><span class="p">)</span> <span class="nx">contentElement</span><span class="p">:</span> <span class="nx">HTMLParagraphElement</span><span class="p">;</span>\n\n  <span class="cm">/**\n   * コンテンツの変更と高さの変更\n   * @param newContent 新しいコンテンツ\n   */</span>\n  <span class="p">@</span><span class="nd">NextTick</span><span class="p">(</span><span class="dl">\'</span><span class="s1">updateContentHeight</span><span class="dl">\'</span><span class="p">)</span>\n  <span class="nx">onChangeContent</span><span class="p">(</span><span class="nx">newContent</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">newContent</span><span class="p">;</span>\n  <span class="p">}</span>\n\n  <span class="cm">/**\n   * コンテンツの高さを更新する\n   */</span>\n  <span class="nx">updateContentHeight</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>\n    <span class="k">this</span><span class="p">.</span><span class="nx">contentHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$ref</span><span class="p">.</span><span class="nx">contentElement</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>\n  <span class="p">}</span>\n<span class="p">}</span>\n<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;\n</span></code></pre></div></div>\n',body:"この記事はVueを勉強している段階からTypeScriptでクラスベースのVueアプリを作りたい！という方へ向けて例を交えながら[`vue-property-decorator`](https://github.com/kaorun343/vue-property-decorator)の機能を**基本**と**応用**、**上級**の３セクションに分けて説明していきます。\n\n基本では、Vueでアプリを作る上で必須となる機能を、応用では用意されている便利なデコレータを、上級では普通の開発ではほぼ使わない機能について説明します。\nとりあえずは基本のみ理解しておけば困ることはないでしょう。\n\nまた、最後に[`nuxt-property-decorator`](https://github.com/nuxt-community/nuxt-property-decorator)独自のデコレータも紹介しています。\n\n**2019/12/09 追記**：`nuxt-property-decorator`独自のデコレータの紹介を追加しました\n\n## 動作確認バージョン\n\n* [`vue-property-decorator v8.4.2`](https://github.com/kaorun343/vue-property-decorator/tree/v8.4.2)\n* [`nuxt-property-decorator v2.5.1`](https://github.com/nuxt-community/nuxt-property-decorator/tree/v2.5.1)\n  - `nuxt-property-decorator v2.7.2` で vuex-module-decorators が同梱されるようになりました（追記予定）\n\n## 基本\n\n### コンポーネントの定義\n\n`@Component`は続けて定義しているクラスをVueが認識できる形式に変換しています。\n\n以下の２つは同じ意味です。\n\n```vue\n<script>\nexport default {\n  name: 'SampleComponent'\n};\n<\/script>\n```\n\n```vue\n<script lang=\"ts\">\nimport { Component, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {}\n<\/script>\n```\n\nこの時、`vue-property-decorator`の`Vue`クラスを継承することを忘れないように気をつけてください。\n\n### Data\n\nDataはクラスのメンバーとして定義するだけで利用できます。\n\n以下のサンプルでは名前と年齢をDataに持たせています。\n\n```vue\n\n<script>\nexport default {\n  data() {\n    return {\n      name: 'simochee',\n      age: 21\n    }\n  }\n};\n<\/script>\n```\n\n```vue\n<script lang=\"ts\">\nimport { Component, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  name = 'simochee';\n  age = 21;\n}\n<\/script>\n```\n\nDataをテンプレート内で使用するときはプレーンなVueと同じように参照できます。\n\n```vue\n<template>\n  \x3c!-- simochee (21) --\x3e\n  <p>{{ name }} ({{ age }})</p>\n</template>\n```\n\n### Computed\n\n算出プロパティ（Computed）はクラスのGetterとして定義することで利用できます。\n\n以下のサンプルではDataに定義されたスコアを３倍する算出プロパティを定義しています。\n\n```vue\n<script>\nexport default {\n  data() {\n    return {\n      score: 55\n    }\n  },\n  computed: {\n    triple() {\n      return this.score * 3;\n    }\n  }\n};\n<\/script>\n```\n\n```vue\n<script lang=\"ts\">\nimport { Component, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  score = 55;\n\n  get triple() {\n    return this.score * 3;\n  }\n}\n<\/script>\n```\n\nComputedをテンプレート内で使用するときはプレーンなVueと同じように参照できます。\n\n```vue\n<template>\n  \x3c!-- Triple score: 163! --\x3e\n  <p>Triple score: {{ triple }}!</p>\n</template>\n```\n\n### メソッド\n\nメソッドはクラスのメソッドとして定義するだけで利用することができます。\n\n以下の例では、ボタンが押されたときに`onClickButton`メソッドを呼び出しています。\n\n```vue\n<template>\n  <button @click=\"onClickButton\">Click Me!</button>\n</template>\n```\n\nこのようなテンプレートがあったときの`onClickButton`は以下のように定義できます。\n\n```vue\n<script>\nexport deafult {\n  methods: {\n    onClickButton() {\n      // ボタンが押されたときの処理\n    }\n  }\n};\n<\/script>\n```\n\n```vue\n<script lang=\"ts\">\nimport { Component, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  onClickButton() {\n    // ボタンが押されたときの処理\n  }\n}\n<\/script>\n```\n\nReactのようにメソッドに`this`をバインドする必要はありません。\n\n### ライフサイクルフック\n\n[ライフサイクルフック](https://jp.vuejs.org/v2/api/#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%83%A9%E3%82%A4%E3%83%95%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB%E3%83%95%E3%83%83%E3%82%AF)は、クラスにライフサイクルの名前でメソッドを定義するだけで利用できます。\n\n```vue\n<script>\nexport default {\n  mounted() {\n    // コンポーネントがマウントされたときの処理\n  },\n  beforeDestroy() {\n    // コンポーネントが破棄される直前の処理\n  }\n}\n<\/script>\n```\n\n```vue\n<script lang=\"ts\">\nimport { Component, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  mounted() {\n    // コンポーネントがマウントされたときの処理\n  }\n\n  beforeDestroy() {\n    // コンポーネントが破棄される直前の処理\n  }\n}\n<\/script>\n```\n\n`vue-property-decorator`ではライフサイクルフックとメソッドが同じ領域で定義されるため、ライフサイクルの名前でメソッドを定義しないように注意が必要です。\n\n### `@Component`\n\n`@Component`は引数としてVueのオブジェクトを指定することができます。\n\n以降で各種デコレータを紹介しますが、そこで定義できない`components`や`filters`、`mixins`などのプロパティは`@Component`の引数として指定します。\n\n```vue\n<script>\nexport deafult {\n  components: {\n    AppButton,\n    ProductList\n  },\n  directives: {\n    resize\n  },\n  filters: {\n    dateFormat\n  },\n  mixins: [\n    PageMixin\n  ]\n};\n<\/script>\n```\n\n```vue\n<script lang=\"ts\">\nimport { Component, Vue } from 'vue-property-decorator';\n\n@Component({\n  components: {\n    AppButton,\n    ProductList\n  },\n  directives: {\n    resize\n  },\n  filters: {\n    dateFormat\n  },\n  mixins: [\n    PageMixin\n  ]\n})\nexport default class SampleComponent extends Vue {\n}\n<\/script>\n```\n\n他にも、以下のドキュメントで紹介されているプロパティを指定できます。\n\n* [オプション / データ](https://jp.vuejs.org/v2/api/#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%83%87%E3%83%BC%E3%82%BF)\n* [オプション / DOM](https://jp.vuejs.org/v2/api/#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-DOM)\n* [オプション / ライフサイクルフック](https://jp.vuejs.org/v2/api/#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%83%A9%E3%82%A4%E3%83%95%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB%E3%83%95%E3%83%83%E3%82%AF)\n* [オプション / アセット](https://jp.vuejs.org/v2/api/#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%82%A2%E3%82%BB%E3%83%83%E3%83%88)\n* [オプション / 構成](https://jp.vuejs.org/v2/api/#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E6%A7%8B%E6%88%90)\n* [オプション / その他](https://jp.vuejs.org/v2/api/#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%81%9D%E3%81%AE%E4%BB%96)\n\n### `@Prop`\n\n`@Prop`は続けて定義したメンバーを`props`として使用できるようにします。\n\n親コンポーネントからは定義したメンバー名で`props`を指定できます。\n\n```vue\n<script>\nexport deafult {\n  props: {\n    userName: {\n      type: String,\n      required: true\n    },\n    isVisible: {\n      type: Boolean,\n      default: false\n    }\n  }\n};\n<\/script>\n```\n\n```vue\n<script lang=\"ts\">\nimport { Component, Prop, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  @Prop({ type: String, required: true })\n  userName: string;\n\n  @Prop({ type: Boolean, defualt: false })\n  isVisible: boolean;\n}\n<\/script>\n```\n\n`@Prop`の引数には`props`で指定可能なオプションがすべて指定できます。\n\n* [props](https://jp.vuejs.org/v2/api/#props)\n\n### `@Watch`\n\n`@Watch`は第１引数に監視したい値へのパスを、第２引数にウォッチャのオプションを指定できます。\n\n以下のサンプルでは単一のDataとObjectのプロパティの値を監視するメソッドを定義しています。\n\nなお、`immediate: true`はコンポーネント初期化時にも処理を実行するかを指定するオプションです。\n\n```vue\n<script>\nexport deafult {\n  data() {\n    isLoading: false,\n    profile: {\n      name: 'simochee',\n      age: 21\n    }\n  },\n  watch: {\n    isLoading() {\n      // ローディング状態が切り替わったときの処理\n    },\n    'profile.age': {\n      handler: function() {\n        // プロフィールの年齢が変更されたときの処理\n      },\n      immediate: true\n    } \n  }\n};\n<\/script>\n```\n\n```vue\n<script lang=\"ts\">\nimport { Component, Watch, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  isLoading = false;\n  profile = {\n    name: 'simochee',\n    age: 21\n  };\n\n  @Watch('isLoading')\n  onChangeLoadingStatus() {\n    // ローディング状態が切り替わったときの処理\n  }\n\n  @Watch('profile.age', { immediate: true })\n  onChangeProfileAge() {\n    // プロフィールの年齢が変更されたときの処理\n  }\n}\n<\/script>\n```\n\nVueの仕様からも分かる通り、`@Watch`は同じパスに対して複数回指定することはできません。\n複数回指定された場合は後勝ちとなるため、先に定義したウォッチャは実行されません。\n\n## 応用\n\n### `@PropSync`\n\nVue.jsでは`props`を指定する際に`.sync`修飾子を付与することで、子コンポーネントから親コンポーネントの値を変更することができるようになります。\n\n仕組みとしては、`@update:<Prop名>`というイベントを受け取ったらDataに代入するという処理を暗黙的に行っています。\n\n```vue\n// 親コンポーネント\n<template>\n  \x3c!-- 以下の２つは同じ意味 --\x3e\n  <ChildComponent\n　  :childValue.sync=\"value\"\n  />\n  <ChildComponent\n    :childValue=\"value\"\n    @update:childValue=\"value = $event\"\n  />\n</template>\n```\n\nこのとき、子コンポーネント以降で`.sync`プロパティをバケツリレーする際に便利なのが`@PropSync`デコレータです。\n\nこのデコレータを使用しない場合は、以下のように書かなければいけませんでした。\n\n```vue\n// 子コンポーネント\n<script lang=\"ts\">\nimport { Component, Prop, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  @Prop({ type: String })\n  childValue: string;\n\n  // value を変更したいときに呼び出す\n  updateValue(newValue) {\n    this.$emit('update:childValue', newValue);\n  }\n}\n<\/script>\n```\n\nこれが、`@PropSync`で定義した場合はメンバーへ値を代入するだけで同等の処理を実現することができます。\n\n```vue\n<script lang=\"ts\">\nimport { Component, PropSync, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  @PropSync({ type: String })\n  childValue: string;\n\n  // value を変更したいときに呼び出す\n  updateValue(newValue) {\n    this.childValue = newValue\n  }\n}\n<\/script>\n```\n\n代入するだけで値の変更を通知できるため、さらに`.sync`で孫コンポーネントへ値を渡す場合なども、とてもシンプルに書くことができます。\n\n```vue\n<template>\n  <SunComponent\n    :sunValue.sync=\"childValue\"\n  />\n</template>\n```\n\n### `@Emit`\n\nVueではコンポーネント間での値を双方向にやり取りすることができます。\n\n親から子への値渡しはPropを指定することで行い、子から親への値渡しはイベントを通知することによってアクションや値を受け渡せるようになっています。\n\nこのとき、子から親へ値を渡すときのイベントを発行するのが`$emit`メソッドです。\n\n以下のサンプルでは子コンポーネントで送信処理が行われたこと`submit`イベントとして親コンポーネントへ通知し、受け取った値を元に親コンポーネント側でリクエストを送信しています。\n\n```vue\n// 子コンポーネント\n<template>\n  <form @submit=\"onSubmit\">\n    <input v-model=\"value\">\n    <button type=\"submit\">Submit</button>\n  </submit>\n</template>\n\n<script lang=\"ts\">\nimport { Component, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class ChildComponent extends Vue {\n  value = '';\n\n  // 値を送信する処理\n  onSubmit() {\n    this.$emit('submit', this.value);\n  }\n}\n<\/script>\n```\n\n```vue\n// 親コンポーネント\n<template>\n  <ChildComponent\n    @submit=\"onReceiveSubmit\"\n  />\n</template>\n\n<script lang=\"ts\">\nimport { Component, Vue } from 'vue-property-decorator';\nimport ChildComponent from './ChildComponent.vue';\n\n@Component({\n  components: {\n    ChildComponent\n  }\n})\nexport default class ParentComponent extends Vue {\n  async onReceiveSubmit(newValue: string) {\n    // $emitでの第２引数を受け取ることができる\n    await this.$request.post(newValue);\n  }\n}\n<\/script>\n```\n\n`@Emit`では`$emit`の処理を事前に定義することができます。\n\nイベント名は`@Emit`の第１引数に明示的に指定するか、省略した場合は続けて定義しているメソッド名が利用されます。\n\nまた、メソッドで値を返却すれば`$emit`でその値を送ることもできます。\n\n上記のサンプルの子コンポーネントを`@Emit`で書き換えると以下のようになります。\n\n```vue\n<template>\n  <form @submit=\"submit\">\n    <input v-model=\"value\">\n    <button type=\"submit\">Submit</button>\n  </submit>\n</template>\n\n<script lang=\"ts\">\nimport { Component, Emit, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class ChildComponent extends Vue {\n  value = '';\n\n  // 値を送信する処理\n  // イベント名を指定しない場合でも () は省略できない\n  @Emit()\n  submit() {\n    return this.value;\n  }\n}\n<\/script>\n```\n\nこの他に、`@Emit`を非同期メソッドへ設定することもできます。\n\nなお、キャメルケースでイベント名、メソッド名を指定した場合、親コンポーネントで受け取る際にはケバブケースへ変換されますので注意が必要です。\n\n```ts\n// 子コンポーネント\n@Emit()\nsubmitForm() {}\n```\n\n```vue\n// 親コンポーネント\n<ChildComponent\n  @submit-form=\"onSubmit\"\n  @submitForm=\"onSubmit\" // 発火しない\n/>\n```\n\n親コンポーネントでケバブケースのイベントを受け取りたい場合は、デコレータの引数にイベント名を指定する必要があります。\n\n```ts\n// 子コンポーネント\n@Emit('submitForm')\nsubmitForm() {}\n```\n\n### `@Ref`\n\n`@Ref`は`$refs`で参照できる要素、コンポーネントの型を定義します。\n事前に定義しておくことでタイポや変更へ対応しやすくなります。\n\n```vue\n<template>\n  <ChildComponent ref=\"childComponent\" />\n  <button ref=\"submitButton\">Submit</button>\n</template>\n\n<script lang=\"ts\">\nimport { Component, Vue } from 'vue-property-decorator';\nimport ChildComponent from '@/component/ChildComponent.vue';\n\n@Component({\n  components: {\n    ChildComponent\n  }\n});\nexport default class SampleComponent extends Vue {\n  @Ref() childComponent: ChildComponent;\n  @Ref() submitButton: HTMLButtonElement;\n\n  mounted() {\n    // 子コンポーネントのメソッドを実行する\n    this.childComponent.updateValue();\n\n    // ボタンをフォーカスする\n    this.submitButton.focus();\n  }\n}\n<\/script>\n```\n\n## 上級\n\n以降は上級者向けのため、あまり詳しく記載しません。必要であれば公式ドキュメントなどを参照してください。\n\n### `@Model`\n\nVueのModelを定義します。VueではModelを指定する際にPropも定義しそちらに型情報などを記載しなければいけませんでしたが、デコレータでは`@Model`に併せて定義できます。\n\n> [Vue.js公式ドキュメント#model](https://jp.vuejs.org/v2/api/#model)\n\n以下の２つは同じ意味です。\n\n```vue\n<script>\nexport deafult {\n  props: {\n    value: {\n      type: String,\n      required: true\n    }\n  },\n  model: {\n    prop: 'value',\n    event: 'update'\n  }\n};\n<\/script>\n```\n\n```vue\n<script lang=\"ts\">\nimport { Component, Model, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  @Model('update', { type: String, required: true })\n  value: string;\n}\n<\/script>\n```\n\nこのとき、暗黙的に`value`がPropとして定義されるため`value`という`data`や`methods`は定義できません。\n\n### `@Provide` / `@Inject`\n\nVueでは親で`provide`として定義した値をその子要素（親子でなくても良い）から`inject`で参照することができます。\n\n> [Vue.js公式ドキュメント#inject/provide](https://jp.vuejs.org/v2/api/#provide-inject)\n\n以下の２つは同じ意味です。\n\n```vue\n\x3c!-- Parent.vue --\x3e\n<script>\nexport deafult {\n  provide: {\n    foo: 'foo',\n    bar: 'bar'\n  }\n};\n<\/script>\n\n\x3c!-- Child.vue --\x3e\n<script>\nexport deafult {\n  inject: {\n    foo: 'foo',\n    bar: 'bar',\n    optional: { from: 'optional', default: 'default' }\n  }\n};\n<\/script>\n```\n\n```vue\n\x3c!-- Parent.vue --\x3e\n<script lang=\"ts\">\nimport { Component, Provide, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class ParentComponent extends Vue {\n  @Provide() foo = 'foo';\n  @Provide('bar') baz = 'bar';\n}\n<\/script>\n\n\x3c!-- Child.vue --\x3e\n<script lang=\"ts\">\nimport { Component, Inject, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class ChildComponent extends Vue {\n  @Inject() foo: string;\n  @Inject('bar') bar: string;\n  @Inject({ from: 'optional', default: 'default' }) optional: string;\n  @Inject(symbol) baz: string;\n}\n<\/script>\n```\n\n### `@ProvideReactive` / `@ProvideInject`\n\n`@Provide` / `@Inject`の拡張です。親コンポーネントから`@ProvideReactive`として提供された値の変更を子コンポーネントでキャッチできるようになります。\n\n```vue\n\x3c!-- Parent.vue --\x3e\n<script lang=\"ts\">\nimport { Component, ProvideReactive, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class ParentComponent extends Vue {\n  @ProvideReactive() foo = 'foo';\n}\n<\/script>\n\n\x3c!-- Child.vue --\x3e\n<script lang=\"ts\">\nimport { Component, InjectReactive, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class ChildComponent extends Vue {\n  @InjectReactive() foo: string;\n}\n<\/script>\n```\n\n### `readonly`と`!`、`?`について\n\n`vue-property-decorator`のサンプルコードでは`readonly`や`prop!: String`のような`!`が登場しています。\n\nこれらはいずれもTypeScriptの機能です。\n\n`readonly`修飾子は、メンバー変数を読み込み専用とするためのものです。\nVueではProp、Modelへの直接の代入はエラーとなります。\n\n誤った代入を事前に防ぐために`@Prop`および`@Model`で定義したメンバー変数へは`readonly`修飾子を付与することをおすすめします。\n\n```vue\n<script lang=\"ts\">\nimport { Component, Prop, PropSync, Watch, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  @Prop({ type: String }) readonly name: string;\n  @Model('update', { type: Object }) readonly profile: IProfile;\n  @PropSync({ type: String }) value: string; // 代入可能\n}\n<\/script>\n```\n\nまた、デコレータで定義されたすべてのメンバー変数についている`!`は [NonNullAssertionオペレータ](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-0.html#non-null-assertion-operator) と呼ばれる機能です。\n`!`がついたプロパティがNull/Undefinedではないことを明示します。\n\nただし、`!`は`required: true`またはデフォルト値が設定されているプロパティにのみ指定することをおすすめします。\n逆に、必須項目でなくデフォルト値も指定されていない場合は、`?`を指定することをおすすめします。\n\nこの`?`はプロパティが任意項目であり、`undefined`の可能性があることを明示します。\n\n```vue\n<script lang=\"ts\">\nimport { Component, Prop, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  @Prop({ type: String, required: true })\n  readonly name!: string;\n\n  @Prop({ type: Array, default: () => [] })\n  readonly items!: string[];\n\n  @Prop({ type: Object });\n  readonly profile?: IProfile;\n\n  mounted() {\n    // undefinedの可能性のあるオブジェクトのプロパティを\n    // 参照しようとしたのでタイプエラーになる\n    profile.age;\n  }\n}\n<\/script>\n```\n\nより強固に型安全にしたい場合はこれらに気をつけて開発するようにしてみてください。\n\n## `nuxt-property-decorator`\n\n`nuxt-property-decorator`は`nuxt-community`がメンテナンスを行っている`vue-property-decorator`のラッパーです。\n`vue-property-decorator`の機能に加え、Nuxt独自のライフサイクルメソッドやプロパティの対応などが追加されています。\n\nまた、`nuxt-property-decorator`には`vue-property-decorator`にない独自のデコレータが実装されています。\n\n### `@On` / `@Off` / `@Once`\n\nVueでは`this.$emit`したイベントを`this.$on`で検知することができます。\n\n以下のソースは、`mounted`時に`foo`イベントを待機させる`$on`/`$once`を仕込み、`onClick`メソッド内で`foo`イベントを発火させています。\n`onClick`メソッドが実行されると、必ず`callback`メソッドも実行され、最初の１度のみ`onceCallback`メソッドも実行されます。\n\nまた、`clearCallback`メソッドが呼ばれると`foo`イベントに対し設定されたコールバックが`$off`によって解除され、以降は発火しなくなります。\n\n```ts\n<script>\nexport default {\n  name: 'SampleComponent',\n  created() {\n    // fooイベントを待機\n    this.$on('foo', this.callback);\n    // fooイベントを１度だけ待機\n    this.$once('foo', this.onceCallback);\n  },\n  methods: {\n    callback(name) { ... },\n    onceCallback(name) { ... },\n    onClick(user) {\n      this.$emit('foo', user.name);\n    },\n    clearCallback() {\n      this.$off('foo', this.callback);\n    }\n  },\n};\n<\/script>\n```\n\nこれを`nuxt-property-decorator`の`@On`/`@Off`/`@Once`デコレータで書き換えると以下のようになります。\n\n```ts\n<script lang=\"ts\">\nimport { Component, Emit, On, Off, Once, Vue } from 'nuxt-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  @On('foo')\n  callback(name: string): void { ... }\n\n  @Once('foo')\n  onceCallback(name: string): void { ... }\n\n  @Off('foo', 'callback')\n  clearCallback(): void { }\n\n  @Emit('foo')\n  onClick(user: IUser): string {\n    return user.name;\n  }\n}\n<\/script>\n```\n\nVueのAPIと異なるのは、`@Off`で指定するのがコールバック関数そのものではなく、その名前であるという点です。\n上記の例では`this.callback`メソッドのイベントリスナを解除したいので`'callback'`を指定しています。\n\n### `@NextTick`\n\nVueの`this.$nextTick`メソッドは、次の処理を描画が終わってから実行するときに使用します。\n\n```vue\n<script lang=\"ts\">\nimport { Component, Ref, Watch, Vue } from 'nuxt-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  /** コンテンツ */\n  content = '';\n\n  /** コンテンツの高さ */\n  contentHeight = 0;\n\n  /** コンテンツの要素のRef */\n  @Ref('content') contentElement: HTMLParagraphElement;\n\n  /**\n   * コンテンツの変更と高さの変更\n   * @param newContent 新しいコンテンツ\n   */\n  async onChangeContent(newContent: string): Promise<void> {\n    this.content = newContent;\n\n    // 新しいコンテンツ反映後の高さを取るため描画完了を待機\n    await this.$nextTick();\n\n    this.contentHeight = this.$ref.contentElement.clientHeight;\n  }\n}\n<\/script>\n```\n\nこれが、`@NextTick`デコレータを使うと以下のようになります。\n\n`@NextTick`デコレータは付与したメソッドの実行が完了したあとに、引数で指定したメソッドを呼ぶようにして使用します。\n\n```ts\n<script lang=\"ts\">\nimport { Component, Ref, Watch, Vue } from 'nuxt-property-decorator';\n\n@Component\nexport default class SampleComponent extends Vue {\n  /** コンテンツ */\n  content = '';\n\n  /** コンテンツの高さ */\n  contentHeight = 0;\n\n  /** コンテンツの要素のRef */\n  @Ref('content') contentElement: HTMLParagraphElement;\n\n  /**\n   * コンテンツの変更と高さの変更\n   * @param newContent 新しいコンテンツ\n   */\n  @NextTick('updateContentHeight')\n  onChangeContent(newContent: string): void {\n    this.content = newContent;\n  }\n\n  /**\n   * コンテンツの高さを更新する\n   */\n  updateContentHeight(): void {\n    this.contentHeight = this.$ref.contentElement.clientHeight;\n  }\n}\n<\/script>\n```\n",coediting:a,comments_count:2,created_at:"2019-06-27T19:55:13+09:00",group:s,id:"e5b77af4aa36bd0f32e5",likes_count:473,private:a,reactions_count:0,tags:[{name:f,versions:[]},{name:v,versions:[]},{name:y,versions:[]},{name:B,versions:[]},{name:"nuxt-property-decorator",versions:[]}],title:"はじめてのvue-property-decorator (nuxtにも対応）",updated_at:"2020-06-05T22:41:37+09:00",url:"https://qiita.com/simochee/items/e5b77af4aa36bd0f32e5",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s},{rendered_body:'<p>TypeScriptって魔法ではなく「手法」さえ覚えれば自作するのも夢じゃない。</p>\n\n<blockquote>\n<p>気合の入った成果物： <a href="https://www.npmjs.com/package/@lollipop-onl/vuex-typesafe-helper" rel="nofollow noopener" target="_blank">@lollipop-onl/vuex-typesafe-helper</a></p>\n</blockquote>\n\n<p>（微妙に実装不備アリ）</p>\n\n<h1>\n<span id="demo" class="fragment"></span><a href="#demo"><i class="fa fa-link"></i></a>Demo</h1>\n\n<p>TypeScript Playgroundで動作を確認できます。</p>\n\n<p><a href="http://www.typescriptlang.org/play/#src=const%20actions%20%3D%20%7B%0D%0A%20%20%20%20async%20login(%7B%20commit%20%7D%2C%20payload%3A%20%7B%20id%3A%20string%2C%20password%3A%20string%20%7D)%3A%20Promise%3Cvoid%3E%20%7B%20%7D%2C%0D%0A%20%20%20%20async%20joinRoom(%7B%20commit%20%7D%2C%20payload%3A%20%7B%20roomId%3A%20string%20%7D)%3A%20Promise%3Cvoid%3E%20%7B%20%7D%2C%0D%0A%20%20%20%20async%20leaveRoom(%7B%20commit%20%7D%2C%20payload%3A%20%7B%7D)%3A%20Promise%3Cvoid%3E%20%7B%20%7D%0D%0A%7D%3B%0D%0A%0D%0Atype%20BaseStoreModule%20%3D%20Record%3Cstring%2C%20(...args%3A%20any%5B%5D)%20%3D%3E%20any%3E%3B%0D%0Atype%20Payload%3CF%20extends%20(...args%3A%20any)%20%3D%3E%20any%3E%20%3D%20F%20extends%20(ctx%2C%20payload%3A%20infer%20P)%20%3D%3E%20any%0D%0A%20%20%3F%20P%0D%0A%20%20%3A%20never%3B%0D%0Atype%20DefineActions%3CActions%20extends%20BaseStoreModule%3E%20%3D%20%7B%0D%0A%20%20%3CK%20extends%20keyof%20Actions%3E(type%3A%20K%2C%20payload%3A%20Payload%3CActions%5BK%5D%3E)%3A%20ReturnType%3CActions%5BK%5D%3E%3B%0D%0A%7D%3B%0D%0A%0D%0Atype%20Dispatch%20%3D%20DefineActions%3Ctypeof%20actions%3E%3B%0D%0A%0D%0Adeclare%20var%20dispatch%3A%20Dispatch%3B%0D%0A%0D%0Adispatch(\'login\'%2C%20%7B%20id%3A%20\'simochee\'%2C%20password%3A%20\'abcd1234\'%20%7D)%3B%0D%0Adispatch(\'logout\'%2C%20%7B%7D)%3B%0D%0Adispatch(\'joinRoom\'%2C%20%7B%20roomId%3A%20100%20%7D)%3B%0D%0A" rel="nofollow noopener" target="_blank">Demo</a></p>\n\n<h1>\n<span id="開発環境" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>開発環境</h1>\n\n<p>IDE (VS Code)</p>\n\n<h1>\n<span id="デバッグ方法" class="fragment"></span><a href="#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>デバッグ方法</h1>\n\n<p>IDEでの型推論</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kr">declare</span> <span class="kd">var</span> <span class="nx">dispatch</span><span class="p">:</span> <span class="nx">Dispatch</span><span class="p">;</span>\n\n<span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">login</span><span class="dl">\'</span><span class="p">,</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">simochee</span><span class="dl">\'</span><span class="p">,</span> <span class="na">password</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">abcd1234</span><span class="dl">\'</span> <span class="p">});</span>\n</code></pre></div></div>\n\n<h1>\n<span id="vuexのactionをタイプセーフにする" class="fragment"></span><a href="#vuex%E3%81%AEaction%E3%82%92%E3%82%BF%E3%82%A4%E3%83%97%E3%82%BB%E3%83%BC%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>VuexのActionをタイプセーフにする</h1>\n\n<h2>\n<span id="やりたいこと" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>やりたいこと</h2>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// store/chat.ts</span>\n<span class="kd">const</span> <span class="nx">actions</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="nx">login</span><span class="p">({</span> <span class="nx">commit</span> <span class="p">},</span> <span class="na">payload</span><span class="p">:</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="na">password</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span> <span class="p">{},</span>\n  <span class="nx">joinRoom</span><span class="p">({</span> <span class="nx">commit</span> <span class="p">},</span> <span class="na">payload</span><span class="p">:</span> <span class="p">{</span> <span class="na">roomId</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{},</span>\n  <span class="nx">leaveRoom</span><span class="p">({</span> <span class="nx">commit</span> <span class="p">},</span> <span class="na">payload</span><span class="p">:</span> <span class="p">{}):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span>\n<span class="p">};</span>\n\n<span class="kd">type</span> <span class="nx">Dispatch</span> <span class="o">=</span> <span class="nx">DefineAction</span><span class="o">&lt;</span><span class="k">typeof</span> <span class="nx">actions</span><span class="p">,</span> <span class="p">{</span>\n  <span class="dl">\'</span><span class="s1">chat/login</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">login</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="dl">\'</span><span class="s1">chat/joinRoom</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">joinRoom</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="dl">\'</span><span class="s1">chat/leaveRoom</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">leaveRoom</span><span class="dl">\'</span>\n<span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>\n</code></pre></div></div>\n\n<p>と定義したものを</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">chat/login</span><span class="dl">\'</span><span class="p">,</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">simochee</span><span class="dl">\'</span><span class="p">,</span> <span class="na">password</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">abcd1234</span><span class="dl">\'</span> <span class="p">});</span> <span class="c1">// returns Promise&lt;boolean&gt;</span>\n<span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">chat/joinRoom</span><span class="dl">\'</span><span class="p">,</span> <span class="p">{</span> <span class="p">});</span> <span class="c1">// payload error!</span>\n<span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">chat/leave</span><span class="dl">\'</span><span class="p">);</span> <span class="c1">// action name type error!</span>\n</code></pre></div></div>\n\n<p>みたく使えるよう正しいアクション名にマッピングするような<code>DefineActions</code>の定義を行う。</p>\n\n<h2>\n<span id="実装方針" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E6%96%B9%E9%87%9D"><i class="fa fa-link"></i></a>実装方針</h2>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kd">type</span> <span class="nx">Dispatch</span><span class="o">=</span> <span class="nx">DefineAction</span><span class="o">&lt;</span><span class="k">typeof</span> <span class="nx">actions</span><span class="p">,</span> <span class="p">{</span>\n  <span class="dl">\'</span><span class="s1">login</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">chat/login</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="dl">\'</span><span class="s1">joinRoom</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">chat/joinRoom</span><span class="dl">\'</span><span class="p">,</span>\n  <span class="dl">\'</span><span class="s1">leaveRoom</span><span class="dl">\'</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">chat/leaveRoom</span><span class="dl">\'</span>\n<span class="p">};</span>\n</code></pre></div></div>\n\n<p>ジェネリクスでアクションオブジェクトの型とマッピングするイベント名のペアを渡す。</p>\n\n<h5>\n<span id="ジェネリック" class="fragment"></span><a href="#%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AA%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>ジェネリック</h5>\n\n<p>関数の型（超適当）</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// 基本的には &lt;&gt; の中に名前を入れていく</span>\n<span class="kd">type</span> <span class="nx">PickValue</span><span class="o">&lt;</span><span class="nx">Obj</span><span class="p">,</span> <span class="nx">Key</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">Obj</span><span class="p">[</span><span class="nx">Key</span><span class="p">];</span>\n<span class="c1">// extends を使うとジェネリックの型を指定できる</span>\n<span class="kd">type</span> <span class="nx">PickValue</span><span class="o">&lt;</span><span class="nx">Obj</span> <span class="kd">extends</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">Key</span> <span class="kd">extends</span> <span class="kr">string</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">Obj</span><span class="p">[</span><span class="nx">Key</span><span class="p">];</span>\n<span class="c1">// = を使うと初期値を設定できる。ただし、型は確定しない</span>\n<span class="c1">// 初期値が設定されている場合のみ、ジェネリックの指定を省略できる</span>\n<span class="kd">type</span> <span class="nx">PickValue</span><span class="o">&lt;</span><span class="nx">Obj</span> <span class="kd">extends</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">Key</span> <span class="o">=</span> <span class="dl">\'</span><span class="s1">default</span><span class="dl">\'</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">Obj</span><span class="p">[</span><span class="nx">Key</span><span class="p">];</span>\n</code></pre></div></div>\n\n<h5>\n<span id="typeof" class="fragment"></span><a href="#typeof"><i class="fa fa-link"></i></a>typeof</h5>\n\n<p>JavaScriptの世界の値を型の世界の値に変換する。<br>\nただし、JavaScriptでの<code>typeof</code>とはちょっと挙動が違う。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kd">const</span> <span class="nx">obj1</span> <span class="o">=</span> <span class="p">{</span> <span class="na">hello</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">world</span><span class="dl">\'</span> <span class="p">};</span>\n<span class="kd">const</span> <span class="nx">obj2</span><span class="p">:</span> <span class="nx">object</span> <span class="o">=</span> <span class="p">{</span> <span class="na">hello</span><span class="p">:</span> <span class="dl">\'</span><span class="s1">world</span><span class="dl">\'</span> <span class="p">};</span>\n\n<span class="kd">const</span> <span class="nx">objType2</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">obj1</span><span class="p">;</span> <span class="c1">// Object</span>\n<span class="kd">const</span> <span class="nx">objType2</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">obj2</span><span class="p">;</span> <span class="c1">// Object</span>\n\n<span class="kd">type</span> <span class="nx">ObjType1</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">obj</span><span class="p">;</span> <span class="c1">// { \'hello\': \'world\' };</span>\n <span class="kd">type</span> <span class="nx">ObjType2</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">obj</span><span class="p">;</span> <span class="c1">// object</span>\n</code></pre></div></div>\n\n<h2>\n<span id="step-1-ベースの型を作る" class="fragment"></span><a href="#step-1-%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E5%9E%8B%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>Step 1. ベースの型を作る</h2>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="nx">login</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">payload</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">;</span>\n<span class="err">↓</span>\n<span class="nx">dispatch</span><span class="p">(</span><span class="dl">\'</span><span class="s1">login</span><span class="dl">\'</span><span class="p">,</span> <span class="nx">payload</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kd">type</span> <span class="nx">BaseStoreModule</span> <span class="o">=</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="kr">any</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="kr">any</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>\n<span class="kd">type</span> <span class="nx">DefineActions</span><span class="o">&lt;</span><span class="nx">Actions</span> <span class="kd">extends</span> <span class="nx">BaseStoreModule</span><span class="p">,</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">string</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="p">{};</span>\n</code></pre></div></div>\n\n<h5>\n<span id="record" class="fragment"></span><a href="#record"><i class="fa fa-link"></i></a>Record</h5>\n\n<p>オブジェクトのキーと値の型を定義する。<code>{ [key: string]: string }</code>と<code>Record&lt;string, string&gt;</code>は同義。</p>\n\n<h2>\n<span id="step-2-アクション名をdispatchにマッピングする" class="fragment"></span><a href="#step-2-%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E5%90%8D%E3%82%92dispatch%E3%81%AB%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Step 2. アクション名をdispatchにマッピングする</h2>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kd">type</span> <span class="nx">DefineActions</span><span class="o">&lt;</span><span class="nx">Actions</span> <span class="kd">extends</span> <span class="nx">BaseStoreModule</span><span class="p">,</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">string</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="o">&lt;</span><span class="nx">K</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">Actions</span><span class="o">&gt;</span><span class="p">(</span><span class="na">type</span><span class="p">:</span> <span class="nx">K</span><span class="p">):</span> <span class="nx">ReturnType</span><span class="o">&lt;</span><span class="nx">Actions</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>\n<span class="p">};</span>\n</code></pre></div></div>\n\n<h5>\n<span id="keyof-a" class="fragment"></span><a href="#keyof-a"><i class="fa fa-link"></i></a>keyof A</h5>\n\n<p>オブジェクトAのキーを取り出す。<br>\n上記の場合、<code>type: K</code>は<code>keyof Actions</code>を継承しているので<code>login</code>、<code>joinRoom</code>または<code>leaveRoom</code>のいずれかとなる。</p>\n\n<h5>\n<span id="returntype" class="fragment"></span><a href="#returntype"><i class="fa fa-link"></i></a>ReturnType</h5>\n\n<p>関数の返り値を返す。</p>\n\n<h2>\n<span id="step-3-アクションからペイロードを取り出す" class="fragment"></span><a href="#step-3-%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%8B%E3%82%89%E3%83%9A%E3%82%A4%E3%83%AD%E3%83%BC%E3%83%89%E3%82%92%E5%8F%96%E3%82%8A%E5%87%BA%E3%81%99"><i class="fa fa-link"></i></a>Step 3. アクションからペイロードを取り出す</h2>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="k">export</span> <span class="kd">type</span> <span class="nx">Payload</span><span class="o">&lt;</span><span class="nx">F</span> <span class="kd">extends</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">F</span> <span class="kd">extends</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">payload</span><span class="p">:</span> <span class="nx">infer</span> <span class="nx">P</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span>\n  <span class="p">?</span> <span class="nx">P</span>\n  <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n</code></pre></div></div>\n\n<h5>\n<span id="a-extends-b--c--d" class="fragment"></span><a href="#a-extends-b--c--d"><i class="fa fa-link"></i></a>A extends B ? C : D</h5>\n\n<p>型の三項演算子。</p>\n\n<h5>\n<span id="infer-p" class="fragment"></span><a href="#infer-p"><i class="fa fa-link"></i></a>infer P</h5>\n\n<p>暫定的な型を使い回せるようにする。ただし、extendsの条件部に仕込む必要があり、型は二項目でのみ参照できる。</p>\n\n<h2>\n<span id="step-4-payloadをdispatchの引数として指定する" class="fragment"></span><a href="#step-4-payload%E3%82%92dispatch%E3%81%AE%E5%BC%95%E6%95%B0%E3%81%A8%E3%81%97%E3%81%A6%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Step 4. PayloadをDispatchの引数として指定する</h2>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kd">type</span> <span class="nx">DefineActions</span><span class="o">&lt;</span><span class="nx">Actions</span> <span class="kd">extends</span> <span class="nx">BaseStoreModule</span><span class="p">,</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">string</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="o">&lt;</span><span class="nx">K</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">Actions</span><span class="o">&gt;</span><span class="p">(</span><span class="na">type</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">Payload</span><span class="o">&lt;</span><span class="nx">Actions</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">ReturnType</span><span class="o">&lt;</span><span class="nx">Actions</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>\n<span class="p">};</span>\n</code></pre></div></div>\n\n<h2>\n<span id="step-5-namespace付きのアクション名にマッピングする" class="fragment"></span><a href="#step-5-namespace%E4%BB%98%E3%81%8D%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E5%90%8D%E3%81%AB%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Step 5. Namespace付きのアクション名にマッピングする</h2>\n\n<p>いまのところ、<code>dispatch(\'login\', payload)</code>となっているので、<code>dispatch(\'chat/login\', payload)</code>となるようにアクション名をマッピングする。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kd">type</span> <span class="nx">MapActions</span><span class="o">&lt;</span><span class="nx">A</span> <span class="kd">extends</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">any</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">string</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">A</span><span class="p">]:</span> <span class="nx">A</span><span class="p">[</span><span class="nx">P</span><span class="p">[</span><span class="nx">K</span><span class="p">]];</span>\n<span class="p">};</span>\n</code></pre></div></div>\n\n<h5>\n<span id="k-in-keyof-p-" class="fragment"></span><a href="#k-in-keyof-p-"><i class="fa fa-link"></i></a>[K in keyof P]: ...</h5>\n\n<p><code>P</code>のキーでマッピングを行う。<code>Array.map</code>的な。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// ObjのすべてのプロパティをString型にする</span>\n<span class="kd">type</span> <span class="nx">Obj</span> <span class="o">=</span> <span class="p">{</span> <span class="na">hello</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="na">world</span><span class="p">:</span> <span class="kr">number</span> <span class="p">};</span>\n<span class="kd">type</span> <span class="nx">StrObj</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">Obj</span><span class="p">]:</span> <span class="kr">string</span><span class="p">;</span>\n<span class="p">};</span>\n</code></pre></div></div>\n\n<h2>\n<span id="step-x-payloadの未指定に対応する" class="fragment"></span><a href="#step-x-payload%E3%81%AE%E6%9C%AA%E6%8C%87%E5%AE%9A%E3%81%AB%E5%AF%BE%E5%BF%9C%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Step X. Payloadの未指定に対応する</h2>\n\n<p>Payloadを省略可能にしようとするととたんに実装がめんどくさくなる。</p>\n\n<h3>\n<span id="before" class="fragment"></span><a href="#before"><i class="fa fa-link"></i></a>Before</h3>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// ペイロードがあるプロパティのキーを取り出す</span>\n<span class="kd">type</span> <span class="nx">DefineActions</span><span class="o">&lt;</span><span class="nx">Actions</span> <span class="kd">extends</span> <span class="nx">BaseStoreModule</span><span class="p">,</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">string</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="o">&lt;</span><span class="nx">K</span> <span class="kd">extends</span> <span class="kr">keyof</span> <span class="nx">Actions</span><span class="o">&gt;</span><span class="p">(</span><span class="na">type</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">Payload</span><span class="o">&lt;</span><span class="nx">Actions</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">ReturnType</span><span class="o">&lt;</span><span class="nx">Actions</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>\n<span class="p">};</span>\n</code></pre></div></div>\n\n<h3>\n<span id="after" class="fragment"></span><a href="#after"><i class="fa fa-link"></i></a>After</h3>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// オブジェクトの値を返す型</span>\n<span class="kd">type</span> <span class="nx">Values</span><span class="o">&lt;</span><span class="nx">P</span> <span class="kd">extends</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">any</span><span class="p">,</span> <span class="kr">any</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="p">{</span> <span class="p">[</span><span class="na">key</span><span class="p">:</span> <span class="kr">any</span><span class="p">]:</span> <span class="nx">infer</span> <span class="nx">V</span> <span class="p">}</span> <span class="p">?</span> <span class="nx">V</span> <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// ペイロードのあるプロパティのキーを取り出す</span>\n<span class="kd">type</span> <span class="nx">PickKeyWithPayload</span><span class="o">&lt;</span><span class="nx">P</span> <span class="kd">extends</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span><span class="o">&gt;</span>\n  <span class="p">?</span> <span class="nx">Values</span><span class="o">&lt;</span><span class="p">{</span>\n      <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">P</span><span class="p">]:</span> <span class="nx">P</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span> <span class="kd">extends</span> <span class="p">(</span><span class="na">context</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span> <span class="p">?</span> <span class="kc">undefined</span> <span class="p">:</span> <span class="nx">K</span>\n    <span class="p">}</span><span class="o">&gt;</span>\n  <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// ペイロードがない or オプショナルなプロパティのキーを取り出す</span>\n<span class="kd">type</span> <span class="nx">PickKeyWithoutPayload</span><span class="o">&lt;</span><span class="nx">P</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span><span class="o">&gt;</span>\n  <span class="p">?</span> <span class="nx">Values</span><span class="o">&lt;</span><span class="p">{</span>\n      <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">P</span><span class="p">]:</span> <span class="nx">P</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span> <span class="kd">extends</span> <span class="p">(</span><span class="na">context</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span> <span class="p">?</span> <span class="nx">K</span> <span class="p">:</span> <span class="kc">undefined</span>\n    <span class="p">}</span><span class="o">&gt;</span>\n  <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n</code></pre></div></div>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="kd">type</span> <span class="nx">DefineActions</span><span class="o">&lt;</span><span class="nx">Actions</span> <span class="kd">extends</span> <span class="nx">BaseStoreModule</span><span class="p">,</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">string</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="p">{</span>\n  <span class="o">&lt;</span><span class="nx">K</span> <span class="kd">extends</span> <span class="nx">PickKeyWithPayload</span><span class="o">&lt;</span><span class="nx">Actions</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="na">type</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">Payload</span><span class="o">&lt;</span><span class="nx">Actions</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">ReturnType</span><span class="o">&lt;</span><span class="nx">Actions</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>\n  <span class="o">&lt;</span><span class="nx">K</span> <span class="kd">extends</span> <span class="nx">PickKeyWithoutPayload</span><span class="o">&lt;</span><span class="nx">Actions</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="na">type</span><span class="p">:</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">payload</span><span class="p">?:</span> <span class="nx">Payload</span><span class="o">&lt;</span><span class="nx">Actions</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">ReturnType</span><span class="o">&lt;</span><span class="nx">Actions</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span><span class="o">&gt;</span><span class="p">;</span>\n<span class="p">};</span>\n</code></pre></div></div>\n\n<p><code>PickKeyWithPayload</code>の<code>{ [K in keyof P]: P[K] extends (context: any) =&gt; any ? undefined : K }</code>の部分では、Payloadが存在しない可能性が<strong>ない</strong>メソッド（逆説的ですが）がある場合のみキーと同じ値が値となってオブジェクトを返します。</p>\n\n<div class="code-frame" data-lang="ts"><div class="highlight"><pre class="with-code"><code><span class="c1">// Valuesしない版</span>\n<span class="kd">type</span> <span class="nx">PickKeyWithPayload</span><span class="o">&lt;</span><span class="nx">P</span> <span class="kd">extends</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="nx">P</span> <span class="kd">extends</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="p">(...</span><span class="nx">args</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span><span class="o">&gt;</span>\n  <span class="p">?</span> <span class="p">{</span>\n      <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="kr">keyof</span> <span class="nx">P</span><span class="p">]:</span> <span class="nx">P</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span> <span class="kd">extends</span> <span class="p">(</span><span class="na">context</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span> <span class="p">?</span> <span class="kc">undefined</span> <span class="p">:</span> <span class="nx">K</span>\n    <span class="p">}</span>\n  <span class="p">:</span> <span class="nx">never</span><span class="p">;</span>\n\n<span class="kd">type</span> <span class="nx">KeyObj</span> <span class="o">=</span> <span class="nx">PickKeyWithPayload</span><span class="o">&lt;</span><span class="k">typeof</span> <span class="nx">actions</span><span class="o">&gt;</span><span class="p">;</span>\n<span class="c1">// { login: "login", joinRoom: undefined, leaveRoom: undefined }</span>\n\n<span class="kd">type</span> <span class="nx">Keys</span> <span class="o">=</span> <span class="nx">Values</span><span class="o">&lt;</span><span class="nx">KeyObj</span><span class="o">&gt;</span><span class="p">;</span> <span class="c1">// "login"</span>\n</code></pre></div></div>\n\n<p><code>PickKeyWithoutPayload</code>も挙動としては同様で、Payloadが存在しない可能性があるメソッドのキーのみをピックアップしています。</p>\n\n<p>もっとスマートなやり方あったら教えてほしい。</p>\n',body:"TypeScriptって魔法ではなく「手法」さえ覚えれば自作するのも夢じゃない。\n\n> 気合の入った成果物： [@lollipop-onl/vuex-typesafe-helper](https://www.npmjs.com/package/@lollipop-onl/vuex-typesafe-helper)\n\n（微妙に実装不備アリ）\n\n# Demo\n\nTypeScript Playgroundで動作を確認できます。\n\n[Demo](http://www.typescriptlang.org/play/#src=const%20actions%20%3D%20%7B%0D%0A%20%20%20%20async%20login(%7B%20commit%20%7D%2C%20payload%3A%20%7B%20id%3A%20string%2C%20password%3A%20string%20%7D)%3A%20Promise%3Cvoid%3E%20%7B%20%7D%2C%0D%0A%20%20%20%20async%20joinRoom(%7B%20commit%20%7D%2C%20payload%3A%20%7B%20roomId%3A%20string%20%7D)%3A%20Promise%3Cvoid%3E%20%7B%20%7D%2C%0D%0A%20%20%20%20async%20leaveRoom(%7B%20commit%20%7D%2C%20payload%3A%20%7B%7D)%3A%20Promise%3Cvoid%3E%20%7B%20%7D%0D%0A%7D%3B%0D%0A%0D%0Atype%20BaseStoreModule%20%3D%20Record%3Cstring%2C%20(...args%3A%20any%5B%5D)%20%3D%3E%20any%3E%3B%0D%0Atype%20Payload%3CF%20extends%20(...args%3A%20any)%20%3D%3E%20any%3E%20%3D%20F%20extends%20(ctx%2C%20payload%3A%20infer%20P)%20%3D%3E%20any%0D%0A%20%20%3F%20P%0D%0A%20%20%3A%20never%3B%0D%0Atype%20DefineActions%3CActions%20extends%20BaseStoreModule%3E%20%3D%20%7B%0D%0A%20%20%3CK%20extends%20keyof%20Actions%3E(type%3A%20K%2C%20payload%3A%20Payload%3CActions%5BK%5D%3E)%3A%20ReturnType%3CActions%5BK%5D%3E%3B%0D%0A%7D%3B%0D%0A%0D%0Atype%20Dispatch%20%3D%20DefineActions%3Ctypeof%20actions%3E%3B%0D%0A%0D%0Adeclare%20var%20dispatch%3A%20Dispatch%3B%0D%0A%0D%0Adispatch('login'%2C%20%7B%20id%3A%20'simochee'%2C%20password%3A%20'abcd1234'%20%7D)%3B%0D%0Adispatch('logout'%2C%20%7B%7D)%3B%0D%0Adispatch('joinRoom'%2C%20%7B%20roomId%3A%20100%20%7D)%3B%0D%0A)\n\n# 開発環境\n\nIDE (VS Code)\n\n# デバッグ方法\n\nIDEでの型推論\n\n```ts\ndeclare var dispatch: Dispatch;\n\ndispatch('login', { id: 'simochee', password: 'abcd1234' });\n```\n\n# VuexのActionをタイプセーフにする\n\n## やりたいこと\n\n```ts\n// store/chat.ts\nconst actions = {\n  login({ commit }, payload: { id: string, password: string }): Promise<boolean> {},\n  joinRoom({ commit }, payload: { roomId: string }): Promise<void> {},\n  leaveRoom({ commit }, payload: {}): Promise<void>\n};\n\ntype Dispatch = DefineAction<typeof actions, {\n  'chat/login': 'login',\n  'chat/joinRoom': 'joinRoom',\n  'chat/leaveRoom': 'leaveRoom'\n}>;\n```\n\nと定義したものを\n\n```ts\ndispatch('chat/login', { id: 'simochee', password: 'abcd1234' }); // returns Promise<boolean>\ndispatch('chat/joinRoom', { }); // payload error!\ndispatch('chat/leave'); // action name type error!\n```\n\nみたく使えるよう正しいアクション名にマッピングするような`DefineActions`の定義を行う。\n\n## 実装方針\n\n```ts\ntype Dispatch= DefineAction<typeof actions, {\n  'login': 'chat/login',\n  'joinRoom': 'chat/joinRoom',\n  'leaveRoom': 'chat/leaveRoom'\n};\n```\n\nジェネリクスでアクションオブジェクトの型とマッピングするイベント名のペアを渡す。\n\n##### ジェネリック\n\n関数の型（超適当）\n\n```ts\n// 基本的には <> の中に名前を入れていく\ntype PickValue<Obj, Key> = Obj[Key];\n// extends を使うとジェネリックの型を指定できる\ntype PickValue<Obj extends object, Key extends string> = Obj[Key];\n// = を使うと初期値を設定できる。ただし、型は確定しない\n// 初期値が設定されている場合のみ、ジェネリックの指定を省略できる\ntype PickValue<Obj extends object, Key = 'default'> = Obj[Key];\n```\n\n##### typeof\n\nJavaScriptの世界の値を型の世界の値に変換する。\nただし、JavaScriptでの`typeof`とはちょっと挙動が違う。\n\n```ts\nconst obj1 = { hello: 'world' };\nconst obj2: object = { hello: 'world' };\n\nconst objType2 = typeof obj1; // Object\nconst objType2 = typeof obj2; // Object\n\ntype ObjType1 = typeof obj; // { 'hello': 'world' };\n type ObjType2 = typeof obj; // object\n```\n\n## Step 1. ベースの型を作る\n\n```ts\nlogin(context, payload): Promise<void>;\n↓\ndispatch('login', payload): Promise<void>;\n```\n\n```ts\ntype BaseStoreModule = Record<string, (...args: any[]) => any)>;\ntype DefineActions<Actions extends BaseStoreModule, P extends Record<string, string>> = {};\n```\n\n##### Record\n\nオブジェクトのキーと値の型を定義する。`{ [key: string]: string }`と`Record<string, string>`は同義。\n\n## Step 2. アクション名をdispatchにマッピングする\n\n```ts\ntype DefineActions<Actions extends BaseStoreModule, P extends Record<string, string>> = {\n  <K extends keyof Actions>(type: K): ReturnType<Actions[K]>;\n};\n```\n\n##### keyof A\n\nオブジェクトAのキーを取り出す。\n上記の場合、`type: K`は`keyof Actions`を継承しているので`login`、`joinRoom`または`leaveRoom`のいずれかとなる。\n\n##### ReturnType\n\n関数の返り値を返す。\n\n## Step 3. アクションからペイロードを取り出す\n\n```ts\nexport type Payload<F extends (...args: any) => any> = F extends (ctx, payload: infer P) => any\n  ? P\n  : never;\n```\n\n##### A extends B ? C : D\n\n型の三項演算子。\n\n##### infer P\n\n暫定的な型を使い回せるようにする。ただし、extendsの条件部に仕込む必要があり、型は二項目でのみ参照できる。\n\n## Step 4. PayloadをDispatchの引数として指定する\n\n```ts\ntype DefineActions<Actions extends BaseStoreModule, P extends Record<string, string>> = {\n  <K extends keyof Actions>(type: K, payload: Payload<Actions[K]>): ReturnType<Actions[K]>;\n};\n```\n\n## Step 5. Namespace付きのアクション名にマッピングする\n\nいまのところ、`dispatch('login', payload)`となっているので、`dispatch('chat/login', payload)`となるようにアクション名をマッピングする。\n\n```ts\ntype MapActions<A extends Record<string, any>, P extends Record<string, string>> = {\n  [K in keyof A]: A[P[K]];\n};\n```\n\n##### [K in keyof P]: ...\n\n`P`のキーでマッピングを行う。`Array.map`的な。\n\n```ts\n// ObjのすべてのプロパティをString型にする\ntype Obj = { hello: string, world: number };\ntype StrObj = {\n  [K in keyof Obj]: string;\n};\n```\n\n## Step X. Payloadの未指定に対応する\n\nPayloadを省略可能にしようとするととたんに実装がめんどくさくなる。\n\n### Before\n\n```ts\n// ペイロードがあるプロパティのキーを取り出す\ntype DefineActions<Actions extends BaseStoreModule, P extends Record<string, string>> = {\n  <K extends keyof Actions>(type: K, payload: Payload<Actions[K]>): ReturnType<Actions[K]>;\n};\n```\n\n### After\n\n```ts\n// オブジェクトの値を返す型\ntype Values<P extends Record<any, any>> = P extends { [key: any]: infer V } ? V : never;\n```\n\n```ts\n// ペイロードのあるプロパティのキーを取り出す\ntype PickKeyWithPayload<P extends Record<string, (...args: any)>> = P extends Record<string, (...args: any) => any>\n  ? Values<{\n      [K in keyof P]: P[K] extends (context: any) => any ? undefined : K\n    }>\n  : never;\n```\n\n```ts\n// ペイロードがない or オプショナルなプロパティのキーを取り出す\ntype PickKeyWithoutPayload<P> = P extends Record<string, (...args: any) => any>\n  ? Values<{\n      [K in keyof P]: P[K] extends (context: any) => any ? K : undefined\n    }>\n  : never;\n```\n\n```ts\ntype DefineActions<Actions extends BaseStoreModule, P extends Record<string, string>> = {\n  <K extends PickKeyWithPayload<Actions>>(type: K, payload: Payload<Actions[K]>): ReturnType<Actions[K]>;\n  <K extends PickKeyWithoutPayload<Actions>>(type: K, payload?: Payload<Actions[K]>): ReturnType<Actions[K]>;\n};\n```\n\n`PickKeyWithPayload`の`{ [K in keyof P]: P[K] extends (context: any) => any ? undefined : K }`の部分では、Payloadが存在しない可能性が**ない**メソッド（逆説的ですが）がある場合のみキーと同じ値が値となってオブジェクトを返します。\n\n```ts\n// Valuesしない版\ntype PickKeyWithPayload<P extends Record<string, (...args: any)>> = P extends Record<string, (...args: any) => any>\n  ? {\n      [K in keyof P]: P[K] extends (context: any) => any ? undefined : K\n    }\n  : never;\n\ntype KeyObj = PickKeyWithPayload<typeof actions>;\n// { login: \"login\", joinRoom: undefined, leaveRoom: undefined }\n\ntype Keys = Values<KeyObj>; // \"login\"\n```\n\n`PickKeyWithoutPayload`も挙動としては同様で、Payloadが存在しない可能性があるメソッドのキーのみをピックアップしています。\n\nもっとスマートなやり方あったら教えてほしい。\n",coediting:a,comments_count:0,created_at:"2019-06-02T22:18:23+09:00",group:s,id:"fa667a33c118766ee55a",likes_count:11,private:a,reactions_count:0,tags:[{name:f,versions:[]},{name:"Vuex",versions:[]}],title:"TypeScriptでVuexの型ユーティリティを作ろう",updated_at:"2019-06-05T13:31:59+09:00",url:"https://qiita.com/simochee/items/fa667a33c118766ee55a",user:{description:e,facebook_id:n,followees_count:c,followers_count:p,github_login_name:l,id:t,items_count:p,linkedin_id:n,location:o,name:i,organization:d,permanent_id:r,profile_image_url:u,team_only:a,twitter_screen_name:m,website_url:g},page_views_count:s,team_membership:s}],npmPackages:[{package:{name:"@lollipop-onl/vue-typed-reactive",scope:h,version:"1.1.3",description:"Provide type-safe Vue.set/Vue.delete mehtods",keywords:[P,"vue"],date:"2021-02-25T22:07:01.630Z",links:{npm:"https://www.npmjs.com/package/%40lollipop-onl%2Fvue-typed-reactive",homepage:j,repository:j,bugs:"https://github.com/lollipop-onl/vue-typed-reactive/issues"},author:{name:b},publisher:{username:h,email:x},maintainers:[{username:h,email:x}]},score:{final:.28072076394800105,detail:{quality:.5214663771381608,popularity:.02275928020137229,maintenance:.3323288649602072}},searchScore:5.9527054e-8},{package:{name:"@lollipop-onl/axios-logger",scope:h,version:"0.2.3",description:"Pretty Axios logger",keywords:["axios"],date:"2021-06-21T05:20:34.754Z",links:{npm:"https://www.npmjs.com/package/%40lollipop-onl%2Faxios-logger",homepage:"https://gitlab.com/lollipop.onl/axios-logger#readme",repository:"https://gitlab.com/lollipop.onl/axios-logger",bugs:"https://gitlab.com/lollipop.onl/axios-logger/issues"},author:{name:b},publisher:{username:h,email:x},maintainers:[{username:h,email:x}]},flags:{unstable:!0},score:{final:.25843245852454744,detail:{quality:.447374368421143,popularity:.021760691324579844,maintenance:.33315401724171884}},searchScore:1.911556e-8},{package:{name:"@lollipop-onl/vuekey",scope:h,version:"0.1.1",description:"`vuekey` is a library of typesafe data path for [`@Watch`](https://github.com/kaorun343/vue-property-decorator#Watch) and `vm.set`.",keywords:["vue",P],date:"2019-07-05T07:08:34.747Z",links:{npm:"https://www.npmjs.com/package/%40lollipop-onl%2Fvuekey",homepage:"https://gitlab.com/lollipop.onl/vuekey#readme",repository:"https://gitlab.com/lollipop.onl/vuekey",bugs:"https://gitlab.com/lollipop.onl/vuekey/issues"},author:{name:b},publisher:{username:h,email:x},maintainers:[{username:h,email:x}]},flags:{unstable:!0},score:{final:.1199254146363335,detail:{quality:.3957439499937915,popularity:.003434941823417269,maintenance:0}},searchScore:7306339e-19}],publishedAt:"2021/09/28"}],error:s,serverRendered:!0}}(null,!1,"",36,"Nuxt & TypeScript大好きマンです",10,"tamuraryoya","simochee","Chiba, Japan","Ryoya Tamura","チームラボ株式会社",127934,"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/127934/profile-images/1558357993","lollipop_onl","https://www.lollipop.onl","TypeScript","lollipop-onl","npm@lollipop.onl","Vue.js","nuxt.js","lollipop.onl","JavaScript","2020-04-29T19:23:23+09:00","2020-03-13T23:36:05+09:00","2020-01-23T22:47:35+09:00","2020-01-10T16:55:06+09:00","2019-11-14T01:02:12+09:00","2019-10-17T21:35:57+09:00","2019-09-12T10:12:34+09:00","2019-07-05T21:43:22+09:00","vue-property-decorator","typescript","https://github.com/lollipop-onl/vue-typed-reactive")</script><script src="/_nuxt/155dd73f6b0b2b931a90.js" defer></script><script src="/_nuxt/c964435de51fda9f2a43.js" defer></script><script src="/_nuxt/ef8eb22d59ee9fe25327.js" defer></script><script src="/_nuxt/22a5f94eeb032400948e.js" defer></script>
  </body>
</html>
